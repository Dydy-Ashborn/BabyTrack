<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>BabyTrack</title>

    <!-- PWA Configuration -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#3B82F6">

    <!-- Favicons -->
    <link rel="icon" type="image/png" href="logo.PNG">

    <!-- Apple iOS Configuration -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BabyTrack">
    <link rel="apple-touch-icon" sizes="152x152" href="logo.PNG">
    <link rel="apple-touch-icon" sizes="180x180" href="logo.PNG">
    <link rel="apple-touch-icon" sizes="192x192" href="logo.PNG">

    <!-- Mobile Web App -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">

    <!-- Scripts et styles -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/heic2any@0.0.4/dist/heic2any.min.js"></script>
    <!-- CDN jsPDF + html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        .animate-in {
            animation: slideIn 0.3s ease-out forwards;
            opacity: 0;
            transform: translate(-50%, 0) scale(0.8);
        }

        @keyframes slideIn {
            to {
                opacity: 1;
                transform: translate(-50%, 0) scale(1);
            }
        }

        body {
            overscroll-behavior: none;
            -ms-overflow-style: none;
            scrollbar-width: none;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        body::-webkit-scrollbar {
            display: none;
        }

        .glass {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.7);
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .pulse-gentle {
            animation: pulse-gentle 2s ease-in-out infinite;
        }

        @keyframes pulse-gentle {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        .medication-available {
            border-color: #10b981;
            background-color: #f0fdf4;
        }

        .medication-waiting {
            border-color: #f59e0b;
            background-color: #fffbeb;
        }

        .medication-soon {
            border-color: #ef4444;
            background-color: #fef2f2;
        }

        .appointment-today {
            border-color: #ef4444;
            background-color: #fef2f2;
        }

        .appointment-upcoming {
            border-color: #f59e0b;
            background-color: #fffbeb;
        }

        /* Animations pour les accomplissements */
        @keyframes float-gentle {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-8px);
            }
        }

        @keyframes rotate-slow {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        @keyframes shake-head {

            0%,
            100% {
                transform: rotate(0deg);
            }

            25% {
                transform: rotate(-5deg);
            }

            75% {
                transform: rotate(5deg);
            }
        }

        @keyframes bounce-gentle {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-5px);
            }
        }

        @keyframes pulse-soft {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        @keyframes swing {

            0%,
            100% {
                transform: rotate(0deg);
            }

            25% {
                transform: rotate(10deg);
            }

            75% {
                transform: rotate(-10deg);
            }
        }

        @keyframes slide-lr {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-5px);
            }

            75% {
                transform: translateX(5px);
            }
        }

        @keyframes peek-a-boo {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.3;
                transform: scale(0.8);
            }
        }

        .accomplishment-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
        }

        /* Bloquer le scroll du body quand modal ouvert */
        body.modal-open {
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }
    </style>

    <!-- Logo BabyTrack en SVG -->
    <svg id="babytrack-logo" style="display: none;">
        <defs>
            <symbol id="logo-symbol" viewBox="0 0 200 120">
                <!-- Montre/cadre -->
                <rect x="20" y="30" width="100" height="60" rx="20" ry="20" fill="url(#gradient1)" stroke="#2563eb"
                    stroke-width="4" />
                <rect x="25" y="35" width="90" height="50" rx="15" ry="15" fill="white" />

                <!-- Visage b√©b√© -->
                <circle cx="70" cy="60" r="20" fill="white" stroke="#2563eb" stroke-width="3" />
                <path d="M70 45 Q75 40, 80 45" fill="none" stroke="#2563eb" stroke-width="2" stroke-linecap="round" />
                <circle cx="65" cy="55" r="2" fill="#2563eb" />
                <circle cx="75" cy="55" r="2" fill="#2563eb" />
                <path d="M65 65 Q70 70, 75 65" fill="none" stroke="#2563eb" stroke-width="2" stroke-linecap="round" />

                <!-- Bracelet -->
                <rect x="10" y="45" width="15" height="30" rx="7" ry="7" fill="url(#gradient2)" />
                <rect x="115" y="45" width="15" height="30" rx="7" ry="7" fill="url(#gradient2)" />

                <!-- Gradients -->
                <defs>
                    <linearGradient id="gradient1" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#8b5cf6;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="gradient2" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#ec4899;stop-opacity:1" />
                    </linearGradient>
                </defs>
            </symbol>
        </defs>
    </svg>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        // Protection contre les erreurs externes
        window.addEventListener('error', function (e) {
            if (e.filename && e.filename.includes('page-events.js')) {
                e.preventDefault();
                return true;
            }
        });
        const { useState, useEffect, useRef } = React;

        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCPQpB3cYk2sgbOVQ8KLbU1Qj2U67D2rZ4",
            authDomain: "suivi-loan.firebaseapp.com",
            projectId: "suivi-loan",
            storageBucket: "suivi-loan.firebasestorage.app",
            messagingSenderId: "334984699415",
            appId: "1:334984699415:web:8b41abb9360d31efabc652"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();




        const BabyTracker = () => {
            // √âtats principaux
            const [user, setUser] = useState(null);
            const [entries, setEntries] = useState([]);
            const [stocks, setStocks] = useState({});
            // √âtat pour le suivi du poids
            const [currentWeight, setCurrentWeight] = useState(null);
            const [lastWeightUpdate, setLastWeightUpdate] = useState(null);
            // √âtat pour le suivi de la diversification alimentaire
            const [diversificationEntries, setDiversificationEntries] = useState([]);
            const [diversificationData, setDiversificationData] = useState({
                category: '',
                food: '',
                quantity: '',
                reaction: '',
                notes: ''
            });
            const [isMixMode, setIsMixMode] = useState(false);
            const [mixFoods, setMixFoods] = useState([]); // Les aliments du mix
            const [mixNewFood, setMixNewFood] = useState(''); // Le nouvel aliment √† tester
            const [mixNewFoodCategory, setMixNewFoodCategory] = useState('');
            const [diversificationSearch, setDiversificationSearch] = useState('');
            const [diversificationSort, setDiversificationSort] = useState('recent');
            const [diversificationPage, setDiversificationPage] = useState(0);
            const [diversificationLastDoc, setDiversificationLastDoc] = useState(null);
            const [diversificationHasMore, setDiversificationHasMore] = useState(true);
            const [diversificationLoading, setDiversificationLoading] = useState(false);
            const ITEMS_PER_PAGE = 10;

            const [wardrobe, setWardrobe] = useState([]);
            const [wardrobeData, setWardrobeData] = useState({
                type: '',
                size: '',
                quantity: 1,
                color: '',
                notes: ''
            });
            const [wardrobePage, setWardrobePage] = useState(0);
            const [wardrobeLastDoc, setWardrobeLastDoc] = useState(null);
            const [wardrobeHasMore, setWardrobeHasMore] = useState(true);
            const [wardrobeLoading, setWardrobeLoading] = useState(false);
            const WARDROBE_ITEMS_PER_PAGE = 20; // 20 articles par page
            // √âtats pour le suivi du sommeil
            const [sleepSessions, setSleepSessions] = useState([]);
            const [currentSleep, setCurrentSleep] = useState(null); // Session en cours
            const [sleepData, setSleepData] = useState({
                startTime: '',
                endTime: '',
                date: new Date().toISOString().slice(0, 10)
            });
            // √âtat pour le suivi de la croissance
            const [currentHeight, setCurrentHeight] = useState(null);
            const [lastHeightUpdate, setLastHeightUpdate] = useState(null);

            // √âtats d'interface
            const [showAuth, setShowAuth] = useState(true);
            const [authMode, setAuthMode] = useState('login');
            const [currentView, setCurrentView] = useState('daily');
            const [periodView, setPeriodView] = useState('daily');
            const [showForm, setShowForm] = useState(false);
            const [formType, setFormType] = useState('');
            const [editingId, setEditingId] = useState(null);
            const [currentPage, setCurrentPage] = useState(0);
            const [historyFilter, setHistoryFilter] = useState('today');
            const [tipsExpanded, setTipsExpanded] = useState(0);
            const [showMoreMenu, setShowMoreMenu] = useState(false);
            const [showPlusMenu, setShowPlusMenu] = useState(false);
            const [editingWardrobeId, setEditingWardrobeId] = useState(null);
            const [editingSleepId, setEditingSleepId] = useState(null);
            // √âtats des formulaires
            const [authData, setAuthData] = useState({
                code: '',
                babyName: '',
                birthDate: '',
                birthTime: '06:00',
                birthWeight: '',
                birthHeight: '',
                parents: '',
                gender: 'boy'
            });

            const [formData, setFormData] = useState({
                time: '',
                date: '',
                amount: '',
                hasPee: false,
                hasPoop: false,
                poopQuantity: '',
                poopConsistency: '',
                poopColor: ''
            });

            // Etats pour les p√©diatres et h√¥pitaux
            const [showExportMenu, setShowExportMenu] = useState(false);
            const [exportPeriod, setExportPeriod] = useState('week');
            const [isExporting, setIsExporting] = useState(false);

            //Etats pour les graphiques sommeil
            const [sleepPeriodView, setSleepPeriodView] = useState('week');
            const sleepChartRef = useRef(null);
            const sleepChartInstance = useRef(null);

            // √âtats pour les notifications
            const [notificationPermission, setNotificationPermission] = useState('default');
            const [activeNotifications, setActiveNotifications] = useState([]);
            // Ajoutez ceci avec vos autres d√©clarations useState
            const [scheduledNotifications, setScheduledNotifications] = useState(new Map());
            // √âtats pour l'intervalle personnalis√© des biberons
            const [feedingInterval, setFeedingInterval] = useState(3); // 3 heures par d√©faut
            const [nextFeedingInfo, setNextFeedingInfo] = useState(null);



            // √âtats pour le profil et param√®tres
            const [showProfileSettings, setShowProfileSettings] = useState(false);
            const [appSettings, setAppSettings] = useState({
                darkMode: false,
                notifications: true,
                autoBackup: true
            });
            // √âtats pour l'allaitement
            const [breastfeedingSession, setBreastfeedingSession] = useState(null);
            const [breastfeedingEntries, setBreastfeedingEntries] = useState([]);
            const [breastfeedingData, setBreastfeedingData] = useState({
                breast: 'left', // left, right, both
                duration: '',
                notes: ''
            });

            // √âtats pour le tire-lait  
            const [breastPumpEntries, setBreastPumpEntries] = useState([]);
            const [breastPumpData, setBreastPumpData] = useState({
                volume: '',
                duration: '',
                storage: 'fridge', // fridge, freezer, immediate
                notes: ''
            });
            const [showBreastfeedingModal, setShowBreastfeedingModal] = useState(false);
            const [showBreastPumpModal, setShowBreastPumpModal] = useState(false);


            // √âtats pour les analytics
            const [analyticsFilter, setAnalyticsFilter] = useState(['feeding', 'diaper-pee']);
            const [analyticsPeriod, setAnalyticsPeriod] = useState('weekly');

            // √âtats pour les accomplissements
            const [accomplishments, setAccomplishments] = useState({});
            const [showAccomplishments, setShowAccomplishments] = useState(false);
            const [selectedMilestone, setSelectedMilestone] = useState(null);
            const [selectedCategory, setSelectedCategory] = useState('movement');
            const [currentMilestoneAge, setCurrentMilestoneAge] = useState('2months');

            const [showWeightModal, setShowWeightModal] = useState(false);
            const [showHeightModal, setShowHeightModal] = useState(false);
            const [weightInput, setWeightInput] = useState('');
            const [heightInput, setHeightInput] = useState('');

            const [showSleepModal, setShowSleepModal] = useState(false);

            const [showFoodModal, setShowFoodModal] = useState(false);
            const [showWardrobeModal, setShowWardrobeModal] = useState(false);

            const [showMilkStockModal, setShowMilkStockModal] = useState(false);
            const [showWaterStockModal, setShowWaterStockModal] = useState(false);
            const [milkDateInput, setMilkDateInput] = useState('');
            const [waterDateTimeInput, setWaterDateTimeInput] = useState('');

            const [showUpdatePopup, setShowUpdatePopup] = useState(false);
            const [showPWAPopup, setShowPWAPopup] = useState(false);
            const [pwaPopupType, setPwaPopupType] = useState(''); // 'suggest' ou 'instructions'

            // Donn√©es des accomplissements par √¢ge et cat√©gorie
            const accomplishmentData = {
                '2months': {
                    movement: [
                        'Tient la t√™te haute lorsque {babyName} est sur le ventre',
                        'Bouge les bras et les jambes de fa√ßon sym√©trique',
                        'Commence √† tenir sa t√™te droite quand on le porte'
                    ],
                    cognitive: [
                        'Suit des objets des yeux',
                        'R√©agit aux sons forts',
                        'Commence √† sourire en r√©ponse'
                    ],
                    language: [
                        'Fait des sons de gorge (ah, eh, oh)',
                        'Pleure diff√©remment selon ses besoins',
                        '√âcoute quand on lui parle'
                    ],
                    social: [
                        'Sourit en r√©ponse aux autres',
                        'Regarde les visages avec int√©r√™t',
                        'Se calme quand on lui parle doucement'
                    ]
                },
                '4months': {
                    movement: [
                        'Tient sa t√™te stable sans support',
                        'Se retourne du ventre vers le dos',
                        'Porte ses mains √† sa bouche'
                    ],
                    cognitive: [
                        'Reconna√Æt les visages familiers',
                        'Suit les objets en mouvement',
                        'Montre de la curiosit√© pour son environnement'
                    ],
                    language: [
                        'Babille avec des sons vari√©s',
                        'Rit aux √©clats',
                        'R√©pond quand on lui parle'
                    ],
                    social: [
                        'Sourit spontan√©ment',
                        'Aime jouer avec les autres',
                        'Exprime la joie et la contrari√©t√©'
                    ]
                },
                '6months': {
                    movement: [
                        'S\'assoit avec un support',
                        'Se retourne dans les deux sens',
                        'Transf√®re des objets d\'une main √† l\'autre'
                    ],
                    cognitive: [
                        'Explore les objets avec sa bouche',
                        'Montre de l\'int√©r√™t pour les images',
                        'Commence √† comprendre cause et effet'
                    ],
                    language: [
                        'Babille avec des consonnes (ma, ba, da)',
                        'R√©pond √† son nom',
                        'Fait des bruits pour attirer l\'attention'
                    ],
                    social: [
                        'Reconna√Æt les personnes famili√®res',
                        'Aime regarder son reflet',
                        'Distingue les √©motions dans les voix'
                    ]
                },
                '9months': {
                    movement: [
                        'S\'assoit sans support',
                        'Rampe ou se d√©place au sol',
                        'Se tient debout avec aide'
                    ],
                    cognitive: [
                        'Cherche les objets cach√©s',
                        'Comprend la permanence des objets',
                        'Imite les actions simples'
                    ],
                    language: [
                        'Dit "mama" ou "papa" sans signification pr√©cise',
                        'Comprend des mots simples',
                        'Utilise des gestes pour communiquer'
                    ],
                    social: [
                        'Montre de l\'anxi√©t√© face aux √©trangers',
                        'Pr√©f√®re les personnes famili√®res',
                        'Joue √† des jeux simples comme "coucou"'
                    ]
                }
            };
            // Ref pour le graphique principal
            const analyticsChartRef = useRef(null);
            const analyticsChartInstance = useRef(null);
            // Refs pour les graphiques analytics
            const feedingChartRef = useRef(null);
            const diaperChartRef = useRef(null);
            const breastfeedingChartRef = useRef(null);
            const sleepAnalyticsChartRef = useRef(null);
            const foodChartRef = useRef(null);

            // Instances des graphiques
            const feedingChartInstance = useRef(null);
            const diaperChartInstance = useRef(null);
            const breastfeedingChartInstance = useRef(null);
            const sleepAnalyticsChartInstance = useRef(null);
            const foodChartInstance = useRef(null);

            const [isLoading, setIsLoading] = useState(true);

            // √âtats pour le d√©blocage des accomplissements
            const [showMilestoneUnlock, setShowMilestoneUnlock] = useState(false);
            const [unlockedMilestone, setUnlockedMilestone] = useState(null);
            // Demander la permission pour les notifications
            const requestNotificationPermission = async () => {
                if ('Notification' in window) {
                    const permission = await Notification.requestPermission();
                    setNotificationPermission(permission);
                    if (permission === 'granted') {
                        scheduleAllNotifications();
                    }
                    return permission === 'granted';
                }
                return false;
            };

            const scheduleAllNotifications = () => {
                if (notificationPermission !== 'granted') return;


                // Effacer les anciennes notifications
                clearAllNotifications();



            };

            // Envoyer une notification imm√©diate
            const sendNotification = (title, body) => {
                if (notificationPermission === 'granted' && 'Notification' in window) {
                    const notification = new Notification(title, {
                        body,
                        icon: 'logo.PNG',
                        badge: 'logo.PNG',
                        requireInteraction: false
                    });

                    notification.onclick = () => {
                        window.focus();
                        notification.close();
                    };

                    return notification;
                }
            };

            // Programmer une notification avec setTimeout
            const scheduleNotification = (title, body, delayMinutes, uniqueKey) => {
                if (notificationPermission !== 'granted') return null;

                // Annuler l'ancienne notification si elle existe
                if (scheduledNotifications.has(uniqueKey)) {
                    clearTimeout(scheduledNotifications.get(uniqueKey));
                }

                // Programmer la nouvelle notification
                const timeoutId = setTimeout(() => {
                    sendNotification(title, body);
                    // Nettoyer la r√©f√©rence
                    setScheduledNotifications(prev => {
                        const newMap = new Map(prev);
                        newMap.delete(uniqueKey);
                        return newMap;
                    });
                }, delayMinutes * 60 * 1000);

                // Stocker la r√©f√©rence
                setScheduledNotifications(prev => {
                    const newMap = new Map(prev);
                    newMap.set(uniqueKey, timeoutId);
                    return newMap;
                });

                return timeoutId;
            };

            // Annuler toutes les notifications
            const clearAllNotifications = () => {
                scheduledNotifications.forEach((timeoutId) => {
                    clearTimeout(timeoutId);
                });
                setScheduledNotifications(new Map());
            };// Notifications pour biberon
            const scheduleNextFeedingNotification = () => {
                if (notificationPermission !== 'granted') return;

                if (!nextFeedingInfo) return;

                const now = new Date();
                const timeDiff = nextFeedingInfo.nextTime - now; const minutesUntilFeeding = Math.ceil(timeDiff / (1000 * 60));

                // Seulement si c'est dans les prochaines 8 heures et pas d√©j√† pass√©
                if (minutesUntilFeeding > 0 && minutesUntilFeeding <= 480) {
                    scheduleNotification(
                        'üçº C\'est l\'heure du biberon !',
                        `Il est temps de donner le biberon √† ${user?.babyName}`,
                        minutesUntilFeeding,
                        'next-feeding'
                    );
                }
            };

            const chartRef = useRef(null);
            const chartInstance = useRef(null);

            // Fonctions utilitaires
            const generateCode = () => Math.random().toString(36).substring(2, 8).toUpperCase();
            const getCurrentTime = () => new Date().toTimeString().slice(0, 5);
            const getCurrentDate = () => {
                const now = new Date();
                return now.toLocaleDateString('sv-SE'); // Format YYYY-MM-DD en heure locale
            };


            const calculateAge = () => {
                if (!user) return 0;
                const birth = new Date(user.birthDate);
                birth.setHours(0, 0, 0, 0); // R√©initialiser √† minuit
                const today = new Date();
                today.setHours(0, 0, 0, 0); // R√©initialiser √† minuit

                const diffTime = today - birth;
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

                return diffDays;
            };

            const formatAgeDisplay = (ageInDays) => {
                if (ageInDays <= 30) {
                    return `Jour ${ageInDays}`;
                }

                const months = Math.floor(ageInDays / 30);
                const remainingDays = ageInDays % 30;

                if (remainingDays === 0) {
                    return `${months} mois`;
                } else {
                    return `${months} mois ${remainingDays}j`;
                }
            };

            const formatTime = (timestamp) => {
                return new Date(timestamp).toLocaleTimeString('fr-FR', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            };

            const formatDate = (timestamp) => {
                return new Date(timestamp).toLocaleDateString('fr-FR', {
                    weekday: 'long',
                    day: 'numeric',
                    month: 'long'
                });
            };
            // Fonction pour formater les dates des stocks
            const formatStockDate = (dateString) => {
                if (!dateString) return 'Non renseign√©e';

                try {
                    const date = new Date(dateString);
                    return date.toLocaleDateString('fr-FR', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric'
                    });
                } catch (error) {
                    return dateString; // Retourner la cha√Æne originale en cas d'erreur
                }
            };

            const formatStockDateTime = (datetimeString) => {
                if (!datetimeString) return 'Non renseign√©e';

                try {
                    const date = new Date(datetimeString);
                    return date.toLocaleString('fr-FR', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                } catch (error) {
                    return datetimeString; // Retourner la cha√Æne originale en cas d'erreur
                }
            };

            const formatDateTime = (timestamp) => {
                const date = new Date(timestamp);
                const today = new Date();
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);

                if (date.toDateString() === today.toDateString()) {
                    return formatTime(timestamp);
                } else if (date.toDateString() === yesterday.toDateString()) {
                    return `Hier ${formatTime(timestamp)}`;
                } else {
                    return `${date.getDate()}/${date.getMonth() + 1} ${formatTime(timestamp)}`;
                }
            };

            const getDayStart = (date) => {
                const dayStart = new Date(date);
                dayStart.setHours(0, 0, 0, 0);
                return dayStart;
            };

            const getDayEnd = (date) => {
                const dayEnd = new Date(date);
                dayEnd.setHours(23, 59, 59, 999);
                return dayEnd;
            };

            // Fonction pour les couleurs selon le sexe
            const getThemeColors = () => {
                return user?.gender === 'girl' ? {
                    primary: 'from-pink-500 to-pink-600',
                    primaryBg: 'bg-pink-500',
                    primaryText: 'text-pink-600',
                    primaryBorder: 'border-pink-200',
                    primaryHover: 'hover:bg-pink-50',
                    primaryLight: 'bg-pink-100',
                    primaryDark: 'text-pink-800'
                } : {
                    primary: 'from-blue-500 to-blue-600',
                    primaryBg: 'bg-blue-500',
                    primaryText: 'text-blue-600',
                    primaryBorder: 'border-blue-200',
                    primaryHover: 'hover:bg-blue-50',
                    primaryLight: 'bg-blue-100',
                    primaryDark: 'text-blue-800'
                };
            };



            // Calculs statistiques
            const getFilteredEntries = (period) => {
                const now = new Date();
                let startDate, endDate;

                switch (period) {
                    case 'daily':
                        startDate = getDayStart(now);
                        endDate = getDayEnd(now);
                        break;
                    case 'weekly':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 7);
                        endDate = new Date(now);
                        break;
                    case 'monthly':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 30);
                        endDate = new Date(now);
                        break;
                    default:
                        return [];
                }

                return entries.filter(entry => {
                    const entryDate = new Date(entry.timestamp);
                    return entryDate >= startDate && entryDate <= endDate;
                });
            };

            const getStats = (period) => {
                const now = new Date();
                let startDate, endDate;

                switch (period) {
                    case 'daily':
                        startDate = getDayStart(now);
                        endDate = getDayEnd(now);
                        break;
                    case 'weekly':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 7);
                        startDate.setHours(0, 0, 0, 0);
                        endDate = getDayEnd(now);
                        break;
                    case 'monthly':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 30);
                        startDate.setHours(0, 0, 0, 0);
                        endDate = getDayEnd(now);
                        break;
                    default:
                        return { totalMilk: 0, totalPees: 0, totalPoops: 0, feedingCount: 0 };
                }

                const filteredEntries = entries.filter(entry => {
                    const entryDate = new Date(entry.timestamp);
                    return entryDate >= startDate && entryDate <= endDate;
                });

                const feedings = filteredEntries.filter(entry => entry.type === 'feeding');
                const totalMilk = feedings.reduce((sum, entry) => sum + parseInt(entry.amount || 0), 0);
                const totalPees = filteredEntries.filter(entry => entry.hasPee).length;
                const totalPoops = filteredEntries.filter(entry => entry.hasPoop).length;

                return { totalMilk, totalPees, totalPoops, feedingCount: feedings.length };
            };
            // Fonctions pour les statistiques analytics
            const getFeedingStats = () => {
                const filtered = getFilteredEntries(analyticsPeriod);
                const feedings = filtered.filter(e => e.type === 'feeding');
                const total = feedings.reduce((sum, e) => sum + parseInt(e.amount || 0), 0);
                const count = feedings.length;
                const average = count > 0 ? Math.round(total / count) : 0;
                return { total, count, average };
            };

            const getDiaperStats = () => {
                const filtered = getFilteredEntries(analyticsPeriod);
                const pees = filtered.filter(e => e.hasPee).length;
                const poops = filtered.filter(e => e.hasPoop).length;
                const total = pees + poops;
                return { pees, poops, total };
            };
            const getBreastfeedingStatsForAnalytics = () => {
                const now = new Date();
                let startDate, endDate;

                switch (analyticsPeriod) {
                    case 'daily':
                        startDate = getDayStart(now);
                        endDate = getDayEnd(now);
                        break;
                    case 'weekly':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 6);
                        startDate.setHours(0, 0, 0, 0);
                        endDate = getDayEnd(now);
                        break;
                    case 'monthly':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 29);
                        startDate.setHours(0, 0, 0, 0);
                        endDate = getDayEnd(now);
                        break;
                }

                const filtered = breastfeedingEntries.filter(entry => {
                    const entryDate = new Date(entry.timestamp);
                    return entryDate >= startDate && entryDate <= endDate && entry.status === 'completed';
                });

                const sessions = filtered.length;
                const totalMinutes = filtered.reduce((sum, e) => sum + (e.duration || 0), 0);
                const averageMinutes = sessions > 0 ? Math.round(totalMinutes / sessions) : 0;
                return { sessions, totalMinutes, averageMinutes };
            };

            const getBreastPumpStatsForAnalytics = () => {
                const now = new Date();
                let startDate, endDate;

                switch (analyticsPeriod) {
                    case 'daily':
                        startDate = getDayStart(now);
                        endDate = getDayEnd(now);
                        break;
                    case 'weekly':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 6);
                        startDate.setHours(0, 0, 0, 0);
                        endDate = getDayEnd(now);
                        break;
                    case 'monthly':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 29);
                        startDate.setHours(0, 0, 0, 0);
                        endDate = getDayEnd(now);
                        break;
                }

                const filtered = breastPumpEntries.filter(entry => {
                    const entryDate = new Date(entry.timestamp);
                    return entryDate >= startDate && entryDate <= endDate;
                });

                const sessions = filtered.length;
                const totalVolume = filtered.reduce((sum, e) => sum + (e.volume || 0), 0);
                const averageVolume = sessions > 0 ? Math.round(totalVolume / sessions) : 0;
                return { sessions, totalVolume, averageVolume };
            };
            const getSleepStats = () => {
                const now = new Date();
                let startDate, endDate;

                switch (analyticsPeriod) {
                    case 'daily':
                        startDate = getDayStart(now);
                        endDate = getDayEnd(now);
                        break;
                    case 'weekly':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 6);
                        startDate.setHours(0, 0, 0, 0);
                        endDate = getDayEnd(now);
                        break;
                    case 'monthly':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 29);
                        startDate.setHours(0, 0, 0, 0);
                        endDate = getDayEnd(now);
                        break;
                }

                const filtered = sleepSessions.filter(session => {
                    const sessionDate = new Date(session.startTime);
                    return sessionDate >= startDate && sessionDate <= endDate && session.status === 'completed';
                });

                const sessions = filtered.length;
                const totalMinutes = filtered.reduce((sum, s) => sum + (s.duration || 0), 0);
                const totalHours = Math.round(totalMinutes / 60 * 10) / 10;
                const averageHours = sessions > 0 ? Math.round(totalMinutes / sessions / 60 * 10) / 10 : 0;
                return { sessions, totalHours, averageHours };
            };
            // Filtrage de l'historique avec pagination
            const getFilteredHistory = () => {
                const now = new Date();
                let startDate, endDate;

                switch (historyFilter) {
                    case 'today':
                        startDate = getDayStart(now);
                        endDate = getDayEnd(now);
                        break;
                    case 'yesterday':
                        const yesterday = new Date(now);
                        yesterday.setDate(yesterday.getDate() - 1);
                        startDate = getDayStart(yesterday);
                        endDate = getDayEnd(yesterday);
                        break;
                    case 'week':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 7);
                        startDate.setHours(0, 0, 0, 0);
                        endDate = getDayEnd(now);
                        break;
                    default:
                        startDate = new Date(0);
                        endDate = new Date();
                }

                // Fonction helper pour parser les timestamps correctement
                const parseTimestamp = (timestamp) => {
                    if (!timestamp) return null;

                    // Si le timestamp contient d√©j√† un fuseau horaire, l'utiliser tel quel
                    if (timestamp.includes('Z') || timestamp.includes('+') || timestamp.includes('-')) {
                        return new Date(timestamp);
                    }

                    // Sinon, le traiter comme heure locale
                    return new Date(timestamp);
                };

                // Fonction helper pour v√©rifier si une date est dans la plage
                const isInDateRange = (timestamp, start, end) => {
                    const date = parseTimestamp(timestamp);
                    if (!date || isNaN(date.getTime())) return false;
                    return date >= start && date <= end;
                };



                // Filtrer les entr√©es normales (biberon, couche)
                const filteredEntries = entries.filter(entry => {
                    const parsedDate = parseTimestamp(entry.timestamp);
                    const inRange = isInDateRange(entry.timestamp, startDate, endDate);


                    return inRange;
                });

                // Filtrer les sessions de sommeil termin√©es
                const filteredSleep = sleepSessions.filter(session => {
                    if (!session.startTime || session.status !== 'completed') return false;
                    const inRange = isInDateRange(session.startTime, startDate, endDate);
                    return inRange;
                }).map(session => ({
                    ...session,
                    type: 'sleep',
                    timestamp: session.startTime
                }));

                // Filtrer les t√©t√©es termin√©es
                const filteredBreastfeeding = breastfeedingEntries.filter(entry => {
                    if (!entry.timestamp || entry.status !== 'completed') return false;
                    const inRange = isInDateRange(entry.timestamp, startDate, endDate);
                    return inRange;
                }).map(entry => ({
                    ...entry,
                    type: 'breastfeeding',
                    timestamp: entry.timestamp
                }));

                // Filtrer les sessions tire-lait
                const filteredBreastPump = breastPumpEntries.filter(entry => {
                    if (!entry.timestamp) return false;
                    const inRange = isInDateRange(entry.timestamp, startDate, endDate);
                    return inRange;
                }).map(entry => ({
                    ...entry,
                    type: 'breast_pump',
                    timestamp: entry.timestamp
                }));

                const totalFiltered = filteredEntries.length + filteredSleep.length +
                    filteredBreastfeeding.length + filteredBreastPump.length;


                // Combiner et trier par timestamp (plus r√©cent en premier)
                const allEntries = [...filteredEntries, ...filteredSleep, ...filteredBreastfeeding, ...filteredBreastPump];

                return allEntries.sort((a, b) => {
                    const dateA = parseTimestamp(a.timestamp);
                    const dateB = parseTimestamp(b.timestamp);
                    return dateB - dateA;
                });
            };
            // V√©rification connexion au chargement
            useEffect(() => {
                const savedCode = localStorage.getItem('familyCode');
                if (savedCode) {
                    setAuthData(prev => ({ ...prev, code: savedCode }));
                    handleLogin(savedCode);
                } else {
                    setIsLoading(false); // Pas de code sauvegard√©, arr√™ter le loader
                }
            }, []);


            // √âcoute des donn√©es Firebase
            useEffect(() => {
                if (!user) return;

                const familyCode = user.code;
                const unsubscribers = [];

                // Charger toutes les donn√©es en parall√®le pour plus de rapidit√©
                Promise.all([
                    // Entries
                    db.collection('entries')
                        .where('familyCode', '==', familyCode)
                        .orderBy('timestamp', 'desc')
                        .limit(50) // Limiter √† 50 entr√©es pour charger plus vite
                        .get(),

                    // Stocks
                    db.collection('stocks')
                        .where('familyCode', '==', familyCode)
                        .get(),

                    // Diversification
                    db.collection('diversification')
                        .where('familyCode', '==', familyCode)
                        .orderBy('timestamp', 'desc')
                        .limit(30)
                        .get(),

                    // Wardrobe
                    db.collection('wardrobe')
                        .where('familyCode', '==', familyCode)
                        .orderBy('timestamp', 'desc')
                        .limit(30)
                        .get(),

                    // Sleep sessions
                    db.collection('sleep_sessions')
                        .where('familyCode', '==', familyCode)
                        .orderBy('timestamp', 'desc')
                        .limit(30)
                        .get(),

                    // Breastfeeding
                    db.collection('breastfeeding')
                        .where('familyCode', '==', familyCode)
                        .orderBy('timestamp', 'desc')
                        .limit(30)
                        .get(),

                    // Breast pump
                    db.collection('breast_pump')
                        .where('familyCode', '==', familyCode)
                        .orderBy('timestamp', 'desc')
                        .limit(30)
                        .get()
                ]).then(([
                    entriesSnap,
                    stocksSnap,
                    diversificationSnap,
                    wardrobeSnap,
                    sleepSnap,
                    breastfeedingSnap,
                    breastPumpSnap
                ]) => {
                    // Entries
                    const entriesData = [];
                    entriesSnap.forEach(doc => entriesData.push({ id: doc.id, ...doc.data() }));
                    setEntries(entriesData);
                    localStorage.setItem('babyTrackerEntries', JSON.stringify(entriesData));

                    // Stocks
                    const stocksData = {};
                    stocksSnap.forEach(doc => {
                        const data = doc.data();
                        stocksData[data.type] = data;
                    });
                    setStocks(stocksData);

                    // Diversification
                    const diversificationData = [];
                    diversificationSnap.forEach(doc => diversificationData.push({ id: doc.id, ...doc.data() }));
                    setDiversificationEntries(diversificationData);

                    // Wardrobe
                    const wardrobeData = [];
                    wardrobeSnap.forEach(doc => wardrobeData.push({ id: doc.id, ...doc.data() }));
                    setWardrobe(wardrobeData);

                    // Sleep
                    const sleepData = [];
                    let ongoingSleep = null;
                    sleepSnap.forEach(doc => {
                        const sessionData = { id: doc.id, ...doc.data() };
                        sleepData.push(sessionData);
                        if (sessionData.status === 'ongoing') {
                            ongoingSleep = sessionData;
                        }
                    });
                    // Plus besoin de tri car d√©j√† fait par orderBy
                    setSleepSessions(sleepData);
                    setCurrentSleep(ongoingSleep);

                    // Breastfeeding
                    const breastfeedingData = [];
                    let ongoingBreastfeeding = null;
                    breastfeedingSnap.forEach(doc => {
                        const sessionData = { id: doc.id, ...doc.data() };
                        breastfeedingData.push(sessionData);
                        if (sessionData.status === 'ongoing') {
                            ongoingBreastfeeding = sessionData;
                        }
                    });
                    setBreastfeedingEntries(breastfeedingData);
                    setBreastfeedingSession(ongoingBreastfeeding);

                    // Breast pump
                    const breastPumpData = [];
                    breastPumpSnap.forEach(doc => breastPumpData.push({ id: doc.id, ...doc.data() }));
                    setBreastPumpEntries(breastPumpData);

                    setIsLoading(false); // Donn√©es charg√©es, cacher le loader
                }).catch(error => {
                    console.error('Erreur chargement donn√©es:', error);
                    setIsLoading(false);
                });

                // Ensuite √©couter les changements en temps r√©el (apr√®s le chargement initial)
                // Entries
                const entriesUnsubscribe = db.collection('entries')
                    .where('familyCode', '==', familyCode)
                    .orderBy('timestamp', 'desc')
                    .limit(50)
                    .onSnapshot((snapshot) => {
                        const entriesData = [];
                        snapshot.forEach((doc) => {
                            entriesData.push({ id: doc.id, ...doc.data() });
                        });
                        setEntries(entriesData);
                        localStorage.setItem('babyTrackerEntries', JSON.stringify(entriesData));
                    });
                unsubscribers.push(entriesUnsubscribe);

                // Accomplissements
                const accomplishmentsUnsubscribe = db.collection('families').doc(user.code)
                    .onSnapshot((doc) => {
                        if (doc.exists) {
                            const userData = doc.data();
                            if (userData.accomplishments) {
                                setAccomplishments(userData.accomplishments);
                            } else {
                                setAccomplishments({});
                            }
                        }
                    });
                unsubscribers.push(accomplishmentsUnsubscribe);

                // Stocks
                const stocksUnsubscribe = db.collection('stocks')
                    .where('familyCode', '==', familyCode)
                    .onSnapshot((snapshot) => {
                        const stocksData = {};
                        snapshot.forEach((doc) => {
                            const data = doc.data();
                            stocksData[data.type] = data;
                        });
                        setStocks(stocksData);
                    });
                unsubscribers.push(stocksUnsubscribe);

                // Diversification




                // Sleep
                const sleepUnsubscribe = db.collection('sleep_sessions')
                    .where('familyCode', '==', familyCode)
                    .orderBy('timestamp', 'desc')
                    .limit(30)
                    .onSnapshot((snapshot) => {
                        const sleepData = [];
                        let ongoingSession = null;

                        snapshot.forEach((doc) => {
                            const sessionData = { id: doc.id, ...doc.data() };
                            sleepData.push(sessionData);

                            if (sessionData.status === 'ongoing') {
                                ongoingSession = sessionData;
                            }
                        });

                        // Plus besoin de tri car d√©j√† fait par orderBy
                        setSleepSessions(sleepData);
                        setCurrentSleep(ongoingSession);
                    });
                unsubscribers.push(sleepUnsubscribe);
                // Breastfeeding
                const breastfeedingUnsubscribe = db.collection('breastfeeding')
                    .where('familyCode', '==', familyCode)
                    .orderBy('timestamp', 'desc')
                    .limit(30)
                    .onSnapshot((snapshot) => {
                        const breastfeedingData = [];
                        let ongoingSession = null;

                        snapshot.forEach((doc) => {
                            const sessionData = { id: doc.id, ...doc.data() };
                            breastfeedingData.push(sessionData);

                            if (sessionData.status === 'ongoing') {
                                ongoingSession = sessionData;
                            }
                        });

                        setBreastfeedingEntries(breastfeedingData);
                        setBreastfeedingSession(ongoingSession);
                    });
                unsubscribers.push(breastfeedingUnsubscribe);

                // Breast pump
                const breastPumpUnsubscribe = db.collection('breast_pump')
                    .where('familyCode', '==', familyCode)
                    .orderBy('timestamp', 'desc')
                    .limit(30)
                    .onSnapshot((snapshot) => {
                        const breastPumpData = [];
                        snapshot.forEach((doc) => {
                            breastPumpData.push({ id: doc.id, ...doc.data() });
                        });
                        setBreastPumpEntries(breastPumpData);
                    });
                unsubscribers.push(breastPumpUnsubscribe);

                return () => {
                    unsubscribers.forEach(unsubscribe => unsubscribe());
                };
            }, [user]);
            // Mise √† jour du graphique
            useEffect(() => {
                if (currentView === 'daily' && chartRef.current && entries.length > 0) {
                    updateChart();
                }
            }, [entries, currentView, periodView]);
            // Mise √† jour du graphique sommeil
            useEffect(() => {
                if (currentView === 'sleep-tracker' && sleepChartRef.current && sleepSessions.length > 0) {
                    updateSleepChart();
                }
            }, [sleepSessions, currentView, sleepPeriodView]);
            // Fermer le menu "Plus" quand on clique ailleurs
            useEffect(() => {
                const handleClickOutside = (event) => {
                    // V√©rifier si le clic est en dehors des menus
                    const isOutsideMoreMenu = !event.target.closest('.relative') ||
                        !event.target.closest('[data-menu="more"]');
                    const isOutsidePlusMenu = !event.target.closest('[data-menu="plus"]');

                    if (showMoreMenu && isOutsideMoreMenu) {
                        setShowMoreMenu(false);
                    }
                    if (showPlusMenu && isOutsidePlusMenu) {
                        setShowPlusMenu(false);
                    }
                };

                document.addEventListener('mousedown', handleClickOutside);
                return () => {
                    document.removeEventListener('mousedown', handleClickOutside);
                };
            }, [showMoreMenu, showPlusMenu]);
            // Calcul du prochain biberon
            useEffect(() => {
                if (entries.length === 0) {
                    setNextFeedingInfo(null);
                    return;
                }

                const lastFeeding = entries
                    .filter(entry => entry.type === 'feeding')
                    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))[0];

                if (lastFeeding) {
                    const lastFeedingTime = new Date(lastFeeding.timestamp);

                    // Si l'intervalle est d√©sactiv√© (0), on met null pour nextTime
                    if (feedingInterval === 0) {
                        setNextFeedingInfo({
                            lastFeeding: lastFeedingTime,
                            nextTime: null // Pas de prochain biberon calcul√©
                        });
                    } else {
                        const nextFeedingTime = new Date(lastFeedingTime.getTime() + (feedingInterval * 60 * 60 * 1000));
                        setNextFeedingInfo({
                            lastFeeding: lastFeedingTime,
                            nextTime: nextFeedingTime
                        });
                    }
                } else {
                    setNextFeedingInfo(null);
                }
            }, [entries, feedingInterval]);
            // Charger les soins depuis Firebase
            useEffect(() => {
                if (!user) return;

                const today = getCurrentDate();

                // √âcouter les changements en temps r√©el
                const unsubscribe = db.collection('daily_care')
                    .doc(`${user.code}_${today}`)
                    .onSnapshot(async (doc) => {
                        if (doc.exists) {
                            const data = doc.data();

                            // V√©rifier que les donn√©es sont bien du jour actuel
                            if (data.date === today) {
                            } else {
                                // Donn√©es d'un autre jour, r√©initialiser
                                const freshCare = {
                                    cordon: {
                                        active: data.care?.cordon?.active ?? true,
                                        morning_done: false,
                                        evening_done: false,
                                        last_updated: null
                                    },
                                    visage: { done: false, last_updated: null },
                                    vitamines: { done: false, last_updated: null }
                                };
                                await saveDailyCareToFirebase(freshCare, today);
                            }
                        } else {
                            // Aucune donn√©e pour aujourd'hui, cr√©er l'initial
                            const initialCare = {
                                cordon: {
                                    active: true,
                                    morning_done: false,
                                    evening_done: false,
                                    last_updated: null
                                },
                                visage: { done: false, last_updated: null },
                                vitamines: { done: false, last_updated: null }
                            };
                            await saveDailyCareToFirebase(initialCare, today);
                        }
                    }, (error) => {
                        console.error('Erreur chargement soins:', error);
                    });

                return () => unsubscribe();
            }, [user]);
            // Initialiser les notifications
            useEffect(() => {
                if ('Notification' in window) {
                    setNotificationPermission(Notification.permission);

                    // Si d√©j√† autoris√©, programmer les notifications
                    if (Notification.permission === 'granted' && user) {
                        scheduleAllNotifications();
                    }
                }
            }, []);

            // Reprogrammer quand les donn√©es changent
            useEffect(() => {
                if (notificationPermission === 'granted' && user) {
                    scheduleAllNotifications();
                }
            }, [user, entries, notificationPermission]);

            // Cleanup au d√©montage
            useEffect(() => {
                return () => {
                    clearAllNotifications();
                };
            }, []);
            // Reprogrammer les notifications quand une nouvelle entr√©e est ajout√©e
            useEffect(() => {
                if (notificationPermission === 'granted' && user) {
                    // Attendre un peu pour que les donn√©es soient mises √† jour
                    setTimeout(() => {
                        scheduleNextFeedingNotification();
                    }, 1000);
                }
            }, [entries.length]);

            // V√©rifier permission au chargement
            useEffect(() => {
                if ('Notification' in window) {
                    setNotificationPermission(Notification.permission);
                }
            }, []);
            useEffect(() => {
                // D√©tection iOS pour les notifications
                const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);

                if (isIOS && user && !isLoading) {
                    const isStandalone = window.navigator.standalone === true;
                    const currentVersion = '1.8.0';
                    const lastSeenVersion = localStorage.getItem('babytrack_last_version');

                    if (!isStandalone) {
                        const delay = lastSeenVersion !== currentVersion ? 10000 : 2000;

                        setTimeout(() => {
                            setPwaPopupType('suggest');
                            setShowPWAPopup(true);
                            // Bloquer le scroll du body
                            document.body.classList.add('modal-open');
                        }, delay);
                    }
                }
            }, [user, isLoading]);
            // V√ârifier si la pop-up de mise √† jour doit s'afficher
            useEffect(() => {
                if (!user || isLoading) return;

                const currentVersion = '1.8.0';
                const lastSeenVersion = localStorage.getItem('babytrack_last_version');

                if (lastSeenVersion !== currentVersion) {
                    const timer = setTimeout(() => {
                        setShowUpdatePopup(true);
                        // Bloquer le scroll du body
                        document.body.classList.add('modal-open');
                    }, 1500);
                    return () => clearTimeout(timer);
                }
            }, [user, isLoading]);


            // Charger les aliments de diversification quand on arrive sur la vue food
            useEffect(() => {
                if (currentView === 'food' && user?.code) {
                    loadDiversificationPage(0, true);
                }
            }, [currentView, diversificationSort, user?.code]);
            const closeUpdatePopup = () => {
                const currentVersion = '1.8.0';
                localStorage.setItem('babytrack_last_version', currentVersion);
                setShowUpdatePopup(false);
                // D√©bloquer le scroll du body
                document.body.classList.remove('modal-open');
            };
            // Authentification
            const handleCreateAccount = async () => {
                const { babyName, birthDate, birthTime, birthWeight, birthHeight, parents, gender } = authData;

                if (!babyName || !birthDate) {
                    alert('Nom du b√©b√© et date de naissance obligatoires');
                    return;
                }

                const familyCode = generateCode();
                const familyData = {
                    code: familyCode,
                    name: authData.name,
                    babyName: babyName,
                    birthDate: birthDate,
                    birthWeight: parseFloat(birthWeight) || 3.290,
                    birthHeight: parseInt(birthHeight) || 48,
                    parents: parents || 'Papa & Maman',
                    gender: gender,
                    accomplishments: {}, // Initialiser avec un objet vide
                    feedingInterval: 3, // Intervalle par d√©faut
                    createdAt: new Date().toISOString()
                };
                try {
                    await db.collection('families').doc(familyCode).set(familyData);
                    alert(`Famille cr√©√©e avec succ√®s!\n\nCode famille: ${familyCode}\n\nNotez bien ce code!`);

                    setUser(familyData);
                    localStorage.setItem('familyCode', familyCode);
                    setShowAuth(false);
                } catch (error) {
                    console.error('Erreur cr√©ation:', error);
                    alert('Erreur lors de la cr√©ation du compte');
                }
            };

            const handleLogin = async (code = authData.code) => {
                if (!code || code.length !== 6) {
                    alert('Code famille invalide (6 caract√®res requis)');
                    return;
                }

                setIsLoading(true); // Afficher le loader

                try {
                    const doc = await db.collection('families').doc(code.toUpperCase()).get();

                    if (doc.exists) {
                        const userData = doc.data();
                        setUser(userData);

                        // Charger le poids et la taille
                        if (userData.currentWeight) {
                            setCurrentWeight(userData.currentWeight);
                        }
                        if (userData.lastWeightUpdate) {
                            setLastWeightUpdate(userData.lastWeightUpdate);
                        }
                        if (userData.currentHeight) {
                            setCurrentHeight(userData.currentHeight);
                        }
                        if (userData.lastHeightUpdate) {
                            setLastHeightUpdate(userData.lastHeightUpdate);
                        }

                        // Charger l'intervalle de biberon
                        if (userData.feedingInterval !== undefined) {
                            setFeedingInterval(userData.feedingInterval);
                        } else {
                            setFeedingInterval(3); // Valeur par d√©faut si pas d√©fini
                        }

                        localStorage.setItem('familyCode', code.toUpperCase());
                        setShowAuth(false);
                    } else {
                        alert('Code famille introuvable. V√©rifiez le code ou cr√©ez un nouveau compte.');
                    }
                } catch (error) {
                    console.error('Erreur connexion:', error);
                    alert(`Erreur de connexion: ${error.message || 'Erreur inconnue'}`);
                } finally {
                    setIsLoading(false); // Cacher le loader
                }
            };
            // Fonctions d'exportation

            async function exportToPDF() {
                setIsExporting(true);

                try {
                    const stats = getStats(exportPeriod === "day" ? "daily" : exportPeriod === "week" ? "weekly" : "monthly");

                    const now = new Date();
                    let startDate, endDate, periodLabel;
                    switch (exportPeriod) {
                        case "day":
                            startDate = getDayStart(now);
                            endDate = getDayEnd(now);
                            periodLabel = "Rapport du jour";
                            break;
                        case "week":
                            startDate = new Date(now);
                            startDate.setDate(startDate.getDate() - 7);
                            startDate.setHours(0, 0, 0, 0);
                            endDate = getDayEnd(now);
                            periodLabel = "Rapport hebdomadaire";
                            break;
                        case "month":
                            startDate = new Date(now);
                            startDate.setDate(startDate.getDate() - 30);
                            startDate.setHours(0, 0, 0, 0);
                            endDate = getDayEnd(now);
                            periodLabel = "Rapport mensuel";
                            break;
                    }

                    const exportEntries = entries.filter(entry => {
                        const entryDate = new Date(entry.timestamp);
                        return entryDate >= startDate && entryDate <= endDate;
                    });

                    // Ajouter les donn√©es d'allaitement
                    const exportBreastfeeding = breastfeedingEntries.filter(entry => {
                        const entryDate = new Date(entry.timestamp);
                        return entry.status === 'completed' && entryDate >= startDate && entryDate <= endDate;
                    });

                    // Ajouter les donn√©es de tire-lait
                    const exportBreastPump = breastPumpEntries.filter(entry => {
                        const entryDate = new Date(entry.timestamp);
                        return entryDate >= startDate && entryDate <= endDate;
                    });

                    // Ajouter les donn√©es de sommeil
                    const exportSleep = sleepSessions.filter(session => {
                        const sessionDate = new Date(session.startTime);
                        return session.status === 'completed' && sessionDate >= startDate && sessionDate <= endDate;
                    });

                    // Combiner toutes les entr√©es pour l'historique
                    const allExportEntries = [
                        ...exportEntries.map(e => ({ ...e, type: e.type, timestamp: e.timestamp })),
                        ...exportBreastfeeding.map(e => ({ ...e, type: 'breastfeeding', timestamp: e.timestamp })),
                        ...exportBreastPump.map(e => ({ ...e, type: 'breastpump', timestamp: e.timestamp })),
                        ...exportSleep.map(e => ({ ...e, type: 'sleep', timestamp: e.startTime }))
                    ].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

                    // Contenu HTML pour le PDF
                    const printHTML = `
      <div id="pdf-report" style="width:210mm; background:white; padding:20px; font-family:Arial, sans-serif; color:#1a1a1a;">

        <!-- HEADER -->
        <div style="display:flex; align-items:center; border-bottom:3px solid #3B82F6; margin-bottom:20px; padding-bottom:10px;">
          <div style="width:100px;height:100px;border-radius:8px;overflow:hidden;display:flex;align-items:center;justify-content:center;margin-right:15px;">
            <img src="logo.PNG" style="width:100%;height:100%;object-fit:cover;" alt="Logo">
          </div>
          <div>
            <h1 style="margin:0;font-size:22px;color:#1e293b;">BabyTrack</h1>
            <p style="margin:0;color:#64748b;font-size:14px;">${user.babyName} - ${periodLabel}</p>
            <p style="margin:0;color:#3B82F6;font-size:12px;">Du ${startDate.toLocaleDateString("fr-FR")} au ${endDate.toLocaleDateString("fr-FR")}</p>
          </div>
        </div>

        <!-- INFOS -->
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:20px;">
          <div style="background:#f8fafc;border:1px solid #e2e8f0;border-left:4px solid #3B82F6;padding:12px;border-radius:6px;">
            <h3 style="margin:0 0 8px 0;font-size:13px;color:#1e293b;">üë∂ Informations du b√©b√©</h3>
            <p><strong>Nom:</strong> ${user.babyName}</p>
            <p><strong>√Çge:</strong> ${formatAgeDisplay(calculateAge())}</p>
            <p><strong>Poids:</strong> ${currentWeight || user.birthWeight}kg</p>
            <p><strong>Taille:</strong> ${currentHeight || user.birthHeight}cm</p>
          </div>
          <div style="background:#f8fafc;border:1px solid #e2e8f0;border-left:4px solid #3B82F6;padding:12px;border-radius:6px;">
            <h3 style="margin:0 0 8px 0;font-size:13px;color:#1e293b;">üë™ Informations famille</h3>
            <p><strong>Parents:</strong> ${user.parents}</p>
            <p><strong>Date du rapport:</strong> ${new Date().toLocaleDateString("fr-FR")}</p>
          </div>
        </div>

        <!-- STATS -->
        <div style="margin-bottom:20px;">
          <h2 style="font-size:14px;font-weight:600;color:#1e293b;border-bottom:2px solid #3B82F6;padding-bottom:4px;">üìä Statistiques de la p√©riode</h2>
          <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;">
            <div style="text-align:center;padding:12px;background:#f1f5f9;border-radius:6px;border:1px solid #e2e8f0;">
              <span style="font-size:18px;font-weight:bold;color:#3B82F6;">${stats.totalMilk}</span><br>
              <span style="font-size:10px;color:#64748b;">ml de lait</span>
            </div>
            <div style="text-align:center;padding:12px;background:#f1f5f9;border-radius:6px;border:1px solid #e2e8f0;">
              <span style="font-size:18px;font-weight:bold;color:#3B82F6;">${stats.feedingCount}</span><br>
              <span style="font-size:10px;color:#64748b;">biberons</span>
            </div>
            <div style="text-align:center;padding:12px;background:#f1f5f9;border-radius:6px;border:1px solid #e2e8f0;">
              <span style="font-size:18px;font-weight:bold;color:#3B82F6;">${stats.totalPees}</span><br>
              <span style="font-size:10px;color:#64748b;">pipis</span>
            </div>
            <div style="text-align:center;padding:12px;background:#f1f5f9;border-radius:6px;border:1px solid #e2e8f0;">
              <span style="font-size:18px;font-weight:bold;color:#3B82F6;">${stats.totalPoops}</span><br>
              <span style="font-size:10px;color:#64748b;">cacas</span>
            </div>
            ${exportBreastfeeding.length > 0 ? `
  <div style="text-align:center;padding:12px;background:#f1f5f9;border-radius:6px;border:1px solid #e2e8f0;">
    <span style="font-size:18px;font-weight:bold;color:#ec4899;">${exportBreastfeeding.reduce((sum, e) => sum + (e.duration || 0), 0)}</span><br>
    <span style="font-size:10px;color:#64748b;">min d'allaitement</span>
  </div>
  <div style="text-align:center;padding:12px;background:#f1f5f9;border-radius:6px;border:1px solid #e2e8f0;">
    <span style="font-size:18px;font-weight:bold;color:#ec4899;">${exportBreastfeeding.length}</span><br>
    <span style="font-size:10px;color:#64748b;">t√©t√©es</span>
  </div>` : ''}
  
  <!-- Nouvelles stats sommeil -->
  ${exportSleep.length > 0 ? `
  <div style="text-align:center;padding:12px;background:#f1f5f9;border-radius:6px;border:1px solid #e2e8f0;">
    <span style="font-size:18px;font-weight:bold;color:#6366f1;">${Math.round(exportSleep.reduce((sum, s) => sum + (s.duration || 0), 0) / 60 * 10) / 10}</span><br>
    <span style="font-size:10px;color:#64748b;">h de sommeil</span>
  </div>
  <div style="text-align:center;padding:12px;background:#f1f5f9;border-radius:6px;border:1px solid #e2e8f0;">
    <span style="font-size:18px;font-weight:bold;color:#6366f1;">${exportSleep.length}</span><br>
    <span style="font-size:10px;color:#64748b;">sessions sommeil</span>
  </div>` : ''}
          </div>
        </div>

       <!-- HISTORIQUE -->
${allExportEntries.length > 0
                            ? `
      <div style="margin-bottom:20px;">
        <h2 style="font-size:14px;font-weight:600;color:#1e293b;border-bottom:2px solid #3B82F6;padding-bottom:4px;">üìã Historique d√©taill√© (15 derni√®res entr√©es)</h2>
        ${allExportEntries
                                .slice(0, 15)
                                .map(entry => {
                                    const time = new Date(entry.timestamp).toLocaleString("fr-FR");

                                    if (entry.type === "feeding") {
                                        return `
<div style="display:flex;align-items:center;padding:8px 12px;margin-bottom:8px;background:#f9fafb;border-radius:8px;border-left:4px solid #3B82F6;">
  <div style="min-width:120px;font-size:12px;font-weight:600;color:#3B82F6;">${time}</div>
  <div style="color:#3B82F6;padding:4px 12px;font-size:12px;font-weight:700;margin-right:12px;">BIBERON</div>
  <div style="font-size:12px;color:#374151;font-weight:500;">Quantit√©: ${entry.amount}ml</div>
</div>`;
                                    }
                                    else if (entry.type === "diaper") {
                                        const details = [];
                                        if (entry.hasPee) details.push("Pipi");
                                        if (entry.hasPoop) {
                                            let poopDetails = "Caca";
                                            if (entry.poopQuantity || entry.poopConsistency || entry.poopColor) {
                                                const poopInfo = [];
                                                if (entry.poopQuantity) poopInfo.push(entry.poopQuantity);
                                                if (entry.poopConsistency) poopInfo.push(entry.poopConsistency);
                                                if (entry.poopColor) poopInfo.push(entry.poopColor);
                                                poopDetails = `Caca (${poopInfo.join(', ')})`;
                                            }
                                            details.push(poopDetails);
                                        }
                                        return `
<div style="display:flex;align-items:center;padding:8px 12px;margin-bottom:8px;background:#f9fafb;border-radius:8px;border-left:4px solid #10b981;">
  <div style="min-width:120px;font-size:12px;font-weight:600;color:#3B82F6;">${time}</div>
  <div style="color:#10b981;padding:4px 12px;font-size:12px;font-weight:700;margin-right:12px;">CHANGE</div>
  <div style="font-size:12px;color:#374151;font-weight:500;">${details.join(" + ")}</div>
</div>`;
                                    }
                                    else if (entry.type === "breastfeeding") {
                                        return `
<div style="display:flex;align-items:center;padding:8px 12px;margin-bottom:8px;background:#f9fafb;border-radius:8px;border-left:4px solid #ec4899;">
  <div style="min-width:120px;font-size:12px;font-weight:600;color:#3B82F6;">${time}</div>
  <div style="color:#ec4899;padding:4px 12px;font-size:12px;font-weight:700;margin-right:12px;">T√âT√âE</div>
  <div style="font-size:12px;color:#374151;font-weight:500;">${entry.breast === 'left' ? 'Sein gauche' : entry.breast === 'right' ? 'Sein droit' : 'Les deux seins'}${entry.duration ? ` - ${entry.duration}min` : ''}</div>
</div>`;
                                    }
                                    else if (entry.type === "breastpump") {
                                        return `
<div style="display:flex;align-items:center;padding:8px 12px;margin-bottom:8px;background:#f9fafb;border-radius:8px;border-left:4px solid #8b5cf6;">
  <div style="min-width:120px;font-size:12px;font-weight:600;color:#3B82F6;">${time}</div>
  <div style="color:#8b5cf6;padding:4px 12px;font-size:12px;font-weight:700;margin-right:12px;">TIRE-LAIT</div>
  <div style="font-size:12px;color:#374151;font-weight:500;">${entry.volume}ml en ${entry.duration}min</div>
</div>`;
                                    }
                                    else if (entry.type === "sleep") {
                                        const durationMinutes = entry.duration || 0;
                                        const hours = Math.floor(durationMinutes / 60);
                                        const mins = durationMinutes % 60;
                                        const durationText = hours > 0 ? `${hours}h${mins.toString().padStart(2, '0')}` : `${mins}min`;
                                        return `
<div style="display:flex;align-items:center;padding:8px 12px;margin-bottom:8px;background:#f9fafb;border-radius:8px;border-left:4px solid #6366f1;">
  <div style="min-width:120px;font-size:12px;font-weight:600;color:#3B82F6;">${time}</div>
  <div style="color:#6366f1;padding:4px 12px;font-size:12px;font-weight:700;margin-right:12px;">SOMMEIL</div>
  <div style="font-size:12px;color:#374151;font-weight:500;">Dur√©e: ${durationText}</div>
</div>`;
                                    }
                                    return "";
                                })
                                .join("")}
      </div>`
                            : ""
                        }
}
                        }
    `;

                    // Ajout temporaire au DOM
                    const container = document.createElement("div");
                    container.innerHTML = printHTML;
                    document.body.appendChild(container);

                    const element = container.querySelector("#pdf-report");

                    // Conversion en canvas puis PDF
                    const canvas = await html2canvas(element, { scale: 2 });
                    const imgData = canvas.toDataURL("image/png");

                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF("p", "mm", "a4");
                    const imgWidth = 210;
                    const pageHeight = 297;
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;

                    let heightLeft = imgHeight;
                    let position = 0;

                    pdf.addImage(imgData, "PNG", 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;

                    while (heightLeft > 0) {
                        position = heightLeft - imgHeight;
                        pdf.addPage();
                        pdf.addImage(imgData, "PNG", 0, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }

                    pdf.save(`Rapport_${periodLabel}_${new Date().toLocaleDateString("fr-FR")}.pdf`);

                    // Nettoyage
                    document.body.removeChild(container);
                    setShowExportMenu(false);
                } catch (error) {
                    console.error("Erreur export PDF:", error);
                    alert("Erreur lors de l'export PDF");
                } finally {
                    setIsExporting(false);
                }
            }
            const logout = () => {
                setUser(null);
                localStorage.removeItem('familyCode');
                setShowAuth(true);
                setAuthMode('login');
            };
            // Gestion des entr√©es
            const openForm = (type) => {
                setFormType(type);
                setEditingId(null);
                setFormData({
                    time: getCurrentTime(),
                    date: getCurrentDate(),
                    amount: '',
                    hasPee: false,
                    hasPoop: false,
                    poopQuantity: '',
                    poopConsistency: '',
                    poopColor: ''
                });

                setShowForm(true);
            };

            const editEntry = (entryId) => {
                const entry = entries.find(e => e.id === entryId);
                if (!entry) return;

                setEditingId(entryId);
                setFormType(entry.type);

                const entryDate = new Date(entry.timestamp);
                setFormData({
                    time: entryDate.toTimeString().slice(0, 5),
                    date: entryDate.toISOString().slice(0, 10),
                    amount: entry.amount || '',
                    hasPee: entry.hasPee || false,
                    hasPoop: entry.hasPoop || false,
                    poopQuantity: entry.poopQuantity || '',
                    poopConsistency: entry.poopConsistency || '',
                    poopColor: entry.poopColor || ''
                });

                setShowForm(true);
            };

            const closeForm = () => {
                setShowForm(false);
                setFormType('');
                setEditingId(null);
            };

            const saveEntry = async () => {
                const { time, date, amount, hasPee, hasPoop, poopQuantity, poopConsistency, poopColor } = formData;

                if (!time || !date) {
                    alert('Heure et date obligatoires');
                    return;
                }

                if (formType === 'feeding' && !amount) {
                    alert('Quantit√© obligatoire pour le biberon');
                    return;
                }

                if (formType === 'diaper' && !hasPee && !hasPoop) {
                    alert('Indiquez au moins pipi ou caca');
                    return;
                }

                const entry = {
                    type: formType,
                    // CORRECTION ICI : Cr√©er le timestamp sans conversion UTC automatique
                    timestamp: `${date}T${time}:00`,
                    familyCode: user.code,
                    hasPee,
                    hasPoop,
                    poopQuantity,
                    poopConsistency,
                    poopColor
                };

                if (formType === 'feeding') {
                    entry.amount = parseInt(amount);
                }

                try {
                    if (editingId) {
                        await db.collection('entries').doc(editingId).update(entry);
                    } else {
                        await db.collection('entries').add(entry);
                    }
                    closeForm();
                } catch (error) {
                    console.error('Erreur sauvegarde:', error);
                    alert('Erreur lors de la sauvegarde');
                }
            };
            const deleteEntry = async (entryId) => {
                if (!confirm('Supprimer cette entr√©e ?')) return;

                try {
                    await db.collection('entries').doc(entryId).delete();
                } catch (error) {
                    console.error('Erreur suppression:', error);
                }
            };

            // Fonctions allaitement
            const startBreastfeeding = async (breast) => {
                const now = new Date().toISOString();
                const session = {
                    familyCode: user.code,
                    breast: breast,
                    startTime: now,
                    endTime: null,
                    duration: null,
                    timestamp: now,
                    status: 'ongoing'
                };

                try {
                    const docRef = await db.collection('breastfeeding').add(session);
                    setBreastfeedingSession({ id: docRef.id, ...session });
                    setShowBreastfeedingModal(false);
                } catch (error) {
                    console.error('Erreur d√©marrage allaitement:', error);
                    alert('Erreur lors du d√©marrage');
                }
            };

            const stopBreastfeeding = async () => {
                if (!breastfeedingSession) return;

                const now = new Date().toISOString();
                const startTime = new Date(breastfeedingSession.startTime);
                const endTime = new Date(now);
                const durationMs = endTime - startTime;
                const durationMinutes = Math.max(1, Math.floor(durationMs / (1000 * 60)));

                const updatedSession = {
                    endTime: now,
                    duration: durationMinutes,
                    status: 'completed',
                    timestamp: now
                };

                try {
                    await db.collection('breastfeeding').doc(breastfeedingSession.id).update(updatedSession);
                    setBreastfeedingSession(null);
                } catch (error) {
                    console.error('Erreur arr√™t allaitement:', error);
                    alert('Erreur lors de l\'arr√™t');
                }
            };

            const saveBreastfeedingManual = async () => {
                const { breast, duration, notes } = breastfeedingData;

                if (!breast || !duration) {
                    alert('Veuillez remplir tous les champs obligatoires');
                    return;
                }

                const entry = {
                    familyCode: user.code,
                    breast: breast,
                    duration: parseInt(duration),
                    notes: notes,
                    timestamp: new Date().toISOString(),
                    status: 'completed'
                };

                try {
                    await db.collection('breastfeeding').add(entry);
                    setBreastfeedingData({ breast: 'left', duration: '', notes: '' });
                    setShowBreastfeedingModal(false);
                } catch (error) {
                    console.error('Erreur sauvegarde allaitement:', error);
                    alert('Erreur lors de la sauvegarde');
                }
            };

            // Fonctions tire-lait
            const saveBreastPumpEntry = async () => {
                const { volume, duration, storage, notes } = breastPumpData;

                if (!volume || !duration) {
                    alert('Volume et dur√©e obligatoires');
                    return;
                }

                const entry = {
                    familyCode: user.code,
                    volume: parseInt(volume),
                    duration: parseInt(duration),
                    storage: storage,
                    notes: notes,
                    timestamp: new Date().toISOString()
                };

                try {
                    await db.collection('breast_pump').add(entry);
                    setBreastPumpData({ volume: '', duration: '', storage: 'fridge', notes: '' });
                    setShowBreastPumpModal(false);
                } catch (error) {
                    console.error('Erreur sauvegarde tire-lait:', error);
                    alert('Erreur lors de la sauvegarde');
                }
            };
            // Fonctions pour poids et taille
            const saveWeight = async () => {
                if (!weightInput || isNaN(weightInput)) {
                    alert('Veuillez entrer un poids valide');
                    return;
                }

                try {
                    await db.collection('families').doc(user.code).update({
                        currentWeight: parseFloat(weightInput),
                        lastWeightUpdate: new Date().toISOString()
                    });

                    setUser(prev => ({ ...prev, currentWeight: parseFloat(weightInput) }));
                    setCurrentWeight(parseFloat(weightInput));
                    setLastWeightUpdate(new Date().toISOString());

                    setWeightInput('');
                    setShowWeightModal(false);
                } catch (error) {
                    console.error('Erreur sauvegarde poids:', error);
                    alert('Erreur lors de la sauvegarde');
                }
            };

            const saveHeight = async () => {
                if (!heightInput || isNaN(heightInput)) {
                    alert('Veuillez entrer une taille valide');
                    return;
                }

                try {
                    await db.collection('families').doc(user.code).update({
                        birthHeight: parseFloat(heightInput)
                    });

                    setUser(prev => ({ ...prev, birthHeight: parseFloat(heightInput) }));
                    setCurrentHeight(parseFloat(heightInput));
                    setLastHeightUpdate(new Date().toISOString());

                    setHeightInput('');
                    setShowHeightModal(false);
                } catch (error) {
                    console.error('Erreur sauvegarde taille:', error);
                    alert('Erreur lors de la sauvegarde');
                }
            };
            const deleteBreastfeedingEntry = async (entryId) => {
                if (!confirm('Supprimer cette t√©t√©e ?')) return;
                try {
                    await db.collection('breastfeeding').doc(entryId).delete();
                } catch (error) {
                    console.error('Erreur suppression allaitement:', error);
                }
            };
            // Fonction pour sauvegarder les soins quotidiens
            const saveDailyCareToFirebase = async (careData, date) => {
                try {
                    await db.collection('daily_care').doc(`${user.code}_${date}`).set({
                        care: careData,
                        date: date,
                        familyCode: user.code,
                        timestamp: new Date().toISOString()
                    });
                } catch (error) {
                    throw error;
                }
            };

            const deleteBreastPumpEntry = async (entryId) => {
                if (!confirm('Supprimer cette session de tire-lait ?')) return;
                try {
                    await db.collection('breast_pump').doc(entryId).delete();
                } catch (error) {
                    console.error('Erreur suppression tire-lait:', error);
                }
            };
            const saveDiversificationEntry = async () => {
                if (isMixMode) {
                    if (mixFoods.length === 0 || !mixNewFood || !mixNewFoodCategory || !diversificationData.quantity) {
                        alert('Veuillez remplir tous les champs du mix');
                        return;
                    }

                    const entry = {
                        familyCode: user.code,
                        isMix: true,
                        mixFoods: mixFoods,
                        newFood: mixNewFood,
                        newFoodCategory: mixNewFoodCategory,
                        category: mixNewFoodCategory,
                        food: mixNewFood,
                        displayName: `${mixNewFood} (mix)`,
                        quantity: diversificationData.quantity,
                        reaction: diversificationData.reaction || '',
                        notes: diversificationData.notes || '',
                        timestamp: new Date().toISOString()
                    };

                    try {
                        await db.collection('diversification').add(entry);
                        setDiversificationData({ category: '', food: '', quantity: '', reaction: '', notes: '' });
                        setMixFoods([]);
                        setMixNewFood('');
                        setMixNewFoodCategory('');
                        setIsMixMode(false);
                        setDiversificationPage(0);
                        setDiversificationLastDoc(null);
                        loadDiversificationPage(0, true);
                    } catch (error) {
                        console.error('Erreur sauvegarde:', error);
                        alert('Erreur lors de la sauvegarde');
                    }
                } else {
                    const { category, food, quantity, reaction, notes } = diversificationData;
                    if (!category || !food || !quantity) {
                        alert('Veuillez remplir tous les champs obligatoires');
                        return;
                    }

                    const entry = {
                        familyCode: user.code,
                        isMix: false,
                        category,
                        food,
                        displayName: food,
                        quantity,
                        reaction: reaction || '',
                        notes: notes || '',
                        timestamp: new Date().toISOString()
                    };

                    try {
                        await db.collection('diversification').add(entry);
                        setDiversificationData({ category: '', food: '', quantity: '', reaction: '', notes: '' });
                        setDiversificationPage(0);
                        setDiversificationLastDoc(null);
                        loadDiversificationPage(0, true);
                    } catch (error) {
                        console.error('Erreur sauvegarde:', error);
                        alert('Erreur lors de la sauvegarde');
                    }
                }
            };
            const loadDiversificationPage = async (pageNumber = 0, isInitial = false) => {
                if (diversificationLoading) return;
                setDiversificationLoading(true);

                try {
                    let query = db.collection('diversification')
                        .where('familyCode', '==', user.code);

                    // Tri
                    if (diversificationSort === 'recent') {
                        query = query.orderBy('timestamp', 'desc');
                    } else {
                        query = query.orderBy('food', 'asc');
                    }

                    // Pagination
                    if (pageNumber > 0 && diversificationLastDoc) {
                        query = query.startAfter(diversificationLastDoc);
                    }

                    query = query.limit(ITEMS_PER_PAGE);

                    const snapshot = await query.get();

                    if (snapshot.empty) {
                        setDiversificationHasMore(false);
                        setDiversificationLoading(false);
                        return;
                    }

                    const newEntries = [];
                    snapshot.forEach(doc => {
                        newEntries.push({ id: doc.id, ...doc.data() });
                    });

                    // Garder le dernier document pour la pagination suivante
                    setDiversificationLastDoc(snapshot.docs[snapshot.docs.length - 1]);

                    // Si moins de r√©sultats que demand√©, c'est la fin
                    setDiversificationHasMore(snapshot.docs.length === ITEMS_PER_PAGE);

                    // Remplacer ou ajouter les entr√©es selon si c'est initial ou non
                    if (isInitial || pageNumber === 0) {
                        setDiversificationEntries(newEntries);
                    } else {
                        setDiversificationEntries(prev => [...prev, ...newEntries]);
                    }

                    setDiversificationPage(pageNumber);
                } catch (error) {
                    console.error('Erreur chargement diversification:', error);
                }

                setDiversificationLoading(false);
            };
            const searchDiversification = async (searchTerm) => {
                if (!searchTerm.trim()) {
                    // Si recherche vide, recharger normalement
                    loadDiversificationPage(0, true);
                    return;
                }

                setDiversificationLoading(true);

                try {
                    // Recherche c√¥t√© client car Firebase ne supporte pas LIKE
                    // On charge tous les r√©sultats et on filtre (optimisation possible avec Algolia/Meilisearch)
                    const snapshot = await db.collection('diversification')
                        .where('familyCode', '==', user.code)
                        .get();

                    const allEntries = [];
                    snapshot.forEach(doc => {
                        allEntries.push({ id: doc.id, ...doc.data() });
                    });

                    // Filtrer c√¥t√© client
                    const filtered = allEntries.filter(entry =>
                        entry.food.toLowerCase().includes(searchTerm.toLowerCase())
                    );

                    // Trier
                    if (diversificationSort === 'recent') {
                        filtered.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    } else {
                        filtered.sort((a, b) => a.food.localeCompare(b.food));
                    }

                    setDiversificationEntries(filtered);
                    setDiversificationHasMore(false); // Pas de pagination en mode recherche
                } catch (error) {
                    console.error('Erreur recherche:', error);
                }

                setDiversificationLoading(false);
            }; {/* Vue Diversification avec pagination Firebase */ }
            {
            }
            const deleteDiversificationEntry = async (entryId) => {
                if (!confirm('Supprimer cette entr√©e ?')) return;

                try {
                    await db.collection('diversification').doc(entryId).delete();

                    // Recharger la liste apr√®s suppression
                    setDiversificationPage(0);
                    setDiversificationLastDoc(null);
                    loadDiversificationPage(0, true);
                } catch (error) {
                    console.error('Erreur suppression diversification:', error);
                    alert('Erreur lors de la suppression');
                }
            };
            // Gestion de la garde-robe
            const saveWardrobeItem = async () => {
                const { type, size, quantity, color, notes } = wardrobeData;

                if (!type || !size) {
                    alert('Veuillez remplir les champs obligatoires');
                    return;
                }

                const item = {
                    familyCode: user.code,
                    type,
                    size,
                    quantity: parseInt(quantity) || 1,
                    color: color || '',
                    notes: notes || '',
                    timestamp: new Date().toISOString()
                };

                try {
                    if (editingWardrobeId) {
                        await db.collection('wardrobe').doc(editingWardrobeId).update(item);
                        setEditingWardrobeId(null);
                    } else {
                        await db.collection('wardrobe').add(item);
                    }

                    setWardrobeData({ type: '', size: '', quantity: 1, color: '', notes: '' });

                    // Recharger la premi√®re page
                    setWardrobePage(0);
                    setWardrobeLastDoc(null);
                    loadWardrobePage(0, true);
                } catch (error) {
                    console.error('Erreur sauvegarde garde-robe:', error);
                    alert('Erreur lors de la sauvegarde');
                }
            };
            const deleteWardrobeItem = async (itemId) => {
                if (!confirm('Supprimer cet article ?')) return;

                try {
                    await db.collection('wardrobe').doc(itemId).delete();

                    // Recharger
                    loadWardrobePage(0, true);
                } catch (error) {
                    console.error('Erreur suppression:', error);
                    alert('Erreur lors de la suppression');
                }
            };
            // Fonction pour charger la garde-robe avec pagination
            const loadWardrobePage = async (pageNumber = 0, isInitial = false) => {
                if (wardrobeLoading) return;
                setWardrobeLoading(true);

                try {
                    let query = db.collection('wardrobe')
                        .where('familyCode', '==', user.code)
                        .orderBy('size', 'asc'); // Tri par taille

                    // Pagination
                    if (pageNumber > 0 && wardrobeLastDoc) {
                        query = query.startAfter(wardrobeLastDoc);
                    }

                    query = query.limit(WARDROBE_ITEMS_PER_PAGE);

                    const snapshot = await query.get();

                    if (snapshot.empty) {
                        setWardrobeHasMore(false);
                        setWardrobeLoading(false);
                        if (isInitial) {
                            setWardrobe([]);
                        }
                        return;
                    }

                    const newItems = [];
                    snapshot.forEach(doc => {
                        newItems.push({ id: doc.id, ...doc.data() });
                    });

                    // Garder le dernier document pour la pagination suivante
                    setWardrobeLastDoc(snapshot.docs[snapshot.docs.length - 1]);

                    // Si moins de r√©sultats que demand√©, c'est la fin
                    setWardrobeHasMore(snapshot.docs.length === WARDROBE_ITEMS_PER_PAGE);

                    // Remplacer ou ajouter les entr√©es
                    if (isInitial || pageNumber === 0) {
                        setWardrobe(newItems);
                    } else {
                        setWardrobe(prev => [...prev, ...newItems]);
                    }

                    setWardrobePage(pageNumber);
                } catch (error) {
                    console.error('Erreur chargement garde-robe:', error);
                }

                setWardrobeLoading(false);
            };
            // Fonctions pour les stocks
            const saveMilkPowderDate = async () => {
                if (!milkDateInput) {
                    alert('Veuillez entrer une date valide');
                    return;
                }

                try {
                    // Supprimer l'ancien s'il existe pour cette famille
                    const existingDocs = await db.collection('stocks')
                        .where('type', '==', 'milk-powder')
                        .where('familyCode', '==', user.code)
                        .get();
                    existingDocs.forEach(doc => doc.ref.delete());

                    await db.collection('stocks').add({
                        type: 'milk-powder',
                        date: milkDateInput,
                        timestamp: new Date().toISOString(),
                        familyCode: user.code
                    });

                    setMilkDateInput('');
                    setShowMilkStockModal(false);
                } catch (error) {
                    console.error('Erreur sauvegarde date lait:', error);
                    alert('Erreur lors de la sauvegarde');
                }
            };

            const saveWaterBottleDateTime = async () => {
                if (!waterDateTimeInput) {
                    alert('Veuillez entrer une date et heure valides');
                    return;
                }

                try {
                    // Supprimer l'ancien s'il existe pour cette famille
                    const existingDocs = await db.collection('stocks')
                        .where('type', '==', 'water-bottle')
                        .where('familyCode', '==', user.code)
                        .get();
                    existingDocs.forEach(doc => doc.ref.delete());

                    await db.collection('stocks').add({
                        type: 'water-bottle',
                        datetime: waterDateTimeInput,
                        timestamp: new Date().toISOString(),
                        familyCode: user.code
                    });

                    setWaterDateTimeInput('');
                    setShowWaterStockModal(false);
                } catch (error) {
                    console.error('Erreur sauvegarde datetime eau:', error);
                    alert('Erreur lors de la sauvegarde');
                }
            };

            // Gestion du sommeil
            const startSleep = async () => {
                const now = new Date().toISOString();
                const sleepSession = {
                    familyCode: user.code,
                    startTime: now,
                    endTime: null,
                    duration: null,
                    timestamp: now,
                    status: 'ongoing'
                };

                try {
                    const docRef = await db.collection('sleep_sessions').add(sleepSession);
                    setCurrentSleep({ id: docRef.id, ...sleepSession });
                } catch (error) {
                    console.error('Erreur d√©marrage sommeil:', error);
                    alert('Erreur lors du d√©marrage');
                }
            };
            const stopSleep = async () => {
                if (!currentSleep) return;

                const now = new Date();
                const startTime = new Date(currentSleep.startTime);

                // Calculer la dur√©e en millisecondes
                const durationMs = now - startTime;
                const durationMinutes = Math.max(1, Math.floor(durationMs / (1000 * 60)));

                try {
                    // V√©rifier si la session traverse minuit
                    const startDay = new Date(startTime);
                    startDay.setHours(0, 0, 0, 0);
                    const endDay = new Date(now);
                    endDay.setHours(0, 0, 0, 0);

                    const crossesMidnight = endDay.getTime() > startDay.getTime();

                    if (crossesMidnight) {
                        // Cr√©er minuit entre les deux dates
                        const midnight = new Date(startTime);
                        midnight.setHours(24, 0, 0, 0); // Minuit du jour suivant

                        // Calculer les dur√©es
                        const durationBeforeMidnight = Math.floor((midnight - startTime) / (1000 * 60));
                        const durationAfterMidnight = Math.floor((now - midnight) / (1000 * 60));

                        // Mettre √† jour la session actuelle jusqu'√† minuit
                        await db.collection('sleep_sessions').doc(currentSleep.id).update({
                            endTime: midnight.toISOString(),
                            duration: durationBeforeMidnight,
                            status: 'completed',
                            timestamp: startTime.toISOString()
                        });

                        // Cr√©er une nouvelle session de minuit jusqu'√† maintenant
                        await db.collection('sleep_sessions').add({
                            familyCode: user.code,
                            startTime: midnight.toISOString(),
                            endTime: now.toISOString(),
                            duration: durationAfterMidnight,
                            timestamp: midnight.toISOString(),
                            status: 'completed'
                        });

                    } else {
                        // Session normale qui ne traverse pas minuit
                        await db.collection('sleep_sessions').doc(currentSleep.id).update({
                            endTime: now.toISOString(),
                            duration: durationMinutes,
                            status: 'completed',
                            timestamp: now.toISOString()
                        });
                    }

                    setCurrentSleep(null);
                } catch (error) {
                    alert('Erreur lors de l\'arr√™t');
                }
            };
            const saveSleepEdit = async () => {
                const { startTime, endTime, date } = sleepData;

                if (!startTime || !endTime || !date) {
                    alert('Veuillez remplir tous les champs');
                    return;
                }

                // Cr√©er les dates avec l'heure locale
                const start = new Date(`${date}T${startTime}:00`);
                let end = new Date(`${date}T${endTime}:00`);

                // Si l'heure de fin est avant l'heure de d√©but, c'est le lendemain
                if (end <= start) {
                    end.setDate(end.getDate() + 1);
                }

                const durationMs = end - start;
                const durationMinutes = Math.floor(durationMs / (1000 * 60));

                // V√©rification que la dur√©e reste raisonnable (max 15h)
                if (durationMinutes > 900) {
                    alert('La dur√©e de sommeil semble trop longue (plus de 15h). V√©rifiez les heures saisies.');
                    return;
                }

                if (durationMinutes <= 0) {
                    alert('La dur√©e de sommeil doit √™tre positive.');
                    return;
                }

                try {
                    // V√©rifier si la session traverse minuit
                    const startDay = new Date(start);
                    startDay.setHours(0, 0, 0, 0);
                    const endDay = new Date(end);
                    endDay.setHours(0, 0, 0, 0);

                    const crossesMidnight = endDay.getTime() > startDay.getTime();

                    if (crossesMidnight) {
                        // Cr√©er minuit entre les deux dates
                        const midnight = new Date(start);
                        midnight.setHours(24, 0, 0, 0); // Minuit du jour suivant

                        // Calculer les dur√©es
                        const durationBeforeMidnight = Math.floor((midnight - start) / (1000 * 60));
                        const durationAfterMidnight = Math.floor((end - midnight) / (1000 * 60));

                        // Session 1 : du d√©but jusqu'√† minuit (enregistr√©e le jour de d√©but)
                        const session1 = {
                            familyCode: user.code,
                            startTime: start.toISOString(),
                            endTime: midnight.toISOString(),
                            duration: durationBeforeMidnight,
                            timestamp: start.toISOString(),
                            status: 'completed'
                        };

                        // Session 2 : de minuit jusqu'√† la fin (enregistr√©e le jour suivant)
                        const session2 = {
                            familyCode: user.code,
                            startTime: midnight.toISOString(),
                            endTime: end.toISOString(),
                            duration: durationAfterMidnight,
                            timestamp: midnight.toISOString(),
                            status: 'completed'
                        };

                        // Si on est en mode √©dition, supprimer l'ancienne session
                        if (editingSleepId) {
                            await db.collection('sleep_sessions').doc(editingSleepId).delete();
                        }

                        // Ajouter les deux nouvelles sessions
                        await db.collection('sleep_sessions').add(session1);
                        await db.collection('sleep_sessions').add(session2);

                    } else {
                        // Session normale qui ne traverse pas minuit
                        const sleepSession = {
                            familyCode: user.code,
                            startTime: start.toISOString(),
                            endTime: end.toISOString(),
                            duration: durationMinutes,
                            timestamp: start.toISOString(),
                            status: 'completed'
                        };

                        if (editingSleepId) {
                            await db.collection('sleep_sessions').doc(editingSleepId).update(sleepSession);
                        } else {
                            await db.collection('sleep_sessions').add(sleepSession);
                        }
                    }

                    setSleepData({ startTime: '', endTime: '', date: getCurrentDate() });
                    setEditingSleepId(null);
                    setShowSleepModal(false);
                } catch (error) {
                    console.error('Erreur sauvegarde sommeil:', error);
                    alert('Erreur lors de la sauvegarde');
                }
            };
            const formatSleepDuration = (minutes) => {
                const hours = Math.floor(minutes / 60);
                const mins = minutes % 60;

                if (hours > 0) {
                    return `${hours}h${mins.toString().padStart(2, '0')}`;
                } else {
                    return `${mins}min`;
                }
            };
            // Nouveau graphique croissance √† ajouter apr√®s formatSleepDuration
            const GrowthChart = () => {
                const chartRef = useRef(null);
                const chartInstance = useRef(null);

                useEffect(() => {
                    if (!chartRef.current) return;

                    const ctx = chartRef.current.getContext('2d');

                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }

                    // Donn√©es de croissance (exemple avec donn√©es actuelles)
                    const growthData = [];

                    // Poids de naissance
                    if (user?.birthDate && user?.birthWeight) {
                        growthData.push({
                            date: new Date(user.birthDate),
                            weight: user.birthWeight,
                            height: user.birthHeight || null
                        });
                    }

                    // Poids actuel si disponible
                    if (currentWeight && lastWeightUpdate) {
                        growthData.push({
                            date: new Date(lastWeightUpdate),
                            weight: currentWeight,
                            height: currentHeight || null
                        });
                    }

                    const labels = growthData.map(point =>
                        point.date.toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' })
                    );

                    chartInstance.current = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [
                                {
                                    label: 'Poids (kg)',
                                    data: growthData.map(point => point.weight),
                                    borderColor: '#3B82F6',
                                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                    tension: 0.4,
                                    pointRadius: 5,
                                    yAxisID: 'y'
                                },
                                {
                                    label: 'Taille (cm)',
                                    data: growthData.map(point => point.height),
                                    borderColor: '#10B981',
                                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                    tension: 0.4,
                                    pointRadius: 5,
                                    yAxisID: 'y1'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    type: 'linear',
                                    display: true,
                                    position: 'left',
                                    title: { display: true, text: 'Poids (kg)' },
                                    ticks: { callback: value => value + 'kg' }
                                },
                                y1: {
                                    type: 'linear',
                                    display: true,
                                    position: 'right',
                                    title: { display: true, text: 'Taille (cm)' },
                                    ticks: { callback: value => value + 'cm' },
                                    grid: { drawOnChartArea: false }
                                }
                            }
                        }
                    });

                    return () => {
                        if (chartInstance.current) {
                            chartInstance.current.destroy();
                        }
                    };
                }, [currentWeight, currentHeight, user]);

                // Mise √† jour du graphique analytics
                useEffect(() => {
                    if (currentView === 'analytics' && analyticsChartRef.current && analyticsFilter.length > 0) {
                        setTimeout(() => {
                            updateAnalyticsChart();
                        }, 100);
                    }
                }, [currentView, analyticsFilter, analyticsPeriod, entries, sleepSessions, breastfeedingEntries, breastPumpEntries]);

                // Charger la garde-robe quand on arrive sur la vue wardrobe
                useEffect(() => {
                    if (currentView === 'wardrobe' && user?.code) {
                        loadWardrobePage(0, true);
                    }
                }, [currentView, user?.code]);
                // Fonction pour fermer la pop-up et marquer comme vue
                const closeUpdatePopup = () => {
                    const currentVersion = '1.8.0';
                    localStorage.setItem('babytrack_last_version', currentVersion);
                    setShowUpdatePopup(false);
                };
                // Fonction pour mettre √† jour le graphique principal
                const updateAnalyticsChart = () => {
                    if (!analyticsChartRef.current || analyticsFilter.length === 0) return;

                    const ctx = analyticsChartRef.current.getContext('2d');
                    if (analyticsChartInstance.current) {
                        analyticsChartInstance.current.destroy();
                    }

                    const now = new Date();
                    let startDate, endDate, labels = [];

                    // Configuration selon la p√©riode
                    switch (analyticsPeriod) {
                        case 'daily':
                            startDate = getDayStart(now);
                            endDate = getDayEnd(now);
                            for (let h = 0; h < 24; h++) {
                                labels.push(`${h}h`);
                            }
                            break;
                        case 'weekly':
                            startDate = new Date(now);
                            startDate.setDate(startDate.getDate() - 6);
                            startDate.setHours(0, 0, 0, 0);
                            endDate = getDayEnd(now);
                            for (let d = 0; d < 7; d++) {
                                const currentDay = new Date(startDate);
                                currentDay.setDate(startDate.getDate() + d);
                                labels.push(currentDay.toLocaleDateString('fr-FR', { weekday: 'short', day: 'numeric' }));
                            }
                            break;
                        case 'monthly':
                            startDate = new Date(now);
                            startDate.setDate(startDate.getDate() - 29);
                            startDate.setHours(0, 0, 0, 0);
                            endDate = getDayEnd(now);
                            for (let d = 0; d < 30; d += 3) {
                                const currentDay = new Date(startDate);
                                currentDay.setDate(startDate.getDate() + d);
                                labels.push(currentDay.getDate().toString());
                            }
                            break;
                    }

                    const datasets = [];

                    // Dataset Biberons
                    if (analyticsFilter.includes('feeding')) {
                        const feedingData = labels.map((_, index) => {
                            if (analyticsPeriod === 'daily') {
                                const hour = index;
                                const hourStart = new Date(startDate);
                                hourStart.setHours(hour, 0, 0, 0);
                                const hourEnd = new Date(startDate);
                                hourEnd.setHours(hour, 59, 59, 999);

                                return entries
                                    .filter(entry => {
                                        const entryDate = new Date(entry.timestamp);
                                        return entry.type === 'feeding' && entryDate >= hourStart && entryDate <= hourEnd;
                                    })
                                    .reduce((sum, entry) => sum + parseInt(entry.amount || 0), 0);
                            } else {
                                const dayIndex = index;
                                const dayStart = new Date(startDate);
                                dayStart.setDate(startDate.getDate() + dayIndex * (analyticsPeriod === 'weekly' ? 1 : 3));
                                const dayEnd = new Date(dayStart);
                                dayEnd.setHours(23, 59, 59, 999);

                                return entries
                                    .filter(entry => {
                                        const entryDate = new Date(entry.timestamp);
                                        return entry.type === 'feeding' && entryDate >= dayStart && entryDate <= dayEnd;
                                    })
                                    .reduce((sum, entry) => sum + parseInt(entry.amount || 0), 0);
                            }
                        });

                        datasets.push({
                            label: 'Biberons (ml)',
                            data: feedingData,
                            borderColor: '#3B82F6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            pointRadius: 4,
                        });
                    }

                    // Dataset Pipis
                    if (analyticsFilter.includes('diaper-pee')) {
                        const peeData = labels.map((_, index) => {
                            if (analyticsPeriod === 'daily') {
                                const hour = index;
                                const hourStart = new Date(startDate);
                                hourStart.setHours(hour, 0, 0, 0);
                                const hourEnd = new Date(startDate);
                                hourEnd.setHours(hour, 59, 59, 999);

                                return entries.filter(entry => {
                                    const entryDate = new Date(entry.timestamp);
                                    return entry.hasPee && entryDate >= hourStart && entryDate <= hourEnd;
                                }).length;
                            } else {
                                const dayIndex = index;
                                const dayStart = new Date(startDate);
                                dayStart.setDate(startDate.getDate() + dayIndex * (analyticsPeriod === 'weekly' ? 1 : 3));
                                const dayEnd = new Date(dayStart);
                                dayEnd.setHours(23, 59, 59, 999);

                                return entries.filter(entry => {
                                    const entryDate = new Date(entry.timestamp);
                                    return entry.hasPee && entryDate >= dayStart && entryDate <= dayEnd;
                                }).length;
                            }
                        });

                        datasets.push({
                            label: 'Pipis',
                            data: peeData,
                            borderColor: '#06B6D4',
                            backgroundColor: 'rgba(6, 182, 212, 0.1)',
                            tension: 0.4,
                            pointRadius: 4,
                        });
                    }

                    // Dataset Cacas
                    if (analyticsFilter.includes('diaper-poop')) {
                        const poopData = labels.map((_, index) => {
                            if (analyticsPeriod === 'daily') {
                                const hour = index;
                                const hourStart = new Date(startDate);
                                hourStart.setHours(hour, 0, 0, 0);
                                const hourEnd = new Date(startDate);
                                hourEnd.setHours(hour, 59, 59, 999);

                                return entries.filter(entry => {
                                    const entryDate = new Date(entry.timestamp);
                                    return entry.hasPoop && entryDate >= hourStart && entryDate <= hourEnd;
                                }).length;
                            } else {
                                const dayIndex = index;
                                const dayStart = new Date(startDate);
                                dayStart.setDate(startDate.getDate() + dayIndex * (analyticsPeriod === 'weekly' ? 1 : 3));
                                const dayEnd = new Date(dayStart);
                                dayEnd.setHours(23, 59, 59, 999);

                                return entries.filter(entry => {
                                    const entryDate = new Date(entry.timestamp);
                                    return entry.hasPoop && entryDate >= dayStart && entryDate <= dayEnd;
                                }).length;
                            }
                        });

                        datasets.push({
                            label: 'Cacas',
                            data: poopData,
                            borderColor: '#F59E0B',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            tension: 0.4,
                            pointRadius: 4,
                        });
                    }

                    analyticsChartInstance.current = new Chart(ctx, {
                        type: 'line',
                        data: { labels, datasets },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: { display: true, text: 'Valeurs' }
                                }
                            }
                        }
                    });
                };
                const updateAnalyticsCharts = () => {
                    if (analyticsFilter.includes('feeding')) updateFeedingChart();
                    if (analyticsFilter.includes('diaper')) updateDiaperChart();
                    if (analyticsFilter.includes('breastfeeding')) updateBreastfeedingChart();
                    if (analyticsFilter.includes('sleep')) updateSleepAnalyticsChart();
                    if (analyticsFilter.includes('food')) updateFoodChart();
                };
                return (
                    <div className="bg-white/90 rounded-2xl p-4 shadow-xl border border-white/50 mb-4">
                        <h3 className="font-bold text-gray-900 mb-3 flex items-center gap-2">
                            <div className="w-8 h-8 bg-indigo-100 rounded-xl flex items-center justify-center">
                                <i className="fas fa-chart-line text-indigo-600"></i>
                            </div>
                            √âvolution de la croissance
                        </h3>
                        <div className="h-48">
                            <canvas ref={chartRef} className="w-full h-full"></canvas>
                        </div>
                    </div>
                );
            };



            const editWardrobeItem = (itemId) => {
                const item = wardrobe.find(i => i.id === itemId);
                if (item) {
                    setWardrobeData({
                        type: item.type,
                        size: item.size,
                        quantity: item.quantity,
                        color: item.color || '',
                        notes: item.notes || ''
                    });
                    setEditingWardrobeId(itemId);
                    setShowWardrobeModal(true);
                }
            };

            const editSleepSession = (sessionId) => {
                const session = sleepSessions.find(s => s.id === sessionId);
                if (!session) return;

                const startDate = new Date(session.startTime);
                const endDate = new Date(session.endTime);

                setSleepData({
                    startTime: startDate.toTimeString().slice(0, 5),
                    endTime: endDate.toTimeString().slice(0, 5),
                    date: startDate.toISOString().slice(0, 10)
                });
                setEditingSleepId(sessionId);
                setShowSleepModal(true);
            };
            const deleteSleepSession = async (sessionId) => {
                if (!confirm('Supprimer cette session de sommeil ?')) return;

                try {
                    await db.collection('sleep_sessions').doc(sessionId).delete();
                } catch (error) {
                    console.error('Erreur suppression session:', error);
                    alert('Erreur lors de la suppression');
                }
            };



            // Graphique quotidien
            const updateChart = () => {
                if (!chartRef.current) return;

                const ctx = chartRef.current.getContext('2d');

                if (chartInstance.current) {
                    chartInstance.current.destroy();
                }

                const now = new Date();
                let startDate, endDate, filteredFeedings, labels, data, labelFormat;

                // Configuration selon la p√©riode
                switch (periodView) {
                    case 'daily':
                        startDate = getDayStart(now);
                        endDate = getDayEnd(now);

                        filteredFeedings = entries.filter(entry => {
                            const entryDate = new Date(entry.timestamp);
                            return entry.type === 'feeding' && entryDate >= startDate && entryDate <= endDate;
                        });

                        // Labels par heure pour la vue quotidienne
                        labels = [];
                        data = [];
                        for (let h = 0; h < 24; h++) {
                            const hourStr = `${h}h`;
                            labels.push(hourStr);

                            let cumulativeMilk = 0;
                            const currentTime = new Date(startDate);
                            currentTime.setHours(h, 59, 59, 999);

                            filteredFeedings.forEach(feeding => {
                                const feedingTime = new Date(feeding.timestamp);
                                if (feedingTime <= currentTime) {
                                    cumulativeMilk += parseInt(feeding.amount || 0);
                                }
                            });

                            data.push(cumulativeMilk);
                        }
                        labelFormat = 'Lait cumul√© par heure';
                        break;

                    case 'weekly':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 6);
                        startDate.setHours(0, 0, 0, 0);
                        endDate = getDayEnd(now);

                        filteredFeedings = entries.filter(entry => {
                            const entryDate = new Date(entry.timestamp);
                            return entry.type === 'feeding' && entryDate >= startDate && entryDate <= endDate;
                        });

                        // Labels par jour pour la vue hebdomadaire
                        labels = [];
                        data = [];
                        for (let d = 0; d < 7; d++) {
                            const currentDay = new Date(startDate);
                            currentDay.setDate(startDate.getDate() + d);

                            const dayStart = getDayStart(currentDay);
                            const dayEnd = getDayEnd(currentDay);

                            const dayLabel = currentDay.toLocaleDateString('fr-FR', {
                                weekday: 'short',
                                day: 'numeric'
                            });
                            labels.push(dayLabel);

                            const dayTotal = filteredFeedings
                                .filter(feeding => {
                                    const feedingTime = new Date(feeding.timestamp);
                                    return feedingTime >= dayStart && feedingTime <= dayEnd;
                                })
                                .reduce((sum, feeding) => sum + parseInt(feeding.amount || 0), 0);

                            data.push(dayTotal);
                        }
                        labelFormat = 'Lait total par jour';
                        break;

                    case 'monthly':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 29);
                        startDate.setHours(0, 0, 0, 0);
                        endDate = getDayEnd(now);

                        filteredFeedings = entries.filter(entry => {
                            const entryDate = new Date(entry.timestamp);
                            return entry.type === 'feeding' && entryDate >= startDate && entryDate <= endDate;
                        });

                        // Labels par jour pour la vue mensuelle (plus d√©taill√©e)
                        labels = [];
                        data = [];
                        for (let d = 0; d < 30; d++) {
                            const currentDay = new Date(startDate);
                            currentDay.setDate(startDate.getDate() + d);

                            const dayStart = getDayStart(currentDay);
                            const dayEnd = getDayEnd(currentDay);

                            // Afficher que certains jours pour √©viter l'encombrement
                            const dayLabel = d % 5 === 0 ? currentDay.getDate().toString() : '';
                            labels.push(dayLabel);

                            const dayTotal = filteredFeedings
                                .filter(feeding => {
                                    const feedingTime = new Date(feeding.timestamp);
                                    return feedingTime >= dayStart && feedingTime <= dayEnd;
                                })
                                .reduce((sum, feeding) => sum + parseInt(feeding.amount || 0), 0);

                            data.push(dayTotal);
                        }
                        labelFormat = 'Lait total par jour';
                        break;

                    default:
                        return;
                }

                chartInstance.current = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: labelFormat,
                            data: data,
                            borderColor: user?.gender === 'girl' ? '#ec4899' : '#3B82F6',
                            backgroundColor: user?.gender === 'girl' ? 'rgba(236, 72, 153, 0.1)' : 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            fill: true,
                            pointBackgroundColor: user?.gender === 'girl' ? '#ec4899' : '#3B82F6',
                            pointRadius: periodView === 'daily' ? 2 : periodView === 'monthly' ? 1 : 4,
                            pointHoverRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    fontSize: 10,
                                    callback: function (value) {
                                        return value + 'ml';
                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'Volume (ml)'
                                }
                            },
                            x: {
                                ticks: { fontSize: periodView === 'monthly' ? 8 : 10 },
                                title: {
                                    display: true,
                                    text: periodView === 'daily' ? 'Heures' : 'Jours'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        return `${context.parsed.y}ml`;
                                    }
                                }
                            }
                        }
                    }
                });
            };
            const updateSleepChart = () => {
                if (!sleepChartRef.current) return;

                const ctx = sleepChartRef.current.getContext('2d');

                if (sleepChartInstance.current) {
                    sleepChartInstance.current.destroy();
                }

                const now = new Date();
                let startDate, endDate, filteredSleep, labels, data;

                switch (sleepPeriodView) {
                    case 'week':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 6);
                        startDate.setHours(0, 0, 0, 0);
                        endDate = getDayEnd(now);

                        filteredSleep = sleepSessions.filter(session => {
                            const sessionDate = new Date(session.startTime);
                            return session.status === 'completed' &&
                                sessionDate >= startDate && sessionDate <= endDate;
                        });

                        // Par jour
                        labels = [];
                        data = [];
                        for (let d = 0; d < 7; d++) {
                            const currentDay = new Date(startDate);
                            currentDay.setDate(startDate.getDate() + d);

                            const dayStart = getDayStart(currentDay);
                            const dayEnd = getDayEnd(currentDay);

                            const dayLabel = currentDay.toLocaleDateString('fr-FR', {
                                weekday: 'short',
                                day: 'numeric'
                            });
                            labels.push(dayLabel);

                            const dayTotal = filteredSleep
                                .filter(session => {
                                    const sessionTime = new Date(session.startTime);
                                    return sessionTime >= dayStart && sessionTime <= dayEnd;
                                })
                                .reduce((sum, session) => sum + (session.duration || 0), 0);

                            data.push(Math.round(dayTotal / 60 * 10) / 10); // Convertir en heures
                        }
                        break;

                    case 'month':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 29);
                        startDate.setHours(0, 0, 0, 0);
                        endDate = getDayEnd(now);

                        filteredSleep = sleepSessions.filter(session => {
                            const sessionDate = new Date(session.startTime);
                            return session.status === 'completed' &&
                                sessionDate >= startDate && sessionDate <= endDate;
                        });

                        // Par semaine
                        labels = [];
                        data = [];
                        for (let w = 0; w < 4; w++) {
                            const weekStart = new Date(startDate);
                            weekStart.setDate(startDate.getDate() + (w * 7));
                            const weekEnd = new Date(weekStart);
                            weekEnd.setDate(weekStart.getDate() + 6);
                            weekEnd.setHours(23, 59, 59, 999);

                            labels.push(`S${w + 1}`);

                            const weekTotal = filteredSleep
                                .filter(session => {
                                    const sessionTime = new Date(session.startTime);
                                    return sessionTime >= weekStart && sessionTime <= weekEnd;
                                })
                                .reduce((sum, session) => sum + (session.duration || 0), 0);

                            data.push(Math.round(weekTotal / 60 * 10) / 10); // Convertir en heures
                        }
                        break;
                }

                sleepChartInstance.current = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Sommeil (heures)',
                            data: data,
                            backgroundColor: 'rgba(147, 51, 234, 0.6)',
                            borderColor: 'rgba(147, 51, 234, 1)',
                            borderWidth: 2,
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    fontSize: 8,
                                    callback: function (value) {
                                        return value + 'h';
                                    }
                                }
                            },
                            x: {
                                ticks: { fontSize: 8 }
                            }
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        const hours = Math.floor(context.parsed.y);
                                        const minutes = Math.round((context.parsed.y - hours) * 60);
                                        return `${hours}h${minutes.toString().padStart(2, '0')}`;
                                    }
                                }
                            }
                        }
                    }
                });
            };
            // Fonctions d'information sur les selles
            const getPoopInfo = (quantity, consistency, color) => {
                const quantities = {
                    'peu': { label: 'Un peu', emoji: 'ü§è' },
                    'moyen': { label: 'Moyen', emoji: 'üëå' },
                    'beaucoup': { label: 'Beaucoup', emoji: 'üôå' }
                };

                const consistencies = {
                    'liquide': { label: 'Liquide', emoji: 'üíß' },
                    'molle': { label: 'Molle', emoji: 'üü°' },
                    'normale': { label: 'Normale', emoji: 'üü§' },
                    'dure': { label: 'Dure', emoji: 'üî¥' }
                };

                const colors = {
                    'noir': { label: 'Noir', emoji: '‚ö´', bgColor: 'bg-gray-800', textColor: 'text-white' },
                    'marron': { label: 'Marron', emoji: 'üü§', bgColor: 'bg-amber-700', textColor: 'text-white' },
                    'vert': { label: 'Vert', emoji: 'üü¢', bgColor: 'bg-green-600', textColor: 'text-white' },
                    'jaune': { label: 'Jaune', emoji: 'üü°', bgColor: 'bg-yellow-400', textColor: 'text-gray-800' }
                };

                return {
                    quantity: quantities[quantity] || { label: '', emoji: '' },
                    consistency: consistencies[consistency] || { label: '', emoji: '' },
                    color: colors[color] || { label: '', emoji: '', bgColor: 'bg-orange-100', textColor: 'text-orange-800' }
                };
            };


            // Calculer les recommandations alimentaires
            const age = calculateAge();

            const themeColors = getThemeColors();
            // √âcran de chargement
            if (isLoading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 flex items-center justify-center">
                        <div className="text-center">
                            <div className="inline-block mb-6">
                                <img src="logo.PNG" alt="BabyTrack" className="w-32 h-32 mx-auto rounded-3xl shadow-2xl" />
                            </div>
                            <div className="flex items-center justify-center gap-2 mb-4">
                                <div className="w-3 h-3 bg-blue-500 rounded-full " style={{ animationDelay: '0s' }}></div>
                                <div className="w-3 h-3 bg-indigo-500 rounded-full " style={{ animationDelay: '0.2s' }}></div>
                                <div className="w-3 h-3 bg-purple-500 rounded-full " style={{ animationDelay: '0.4s' }}></div>
                            </div>
                            <p className="text-lg font-semibold text-gray-700">Chargement...</p>
                        </div>
                    </div>
                );
            }

            // Rendu conditionnel - √âcran d'authentification
            if (showAuth) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl p-6 max-w-md w-full shadow-xl">
                            <div className="text-center mb-6">
                                <div className="inline-block mb-4">
                                    <img src="logo.PNG" alt="BabyTrack Logo" className="w-40 h-40 mx-auto rounded-2xl" />                                </div>

                            </div>

                            {authMode === 'login' ? (
                                <div className="space-y-4">
                                    <h2 className="text-lg font-semibold">Se connecter</h2>
                                    <input
                                        type="text"
                                        placeholder="Code famille (6 caract√®res)"
                                        className="w-full border rounded-xl px-4 py-3 text-center uppercase"
                                        maxLength="6"
                                        value={authData.code}
                                        onChange={(e) => setAuthData(prev => ({ ...prev, code: e.target.value }))}
                                    />
                                    <button
                                        onClick={() => handleLogin()}
                                        className="w-full bg-blue-500 text-white py-3 rounded-xl font-medium"
                                    >
                                        Se connecter
                                    </button>
                                    <button
                                        onClick={() => setAuthMode('create')}
                                        className="w-full bg-gray-200 text-gray-700 py-3 rounded-xl font-medium"
                                    >
                                        Cr√©er un compte famille
                                    </button>
                                </div>
                            ) : (
                                <div className="space-y-4">
                                    <h2 className="text-lg font-semibold">Nouvelle famille</h2>
                                    <input
                                        type="text"
                                        placeholder="Nom du b√©b√©"
                                        className="w-full border rounded-xl px-4 py-3"
                                        value={authData.babyName}
                                        onChange={(e) => setAuthData(prev => ({ ...prev, babyName: e.target.value }))}
                                    />
                                    <input
                                        type="date"
                                        className="w-full border rounded-xl px-4 py-3"
                                        value={authData.birthDate}
                                        onChange={(e) => setAuthData(prev => ({ ...prev, birthDate: e.target.value }))}
                                    />
                                    <input
                                        type="time"
                                        className="w-full border rounded-xl px-4 py-3"
                                        value={authData.birthTime}
                                        onChange={(e) => setAuthData(prev => ({ ...prev, birthTime: e.target.value }))}
                                    />
                                    <div className="grid grid-cols-2 gap-3">
                                        <input
                                            type="number"
                                            placeholder="Poids (kg)"
                                            step="0.001"
                                            className="w-full border rounded-xl px-4 py-3"
                                            value={authData.birthWeight}
                                            onChange={(e) => setAuthData(prev => ({ ...prev, birthWeight: e.target.value }))}
                                        />
                                        <input
                                            type="number"
                                            placeholder="Taille (cm)"
                                            className="w-full border rounded-xl px-4 py-3"
                                            value={authData.birthHeight}
                                            onChange={(e) => setAuthData(prev => ({ ...prev, birthHeight: e.target.value }))}
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Sexe</label>
                                        <select
                                            className="w-full border rounded-xl px-4 py-3"
                                            value={authData.gender}
                                            onChange={(e) => setAuthData(prev => ({ ...prev, gender: e.target.value }))}
                                        >
                                            <option value="boy">Gar√ßon</option>
                                            <option value="girl">Fille</option>
                                        </select>
                                    </div>
                                    <input
                                        type="text"
                                        placeholder="Noms des parents"
                                        className="w-full border rounded-xl px-4 py-3"
                                        value={authData.parents}
                                        onChange={(e) => setAuthData(prev => ({ ...prev, parents: e.target.value }))}
                                    />
                                    <button
                                        onClick={handleCreateAccount}
                                        className="w-full bg-green-500 text-white py-3 rounded-xl font-medium"
                                    >
                                        Cr√©er la famille
                                    </button>
                                    <button
                                        onClick={() => setAuthMode('login')}
                                        className="w-full bg-gray-200 text-gray-700 py-3 rounded-xl font-medium"
                                    >
                                        Retour
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            // Navigation tabs
            const TabButton = ({ id, label, icon, active, onClick }) => (
                <button
                    onClick={onClick}
                    className={`flex flex-col items-center justify-center p-2 rounded-lg text-xs font-medium transition-all ${active
                        ? `${themeColors.primaryBg} text-white shadow-md`
                        : 'text-gray-600 hover:text-gray-800'
                        }`}
                >
                    <i className={`${icon} text-lg mb-1`}></i>
                    <span>{label}</span>
                </button>
            );
            // Fonction pour obtenir l'ic√¥ne et l'animation selon la comp√©tence
            const getAccomplishmentVisual = (accomplishmentText) => {
                const text = accomplishmentText.toLowerCase();

                // Mouvements de la t√™te
                if (text.includes('t√™te') && (text.includes('haute') || text.includes('stable') || text.includes('droite'))) {
                    return { icon: 'üë∂', animation: 'shake-head', color: 'from-blue-100 to-blue-200' };
                }

                // Se retourner
                if (text.includes('retourne') || (text.includes('ventre') && text.includes('dos'))) {
                    return { icon: 'üîÑ', animation: 'rotate-slow', color: 'from-purple-100 to-purple-200' };
                }

                // Mains √† la bouche
                if (text.includes('mains') && text.includes('bouche')) {
                    return { icon: '‚úã', animation: 'bounce-gentle', color: 'from-pink-100 to-pink-200' };
                }

                // Bras et jambes
                if (text.includes('bras') || text.includes('jambes') || text.includes('sym√©trique')) {
                    return { icon: 'üí™', animation: 'swing', color: 'from-orange-100 to-orange-200' };
                }

                // Suivre des objets
                if (text.includes('suit') && text.includes('objets')) {
                    return { icon: 'üëÄ', animation: 'slide-lr', color: 'from-indigo-100 to-indigo-200' };
                }

                // Sourire
                if (text.includes('sourit') || text.includes('sourire')) {
                    return { icon: 'üòä', animation: 'pulse-soft', color: 'from-yellow-100 to-yellow-200' };
                }

                // Transfert d'objets
                if (text.includes('transf√®re') || text.includes('main √†')) {
                    return { icon: 'ü§≤', animation: 'slide-lr', color: 'from-teal-100 to-teal-200' };
                }

                // S'asseoir
                if (text.includes('assoit') || text.includes('assis')) {
                    return { icon: 'ü™ë', animation: 'bounce-gentle', color: 'from-green-100 to-green-200' };
                }

                // Ramper
                if (text.includes('rampe') || text.includes('d√©place')) {
                    return { icon: 'üêõ', animation: 'slide-lr', color: 'from-lime-100 to-lime-200' };
                }

                // Debout
                if (text.includes('debout') || text.includes('tient')) {
                    return { icon: 'üßç', animation: 'bounce-gentle', color: 'from-cyan-100 to-cyan-200' };
                }

                // Sons et babillage
                if (text.includes('babille') || text.includes('sons') || text.includes('consonnes') || text.includes('bruits')) {
                    return { icon: 'üó£Ô∏è', animation: 'pulse-soft', color: 'from-rose-100 to-rose-200' };
                }

                // √âcouter
                if (text.includes('√©coute') || text.includes('r√©agit') && text.includes('sons')) {
                    return { icon: 'üëÇ', animation: 'shake-head', color: 'from-purple-100 to-purple-200' };
                }

                // Reconna√Ætre
                if (text.includes('reconna√Æt') || text.includes('visages')) {
                    return { icon: 'üë®‚Äçüë©‚Äçüëß', animation: 'pulse-soft', color: 'from-pink-100 to-pink-200' };
                }

                // Rire
                if (text.includes('rit') || text.includes('rire')) {
                    return { icon: 'üòÑ', animation: 'bounce-gentle', color: 'from-yellow-100 to-yellow-200' };
                }

                // Explorer
                if (text.includes('explore') && text.includes('bouche')) {
                    return { icon: 'üçº', animation: 'float-gentle', color: 'from-orange-100 to-orange-200' };
                }

                // Chercher objets cach√©s
                if (text.includes('cherche') || text.includes('cach√©')) {
                    return { icon: 'üîç', animation: 'peek-a-boo', color: 'from-blue-100 to-blue-200' };
                }

                // Permanence des objets
                if (text.includes('permanence')) {
                    return { icon: 'üéÅ', animation: 'peek-a-boo', color: 'from-purple-100 to-purple-200' };
                }

                // Imiter
                if (text.includes('imite')) {
                    return { icon: 'ü™û', animation: 'pulse-soft', color: 'from-indigo-100 to-indigo-200' };
                }

                // Jouer (coucou)
                if (text.includes('joue') || text.includes('coucou')) {
                    return { icon: 'üëã', animation: 'swing', color: 'from-green-100 to-green-200' };
                }

                // Gestes pour communiquer
                if (text.includes('gestes') && text.includes('communiquer')) {
                    return { icon: '‚úåÔ∏è', animation: 'swing', color: 'from-teal-100 to-teal-200' };
                }

                // Comprendre des mots
                if (text.includes('comprend') && text.includes('mots')) {
                    return { icon: 'üí¨', animation: 'pulse-soft', color: 'from-blue-100 to-blue-200' };
                }

                // R√©pondre au nom
                if (text.includes('r√©pond') && text.includes('nom')) {
                    return { icon: 'üì¢', animation: 'shake-head', color: 'from-pink-100 to-pink-200' };
                }

                // Anxi√©t√© √©trangers
                if (text.includes('anxi√©t√©') || text.includes('√©trangers')) {
                    return { icon: 'üò∞', animation: 'shake-head', color: 'from-gray-100 to-gray-200' };
                }

                // Pr√©f√©rence personnes famili√®res
                if (text.includes('pr√©f√®re') && text.includes('famili√®res')) {
                    return { icon: '‚ù§Ô∏è', animation: 'pulse-soft', color: 'from-red-100 to-red-200' };
                }

                // Regarder le reflet
                if (text.includes('reflet') || text.includes('miroir')) {
                    return { icon: 'ü™û', animation: 'pulse-soft', color: 'from-cyan-100 to-cyan-200' };
                }

                // Montrer int√©r√™t/curiosit√©
                if (text.includes('int√©r√™t') || text.includes('curiosit√©')) {
                    return { icon: 'ü§î', animation: 'shake-head', color: 'from-yellow-100 to-yellow-200' };
                }

                // Joie et contrari√©t√© (√©motions)
                if (text.includes('joie') || text.includes('contrari√©t√©') || text.includes('√©motions')) {
                    return { icon: 'üòäüò¢', animation: 'pulse-soft', color: 'from-orange-100 to-orange-200' };
                }

                // Images
                if (text.includes('images')) {
                    return { icon: 'üì∑', animation: 'float-gentle', color: 'from-blue-100 to-blue-200' };
                }

                // Cause et effet
                if (text.includes('cause') && text.includes('effet')) {
                    return { icon: '‚ö°', animation: 'pulse-soft', color: 'from-yellow-100 to-yellow-200' };
                }

                // Pleurs diff√©rents
                if (text.includes('pleure') || text.includes('pleurs')) {
                    return { icon: 'üò¢', animation: 'bounce-gentle', color: 'from-blue-100 to-blue-200' };
                }

                // Se calmer
                if (text.includes('calme')) {
                    return { icon: 'üòå', animation: 'float-gentle', color: 'from-green-100 to-green-200' };
                }

                // D√©faut pour les autres
                return { icon: '‚ú®', animation: 'pulse-soft', color: 'from-purple-100 to-purple-200' };
            };

            return (

                <div className="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50">
                    <div className="max-w-md mx-auto p-4 pb-24">

                        {/* Header masqu√© sur toutes les vues sauf daily */}
                        {currentView === 'daily' && (
                            <div className="relative mb-4">
                                <div className="bg-white/95 backdrop-blur-xl rounded-2xl shadow-lg border border-white/50 p-3">
                                    <div className="flex items-center justify-end mb-2">
                                        <button
                                            onClick={logout}
                                            className="w-6 h-6 rounded-lg bg-gray-50 flex items-center justify-center"
                                        >
                                            <i className="fas fa-sign-out-alt text-xs text-gray-400"></i>
                                        </button>

                                    </div>

                                    <div className="flex items-center gap-3 mb-2">
                                        {/* Photo/Avatar am√©lior√© avec support HEIC */}
                                        <div className="relative">
                                            <input
                                                type="file"
                                                accept="image/*,.heic,.HEIC"
                                                onChange={async (e) => {
                                                    const file = e.target.files[0];
                                                    if (file) {
                                                        try {
                                                            // Support HEIC avec heic2any
                                                            let processedFile = file;

                                                            if (file.type === 'image/heic' || file.name.toLowerCase().endsWith('.heic')) {
                                                                // Convertir HEIC en JPEG
                                                                if (window.heic2any) {
                                                                    processedFile = await heic2any({
                                                                        blob: file,
                                                                        toType: "image/jpeg",
                                                                        quality: 0.8
                                                                    });
                                                                }
                                                            }

                                                            const reader = new FileReader();
                                                            reader.onload = async (e) => {
                                                                const imageData = e.target.result;

                                                                // Sauvegarder la photo dans Firebase
                                                                try {
                                                                    await db.collection('families').doc(user.code).update({
                                                                        photo: imageData
                                                                    });
                                                                    setUser(prev => ({ ...prev, photo: imageData }));
                                                                } catch (error) {
                                                                    console.error('Erreur sauvegarde photo:', error);
                                                                    // Garder la photo localement m√™me si Firebase √©choue
                                                                    setUser(prev => ({ ...prev, photo: imageData }));
                                                                }
                                                            };
                                                            reader.readAsDataURL(processedFile);
                                                        } catch (error) {
                                                            console.error('Erreur traitement photo:', error);
                                                            alert('Erreur lors du traitement de la photo');
                                                        }
                                                    }
                                                }}
                                                className="hidden"
                                                id="photo-upload"
                                            />
                                            <label
                                                htmlFor="photo-upload"
                                                className="group block w-24 h-24 rounded-xl overflow-hidden cursor-pointer border-2 border-gray-200 hover:border-blue-400 transition-all duration-200 relative"
                                            >
                                                {user?.photo ? (
                                                    <>
                                                        <img
                                                            src={user.photo}
                                                            alt={user.babyName}
                                                            className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-200"
                                                        />
                                                        {/* Overlay pour indiquer qu'on peut changer */}
                                                        <div className="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center">
                                                            <i className="fas fa-camera text-white text-sm"></i>
                                                        </div>
                                                    </>
                                                ) : (
                                                    <div
                                                        className="w-full h-full flex items-center justify-center text-2xl group-hover:scale-105 transition-transform duration-200 relative"
                                                        style={{
                                                            background: `linear-gradient(135deg, ${user?.gender === 'girl' ? '#ec4899' : '#3b82f6'} 0%, ${user?.gender === 'girl' ? '#f472b6' : '#6366f1'} 100%)`
                                                        }}
                                                    >
                                                        <span className="text-white">
                                                            {user?.gender === 'girl' ? 'üëß' : 'üë¶'}
                                                        </span>
                                                        {/* Indicateur pour ajouter une photo */}
                                                        <div className="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center">
                                                            <i className="fas fa-plus text-white text-sm"></i>
                                                        </div>
                                                    </div>
                                                )}
                                            </label>
                                        </div>
                                        <div className="flex-1">
                                            <h1 className="text-lg font-bold text-gray-900 mb-1">{user?.babyName}</h1>
                                            <div className="text-sm font-semibold text-gray-600">{formatAgeDisplay(age)}</div>

                                            {/* Prochain biberon avec dernier en petit */}
                                            {nextFeedingInfo && (
                                                <div className="mt-2">
                                                    {(() => {
                                                        const now = new Date();
                                                        const lastFeedingTime = new Date(nextFeedingInfo.lastFeeding);

                                                        // Formatage de l'heure exacte
                                                        const formatExactTime = (date) => {
                                                            return date.toLocaleTimeString('fr-FR', {
                                                                hour: '2-digit',
                                                                minute: '2-digit'
                                                            });
                                                        };

                                                        // Si l'intervalle est d√©sactiv√©
                                                        if (feedingInterval === 0 || !nextFeedingInfo.nextTime) {
                                                            return (
                                                                <div className="bg-gradient-to-r from-green-500 to-green-600 text-white px-3 py-2 rounded-xl text-xs font-medium shadow-lg">
                                                                    <div className="flex items-center gap-2">
                                                                        <span className="text-sm">üçº</span>
                                                                        <div className="flex-1">
                                                                            <div className="font-bold">Donner quand {user?.babyName} r√©clame</div>                                                                            <div className="text-xs opacity-80">
                                                                                Dernier √† {formatExactTime(lastFeedingTime)}
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            );
                                                        }

                                                        // Sinon, affichage normal avec calcul
                                                        const nextFeedingTime = new Date(nextFeedingInfo.nextTime);
                                                        const minutesSinceLastFeeding = Math.floor((now - lastFeedingTime) / (1000 * 60));
                                                        const minutesUntilNextFeeding = Math.ceil((nextFeedingTime - now) / (1000 * 60));

                                                        // Formatage du temps √©coul√©
                                                        const formatTime = (minutes) => {
                                                            if (minutes < 0) return "0 min";
                                                            if (minutes < 60) return `${minutes} min`;
                                                            const hours = Math.floor(minutes / 60);
                                                            const mins = minutes % 60;
                                                            return mins > 0 ? `${hours}h${mins.toString().padStart(2, '0')}` : `${hours}h`;
                                                        };

                                                        let bgClass, textClass, emoji, mainMessage;

                                                        if (minutesUntilNextFeeding <= 0) {
                                                            // C'est l'heure ou en retard
                                                            bgClass = 'bg-gradient-to-r from-red-500 to-red-600';
                                                            textClass = 'text-white';
                                                            emoji = 'üö®';
                                                            mainMessage = 'C\'est l\'heure !';
                                                        } else if (minutesUntilNextFeeding <= 30) {
                                                            // Bient√¥t (dans moins de 30 min)
                                                            bgClass = 'bg-gradient-to-r from-orange-500 to-orange-600';
                                                            textClass = 'text-white';
                                                            emoji = '‚è∞';
                                                            mainMessage = `Prochain biberon √† ${formatExactTime(nextFeedingTime)}`;
                                                        } else if (minutesUntilNextFeeding <= 120) {
                                                            // Normal (30min - 2h)
                                                            bgClass = 'bg-gradient-to-r from-blue-500 to-blue-600';
                                                            textClass = 'text-white';
                                                            emoji = 'üçº';
                                                            mainMessage = `Prochain biberon √† ${formatExactTime(nextFeedingTime)}`;
                                                        } else {
                                                            // Loin (plus de 2h)
                                                            bgClass = 'bg-gradient-to-r from-green-500 to-green-600';
                                                            textClass = 'text-white';
                                                            emoji = 'üò¥';
                                                            mainMessage = `Prochain biberon √† ${formatExactTime(nextFeedingTime)}`;
                                                        }

                                                        return (
                                                            <div className={`${bgClass} ${textClass} px-3 py-2 rounded-xl text-xs font-medium shadow-lg`}>
                                                                <div className="flex items-center gap-2">
                                                                    <span className="text-sm">{emoji}</span>
                                                                    <div className="flex-1">
                                                                        <div className="font-bold">{mainMessage}</div>
                                                                        <div className="text-xs opacity-80">
                                                                            Dernier √† {formatExactTime(lastFeedingTime)}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        );
                                                    })()}
                                                </div>
                                            )}
                                        </div>
                                    </div>



                                </div>
                            </div>
                        )}
                        {/* Menu d'export */}
                        {showExportMenu && (
                            <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                                <div className="bg-white rounded-2xl p-6 max-w-sm w-full shadow-2xl">
                                    <div className="flex items-center justify-between mb-4">
                                        <h3 className="text-lg font-bold text-gray-900">Export des donn√©es</h3>
                                        <button
                                            onClick={() => setShowExportMenu(false)}
                                            className="w-8 h-8 rounded-lg bg-gray-100 flex items-center justify-center"
                                        >
                                            <i className="fas fa-times text-gray-600"></i>
                                        </button>
                                    </div>

                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">P√©riode</label>
                                            <select
                                                className="w-full px-3 py-2 border rounded-xl"
                                                value={exportPeriod}
                                                onChange={(e) => setExportPeriod(e.target.value)}
                                            >
                                                <option value="day">Aujourd'hui</option>
                                                <option value="week">7 derniers jours</option>
                                                <option value="month">30 derniers jours</option>
                                            </select>
                                        </div>

                                        <div className="grid grid-cols-2 gap-3">

                                            <button
                                                onClick={exportToPDF}
                                                disabled={isExporting}
                                                className="bg-blue-500 text-white py-3 rounded-xl font-medium disabled:opacity-50"
                                            >
                                                {isExporting ? 'Export...' : 'PDF'}
                                            </button>
                                        </div>

                                        <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                                            <p className="text-xs text-yellow-800">
                                                <i className="fas fa-info-circle mr-1"></i>
                                                Ces exports sont parfaits √† partager avec votre p√©diatre lors des consultations.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* Navigation fixe en bas */}
                        <div className="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-lg border-t border-gray-200 shadow-xl z-50">
                            <div className="max-w-md mx-auto px-4 py-2">
                                <div className="flex items-center justify-around">
                                    {/* Accueil */}
                                    <button
                                        onClick={() => {
                                            setCurrentView('daily');
                                            window.scrollTo({ top: 0, behavior: 'smooth' });
                                        }}
                                        className={`flex flex-col items-center p-2 rounded-2xl transition-all ${currentView === 'daily'
                                            ? `text-${user?.gender === 'girl' ? 'pink' : 'blue'}-600`
                                            : 'text-gray-500'
                                            }`}
                                    >
                                        <i className="fas fa-home text-lg mb-1"></i>
                                        <span className="text-xs font-medium">Accueil</span>
                                    </button>

                                    {/* Profil */}
                                    <button
                                        onClick={() => {
                                            setCurrentView('profile');
                                            window.scrollTo({ top: 0, behavior: 'smooth' });
                                        }}
                                        className={`flex flex-col items-center p-2 rounded-2xl transition-all ${currentView === 'profile'
                                            ? `text-${user?.gender === 'girl' ? 'pink' : 'blue'}-600`
                                            : 'text-gray-500'
                                            }`}
                                    >
                                        <i className="fas fa-user text-lg mb-1"></i>
                                        <span className="text-xs font-medium">Profil</span>
                                    </button>

                                    {/* Bouton + central avec menu d√©roulant - RESTE IDENTIQUE */}
                                    <div className="relative -mt-6" data-menu="plus">
                                        <button
                                            onClick={() => setShowPlusMenu(!showPlusMenu)}
                                            className={`w-16 h-16 bg-gradient-to-r ${themeColors.primary} text-white rounded-full shadow-xl flex items-center justify-center transition-transform duration-300 ${showPlusMenu ? 'rotate-45' : ''}`}
                                        >
                                            <i className="fas fa-plus text-2xl"></i>
                                        </button>

                                        {/* Menu d√©roulant simple */}
                                        {showPlusMenu && (
                                            <div className="absolute bottom-20 left-1/2 transform -translate-x-1/2 bg-white rounded-2xl shadow-2xl border border-gray-200 p-3 min-w-[200px] z-50">
                                                <div className="grid grid-cols-2 gap-3">
                                                    {/* Biberon */}
                                                    <button
                                                        onClick={() => {
                                                            openForm('feeding');
                                                            setShowPlusMenu(false);
                                                        }}
                                                        className={`flex flex-col items-center p-3 rounded-xl bg-gradient-to-r ${themeColors.primary} text-white hover:opacity-90 transition-opacity`}
                                                    >
                                                        <i className="fas fa-bottle-water text-xl mb-1"></i>
                                                        <span className="text-xs font-medium">Biberon</span>
                                                    </button>

                                                    {/* Couche */}
                                                    <button
                                                        onClick={() => {
                                                            openForm('diaper');
                                                            setShowPlusMenu(false);
                                                        }}
                                                        className="flex flex-col items-center p-3 rounded-xl bg-gradient-to-r from-green-500 to-green-600 text-white hover:opacity-90 transition-opacity"
                                                    >
                                                        <i className="fas fa-baby text-xl mb-1"></i>
                                                        <span className="text-xs font-medium">Couche</span>
                                                    </button>

                                                    {/* Allaitement */}
                                                    <button
                                                        onClick={() => {
                                                            setShowBreastfeedingModal(true);
                                                            setShowPlusMenu(false);
                                                        }}
                                                        className="flex flex-col items-center p-3 rounded-xl bg-gradient-to-r from-pink-500 to-pink-600 text-white hover:opacity-90 transition-opacity"
                                                    >
                                                        <i className="fas fa-heart text-xl mb-1"></i>
                                                        <span className="text-xs font-medium">Allaitement</span>
                                                    </button>

                                                    {/* Tire-lait */}
                                                    <button
                                                        onClick={() => {
                                                            setShowBreastPumpModal(true);
                                                            setShowPlusMenu(false);
                                                        }}
                                                        className="flex flex-col items-center p-3 rounded-xl bg-gradient-to-r from-purple-500 to-purple-600 text-white hover:opacity-90 transition-opacity"
                                                    >
                                                        <i className="fas fa-pump-soap text-xl mb-1"></i>
                                                        <span className="text-xs font-medium">Tire-lait</span>
                                                    </button>

                                                    {/* Sommeil */}
                                                    <button
                                                        onClick={() => {
                                                            setShowSleepModal(true);
                                                            setShowPlusMenu(false);
                                                        }}
                                                        className="flex flex-col items-center p-3 rounded-xl bg-gradient-to-r from-indigo-500 to-indigo-600 text-white hover:opacity-90 transition-opacity"
                                                    >
                                                        <i className="fas fa-moon text-xl mb-1"></i>
                                                        <span className="text-xs font-medium">Sommeil</span>
                                                    </button>
                                                </div>
                                            </div>
                                        )} </div>

                                    {/* Historique */}
                                    <button
                                        onClick={() => {
                                            setCurrentView('analytics');
                                            window.scrollTo({ top: 0, behavior: 'smooth' });
                                        }}
                                        className={`flex flex-col items-center p-2 rounded-2xl transition-all ${currentView === 'analytics'
                                            ? `text-${user?.gender === 'girl' ? 'pink' : 'blue'}-600`
                                            : 'text-gray-500'
                                            }`}
                                    >
                                        <i className="fas fa-history text-lg mb-1"></i>
                                        <span className="text-xs font-medium">Historique</span>
                                    </button>
                                    {/* Plus - Menu dropdown */}
                                    <div className="relative" data-menu="more">
                                        <button
                                            onClick={() => setShowMoreMenu(!showMoreMenu)}
                                            className={`flex flex-col items-center p-2 rounded-2xl transition-all ${['supplies', 'food', 'wardrobe'].includes(currentView)
                                                ? 'text-purple-600'
                                                : 'text-gray-500'
                                                }`}
                                        >
                                            <i className="fas fa-ellipsis-h text-lg mb-1"></i>
                                            <span className="text-xs font-medium">Plus</span>
                                        </button>

                                        {/* Dropdown menu Plus */}
                                        {showMoreMenu && (
                                            <div className="absolute bottom-16 right-0 bg-white rounded-2xl shadow-2xl border border-gray-200 py-2 min-w-[140px] z-50">
                                                <button
                                                    onClick={() => {
                                                        setCurrentView('food');
                                                        setShowMoreMenu(false);
                                                        window.scrollTo({ top: 0, behavior: 'smooth' });
                                                    }}
                                                    className="w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center gap-3"
                                                >
                                                    <i className="fas fa-utensils text-orange-500"></i>
                                                    <span className="text-sm font-medium">Diversification</span>
                                                </button>
                                                <button
                                                    onClick={() => {
                                                        setCurrentView('supplies');
                                                        setShowMoreMenu(false);
                                                        window.scrollTo({ top: 0, behavior: 'smooth' });
                                                    }}
                                                    className="w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center gap-3"
                                                >
                                                    <i className="fas fa-boxes text-blue-500"></i>
                                                    <span className="text-sm font-medium">Stocks</span>
                                                </button>
                                                <button
                                                    onClick={() => {
                                                        setCurrentView('wardrobe');
                                                        setShowMoreMenu(false);
                                                        window.scrollTo({ top: 0, behavior: 'smooth' });
                                                    }}
                                                    className="w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center gap-3"
                                                >
                                                    <i className="fas fa-tshirt text-pink-500"></i>
                                                    <span className="text-sm font-medium">Garde-robe</span>
                                                </button>
                                                <button
                                                    onClick={() => {
                                                        setCurrentView('accomplishments');
                                                        setShowMoreMenu(false);
                                                        window.scrollTo({ top: 0, behavior: 'smooth' });
                                                    }}
                                                    className="w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center gap-3"
                                                >
                                                    <i className="fas fa-trophy text-yellow-500"></i>
                                                    <span className="text-sm font-medium">Accomplissements</span>
                                                </button>
                                            </div>
                                        )}                                    </div>
                                </div></div>
                        </div>
                        {/* Contenu selon la vue */}
                        {currentView === 'daily' && (
                            <>

                                {/* Statistiques du jour selon le filtre s√©lectionn√© */}
                                {(() => {
                                    const now = new Date();
                                    let startDate, endDate;

                                    switch (historyFilter) {
                                        case 'today':
                                            startDate = getDayStart(now);
                                            endDate = getDayEnd(now);
                                            break;
                                        case 'yesterday':
                                            const yesterday = new Date(now);
                                            yesterday.setDate(yesterday.getDate() - 1);
                                            startDate = getDayStart(yesterday);
                                            endDate = getDayEnd(yesterday);
                                            break;
                                        case 'week':
                                            startDate = new Date(now);
                                            startDate.setDate(startDate.getDate() - 7);
                                            startDate.setHours(0, 0, 0, 0);
                                            endDate = getDayEnd(now);
                                            break;
                                        default: // 'all'
                                            startDate = new Date(0);
                                            endDate = new Date();
                                    }

                                    // Filtrer les entr√©es selon la p√©riode s√©lectionn√©e
                                    const filteredEntries = entries.filter(entry => {
                                        const entryDate = new Date(entry.timestamp);
                                        return entryDate >= startDate && entryDate <= endDate;
                                    });

                                    // Stats normales (biberons, couches)
                                    const feedingEntries = filteredEntries.filter(e => e.type === 'feeding');
                                    const peeEntries = filteredEntries.filter(e => e.type === 'pee');
                                    const poopEntries = filteredEntries.filter(e => e.type === 'poop');

                                    const totalMilk = feedingEntries.reduce((sum, entry) => sum + (entry.amount || 0), 0);
                                    const feedingCount = feedingEntries.length;
                                    const totalPees = peeEntries.length;
                                    const totalPoops = poopEntries.length;

                                    const todayStats = { totalMilk, feedingCount, totalPees, totalPoops };

                                    // Stats allaitement selon la p√©riode s√©lectionn√©e
                                    const todayBreastfeeding = breastfeedingEntries.filter(entry => {
                                        const entryDate = new Date(entry.timestamp);
                                        return entry.status === 'completed' && entryDate >= startDate && entryDate <= endDate;
                                    });

                                    // Stats tire-lait selon la p√©riode s√©lectionn√©e
                                    const todayBreastPump = breastPumpEntries.filter(entry => {
                                        const entryDate = new Date(entry.timestamp);
                                        return entryDate >= startDate && entryDate <= endDate;
                                    });

                                    // Stats sommeil selon la p√©riode s√©lectionn√©e
                                    const todaySleep = sleepSessions.filter(session => {
                                        const sessionDate = new Date(session.startTime);
                                        return session.status === 'completed' && sessionDate >= startDate && sessionDate <= endDate;
                                    });

                                    const cards = [];

                                    // Biberon (toujours affich√©)
                                    cards.push(
                                        <div key="feeding" className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30 relative overflow-hidden">
                                            <div className={`absolute top-0 right-0 w-12 h-12 ${themeColors.primary} opacity-5 rounded-full -translate-y-2 translate-x-2`} />
                                            <div className="relative">
                                                <div className="flex items-center justify-center mb-2">
                                                    <div className={`w-8 h-8 rounded-xl ${themeColors.primaryLight} flex items-center justify-center`}>
                                                        <i className={`fas fa-bottle-water ${themeColors.primaryText} text-sm`}></i>
                                                    </div>
                                                </div>
                                                <div className="text-center">
                                                    <div className="text-xl font-bold text-gray-900 mb-1">
                                                        {todayStats.totalMilk}
                                                        <span className="text-sm font-medium text-gray-600">ml</span>
                                                    </div>
                                                    <div className="text-xs font-medium text-gray-500">Biberons</div>
                                                    {todayStats.feedingCount > 0 && (
                                                        <div className="text-xs text-gray-400 mt-1">
                                                            ~{Math.round(todayStats.totalMilk / todayStats.feedingCount)}ml/bib
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    );

                                    // Pipi (toujours affich√©)
                                    cards.push(
                                        <div key="pee" className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30 relative overflow-hidden">
                                            <div className="relative">
                                                <div className="flex items-center justify-center mb-2">
                                                    <div className="w-8 h-8 rounded-xl bg-blue-100 flex items-center justify-center">
                                                        <span className="text-sm">üíß</span>
                                                    </div>
                                                </div>
                                                <div className="text-center">
                                                    <div className="text-xl font-bold text-gray-900 mb-1">
                                                        {todayStats.totalPees}
                                                    </div>
                                                    <div className="text-xs font-medium text-gray-500">Pipis</div>
                                                </div>
                                            </div>
                                        </div>
                                    );

                                    // Caca (toujours affich√©)
                                    cards.push(
                                        <div key="poop" className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30 relative overflow-hidden">
                                            <div className="relative">
                                                <div className="flex items-center justify-center mb-2">
                                                    <div className="w-8 h-8 rounded-xl bg-orange-100 flex items-center justify-center">
                                                        <span className="text-sm">üí©</span>
                                                    </div>
                                                </div>
                                                <div className="text-center">
                                                    <div className="text-xl font-bold text-gray-900 mb-1">
                                                        {todayStats.totalPoops}
                                                    </div>
                                                    <div className="text-xs font-medium text-gray-500">Cacas</div>
                                                </div>
                                            </div>
                                        </div>
                                    );

                                    // Allaitement (si il y en a eu aujourd'hui)
                                    if (todayBreastfeeding.length > 0) {
                                        const totalMinutes = todayBreastfeeding.reduce((sum, entry) => sum + (entry.duration || 0), 0);
                                        cards.push(
                                            <div key="breastfeeding" className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30 relative overflow-hidden">
                                                <div className="relative">
                                                    <div className="flex items-center justify-center mb-2">
                                                        <div className="w-8 h-8 rounded-xl bg-pink-100 flex items-center justify-center">
                                                            <i className="fas fa-heart text-pink-600 text-sm"></i>
                                                        </div>
                                                    </div>
                                                    <div className="text-center">
                                                        <div className="text-xl font-bold text-gray-900 mb-1">
                                                            {todayBreastfeeding.length}
                                                        </div>
                                                        <div className="text-xs font-medium text-gray-500">T√©t√©es</div>
                                                        {totalMinutes > 0 && (
                                                            <div className="text-xs text-gray-400 mt-1">
                                                                {totalMinutes}min
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    }

                                    // Tire-lait (si il y en a eu aujourd'hui)
                                    if (todayBreastPump.length > 0) {
                                        const totalVolume = todayBreastPump.reduce((sum, entry) => sum + (entry.volume || 0), 0);
                                        cards.push(
                                            <div key="breastpump" className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30 relative overflow-hidden">
                                                <div className="relative">
                                                    <div className="flex items-center justify-center mb-2">
                                                        <div className="w-8 h-8 rounded-xl bg-purple-100 flex items-center justify-center">
                                                            <i className="fas fa-pump-soap text-purple-600 text-sm"></i>
                                                        </div>
                                                    </div>
                                                    <div className="text-center">
                                                        <div className="text-xl font-bold text-gray-900 mb-1">
                                                            {totalVolume}
                                                            <span className="text-sm font-medium text-gray-600">ml</span>
                                                        </div>
                                                        <div className="text-xs font-medium text-gray-500">Tire-lait</div>
                                                        <div className="text-xs text-gray-400 mt-1">
                                                            {todayBreastPump.length} session{todayBreastPump.length > 1 ? 's' : ''}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    }

                                    // Sommeil (si il y en a eu aujourd'hui)
                                    if (todaySleep.length > 0) {
                                        const totalMinutes = todaySleep.reduce((sum, session) => sum + (session.duration || 0), 0);
                                        const totalHours = Math.floor(totalMinutes / 60);
                                        const totalMins = totalMinutes % 60;

                                        cards.push(
                                            <div key="sleep" className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30 relative overflow-hidden">
                                                <div className="relative">
                                                    <div className="flex items-center justify-center mb-2">
                                                        <div className="w-8 h-8 rounded-xl bg-indigo-100 flex items-center justify-center">
                                                            <i className="fas fa-moon text-indigo-600 text-sm"></i>
                                                        </div>
                                                    </div>
                                                    <div className="text-center">
                                                        <div className="text-xl font-bold text-gray-900 mb-1">
                                                            {totalHours > 0 ? `${totalHours}h${totalMins.toString().padStart(2, '0')}` : `${totalMins}min`}
                                                        </div>
                                                        <div className="text-xs font-medium text-gray-500">Sommeil</div>
                                                        <div className="text-xs text-gray-400 mt-1">
                                                            {todaySleep.length} session{todaySleep.length > 1 ? 's' : ''}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    }
                                    return (
                                        <div className="grid grid-cols-3 gap-3 mb-6">
                                            {cards}
                                        </div>
                                    );
                                })()}
                                {/* Panneau notifications */}
                                {notificationPermission !== 'granted' && (
                                    <div className="bg-blue-50 border border-blue-200 rounded-2xl p-4 mb-4">
                                        <div className="flex items-center gap-3">
                                            <div className="w-12 h-12 bg-blue-100 rounded-2xl flex items-center justify-center">
                                                <i className="fas fa-bell text-blue-600 text-xl"></i>
                                            </div>
                                            <div className="flex-1">
                                                <h3 className="font-bold text-blue-800">Activer les notifications</h3>
                                                <p className="text-sm text-blue-700">Recevez des rappels automatiques pour les biberons, m√©dicaments et RDV</p>
                                                {scheduledNotifications.size > 0 && (
                                                    <p className="text-xs text-blue-600 mt-1">{scheduledNotifications.size} notifications programm√©es</p>
                                                )}
                                            </div>
                                            <button
                                                onClick={requestNotificationPermission}
                                                className="bg-blue-500 text-white px-4 py-2 rounded-xl text-sm font-medium shadow-lg active:scale-95 transition-transform"
                                            >
                                                Activer
                                            </button>
                                        </div>
                                    </div>
                                )}
                                {/* Historique avec pagination */}
                                <div className="space-y-3">
                                    <div className="flex items-center justify-between">
                                        <h3 className="text-lg font-bold text-gray-800">Historique</h3>
                                        <select
                                            value={historyFilter}
                                            onChange={(e) => {
                                                setHistoryFilter(e.target.value);
                                                setCurrentPage(0);
                                            }}
                                            className="text-sm border rounded-lg px-2 py-1"
                                        >
                                            <option value="today">Aujourd'hui</option>
                                            <option value="yesterday">Hier</option>
                                            <option value="week">7 derniers jours</option>
                                            <option value="all">Tout</option>
                                        </select>
                                    </div>

                                    <div className="space-y-3">
                                        {(() => {
                                            const combinedEntries = getFilteredHistory();
                                            const itemsPerPage = 10;
                                            const startIndex = currentPage * itemsPerPage;
                                            const endIndex = startIndex + itemsPerPage;
                                            const currentEntries = combinedEntries.slice(startIndex, endIndex);
                                            const totalPages = Math.ceil(combinedEntries.length / itemsPerPage);
                                            return (
                                                <>
                                                    {currentEntries.length === 0 ? (
                                                        <p className="text-gray-500 text-center py-8">Aucune entr√©e pour cette p√©riode</p>
                                                    ) : (
                                                        currentEntries.map((entry) => {
                                                            // Rendu sp√©cial pour les sessions de sommeil
                                                            if (entry.type === 'sleep') {
                                                                return (
                                                                    <div key={entry.id} className="bg-white/95 backdrop-blur-sm rounded-3xl shadow-xl border border-white/20 overflow-hidden">
                                                                        {/* Barre de couleur lat√©rale violette */}

                                                                        <div className="absolute left-0 top-0 bottom-0 w-1 bg-gradient-to-b from-purple-500 to-purple-600" />

                                                                        <div className="p-5 pl-6 relative">
                                                                            <div className="flex items-start justify-between mb-4">
                                                                                <div className="flex items-center gap-4 flex-1">
                                                                                    <div className="w-14 h-14 rounded-2xl flex items-center justify-center bg-purple-100 border-2 border-purple-200">
                                                                                        <i className="fas fa-moon text-purple-600 text-xl"></i>
                                                                                    </div>

                                                                                    <div className="flex-1 min-w-0">
                                                                                        <div className="flex items-center gap-2 mb-1 flex-wrap">
                                                                                            <h4 className="font-bold text-gray-900 text-lg">Sommeil</h4>
                                                                                            <div className="px-2 py-0.5 rounded-full text-xs font-medium border bg-purple-50 text-purple-700 border-purple-200">
                                                                                                Repos
                                                                                            </div>
                                                                                        </div>

                                                                                        <div className="flex items-center gap-2 flex-wrap">
                                                                                            <p className="text-sm font-medium text-gray-600">
                                                                                                {formatDateTime(entry.startTime)}
                                                                                            </p>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>

                                                                                <div className="flex items-center gap-2 ml-2">
                                                                                    <button
                                                                                        onClick={() => editSleepSession(entry.id)}
                                                                                        className="w-9 h-9 rounded-2xl bg-blue-50 flex items-center justify-center active:scale-95 transition-transform"
                                                                                    >
                                                                                        <i className="fas fa-edit text-sm text-blue-600"></i>
                                                                                    </button>
                                                                                    <button
                                                                                        onClick={() => deleteSleepSession(entry.id)}
                                                                                        className="w-9 h-9 rounded-2xl bg-red-50 flex items-center justify-center active:scale-95 transition-transform"
                                                                                    >
                                                                                        <i className="fas fa-trash text-sm text-red-600"></i>
                                                                                    </button>
                                                                                </div>
                                                                            </div>

                                                                            <div className="h-px bg-gradient-to-r from-transparent via-gray-200 to-transparent mb-4 opacity-60"></div>

                                                                            <div className="space-y-3">
                                                                                <div className="flex items-center gap-3 flex-wrap">
                                                                                    <div className="flex items-center gap-2 px-4 py-2 rounded-2xl bg-purple-100 border border-purple-200">
                                                                                        <i className="fas fa-clock text-sm opacity-70"></i>
                                                                                        <span className="font-bold text-base">{formatSleepDuration(entry.duration)}</span>
                                                                                    </div>

                                                                                    <div className="flex items-center gap-2 px-3 py-1 rounded-full bg-purple-50 border border-purple-200">
                                                                                        <span className="text-xs text-purple-700">
                                                                                            {formatTime(entry.startTime)} ‚Üí {formatTime(entry.endTime)}
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                            </div>

                                                                            <div className="mt-4 pt-3 border-t border-gray-100">
                                                                                <div className="flex items-center justify-between text-xs text-gray-500">
                                                                                    <span>#{entry.id.slice(-6)}</span>
                                                                                    <span>Session de {formatSleepDuration(entry.duration)}</span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                );
                                                            }
                                                            // Rendu sp√©cial pour les t√©t√©es
                                                            if (entry.type === 'breastfeeding') {
                                                                return (
                                                                    <div key={entry.id} className="bg-white/95 backdrop-blur-sm rounded-3xl shadow-xl border border-white/20 overflow-hidden">
                                                                        <div className="absolute left-0 top-0 bottom-0 w-1 bg-gradient-to-b from-pink-500 to-pink-600" />
                                                                        <div className="p-5 pl-6 relative">
                                                                            <div className="flex items-start justify-between mb-4">
                                                                                <div className="flex items-center gap-4 flex-1">
                                                                                    <div className="w-14 h-14 rounded-2xl flex items-center justify-center bg-pink-100 border-2 border-pink-200">
                                                                                        <i className="fas fa-heart text-pink-600 text-xl"></i>
                                                                                    </div>
                                                                                    <div className="flex-1 min-w-0">
                                                                                        <div className="flex items-center gap-2 mb-1 flex-wrap">
                                                                                            <h4 className="font-bold text-gray-900 text-lg">Allaitement</h4>
                                                                                            <div className="px-2 py-0.5 rounded-full text-xs font-medium border bg-pink-50 text-pink-700 border-pink-200">
                                                                                                T√©t√©e
                                                                                            </div>
                                                                                        </div>
                                                                                        <div className="flex items-center gap-2 flex-wrap">
                                                                                            <p className="text-sm font-medium text-gray-600">
                                                                                                {formatDateTime(entry.timestamp)}
                                                                                            </p>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                                <div className="flex items-center gap-2 ml-2">
                                                                                    <button
                                                                                        onClick={() => deleteBreastfeedingEntry(entry.id)}
                                                                                        className="w-9 h-9 rounded-2xl bg-red-50 flex items-center justify-center active:scale-95 transition-transform"
                                                                                    >
                                                                                        <i className="fas fa-trash text-sm text-red-600"></i>
                                                                                    </button>
                                                                                </div>
                                                                            </div>
                                                                            <div className="h-px bg-gradient-to-r from-transparent via-gray-200 to-transparent mb-4 opacity-60"></div>
                                                                            <div className="space-y-3">
                                                                                <div className="flex items-center gap-3 flex-wrap">
                                                                                    <div className="flex items-center gap-2 px-4 py-2 rounded-2xl bg-pink-100 border border-pink-200">
                                                                                        <i className="fas fa-heart text-sm opacity-70"></i>
                                                                                        <span className="font-bold text-base">
                                                                                            {entry.breast === 'left' ? 'Sein gauche' :
                                                                                                entry.breast === 'right' ? 'Sein droit' : 'Les deux seins'}
                                                                                        </span>
                                                                                    </div>
                                                                                    {entry.duration && (
                                                                                        <div className="flex items-center gap-2 px-3 py-1 rounded-full bg-pink-50 border border-pink-200">
                                                                                            <span className="text-xs text-pink-700">{entry.duration} min</span>
                                                                                        </div>
                                                                                    )}
                                                                                </div>
                                                                            </div>
                                                                            <div className="mt-4 pt-3 border-t border-gray-100">
                                                                                <div className="flex items-center justify-between text-xs text-gray-500">
                                                                                    <span>#{entry.id.slice(-6)}</span>
                                                                                    <span>Allaitement {entry.duration ? `de ${entry.duration}min` : ''}</span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                );
                                                            }

                                                            // Rendu sp√©cial pour le tire-lait
                                                            if (entry.type === 'breast_pump') {
                                                                return (
                                                                    <div key={entry.id} className="bg-white/95 backdrop-blur-sm rounded-3xl shadow-xl border border-white/20 overflow-hidden">
                                                                        <div className="absolute left-0 top-0 bottom-0 w-1 bg-gradient-to-b from-purple-500 to-purple-600" />
                                                                        <div className="p-5 pl-6 relative">
                                                                            <div className="flex items-start justify-between mb-4">
                                                                                <div className="flex items-center gap-4 flex-1">
                                                                                    <div className="w-14 h-14 rounded-2xl flex items-center justify-center bg-purple-100 border-2 border-purple-200">
                                                                                        <i className="fas fa-pump-soap text-purple-600 text-xl"></i>
                                                                                    </div>
                                                                                    <div className="flex-1 min-w-0">
                                                                                        <div className="flex items-center gap-2 mb-1 flex-wrap">
                                                                                            <h4 className="font-bold text-gray-900 text-lg">Tire-lait</h4>
                                                                                            <div className="px-2 py-0.5 rounded-full text-xs font-medium border bg-purple-50 text-purple-700 border-purple-200">
                                                                                                Pompage
                                                                                            </div>
                                                                                        </div>
                                                                                        <div className="flex items-center gap-2 flex-wrap">
                                                                                            <p className="text-sm font-medium text-gray-600">
                                                                                                {formatDateTime(entry.timestamp)}
                                                                                            </p>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                                <div className="flex items-center gap-2 ml-2">
                                                                                    <button
                                                                                        onClick={() => deleteBreastPumpEntry(entry.id)}
                                                                                        className="w-9 h-9 rounded-2xl bg-red-50 flex items-center justify-center active:scale-95 transition-transform"
                                                                                    >
                                                                                        <i className="fas fa-trash text-sm text-red-600"></i>
                                                                                    </button>
                                                                                </div>
                                                                            </div>
                                                                            <div className="h-px bg-gradient-to-r from-transparent via-gray-200 to-transparent mb-4 opacity-60"></div>
                                                                            <div className="space-y-3">
                                                                                <div className="flex items-center gap-3 flex-wrap">
                                                                                    <div className="flex items-center gap-2 px-4 py-2 rounded-2xl bg-purple-100 border border-purple-200">
                                                                                        <i className="fas fa-tint text-sm opacity-70"></i>
                                                                                        <span className="font-bold text-base">{entry.volume}ml</span>
                                                                                    </div>
                                                                                    <div className="flex items-center gap-2 px-3 py-1 rounded-full bg-purple-50 border border-purple-200">
                                                                                        <span className="text-xs text-purple-700">{entry.duration} min</span>
                                                                                    </div>
                                                                                    <div className="flex items-center gap-2 px-3 py-1 rounded-full bg-gray-50 border border-gray-200">
                                                                                        <span className="text-xs text-gray-700">
                                                                                            {entry.storage === 'immediate' ? 'Imm√©diat' :
                                                                                                entry.storage === 'fridge' ? 'Frigo' : 'Cong√©lateur'}
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div className="mt-4 pt-3 border-t border-gray-100">
                                                                                <div className="flex items-center justify-between text-xs text-gray-500">
                                                                                    <span>#{entry.id.slice(-6)}</span>
                                                                                    <span>Session de {entry.duration}min</span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                );
                                                            }
                                                            // Continuer avec le code existant pour biberon/couche...
                                                            let poopDisplay = '';
                                                            if (entry.hasPoop) {
                                                                const poopInfo = getPoopInfo(entry.poopQuantity, entry.poopConsistency, entry.poopColor);
                                                                const parts = [];

                                                                if (poopInfo.quantity.label) parts.push(`${poopInfo.quantity.emoji} ${poopInfo.quantity.label}`);
                                                                if (poopInfo.consistency.label) parts.push(`${poopInfo.consistency.emoji} ${poopInfo.consistency.label}`);
                                                                if (poopInfo.color.label) parts.push(`${poopInfo.color.emoji} ${poopInfo.color.label}`);

                                                                const displayText = parts.length > 0 ? parts.join(' ‚Ä¢ ') : 'üí© Caca';
                                                                poopDisplay = (
                                                                    <span className={`${poopInfo.color.bgColor || 'bg-orange-100'} ${poopInfo.color.textColor || 'text-orange-800'} px-3 py-1 rounded-full text-xs font-medium`}>
                                                                        {displayText}
                                                                    </span>
                                                                );
                                                            }

                                                            // Calcul du temps √©coul√©
                                                            const timeElapsed = new Date() - new Date(entry.timestamp);
                                                            const minutesAgo = Math.floor(timeElapsed / (1000 * 60));
                                                            const hoursAgo = Math.floor(minutesAgo / 60);

                                                            let timeDisplayClass = 'text-gray-500';
                                                            if (minutesAgo < 30) timeDisplayClass = 'text-green-600 font-medium';
                                                            else if (minutesAgo < 120) timeDisplayClass = 'text-blue-600';

                                                            return (
                                                                <div key={entry.id} className="bg-white/95 backdrop-blur-sm rounded-3xl shadow-xl border border-white/20 overflow-hidden">
                                                                    {/* Barre de couleur lat√©rale */}
                                                                    <div
                                                                        className={`absolute left-0 top-0 bottom-0 w-1 ${entry.type === 'feeding'
                                                                            ? `bg-gradient-to-b ${themeColors.primary}`
                                                                            : 'bg-gradient-to-b from-emerald-500 to-emerald-600'
                                                                            }`}
                                                                    />

                                                                    {/* Contenu principal */}
                                                                    <div className="p-5 pl-6 relative">
                                                                        {/* Header de la carte */}
                                                                        <div className="flex items-start justify-between mb-4">
                                                                            <div className="flex items-center gap-4 flex-1">
                                                                                {/* Ic√¥ne */}
                                                                                <div className={`w-14 h-14 rounded-2xl flex items-center justify-center ${entry.type === 'feeding'
                                                                                    ? `${themeColors.primaryLight} ${themeColors.primaryBorder} border-2`
                                                                                    : 'bg-emerald-100 border-2 border-emerald-200'
                                                                                    }`}>
                                                                                    {entry.type === 'feeding' ? (
                                                                                        <i className={`fas fa-bottle-water ${themeColors.primaryText} text-xl`}></i>
                                                                                    ) : (
                                                                                        <i className="fas fa-baby text-emerald-600 text-xl"></i>
                                                                                    )}


                                                                                </div>

                                                                                {/* Titre et infos */}
                                                                                <div className="flex-1 min-w-0">
                                                                                    <div className="flex items-center gap-2 mb-1 flex-wrap">
                                                                                        <h4 className="font-bold text-gray-900 text-lg">
                                                                                            {entry.type === 'feeding' ? 'Biberon' : 'Change'}
                                                                                        </h4>

                                                                                        {/* Badge de statut */}
                                                                                        <div className={`px-2 py-0.5 rounded-full text-xs font-medium border ${entry.type === 'feeding'
                                                                                            ? `${themeColors.primaryLight} ${themeColors.primaryText} ${themeColors.primaryBorder}`
                                                                                            : 'bg-emerald-50 text-emerald-700 border-emerald-200'
                                                                                            }`}>
                                                                                            {entry.type === 'feeding' ? 'Nutrition' : 'Hygi√®ne'}
                                                                                        </div>
                                                                                    </div>

                                                                                    <div className="flex items-center gap-2 flex-wrap">
                                                                                        <p className={`text-sm font-medium ${timeDisplayClass}`}>
                                                                                            {formatDateTime(entry.timestamp)}
                                                                                        </p>

                                                                                        {/* Indicateur de fra√Æcheur */}
                                                                                        {minutesAgo < 30 && (
                                                                                            <div className="flex items-center gap-1 bg-green-50 px-2 py-0.5 rounded-full">
                                                                                                <div className="w-2 h-2 bg-green-500 rounded-full"></div>
                                                                                                <span className="text-xs text-green-700 font-medium">R√©cent</span>
                                                                                            </div>
                                                                                        )}
                                                                                    </div>
                                                                                </div>
                                                                            </div>

                                                                            {/* Actions toujours visibles sur mobile */}
                                                                            <div className="flex items-center gap-2 ml-2">
                                                                                <button
                                                                                    onClick={() => editEntry(entry.id)}
                                                                                    className="w-9 h-9 rounded-2xl bg-blue-50 flex items-center justify-center active:scale-95 transition-transform"
                                                                                >
                                                                                    <i className="fas fa-edit text-sm text-blue-600"></i>
                                                                                </button>
                                                                                <button
                                                                                    onClick={() => deleteEntry(entry.id)}
                                                                                    className="w-9 h-9 rounded-2xl bg-red-50 flex items-center justify-center active:scale-95 transition-transform"
                                                                                >
                                                                                    <i className="fas fa-trash text-sm text-red-600"></i>
                                                                                </button>
                                                                            </div>
                                                                        </div>

                                                                        {/* S√©parateur */}
                                                                        <div className="h-px bg-gradient-to-r from-transparent via-gray-200 to-transparent mb-4 opacity-60"></div>

                                                                        {/* Contenu principal */}
                                                                        <div className="space-y-3">
                                                                            {/* Donn√©es biberon */}
                                                                            {entry.type === 'feeding' && entry.amount && (
                                                                                <div className="flex items-center gap-3 flex-wrap">
                                                                                    <div className={`flex items-center gap-2 px-4 py-2 rounded-2xl ${themeColors.primaryLight} ${themeColors.primaryBorder} border`}>
                                                                                        <i className="fas fa-tint text-sm opacity-70"></i>
                                                                                        <span className="font-bold text-base">{entry.amount}ml</span>
                                                                                    </div>

                                                                                </div>
                                                                            )}

                                                                            {/* Informations change */}
                                                                            {(entry.hasPee || entry.hasPoop) && (
                                                                                <div className="flex items-center gap-3 flex-wrap">
                                                                                    {entry.hasPee && (
                                                                                        <div className="flex items-center gap-2 px-4 py-2 rounded-2xl bg-blue-100 border border-blue-200">
                                                                                            <span className="text-base">üíß</span>
                                                                                            <span className="font-medium text-blue-800 text-sm">Pipi</span>
                                                                                        </div>
                                                                                    )}
                                                                                    {entry.hasPoop && (
                                                                                        <div className="flex items-center gap-2 px-4 py-2 rounded-2xl bg-amber-100 border border-amber-200">
                                                                                            {poopDisplay}
                                                                                        </div>
                                                                                    )}
                                                                                </div>
                                                                            )}
                                                                        </div>

                                                                        {/* Footer informatif */}
                                                                        <div className="mt-4 pt-3 border-t border-gray-100">
                                                                            <div className="flex items-center justify-between text-xs text-gray-500">
                                                                                <span>#{entry.id.slice(-6)}</span>
                                                                                <span>
                                                                                    {minutesAgo < 60
                                                                                        ? `Il y a ${minutesAgo} min`
                                                                                        : `Il y a ${Math.floor(minutesAgo / 60)}h${minutesAgo % 60 > 0 ? `${minutesAgo % 60}min` : ''}`
                                                                                    }
                                                                                </span>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            );
                                                        })
                                                    )}

                                                    {/* Pagination */}
                                                    {totalPages > 1 && (
                                                        <div className="flex items-center justify-center gap-2 mt-4">
                                                            <button
                                                                onClick={() => setCurrentPage(Math.max(0, currentPage - 1))}
                                                                disabled={currentPage === 0}
                                                                className="px-3 py-1 rounded-lg border disabled:opacity-50"
                                                            >
                                                                ‚Üê
                                                            </button>
                                                            <span className="text-sm text-gray-600">
                                                                Page {currentPage + 1} sur {totalPages}
                                                            </span>
                                                            <button
                                                                onClick={() => setCurrentPage(Math.min(totalPages - 1, currentPage + 1))}
                                                                disabled={currentPage === totalPages - 1}
                                                                className="px-3 py-1 rounded-lg border disabled:opacity-50"
                                                            >
                                                                ‚Üí
                                                            </button>
                                                        </div>
                                                    )}
                                                </>
                                            );
                                        })()}
                                    </div>
                                </div>

                            </>

                        )}
                        {/* Vue Profil */}
                        {currentView === 'profile' && (
                            <div className="space-y-6">
                                {/* Header Profil */}
                                <div className="bg-white/90 rounded-2xl p-6 shadow-xl border border-white/50">
                                    <div className="text-center">
                                        {/* Photo de profil */}
                                        <div className="relative mb-4">
                                            <input
                                                type="file"
                                                accept="image/*,.heic,.HEIC"
                                                onChange={async (e) => {
                                                    // UTILISER LE M√äME CODE QUE DANS LE HEADER POUR LA PHOTO
                                                    const file = e.target.files[0];
                                                    if (file) {
                                                        try {
                                                            let processedFile = file;
                                                            if (file.type === 'image/heic' || file.name.toLowerCase().endsWith('.heic')) {
                                                                if (window.heic2any) {
                                                                    processedFile = await heic2any({
                                                                        blob: file,
                                                                        toType: "image/jpeg",
                                                                        quality: 0.8
                                                                    });
                                                                }
                                                            }
                                                            const reader = new FileReader();
                                                            reader.onload = async (e) => {
                                                                const imageData = e.target.result;
                                                                try {
                                                                    await db.collection('families').doc(user.code).update({
                                                                        photo: imageData
                                                                    });
                                                                    setUser(prev => ({ ...prev, photo: imageData }));
                                                                } catch (error) {
                                                                    console.error('Erreur sauvegarde photo:', error);
                                                                    setUser(prev => ({ ...prev, photo: imageData }));
                                                                }
                                                            };
                                                            reader.readAsDataURL(processedFile);
                                                        } catch (error) {
                                                            console.error('Erreur traitement photo:', error);
                                                            alert('Erreur lors du traitement de la photo');
                                                        }
                                                    }
                                                }}
                                                className="hidden"
                                                id="profile-photo-upload"
                                            />
                                            <label
                                                htmlFor="profile-photo-upload"
                                                className="group block w-32 h-32 rounded-full overflow-hidden cursor-pointer border-4 border-white shadow-xl mx-auto relative"
                                            >
                                                {user?.photo ? (
                                                    <>
                                                        <img
                                                            src={user.photo}
                                                            alt={user.babyName}
                                                            className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-200"
                                                        />
                                                        <div className="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center">
                                                            <i className="fas fa-camera text-white text-lg"></i>
                                                        </div>
                                                    </>
                                                ) : (
                                                    <div
                                                        className="w-full h-full flex items-center justify-center text-4xl group-hover:scale-105 transition-transform duration-200 relative"
                                                        style={{
                                                            background: `linear-gradient(135deg, ${user?.gender === 'girl' ? '#ec4899' : '#3b82f6'} 0%, ${user?.gender === 'girl' ? '#f472b6' : '#6366f1'} 100%)`
                                                        }}
                                                    >
                                                        <span className="text-white">
                                                            {user?.gender === 'girl' ? 'üëß' : 'üë¶'}
                                                        </span>
                                                        <div className="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center">
                                                            <i className="fas fa-plus text-white text-lg"></i>
                                                        </div>
                                                    </div>
                                                )}
                                            </label>
                                        </div>

                                        {/* Informations b√©b√© */}
                                        <h1 className="text-2xl font-bold text-gray-900 mb-2">{user?.babyName}</h1>
                                        <div className="flex items-center justify-center gap-4 text-sm text-gray-600 mb-4">
                                            <div className="flex items-center gap-2">
                                                <i className={`fas ${user?.gender === 'girl' ? 'fa-venus' : 'fa-mars'} ${user?.gender === 'girl' ? 'text-pink-500' : 'text-blue-500'}`}></i>
                                                <span className="capitalize">{user?.gender === 'girl' ? 'Fille' : 'Gar√ßon'}</span>
                                            </div>
                                            <div className="flex items-center gap-2">
                                                <i className="fas fa-birthday-cake text-yellow-500"></i>
                                                <span>{formatAgeDisplay(calculateAge())}</span>
                                            </div>
                                        </div>

                                        {/* Stats rapides cliquables */}
                                        <div className="grid grid-cols-3 gap-4 mb-4">
                                            <button
                                                onClick={() => {
                                                    setWeightInput(currentWeight ? currentWeight.toString() : user?.birthWeight?.toString() || '');
                                                    setShowWeightModal(true);
                                                }}
                                                className="text-center p-3 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors active:scale-95"
                                            >
                                                <div className={`text-lg font-bold ${themeColors.primaryText}`}>
                                                    {currentWeight ? `${currentWeight}` : `${user?.birthWeight?.toFixed(2)}`}kg
                                                </div>
                                                <div className="text-xs text-gray-500">Poids actuel</div>
                                            </button>
                                            <button
                                                onClick={() => {
                                                    setHeightInput(currentHeight ? currentHeight.toString() : user?.birthHeight?.toString() || '');
                                                    setShowHeightModal(true);
                                                }}
                                                className="text-center p-3 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors active:scale-95"
                                            >
                                                <div className={`text-lg font-bold ${themeColors.primaryText}`}>
                                                    {currentHeight || user?.birthHeight}cm
                                                </div>
                                                <div className="text-xs text-gray-500">Taille actuelle</div>
                                            </button>
                                            <div className="text-center p-3 rounded-xl bg-gray-50">
                                                <div className={`text-lg font-bold ${themeColors.primaryText}`}>
                                                    {entries.filter(e => e.type === 'feeding').length}
                                                </div>
                                                <div className="text-xs text-gray-500">Biberons total</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Param√®tres de l'application */}
                                <div className="bg-white/90 rounded-2xl p-6 shadow-xl border border-white/50">
                                    <h3 className="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
                                        <i className="fas fa-cog text-gray-600"></i>
                                        Param√®tres de l'application
                                    </h3>

                                    <div className="space-y-4">
                                        {/* Notifications */}
                                        <div className="flex items-center justify-between p-3 bg-gray-50 rounded-xl">
                                            <div>
                                                <div className="font-medium text-gray-800">Notifications</div>
                                                <div className="text-sm text-gray-600">Rappels biberons</div>
                                            </div>
                                            <button
                                                onClick={() => {
                                                    if (notificationPermission !== 'granted') {
                                                        requestNotificationPermission();
                                                    } else {
                                                        setAppSettings(prev => ({ ...prev, notifications: !prev.notifications }));
                                                    }
                                                }}
                                                className={`w-12 h-6 rounded-full transition-colors relative ${appSettings.notifications ? 'bg-green-500' : 'bg-gray-300'}`}
                                            >
                                                <div className={`w-5 h-5 bg-white rounded-full absolute top-0.5 transition-transform ${appSettings.notifications ? 'translate-x-6' : 'translate-x-0.5'}`} />
                                            </button>
                                        </div>

                                        {/* Intervalle biberons */}
                                        <div className="p-3 bg-gray-50 rounded-xl">
                                            <div className="flex items-center justify-between mb-2">
                                                <div>
                                                    <div className="font-medium text-gray-800">Intervalle biberons</div>
                                                    <div className="text-sm text-gray-600">
                                                        {feedingInterval === 0
                                                            ? "√Ä la demande, pas de rappel"
                                                            : `Rappel toutes les ${feedingInterval}h`}
                                                    </div>
                                                </div>
                                                <div className="text-lg font-bold text-blue-600">
                                                    {feedingInterval === 0 ? 'üçº' : `${feedingInterval}h`}
                                                </div>
                                            </div>
                                            <select
                                                value={feedingInterval}
                                                onChange={(e) => {
                                                    const newInterval = Number(e.target.value);
                                                    setFeedingInterval(newInterval);
                                                    if (user) {
                                                        db.collection('families').doc(user.code).update({
                                                            feedingInterval: newInterval
                                                        }).catch(console.error);
                                                    }
                                                }}
                                                className="w-full bg-white border border-gray-300 py-2 px-3 rounded-lg text-sm font-medium focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            >
                                                <option value="0">D√©sactiver (√† la demande)</option>
                                                <option value="2">2 heures</option>
                                                <option value="3">3 heures</option>
                                                <option value="4">4 heures</option>
                                                <option value="5">5 heures</option>
                                            </select>
                                        </div>
                                        {/* Export donn√©es */}
                                        <button
                                            onClick={() => setShowExportMenu(true)}
                                            className="w-full p-3 bg-gray-50 rounded-xl flex items-center justify-between hover:bg-gray-100 transition-colors"
                                        >
                                            <div className="text-left">
                                                <div className="font-medium text-gray-800">Exporter les donn√©es</div>
                                                <div className="text-sm text-gray-600">PDF pour le p√©diatre</div>
                                            </div>
                                            <i className="fas fa-download text-gray-500"></i>
                                        </button>
                                    </div>
                                </div>

                                {/* Informations famille */}
                                <div className="bg-white/90 rounded-2xl p-6 shadow-xl border border-white/50">
                                    <h3 className="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
                                        <i className="fas fa-users text-gray-600"></i>
                                        Informations famille
                                    </h3>

                                    <div className="space-y-3">
                                        <div className="flex items-center justify-between p-3 bg-gray-50 rounded-xl">
                                            <span className="text-sm font-medium text-gray-700">Code famille</span>
                                            <span className="font-mono text-sm bg-gray-200 px-2 py-1 rounded">{user?.code}</span>
                                        </div>
                                        <div className="flex items-center justify-between p-3 bg-gray-50 rounded-xl">
                                            <span className="text-sm font-medium text-gray-700">Parents</span>
                                            <span className="text-sm text-gray-600">{user?.parents}</span>
                                        </div>
                                        <div className="flex items-center justify-between p-3 bg-gray-50 rounded-xl">
                                            <span className="text-sm font-medium text-gray-700">Date de naissance</span>
                                            <span className="text-sm text-gray-600">{new Date(user?.birthDate).toLocaleDateString('fr-FR')}</span>
                                        </div>
                                    </div>
                                </div>

                                {/* Bouton d√©connexion */}
                                <button
                                    onClick={logout}
                                    className="w-full bg-red-500 text-white py-4 rounded-2xl font-bold shadow-lg active:scale-95 transition-transform"
                                >
                                    Se d√©connecter
                                </button>
                            </div>
                        )}
                        {/* Vue Analytics/Graphiques */}
                        {currentView === 'analytics' && (
                            <div className="space-y-6">
                                <div className="flex items-center justify-between">
                                    <h2 className="text-xl font-bold text-gray-800">Historique</h2>
                                    <button
                                        onClick={() => setShowExportMenu(true)}
                                        className="bg-blue-500 text-white px-4 py-2 rounded-xl text-sm font-medium shadow-lg flex items-center gap-2"
                                    >
                                        <i className="fas fa-download"></i>
                                        Export PDF
                                    </button>
                                </div>
                                {/* P√©riode d'analyse */}
                                <div className="bg-white/90 rounded-2xl p-4 shadow-xl border border-white/50">
                                    <div className="flex gap-2">
                                        {[
                                            { value: 'daily', label: 'Aujourd\'hui' },
                                            { value: 'weekly', label: '7 jours' },
                                            { value: 'monthly', label: '30 jours' }
                                        ].map(period => (
                                            <button
                                                key={period.value}
                                                onClick={() => setAnalyticsPeriod(period.value)}
                                                className={`flex-1 py-2 px-3 rounded-xl text-sm font-medium ${analyticsPeriod === period.value
                                                    ? `${themeColors.primaryBg} text-white`
                                                    : 'bg-gray-100 text-gray-600'
                                                    }`}
                                            >
                                                {period.label}
                                            </button>
                                        ))}
                                    </div>
                                </div>


                                {/* Filtres de donn√©es - sous le graphique */}
                                <div className="bg-white/90 rounded-2xl p-4 shadow-xl border border-white/50">
                                    <h3 className="font-bold text-gray-900 mb-3 text-sm">Donn√©es √† afficher</h3>
                                    <div className="flex flex-wrap gap-2">
                                        {[
                                            { key: 'feeding', label: 'Biberons', color: 'blue' },
                                            { key: 'diaper', label: 'Changes', color: 'green' },
                                            { key: 'breastfeeding', label: 'T√©t√©es', color: 'pink' },
                                            { key: 'breastpump', label: 'Tire-lait', color: 'purple' },
                                            { key: 'sleep', label: 'Sommeil', color: 'indigo' }
                                        ].map(filter => (
                                            <button
                                                key={filter.key}
                                                onClick={() => {
                                                    setAnalyticsFilter(prev =>
                                                        prev.includes(filter.key)
                                                            ? prev.filter(f => f !== filter.key)
                                                            : [...prev, filter.key]
                                                    );
                                                }}
                                                className={`px-3 py-1 rounded-full text-xs font-medium border transition-all ${analyticsFilter.includes(filter.key)
                                                    ? `bg-${filter.color}-100 border-${filter.color}-300 text-${filter.color}-800`
                                                    : 'bg-gray-100 border-gray-200 text-gray-600'
                                                    }`}
                                            >
                                                {filter.label}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* Statistiques r√©sum√©es */}
                                <div className="grid grid-cols-2 gap-3">
                                    {analyticsFilter.includes('feeding') && (
                                        <div className="bg-white/90 rounded-2xl p-4 shadow-xl border border-white/50">
                                            <div className="flex items-center gap-3 mb-2">
                                                <div className="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center">
                                                    <i className="fas fa-bottle-water text-blue-600"></i>
                                                </div>
                                                <div>
                                                    <div className="text-lg font-bold text-blue-600">{getFeedingStats().total}ml</div>
                                                    <div className="text-xs text-gray-500">Lait total</div>
                                                </div>
                                            </div>
                                            <div className="text-sm text-gray-600">
                                                {getFeedingStats().count} biberons ‚Ä¢ Moy: {getFeedingStats().average}ml
                                            </div>
                                        </div>
                                    )}

                                    {analyticsFilter.includes('diaper') && (<div className="bg-white/90 rounded-2xl p-4 shadow-xl border border-white/50">
                                        <div className="flex items-center gap-3 mb-2">
                                            <div className="w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center">
                                                <i className="fas fa-baby text-green-600"></i>
                                            </div>
                                            <div>
                                                <div className="text-lg font-bold text-green-600">{getDiaperStats().total}</div>
                                                <div className="text-xs text-gray-500">Changes total</div>
                                            </div>
                                        </div>
                                        <div className="text-sm text-gray-600">
                                            {getDiaperStats().pees} pipis ‚Ä¢ {getDiaperStats().poops} cacas
                                        </div>
                                    </div>
                                    )}

                                    {analyticsFilter.includes('breastfeeding') && getBreastfeedingStatsForAnalytics().sessions > 0 && (
                                        <div className="bg-white/90 rounded-2xl p-4 shadow-xl border border-white/50">
                                            <div className="flex items-center gap-3 mb-2">
                                                <div className="w-10 h-10 bg-pink-100 rounded-xl flex items-center justify-center">
                                                    <i className="fas fa-heart text-pink-600"></i>
                                                </div>
                                                <div>
                                                    <div className="text-lg font-bold text-pink-600">{getBreastfeedingStatsForAnalytics().totalMinutes}min</div>
                                                    <div className="text-xs text-gray-500">Allaitement total</div>
                                                </div>
                                            </div>
                                            <div className="text-sm text-gray-600">
                                                {getBreastfeedingStatsForAnalytics().sessions} t√©t√©es ‚Ä¢ Moy: {getBreastfeedingStatsForAnalytics().averageMinutes}min
                                            </div>
                                        </div>
                                    )}

                                    {analyticsFilter.includes('breastpump') && getBreastPumpStatsForAnalytics().sessions > 0 && (
                                        <div className="bg-white/90 rounded-2xl p-4 shadow-xl border border-white/50">
                                            <div className="flex items-center gap-3 mb-2">
                                                <div className="w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center">
                                                    <i className="fas fa-pump-soap text-purple-600"></i>
                                                </div>
                                                <div>
                                                    <div className="text-lg font-bold text-purple-600">{getBreastPumpStatsForAnalytics().totalVolume}ml</div>
                                                    <div className="text-xs text-gray-500">Lait tir√© total</div>
                                                </div>
                                            </div>
                                            <div className="text-sm text-gray-600">
                                                {getBreastPumpStatsForAnalytics().sessions} sessions ‚Ä¢ Moy: {getBreastPumpStatsForAnalytics().averageVolume}ml
                                            </div>
                                        </div>
                                    )}

                                    {analyticsFilter.includes('sleep') && (
                                        <div className="bg-white/90 rounded-2xl p-4 shadow-xl border border-white/50 col-span-2">
                                            <div className="flex items-center gap-3 mb-2">
                                                <div className="w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center">
                                                    <i className="fas fa-moon text-purple-600"></i>
                                                </div>
                                                <div>
                                                    <div className="text-lg font-bold text-purple-600">{getSleepStats().totalHours}h</div>
                                                    <div className="text-xs text-gray-500">Sommeil total</div>
                                                </div>
                                            </div>
                                            <div className="text-sm text-gray-600">
                                                {getSleepStats().sessions} sessions ‚Ä¢ Moy: {getSleepStats().averageHours}h/session
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {analyticsFilter.length === 0 && (
                                    <div className="bg-white/90 rounded-2xl p-8 shadow-xl border border-white/50 text-center">
                                        <div className="w-16 h-16 bg-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                                            <i className="fas fa-chart-bar text-gray-400 text-2xl"></i>
                                        </div>
                                        <p className="text-gray-500 font-medium">S√©lectionnez des donn√©es √† afficher</p>
                                        <p className="text-gray-400 text-sm">Choisissez les types de donn√©es dans les filtres ci-dessus</p>
                                    </div>
                                )}
                            </div>
                        )}

                        {showBreastfeedingModal && (
                            <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-end sm:items-center justify-center p-0 sm:p-4 z-50">
                                <div className="bg-white w-full sm:max-w-md sm:rounded-3xl rounded-t-3xl max-h-[90vh] overflow-y-auto relative">
                                    {/* Header */}
                                    <div className="sticky top-0 bg-gradient-to-r from-pink-500 to-pink-600 text-white p-6 rounded-t-3xl z-10">
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center gap-3">
                                                <div className="w-12 h-12 bg-white/20 rounded-2xl flex items-center justify-center">
                                                    <i className="fas fa-heart text-xl"></i>
                                                </div>
                                                <div>
                                                    <h3 className="text-xl font-bold">Allaitement</h3>
                                                    <p className="text-sm opacity-80">Suivi des t√©t√©es</p>
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => setShowBreastfeedingModal(false)}
                                                className="w-10 h-10 rounded-2xl bg-white/20 flex items-center justify-center"
                                            >
                                                <i className="fas fa-times text-lg"></i>
                                            </button>
                                        </div>
                                    </div>

                                    {/* Contenu */}
                                    <div className="p-6 space-y-6">
                                        {breastfeedingSession ? (
                                            // Session en cours
                                            <div className="text-center">
                                                <div className="w-20 h-20 bg-pink-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                                    <i className="fas fa-heart text-pink-600 text-2xl pulse-gentle"></i>
                                                </div>
                                                <h3 className="text-lg font-bold text-gray-900 mb-2">Allaitement en cours</h3>
                                                <p className="text-sm text-gray-600 mb-1">
                                                    {breastfeedingSession.breast === 'left' ? 'Sein gauche' :
                                                        breastfeedingSession.breast === 'right' ? 'Sein droit' : 'Les deux seins'}
                                                </p>
                                                <p className="text-sm text-gray-600 mb-4">
                                                    D√©marr√© √† {formatTime(breastfeedingSession.startTime)}
                                                </p>
                                                <button
                                                    onClick={stopBreastfeeding}
                                                    className="w-full bg-gradient-to-r from-red-500 to-red-600 text-white py-4 rounded-2xl font-bold active:scale-95 transition-transform"
                                                >
                                                    Arr√™ter l'allaitement
                                                </button>
                                            </div>
                                        ) : (
                                            // D√©marrer nouvelle session
                                            <div className="space-y-4">
                                                <div className="text-center mb-6">
                                                    <div className="w-16 h-16 bg-pink-100 rounded-2xl flex items-center justify-center mx-auto mb-3">
                                                        <i className="fas fa-heart text-pink-600 text-2xl"></i>
                                                    </div>
                                                    <h3 className="text-lg font-bold text-gray-900 mb-2">Nouvelle t√©t√©e</h3>
                                                    <p className="text-sm text-gray-600">Choisissez le sein pour commencer</p>
                                                </div>

                                                {/* Choix du sein */}
                                                <div className="grid grid-cols-2 gap-3 mb-6">
                                                    <button
                                                        onClick={() => startBreastfeeding('left')}
                                                        className="p-4 rounded-2xl border-2 border-pink-200 bg-pink-50 hover:bg-pink-100 transition-all active:scale-95"
                                                    >
                                                        <div className="text-2xl mb-2">ü§±</div>
                                                        <div className="font-semibold text-pink-800">Sein gauche</div>
                                                    </button>
                                                    <button
                                                        onClick={() => startBreastfeeding('right')}
                                                        className="p-4 rounded-2xl border-2 border-pink-200 bg-pink-50 hover:bg-pink-100 transition-all active:scale-95"
                                                    >
                                                        <div className="text-2xl mb-2">ü§±</div>
                                                        <div className="font-semibold text-pink-800">Sein droit</div>
                                                    </button>
                                                </div>

                                                {/* Saisie manuelle */}
                                                <div className="border-t pt-6">
                                                    <h4 className="font-semibold text-gray-800 mb-4">Ou saisie manuelle</h4>

                                                    <div className="space-y-4">
                                                        <div>
                                                            <label className="block text-sm font-medium text-gray-700 mb-2">Sein utilis√©</label>
                                                            <div className="grid grid-cols-3 gap-2">
                                                                {[
                                                                    { value: 'left', label: 'Gauche', emoji: 'üëà' },
                                                                    { value: 'right', label: 'Droit', emoji: 'üëâ' },
                                                                    { value: 'both', label: 'Les deux', emoji: 'ü§≤' }
                                                                ].map(option => (
                                                                    <button
                                                                        key={option.value}
                                                                        type="button"
                                                                        onClick={() => setBreastfeedingData(prev => ({ ...prev, breast: option.value }))}
                                                                        className={`p-3 rounded-xl border-2 transition-all text-center ${breastfeedingData.breast === option.value
                                                                            ? 'bg-pink-100 border-pink-300 text-pink-800'
                                                                            : 'bg-gray-50 border-gray-200 text-gray-600'
                                                                            }`}
                                                                    >
                                                                        <div className="text-lg mb-1">{option.emoji}</div>
                                                                        <div className="text-xs font-medium">{option.label}</div>
                                                                    </button>
                                                                ))}
                                                            </div>
                                                        </div>

                                                        <div>
                                                            <label className="block text-sm font-medium text-gray-700 mb-2">Dur√©e (minutes)</label>
                                                            <input
                                                                type="number"
                                                                placeholder="15"
                                                                className="w-full px-4 py-3 rounded-2xl border-2 border-gray-200 focus:border-pink-500 focus:outline-none"
                                                                value={breastfeedingData.duration}
                                                                onChange={(e) => setBreastfeedingData(prev => ({ ...prev, duration: e.target.value }))}
                                                            />
                                                        </div>

                                                        <div>
                                                            <label className="block text-sm font-medium text-gray-700 mb-2">Notes (optionnel)</label>
                                                            <textarea
                                                                className="w-full px-4 py-3 rounded-2xl border-2 border-gray-200 focus:border-pink-500 focus:outline-none"
                                                                rows="2"
                                                                placeholder="Observations..."
                                                                value={breastfeedingData.notes}
                                                                onChange={(e) => setBreastfeedingData(prev => ({ ...prev, notes: e.target.value }))}
                                                            />
                                                        </div>

                                                        <button
                                                            onClick={saveBreastfeedingManual}
                                                            className="w-full bg-gradient-to-r from-pink-500 to-pink-600 text-white py-4 rounded-2xl font-bold active:scale-95 transition-transform"
                                                        >
                                                            Enregistrer la t√©t√©e
                                                        </button>
                                                    </div>
                                                </div>

                                                {/* Derni√®res t√©t√©es */}
                                                {breastfeedingEntries.length > 0 && (
                                                    <div className="border-t pt-6">
                                                        <h4 className="font-semibold text-gray-800 mb-3">Derni√®res t√©t√©es</h4>
                                                        <div className="space-y-2 max-h-40 overflow-y-auto">
                                                            {breastfeedingEntries.slice(0, 3).map(entry => (
                                                                <div key={entry.id} className="bg-pink-50 rounded-xl p-3 border border-pink-200">
                                                                    <div className="flex items-center justify-between">
                                                                        <div>
                                                                            <div className="font-medium text-pink-800">
                                                                                {entry.breast === 'left' ? 'Sein gauche' :
                                                                                    entry.breast === 'right' ? 'Sein droit' : 'Les deux seins'}
                                                                                {entry.duration && ` - ${entry.duration}min`}
                                                                            </div>
                                                                            <div className="text-xs text-pink-600">
                                                                                {formatDateTime(entry.timestamp)}
                                                                            </div>
                                                                        </div>
                                                                        <button
                                                                            onClick={() => deleteBreastfeedingEntry(entry.id)}
                                                                            className="text-red-500 hover:text-red-700 p-1"
                                                                        >
                                                                            <i className="fas fa-trash text-xs"></i>
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* Modal Tire-lait */}
                        {showBreastPumpModal && (
                            <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-end sm:items-center justify-center p-0 sm:p-4 z-50">
                                <div className="bg-white w-full sm:max-w-md sm:rounded-3xl rounded-t-3xl max-h-[90vh] overflow-y-auto relative">
                                    {/* Header */}
                                    <div className="sticky top-0 bg-gradient-to-r from-purple-500 to-purple-600 text-white p-6 rounded-t-3xl z-10">
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center gap-3">
                                                <div className="w-12 h-12 bg-white/20 rounded-2xl flex items-center justify-center">
                                                    <i className="fas fa-pump-soap text-xl"></i>
                                                </div>
                                                <div>
                                                    <h3 className="text-xl font-bold">Tire-lait</h3>
                                                    <p className="text-sm opacity-80">Suivi du pompage</p>
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => setShowBreastPumpModal(false)}
                                                className="w-10 h-10 rounded-2xl bg-white/20 flex items-center justify-center"
                                            >
                                                <i className="fas fa-times text-lg"></i>
                                            </button>
                                        </div>
                                    </div>

                                    {/* Contenu */}
                                    <div className="p-6 space-y-6">
                                        <div className="text-center mb-6">
                                            <div className="w-16 h-16 bg-purple-100 rounded-2xl flex items-center justify-center mx-auto mb-3">
                                                <i className="fas fa-pump-soap text-purple-600 text-2xl"></i>
                                            </div>
                                            <h3 className="text-lg font-bold text-gray-900 mb-2">Session de tire-lait</h3>
                                            <p className="text-sm text-gray-600">Enregistrez votre session</p>
                                        </div>

                                        <div className="space-y-4">
                                            {/* Volume */}
                                            <div>
                                                <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                    Volume extrait (ml) *
                                                </label>
                                                <div className="relative">
                                                    <input
                                                        type="number"
                                                        placeholder="120"
                                                        className="w-full px-4 py-3 pr-12 rounded-2xl border-2 border-gray-200 focus:border-purple-500 focus:outline-none text-lg font-bold text-center"
                                                        value={breastPumpData.volume}
                                                        onChange={(e) => setBreastPumpData(prev => ({ ...prev, volume: e.target.value }))}
                                                    />
                                                    <span className="absolute right-4 top-4 text-gray-500 font-medium">ml</span>
                                                </div>
                                            </div>

                                            {/* Dur√©e */}
                                            <div>
                                                <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                    Dur√©e de pompage (minutes) *
                                                </label>
                                                <div className="relative">
                                                    <input
                                                        type="number"
                                                        placeholder="20"
                                                        className="w-full px-4 py-3 pr-16 rounded-2xl border-2 border-gray-200 focus:border-purple-500 focus:outline-none text-lg font-bold text-center"
                                                        value={breastPumpData.duration}
                                                        onChange={(e) => setBreastPumpData(prev => ({ ...prev, duration: e.target.value }))}
                                                    />
                                                    <span className="absolute right-4 top-4 text-gray-500 font-medium">min</span>
                                                </div>
                                            </div>

                                            {/* Conservation */}
                                            <div>
                                                <label className="block text-sm font-semibold text-gray-700 mb-2">Conservation</label>
                                                <div className="grid grid-cols-3 gap-2">
                                                    {[
                                                        { value: 'immediate', label: 'Imm√©diat', emoji: 'üçº' },
                                                        { value: 'fridge', label: 'Frigo', emoji: '‚ùÑÔ∏è' },
                                                        { value: 'freezer', label: 'Cong√©lateur', emoji: 'üßä' }
                                                    ].map(option => (
                                                        <button
                                                            key={option.value}
                                                            type="button"
                                                            onClick={() => setBreastPumpData(prev => ({ ...prev, storage: option.value }))}
                                                            className={`p-3 rounded-xl border-2 transition-all text-center ${breastPumpData.storage === option.value
                                                                ? 'bg-purple-100 border-purple-300 text-purple-800'
                                                                : 'bg-gray-50 border-gray-200 text-gray-600'
                                                                }`}
                                                        >
                                                            <div className="text-lg mb-1">{option.emoji}</div>
                                                            <div className="text-xs font-medium mb-1">{option.label}</div>
                                                            <div className="text-xs text-gray-500">{option.desc}</div>
                                                        </button>
                                                    ))}
                                                </div>
                                            </div>

                                            {/* Notes */}
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Notes (optionnel)</label>
                                                <textarea
                                                    className="w-full px-4 py-3 rounded-2xl border-2 border-gray-200 focus:border-purple-500 focus:outline-none"
                                                    rows="2"
                                                    placeholder="Observations, conditions..."
                                                    value={breastPumpData.notes}
                                                    onChange={(e) => setBreastPumpData(prev => ({ ...prev, notes: e.target.value }))}
                                                />
                                            </div>

                                            <button
                                                onClick={saveBreastPumpEntry}
                                                className="w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white py-4 rounded-2xl font-bold active:scale-95 transition-transform"
                                            >
                                                Enregistrer la session
                                            </button>
                                        </div>

                                        {/* Derni√®res sessions */}
                                        {breastPumpEntries.length > 0 && (
                                            <div className="border-t pt-6">
                                                <h4 className="font-semibold text-gray-800 mb-3">Derni√®res sessions</h4>
                                                <div className="space-y-2 max-h-40 overflow-y-auto">
                                                    {breastPumpEntries.slice(0, 3).map(entry => (
                                                        <div key={entry.id} className="bg-purple-50 rounded-xl p-3 border border-purple-200">
                                                            <div className="flex items-center justify-between">
                                                                <div>
                                                                    <div className="font-medium text-purple-800">
                                                                        {entry.volume}ml en {entry.duration}min
                                                                    </div>
                                                                    <div className="text-xs text-purple-600 flex items-center gap-2">
                                                                        <span>{formatDateTime(entry.timestamp)}</span>
                                                                        <span className="w-1 h-1 bg-purple-400 rounded-full"></span>
                                                                        <span className="capitalize">
                                                                            {entry.storage === 'immediate' ? 'Imm√©diat' :
                                                                                entry.storage === 'fridge' ? 'Frigo' : 'Cong√©lateur'}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                                <button
                                                                    onClick={() => deleteBreastPumpEntry(entry.id)}
                                                                    className="text-red-500 hover:text-red-700 p-1"
                                                                >
                                                                    <i className="fas fa-trash text-xs"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* Modal Poids */}
                        {showWeightModal && (
                            <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-end sm:items-center justify-center p-0 sm:p-4 z-50">
                                <div className="bg-white w-full sm:max-w-md sm:rounded-3xl rounded-t-3xl max-h-[90vh] overflow-y-auto relative">
                                    <div className="sticky top-0 bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-t-3xl z-10">
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center gap-3">
                                                <div className="w-12 h-12 bg-white/20 rounded-2xl flex items-center justify-center">
                                                    <i className="fas fa-weight text-xl"></i>
                                                </div>
                                                <div>
                                                    <h3 className="text-xl font-bold">Mise √† jour du poids</h3>
                                                    <p className="text-sm opacity-80">Poids actuel de {user?.babyName}</p>
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => setShowWeightModal(false)}
                                                className="w-10 h-10 rounded-2xl bg-white/20 flex items-center justify-center"
                                            >
                                                <i className="fas fa-times text-lg"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <div className="p-6 space-y-6">
                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                Poids actuel (kg) *
                                            </label>
                                            <div className="relative">
                                                <input
                                                    type="number"
                                                    step="0.001"
                                                    placeholder="3.500"
                                                    className="w-full px-4 py-3 pr-12 rounded-2xl border-2 border-gray-200 focus:border-blue-500 focus:outline-none text-lg font-bold text-center"
                                                    value={weightInput}
                                                    onChange={(e) => setWeightInput(e.target.value)}
                                                />
                                                <span className="absolute right-4 top-4 text-gray-500 font-medium">kg</span>
                                            </div>
                                        </div>

                                        <button
                                            onClick={saveWeight}
                                            className="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-4 rounded-2xl font-bold active:scale-95 transition-transform"
                                        >
                                            Mettre √† jour le poids
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Modal Taille */}
                        {showHeightModal && (
                            <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-end sm:items-center justify-center p-0 sm:p-4 z-50">
                                <div className="bg-white w-full sm:max-w-md sm:rounded-3xl rounded-t-3xl max-h-[90vh] overflow-y-auto relative">
                                    <div className="sticky top-0 bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-t-3xl z-10">
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center gap-3">
                                                <div className="w-12 h-12 bg-white/20 rounded-2xl flex items-center justify-center">
                                                    <i className="fas fa-ruler text-xl"></i>
                                                </div>
                                                <div>
                                                    <h3 className="text-xl font-bold">Mise √† jour de la taille</h3>
                                                    <p className="text-sm opacity-80">Taille actuelle de {user?.babyName}</p>
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => setShowHeightModal(false)}
                                                className="w-10 h-10 rounded-2xl bg-white/20 flex items-center justify-center"
                                            >
                                                <i className="fas fa-times text-lg"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <div className="p-6 space-y-6">
                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                Taille actuelle (cm) *
                                            </label>
                                            <div className="relative">
                                                <input
                                                    type="number"
                                                    step="0.1"
                                                    placeholder="52.5"
                                                    className="w-full px-4 py-3 pr-12 rounded-2xl border-2 border-gray-200 focus:border-green-500 focus:outline-none text-lg font-bold text-center"
                                                    value={heightInput}
                                                    onChange={(e) => setHeightInput(e.target.value)}
                                                />
                                                <span className="absolute right-4 top-4 text-gray-500 font-medium">cm</span>
                                            </div>
                                        </div>

                                        <button
                                            onClick={saveHeight}
                                            className="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-4 rounded-2xl font-bold active:scale-95 transition-transform"
                                        >
                                            Mettre √† jour la taille
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* Modal Sommeil */}
                        {showSleepModal && (
                            <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-end sm:items-center justify-center p-0 sm:p-4 z-50">
                                <div className="bg-white w-full sm:max-w-md sm:rounded-3xl rounded-t-3xl max-h-[90vh] overflow-y-auto relative">
                                    {/* Header */}
                                    <div className="sticky top-0 bg-gradient-to-r from-indigo-500 to-indigo-600 text-white p-6 rounded-t-3xl z-10">
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center gap-3">
                                                <div className="w-12 h-12 bg-white/20 rounded-2xl flex items-center justify-center">
                                                    <i className="fas fa-moon text-xl"></i>
                                                </div>
                                                <div>
                                                    <h3 className="text-xl font-bold">Suivi du sommeil</h3>
                                                    <p className="text-sm opacity-80">Gestion des sessions</p>
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => setShowSleepModal(false)}
                                                className="w-10 h-10 rounded-2xl bg-white/20 flex items-center justify-center"
                                            >
                                                <i className="fas fa-times text-lg"></i>
                                            </button>
                                        </div>
                                    </div>

                                    {/* Contenu */}
                                    <div className="p-6 space-y-6">
                                        {currentSleep ? (
                                            // Session en cours
                                            <div className="text-center">
                                                <div className="w-20 h-20 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                                    <i className="fas fa-moon text-indigo-600 text-2xl pulse-gentle"></i>
                                                </div>
                                                <h3 className="text-lg font-bold text-gray-900 mb-2">Sommeil en cours</h3>
                                                <p className="text-sm text-gray-600 mb-4">
                                                    D√©marr√© √† {formatTime(currentSleep.startTime)}
                                                </p>
                                                <button
                                                    onClick={() => {
                                                        stopSleep();
                                                        setShowSleepModal(false);
                                                    }}
                                                    className="w-full bg-gradient-to-r from-red-500 to-red-600 text-white py-4 rounded-2xl font-bold active:scale-95 transition-transform"
                                                >
                                                    Arr√™ter le sommeil
                                                </button>
                                            </div>
                                        ) : (
                                            // D√©marrer nouvelle session OU saisie manuelle
                                            <div className="space-y-6">
                                                {/* Option 1: D√©marrer maintenant */}
                                                <div className="text-center pb-6 border-b border-gray-200">
                                                    <div className="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                                        <i className="fas fa-play text-green-600 text-2xl"></i>
                                                    </div>
                                                    <h3 className="text-lg font-bold text-gray-900 mb-2">D√©marrer maintenant</h3>
                                                    <p className="text-sm text-gray-600 mb-6">
                                                        Lancez le suivi quand {user?.babyName} s'endort
                                                    </p>

                                                    <button
                                                        onClick={() => {
                                                            startSleep();
                                                            setShowSleepModal(false);
                                                        }}
                                                        className="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-4 rounded-2xl font-bold active:scale-95 transition-transform"
                                                    >
                                                        Commencer le sommeil
                                                    </button>
                                                </div>

                                                {/* Option 2: Saisie manuelle */}
                                                <div>
                                                    <h4 className="font-semibold text-gray-800 mb-4 text-center">Ou saisie manuelle</h4>

                                                    <div className="space-y-4">
                                                        {/* Date */}
                                                        <div>
                                                            <label className="block text-sm font-medium text-gray-700 mb-2">Date</label>
                                                            <input
                                                                type="date"
                                                                className="w-full px-4 py-3 rounded-2xl border-2 border-gray-200 focus:border-indigo-500 focus:outline-none"
                                                                value={sleepData.date}
                                                                onChange={(e) => setSleepData(prev => ({ ...prev, date: e.target.value }))}
                                                            />
                                                        </div>

                                                        {/* Heures */}
                                                        <div className="grid grid-cols-2 gap-3">
                                                            <div>
                                                                <label className="block text-sm font-medium text-gray-700 mb-2">D√©but</label>
                                                                <input
                                                                    type="time"
                                                                    className="w-full px-4 py-3 rounded-2xl border-2 border-gray-200 focus:border-indigo-500 focus:outline-none"
                                                                    value={sleepData.startTime}
                                                                    onChange={(e) => setSleepData(prev => ({ ...prev, startTime: e.target.value }))}
                                                                />
                                                            </div>
                                                            <div>
                                                                <label className="block text-sm font-medium text-gray-700 mb-2">Fin</label>
                                                                <input
                                                                    type="time"
                                                                    className="w-full px-4 py-3 rounded-2xl border-2 border-gray-200 focus:border-indigo-500 focus:outline-none"
                                                                    value={sleepData.endTime}
                                                                    onChange={(e) => setSleepData(prev => ({ ...prev, endTime: e.target.value }))}
                                                                />
                                                            </div>
                                                        </div>

                                                        {/* Message info pour les sessions sur plusieurs jours */}
                                                        <div className="bg-blue-50 border border-blue-200 rounded-xl p-3">
                                                            <p className="text-xs text-blue-700">
                                                                <i className="fas fa-info-circle mr-1"></i>
                                                                Si l'heure de fin est avant l'heure de d√©but, le syst√®me comprendra automatiquement qu'il s'agit du lendemain.
                                                            </p>
                                                        </div>

                                                        <button
                                                            onClick={() => {
                                                                saveSleepEdit();
                                                            }}
                                                            className="w-full bg-gradient-to-r from-indigo-500 to-indigo-600 text-white py-4 rounded-2xl font-bold active:scale-95 transition-transform"
                                                        >
                                                            Enregistrer la session
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        )}

                                        {/* Derni√®res sessions */}
                                        {sleepSessions.filter(s => s.status === 'completed').length > 0 && (
                                            <div className="border-t pt-6">
                                                <h4 className="font-semibold text-gray-800 mb-3">Derni√®res sessions</h4>
                                                <div className="space-y-2 max-h-40 overflow-y-auto">
                                                    {sleepSessions.filter(s => s.status === 'completed').slice(0, 3).map(session => (
                                                        <div key={session.id} className="bg-indigo-50 rounded-xl p-3 border border-indigo-200">
                                                            <div className="flex items-center justify-between">
                                                                <div>
                                                                    <div className="font-medium text-indigo-800">
                                                                        {formatSleepDuration(session.duration)}
                                                                    </div>
                                                                    <div className="text-xs text-indigo-600">
                                                                        {formatDateTime(session.startTime)}
                                                                    </div>
                                                                </div>
                                                                <button
                                                                    onClick={() => deleteSleepSession(session.id)}
                                                                    className="text-red-500 hover:text-red-700 p-1"
                                                                >
                                                                    <i className="fas fa-trash text-xs"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* Modal Diversification - Version Gamifi√©e */}
                        {showFoodModal && (
                            <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-end sm:items-center justify-center p-0 sm:p-4 z-50">
                                <div className="bg-gradient-to-br from-orange-50 to-yellow-50 w-full sm:max-w-md sm:rounded-3xl rounded-t-3xl max-h-[90vh] overflow-y-auto relative">
                                    {/* Header */}
                                    <div className={`sticky top-0 ${isMixMode ? 'bg-gradient-to-r from-purple-400 via-purple-500 to-pink-400' : 'bg-gradient-to-r from-orange-400 via-orange-500 to-yellow-400'} text-white p-6 rounded-t-3xl z-10 relative overflow-hidden`}>
                                        <div className="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-16 translate-x-16"></div>
                                        <div className="absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full translate-y-12 -translate-x-12"></div>

                                        <div className="flex items-center justify-between relative z-10">
                                            <div className="flex items-center gap-3">
                                                <div className="w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center backdrop-blur-sm">
                                                    <span className="text-3xl">{isMixMode ? 'ü•£' : 'üçΩÔ∏è'}</span>
                                                </div>
                                                <div>
                                                    <h3 className="text-xl font-bold">{isMixMode ? 'Mix d\'aliments' : 'D√©couverte culinaire'}</h3>
                                                    <p className="text-sm opacity-90">{isMixMode ? 'M√©lange avec nouvel aliment' : 'Nouvel aliment test√© !'}</p>
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => {
                                                    setShowFoodModal(false);
                                                    setIsMixMode(false);
                                                    setMixFoods([]);
                                                    setMixNewFood('');
                                                    setMixNewFoodCategory('');
                                                }}
                                                className="w-10 h-10 rounded-2xl bg-white/20 backdrop-blur-sm flex items-center justify-center hover:bg-white/30 transition-all"
                                            >
                                                <i className="fas fa-times text-lg"></i>
                                            </button>
                                        </div>
                                    </div>

                                    {/* Contenu */}
                                    <div className="p-6 space-y-5">
                                        {/* MODE MIX */}
                                        {isMixMode ? (
                                            <>
                                                {/* Aliments d√©j√† connus */}
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-3 flex items-center gap-2">
                                                        <span className="text-lg">‚úÖ</span>
                                                        Aliments d√©j√† tol√©r√©s dans le mix
                                                    </label>
                                                    <div className="bg-white rounded-2xl p-4 border-2 border-gray-200">
                                                        <div className="flex gap-2 mb-3">
                                                            <input
                                                                type="text"
                                                                id="mixFoodInput"
                                                                className="flex-1 px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-purple-400 focus:outline-none"
                                                                placeholder="Ex: Pomme, Banane..."
                                                                onKeyDown={(e) => {
                                                                    if (e.key === 'Enter' && e.target.value.trim()) {
                                                                        setMixFoods([...mixFoods, e.target.value.trim()]);
                                                                        e.target.value = '';
                                                                    }
                                                                }}
                                                            />
                                                            <button
                                                                type="button"
                                                                onClick={() => {
                                                                    const input = document.getElementById('mixFoodInput');
                                                                    if (input && input.value.trim()) {
                                                                        setMixFoods([...mixFoods, input.value.trim()]);
                                                                        input.value = '';
                                                                    }
                                                                }}
                                                                className="w-12 h-12 bg-gradient-to-r from-green-400 to-emerald-500 text-white rounded-xl flex items-center justify-center shadow-lg active:scale-95 transition-transform"
                                                            >
                                                                <i className="fas fa-plus text-xl"></i>
                                                            </button>
                                                        </div>
                                                        <div className="flex flex-wrap gap-2">
                                                            {mixFoods.map((food, index) => (
                                                                <div key={index} className="bg-green-100 text-green-700 px-3 py-1.5 rounded-full text-sm font-medium flex items-center gap-2">
                                                                    <span>{food}</span>
                                                                    <button
                                                                        onClick={() => setMixFoods(mixFoods.filter((_, i) => i !== index))}
                                                                        className="w-4 h-4 bg-green-200 rounded-full flex items-center justify-center hover:bg-green-300"
                                                                    >
                                                                        <i className="fas fa-times text-[8px]"></i>
                                                                    </button>
                                                                </div>
                                                            ))}
                                                        </div>
                                                        {mixFoods.length === 0 && (
                                                            <p className="text-xs text-gray-500 text-center py-2">Tapez un aliment et appuyez sur Entr√©e ou sur le bouton +</p>
                                                        )}
                                                    </div>
                                                </div>
                                                {/* Cat√©gorie du NOUVEL aliment */}
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-3 flex items-center gap-2">
                                                        <span className="text-lg">üÜï</span>
                                                        Cat√©gorie du NOUVEL aliment √† tester
                                                    </label>
                                                    <div className="grid grid-cols-2 gap-3">
                                                        {[
                                                            { id: 'legumes', label: 'L√©gumes', icon: 'ü•ï', gradient: 'from-green-400 to-emerald-500', bgLight: 'bg-green-50', border: 'border-green-400' },
                                                            { id: 'fruits', label: 'Fruits', icon: 'üçé', gradient: 'from-red-400 to-pink-500', bgLight: 'bg-red-50', border: 'border-red-400' },
                                                            { id: 'viande', label: 'Prot√©ines', icon: 'üçó', gradient: 'from-purple-400 to-indigo-500', bgLight: 'bg-purple-50', border: 'border-purple-400' },
                                                            { id: 'cereales', label: 'C√©r√©ales', icon: 'üåæ', gradient: 'from-yellow-400 to-amber-500', bgLight: 'bg-yellow-50', border: 'border-yellow-400' }
                                                        ].map(cat => (
                                                            <button
                                                                key={cat.id}
                                                                type="button"
                                                                onClick={() => setMixNewFoodCategory(cat.id)}
                                                                className={`relative p-4 rounded-2xl border-3 transition-all transform hover:scale-105 ${mixNewFoodCategory === cat.id
                                                                    ? `${cat.border} ${cat.bgLight} shadow-lg scale-105`
                                                                    : 'border-gray-200 bg-white shadow-sm'
                                                                    }`}
                                                            >
                                                                {mixNewFoodCategory === cat.id && (
                                                                    <div className="absolute -top-2 -right-2 w-7 h-7 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center shadow-lg">
                                                                        <i className="fas fa-check text-white text-xs"></i>
                                                                    </div>
                                                                )}
                                                                <div className="text-4xl mb-2">{cat.icon}</div>
                                                                <div className="font-bold text-gray-800 text-sm">{cat.label}</div>
                                                            </button>
                                                        ))}
                                                    </div>
                                                </div>

                                                {/* Nom du NOUVEL aliment */}
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2 flex items-center gap-2">
                                                        <span className="text-lg">‚ú®</span>
                                                        NOUVEL aliment √† introduire
                                                    </label>
                                                    <div className="relative">
                                                        <input
                                                            type="text"
                                                            className="w-full px-4 py-4 pl-12 rounded-2xl border-3 border-purple-300 focus:border-purple-500 focus:outline-none text-lg font-medium shadow-sm bg-purple-50"
                                                            placeholder="Ex: Poire (nouveau)"
                                                            value={mixNewFood}
                                                            onChange={(e) => setMixNewFood(e.target.value)}
                                                        />
                                                        <div className="absolute left-4 top-1/2 -translate-y-1/2 text-2xl">
                                                            {mixNewFoodCategory === 'legumes' && 'ü•ï'}
                                                            {mixNewFoodCategory === 'fruits' && 'üçé'}
                                                            {mixNewFoodCategory === 'viande' && 'üçó'}
                                                            {mixNewFoodCategory === 'cereales' && 'üåæ'}
                                                            {!mixNewFoodCategory && 'üÜï'}
                                                        </div>
                                                    </div>
                                                    <p className="text-xs text-purple-600 mt-2 font-medium">‚ö†Ô∏è Cet aliment sera marqu√© comme le nouvel aliment test√©</p>
                                                </div>
                                            </>
                                        ) : (
                                            <>
                                                {/* MODE NORMAL - Cat√©gorie */}
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-3 flex items-center gap-2">
                                                        <span className="text-lg">üéØ</span>
                                                        Cat√©gorie d'aliment
                                                    </label>
                                                    <div className="grid grid-cols-2 gap-3">
                                                        {[
                                                            { id: 'legumes', label: 'L√©gumes', icon: 'ü•ï', gradient: 'from-green-400 to-emerald-500', bgLight: 'bg-green-50', border: 'border-green-400' },
                                                            { id: 'fruits', label: 'Fruits', icon: 'üçé', gradient: 'from-red-400 to-pink-500', bgLight: 'bg-red-50', border: 'border-red-400' },
                                                            { id: 'viande', label: 'Prot√©ines', icon: 'üçó', gradient: 'from-purple-400 to-indigo-500', bgLight: 'bg-purple-50', border: 'border-purple-400' },
                                                            { id: 'cereales', label: 'C√©r√©ales', icon: 'üåæ', gradient: 'from-yellow-400 to-amber-500', bgLight: 'bg-yellow-50', border: 'border-yellow-400' }
                                                        ].map(cat => (
                                                            <button
                                                                key={cat.id}
                                                                type="button"
                                                                onClick={() => setDiversificationData(prev => ({ ...prev, category: cat.id }))}
                                                                className={`relative p-4 rounded-2xl border-3 transition-all transform hover:scale-105 ${diversificationData.category === cat.id
                                                                    ? `${cat.border} ${cat.bgLight} shadow-lg scale-105`
                                                                    : 'border-gray-200 bg-white shadow-sm'
                                                                    }`}
                                                            >
                                                                {diversificationData.category === cat.id && (
                                                                    <div className="absolute -top-2 -right-2 w-7 h-7 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center shadow-lg">
                                                                        <i className="fas fa-check text-white text-xs"></i>
                                                                    </div>
                                                                )}
                                                                <div className="text-4xl mb-2">{cat.icon}</div>
                                                                <div className="font-bold text-gray-800 text-sm">{cat.label}</div>
                                                            </button>
                                                        ))}
                                                    </div>
                                                </div>

                                                {/* MODE NORMAL - Nom de l'aliment */}
                                                <div>
                                                    <label className="block text-sm font-bold text-gray-700 mb-2 flex items-center gap-2">
                                                        <span className="text-lg">‚ú®</span>
                                                        Quel aliment ?
                                                    </label>
                                                    <div className="relative">
                                                        <input
                                                            type="text"
                                                            className="w-full px-4 py-4 pl-12 rounded-2xl border-3 border-gray-200 focus:border-orange-400 focus:outline-none text-lg font-medium shadow-sm"
                                                            placeholder="Ex: Carotte, Pomme..."
                                                            value={diversificationData.food}
                                                            onChange={(e) => setDiversificationData(prev => ({ ...prev, food: e.target.value }))}
                                                        />
                                                        <div className="absolute left-4 top-1/2 -translate-y-1/2 text-2xl">
                                                            {diversificationData.category === 'legumes' && 'ü•ï'}
                                                            {diversificationData.category === 'fruits' && 'üçé'}
                                                            {diversificationData.category === 'viande' && 'üçó'}
                                                            {diversificationData.category === 'cereales' && 'üåæ'}
                                                            {!diversificationData.category && 'üçΩÔ∏è'}
                                                        </div>
                                                    </div>
                                                </div>
                                            </>
                                        )}

                                        {/* Quantit√© - COMMUN */}
                                        <div>
                                            <label className="block text-sm font-bold text-gray-700 mb-3 flex items-center gap-2">
                                                <span className="text-lg">üìä</span>
                                                Quantit√© mang√©e
                                            </label>
                                            <div className="grid grid-cols-4 gap-2">
                                                {[
                                                    { id: 'petite', emoji: 'ü•Ñ', label: 'Petite', color: 'blue' },
                                                    { id: 'moyenne', emoji: 'üç¥', label: 'Moyenne', color: 'green' },
                                                    { id: 'grande', emoji: 'üçΩÔ∏è', label: 'Grande', color: 'orange' },
                                                    { id: 'complete', emoji: '‚≠ê', label: 'Compl√®te', color: 'purple' }
                                                ].map(q => (
                                                    <button
                                                        key={q.id}
                                                        type="button"
                                                        onClick={() => setDiversificationData(prev => ({ ...prev, quantity: q.id }))}
                                                        className={`p-3 rounded-2xl border-2 transition-all ${diversificationData.quantity === q.id
                                                            ? `border-${q.color}-400 bg-${q.color}-50`
                                                            : 'border-gray-200 bg-white'
                                                            }`}
                                                    >
                                                        <div className="text-2xl mb-1">{q.emoji}</div>
                                                        <div className="text-xs font-bold text-gray-700">{q.label}</div>
                                                    </button>
                                                ))}
                                            </div>
                                        </div>

                                        {/* R√©action - COMMUN */}
                                        <div>
                                            <label className="block text-sm font-bold text-gray-700 mb-3 flex items-center gap-2">
                                                <span className="text-lg">üòä</span>
                                                R√©action de b√©b√©
                                            </label>
                                            <div className="grid grid-cols-5 gap-2">
                                                {[
                                                    { id: 'adore', emoji: 'üòç', label: 'Ador√©' },
                                                    { id: 'aime', emoji: 'üòä', label: 'Aim√©' },
                                                    { id: 'neutre', emoji: 'üòê', label: 'Neutre' },
                                                    { id: 'bof', emoji: 'üòï', label: 'Bof' },
                                                    { id: 'refuse', emoji: 'üòñ', label: 'Refus√©' }
                                                ].map(reaction => (
                                                    <button
                                                        key={reaction.id}
                                                        type="button"
                                                        onClick={() => setDiversificationData(prev => ({ ...prev, reaction: reaction.id }))}
                                                        className={`p-3 rounded-2xl border-2 transition-all transform hover:scale-110 ${diversificationData.reaction === reaction.id
                                                            ? 'border-orange-400 bg-orange-50 scale-110'
                                                            : 'border-gray-200 bg-white'
                                                            }`}
                                                    >
                                                        <div className="text-2xl mb-1">{reaction.emoji}</div>
                                                        <div className="text-xs font-medium text-gray-600">{reaction.label}</div>
                                                    </button>
                                                ))}
                                            </div>
                                        </div>

                                        {/* Notes - COMMUN */}
                                        <div>
                                            <label className="block text-sm font-bold text-gray-700 mb-2 flex items-center gap-2">
                                                <span className="text-lg">üìù</span>
                                                Notes (optionnel)
                                            </label>
                                            <textarea
                                                className="w-full px-4 py-3 rounded-2xl border-3 border-gray-200 focus:border-orange-400 focus:outline-none shadow-sm"
                                                rows="3"
                                                placeholder="Texture, pr√©paration, commentaires..."
                                                value={diversificationData.notes}
                                                onChange={(e) => setDiversificationData(prev => ({ ...prev, notes: e.target.value }))}
                                            />
                                        </div>

                                        {/* Bouton de validation */}
                                        <button
                                            onClick={() => {
                                                if (isMixMode) {
                                                    console.log('=== VALIDATION MIX ===');
                                                    console.log('mixFoods:', mixFoods);
                                                    console.log('mixFoods.length:', mixFoods.length);
                                                    console.log('mixNewFood:', mixNewFood);
                                                    console.log('mixNewFoodCategory:', mixNewFoodCategory);
                                                    console.log('quantity:', diversificationData.quantity);

                                                    if (mixFoods.length === 0) {
                                                        alert('‚ö†Ô∏è Vous devez ajouter au moins 1 aliment d√©j√† tol√©r√©\n\n‚û°Ô∏è Tapez le nom (ex: Pomme) puis appuyez sur ENTR√âE');
                                                        return;
                                                    }
                                                    if (!mixNewFood || mixNewFood.trim() === '') {
                                                        alert('‚ö†Ô∏è Vous devez indiquer le NOUVEL aliment √† introduire');
                                                        return;
                                                    }
                                                    if (!mixNewFoodCategory || mixNewFoodCategory === '') {
                                                        alert('‚ö†Ô∏è Vous devez choisir la cat√©gorie du NOUVEL aliment (L√©gumes, Fruits, etc.)');
                                                        return;
                                                    }
                                                    if (!diversificationData.quantity || diversificationData.quantity === '') {
                                                        alert('‚ö†Ô∏è Vous devez indiquer la quantit√© mang√©e (Petite, Moyenne, Grande, Compl√®te)');
                                                        return;
                                                    }

                                                    console.log('‚úÖ Validation OK, sauvegarde...');
                                                } else {
                                                    if (!diversificationData.category || !diversificationData.food || !diversificationData.quantity) {
                                                        alert('Veuillez remplir tous les champs obligatoires');
                                                        return;
                                                    }
                                                }
                                                saveDiversificationEntry();
                                                setShowFoodModal(false);
                                            }}
                                            className={`w-full ${isMixMode ? 'bg-gradient-to-r from-purple-500 via-purple-600 to-pink-500' : 'bg-gradient-to-r from-orange-500 via-orange-600 to-yellow-500'} text-white py-5 rounded-2xl font-bold text-lg shadow-xl active:scale-95 transition-transform flex items-center justify-center gap-3`}
                                        >
                                            <span className="text-2xl">üéâ</span>
                                            {isMixMode ? 'Valider le Mix !' : 'Valider la d√©couverte !'}
                                            <span className="text-2xl">üéâ</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* Modal Garde-robe - Version Gamifi√©e */}
                        {showWardrobeModal && (
                            <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-end sm:items-center justify-center p-0 sm:p-4 z-50">
                                <div className="bg-gradient-to-br from-pink-50 to-purple-50 w-full sm:max-w-md sm:rounded-3xl rounded-t-3xl max-h-[90vh] overflow-y-auto relative">
                                    {/* Header avec animation */}
                                    <div className="sticky top-0 bg-gradient-to-r from-pink-400 via-pink-500 to-purple-500 text-white p-6 rounded-t-3xl z-10 relative overflow-hidden">
                                        {/* √âl√©ments d√©coratifs anim√©s */}
                                        <div className="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-16 translate-x-16"></div>
                                        <div className="absolute bottom-0 left-0 w-24 h-24 bg-white/10 rounded-full translate-y-12 -translate-x-12"></div>

                                        <div className="flex items-center justify-between relative z-10">
                                            <div className="flex items-center gap-3">
                                                <div className="w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center backdrop-blur-sm animate-bounce">
                                                    <span className="text-3xl">üëï</span>
                                                </div>
                                                <div>
                                                    <h3 className="text-xl font-bold">{editingWardrobeId ? 'Modifier l\'article' : 'Nouvel article'}</h3>
                                                    <p className="text-sm opacity-90">Garde-robe de {user?.babyName}</p>
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => {
                                                    setShowWardrobeModal(false);
                                                    setEditingWardrobeId(null);
                                                    setWardrobeData({ type: '', size: '', quantity: 1, color: '', notes: '' });
                                                }}
                                                className="w-10 h-10 rounded-2xl bg-white/20 backdrop-blur-sm flex items-center justify-center hover:bg-white/30 transition-all"
                                            >
                                                <i className="fas fa-times text-lg"></i>
                                            </button>
                                        </div>
                                    </div>

                                    {/* Contenu */}
                                    <div className="p-6 space-y-5">
                                        {/* Type de v√™tement - Style grille avec ic√¥nes */}
                                        <div>
                                            <label className="block text-sm font-bold text-gray-700 mb-3 flex items-center gap-2">
                                                <span className="text-lg">üëî</span>
                                                Type de v√™tement
                                            </label>
                                            <div className="grid grid-cols-3 gap-3">
                                                {[
                                                    { id: 'Body manche courte', emoji: 'üëï', label: 'Body MC' },
                                                    { id: 'Body manche longue', emoji: 'üß•', label: 'Body ML' },
                                                    { id: 'Pyjama', emoji: 'üåô', label: 'Pyjama' },
                                                    { id: 'Pantalon', emoji: 'üëñ', label: 'Pantalon' },
                                                    { id: 'Pull', emoji: 'üß∂', label: 'Pull' },
                                                    { id: 'Gilet', emoji: 'ü¶∫', label: 'Gilet' },
                                                    { id: 'Robe', emoji: 'üëó', label: 'Robe' },
                                                    { id: 'Gigoteuse', emoji: 'üí§', label: 'Gigoteuse' },
                                                    { id: 'Chaussettes', emoji: 'üß¶', label: 'Chaussettes' },
                                                    { id: 'Bonnet', emoji: 'üß¢', label: 'Bonnet' },
                                                    { id: 'T-shirt manche courte', emoji: 'üëö', label: 'T-shirt MC' },
                                                    { id: 'T-shirt manche longue', emoji: 'üéΩ', label: 'T-shirt ML' }
                                                ].map(type => (
                                                    <button
                                                        key={type.id}
                                                        type="button"
                                                        onClick={() => setWardrobeData(prev => ({ ...prev, type: type.id }))}
                                                        className={`p-3 rounded-2xl border-3 transition-all transform hover:scale-105 ${wardrobeData.type === type.id
                                                            ? 'border-pink-400 bg-pink-100 shadow-lg scale-105'
                                                            : 'border-gray-200 bg-white shadow-sm'
                                                            }`}
                                                    >
                                                        {wardrobeData.type === type.id && (
                                                            <div className="absolute -top-2 -right-2 w-6 h-6 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center shadow-lg">
                                                                <i className="fas fa-check text-white text-xs"></i>
                                                            </div>
                                                        )}
                                                        <div className="text-2xl mb-1">{type.emoji}</div>
                                                        <div className="font-medium text-gray-800 text-xs leading-tight">{type.label}</div>
                                                    </button>
                                                ))}
                                            </div>
                                        </div>

                                        {/* Taille - Style boutons ludiques */}
                                        <div>
                                            <label className="block text-sm font-bold text-gray-700 mb-3 flex items-center gap-2">
                                                <span className="text-lg">üìè</span>
                                                Taille
                                            </label>
                                            <div className="grid grid-cols-3 gap-2">
                                                {[
                                                    { id: 'Naissance', icon: 'üë∂', gradient: 'from-blue-200 to-blue-300' },
                                                    { id: '1 mois', icon: 'üçº', gradient: 'from-cyan-200 to-cyan-300' },
                                                    { id: '3 mois', icon: 'üå∏', gradient: 'from-teal-200 to-teal-300' },
                                                    { id: '6 mois', icon: 'üéà', gradient: 'from-green-200 to-green-300' },
                                                    { id: '9 mois', icon: 'üåü', gradient: 'from-yellow-200 to-yellow-300' },
                                                    { id: '12 mois', icon: 'üéÇ', gradient: 'from-orange-200 to-orange-300' },
                                                    { id: '18 mois', icon: 'üöÄ', gradient: 'from-red-200 to-red-300' },
                                                    { id: '2 ans', icon: 'üé™', gradient: 'from-pink-200 to-pink-300' },
                                                    { id: '3 ans', icon: 'üé®', gradient: 'from-purple-200 to-purple-300' }
                                                ].map(size => (
                                                    <button
                                                        key={size.id}
                                                        type="button"
                                                        onClick={() => setWardrobeData(prev => ({ ...prev, size: size.id }))}
                                                        className={`p-3 rounded-xl transition-all transform hover:scale-105 ${wardrobeData.size === size.id
                                                            ? `bg-gradient-to-br ${size.gradient} shadow-lg scale-105 border-2 border-white`
                                                            : 'bg-white border-2 border-gray-200'
                                                            }`}
                                                    >
                                                        <div className="text-xl mb-1">{size.icon}</div>
                                                        <div className="font-bold text-gray-800 text-xs">{size.id}</div>
                                                    </button>
                                                ))}
                                            </div>
                                        </div>

                                        {/* Couleur - Palette de couleurs */}
                                        <div>
                                            <label className="block text-sm font-bold text-gray-700 mb-3 flex items-center gap-2">
                                                <span className="text-lg">üé®</span>
                                                Couleur (optionnel)
                                            </label>
                                            <div className="grid grid-cols-6 gap-2">
                                                {[
                                                    { id: 'Blanc', color: 'bg-white border-2 border-gray-300', dot: 'bg-white' },
                                                    { id: 'Rose', color: 'bg-pink-300', dot: 'bg-pink-300' },
                                                    { id: 'Bleu', color: 'bg-blue-300', dot: 'bg-blue-300' },
                                                    { id: 'Jaune', color: 'bg-yellow-300', dot: 'bg-yellow-300' },
                                                    { id: 'Vert', color: 'bg-green-300', dot: 'bg-green-300' },
                                                    { id: 'Rouge', color: 'bg-red-300', dot: 'bg-red-300' },
                                                    { id: 'Violet', color: 'bg-purple-300', dot: 'bg-purple-300' },
                                                    { id: 'Gris', color: 'bg-gray-400', dot: 'bg-gray-400' },
                                                    { id: 'Noir', color: 'bg-gray-800', dot: 'bg-gray-800' },
                                                    { id: 'Orange', color: 'bg-orange-300', dot: 'bg-orange-300' },
                                                    { id: 'Beige', color: 'bg-amber-200', dot: 'bg-amber-200' },
                                                    { id: 'Marron', color: 'bg-amber-700', dot: 'bg-amber-700' }
                                                ].map(color => (
                                                    <button
                                                        key={color.id}
                                                        type="button"
                                                        onClick={() => setWardrobeData(prev => ({ ...prev, color: color.id }))}
                                                        className={`w-12 h-12 rounded-full ${color.color} transition-all transform hover:scale-110 shadow-md relative ${wardrobeData.color === color.id ? 'ring-4 ring-pink-400 scale-110' : ''
                                                            }`}
                                                        title={color.id}
                                                    >
                                                        {wardrobeData.color === color.id && (
                                                            <div className="absolute inset-0 flex items-center justify-center">
                                                                <i className="fas fa-check text-gray-700 text-lg drop-shadow"></i>
                                                            </div>
                                                        )}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>

                                        {/* Quantit√© - Compteur visuel */}
                                        <div>
                                            <label className="block text-sm font-bold text-gray-700 mb-3 flex items-center gap-2">
                                                <span className="text-lg">üî¢</span>
                                                Quantit√©
                                            </label>
                                            <div className="flex items-center justify-center gap-4 bg-white rounded-2xl p-4 shadow-sm border-2 border-gray-200">
                                                <button
                                                    type="button"
                                                    onClick={() => setWardrobeData(prev => ({ ...prev, quantity: Math.max(1, prev.quantity - 1) }))}
                                                    className="w-12 h-12 rounded-full bg-gradient-to-br from-pink-400 to-pink-600 text-white font-bold text-xl shadow-lg active:scale-95 transition-transform"
                                                >
                                                    -
                                                </button>
                                                <div className="flex flex-col items-center">
                                                    <div className="text-4xl font-bold text-gray-800">{wardrobeData.quantity}</div>
                                                    <div className="text-xs text-gray-500">article{wardrobeData.quantity > 1 ? 's' : ''}</div>
                                                </div>
                                                <button
                                                    type="button"
                                                    onClick={() => setWardrobeData(prev => ({ ...prev, quantity: prev.quantity + 1 }))}
                                                    className="w-12 h-12 rounded-full bg-gradient-to-br from-pink-400 to-pink-600 text-white font-bold text-xl shadow-lg active:scale-95 transition-transform"
                                                >
                                                    +
                                                </button>
                                            </div>
                                        </div>

                                        {/* Notes */}
                                        <div>
                                            <label className="block text-sm font-bold text-gray-700 mb-2 flex items-center gap-2">
                                                <span className="text-lg">üìù</span>
                                                Notes (optionnel)
                                            </label>
                                            <textarea
                                                className="w-full px-4 py-3 rounded-2xl border-3 border-gray-200 focus:border-pink-400 focus:outline-none shadow-sm"
                                                rows="3"
                                                placeholder="Marque, √©tat, commentaires..."
                                                value={wardrobeData.notes}
                                                onChange={(e) => setWardrobeData(prev => ({ ...prev, notes: e.target.value }))}
                                            />
                                        </div>

                                        {/* Bouton de validation */}
                                        <button
                                            onClick={() => {
                                                if (!wardrobeData.type || !wardrobeData.size) {
                                                    alert('Veuillez s√©lectionner un type et une taille');
                                                    return;
                                                }
                                                saveWardrobeItem();
                                                setShowWardrobeModal(false);
                                            }}
                                            className="w-full bg-gradient-to-r from-pink-500 via-pink-600 to-purple-500 text-white py-5 rounded-2xl font-bold text-lg shadow-xl active:scale-95 transition-transform flex items-center justify-center gap-3"
                                        >
                                            <span className="text-2xl">‚ú®</span>
                                            {editingWardrobeId ? 'Mettre √† jour' : 'Ajouter √† la garde-robe'}
                                            <span className="text-2xl">‚ú®</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* Modal Lait en poudre */}
                        {showMilkStockModal && (
                            <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-end sm:items-center justify-center p-0 sm:p-4 z-50">
                                <div className="bg-white w-full sm:max-w-md sm:rounded-3xl rounded-t-3xl max-h-[90vh] overflow-y-auto relative">
                                    {/* Header */}
                                    <div className="sticky top-0 bg-gradient-to-r from-yellow-500 to-yellow-600 text-white p-6 rounded-t-3xl z-10">
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center gap-3">
                                                <div className="w-12 h-12 bg-white/20 rounded-2xl flex items-center justify-center">
                                                    <i className="fas fa-baby text-xl"></i>
                                                </div>
                                                <div>
                                                    <h3 className="text-xl font-bold">Lait en poudre</h3>
                                                    <p className="text-sm opacity-80">Date d'ouverture</p>
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => setShowMilkStockModal(false)}
                                                className="w-10 h-10 rounded-2xl bg-white/20 flex items-center justify-center"
                                            >
                                                <i className="fas fa-times text-lg"></i>
                                            </button>
                                        </div>
                                    </div>

                                    {/* Contenu */}
                                    <div className="p-6 space-y-6">
                                        <div className="text-center mb-6">
                                            <div className="w-16 h-16 bg-yellow-100 rounded-2xl flex items-center justify-center mx-auto mb-3">
                                                <i className="fas fa-baby text-yellow-600 text-2xl"></i>
                                            </div>
                                            <h3 className="text-lg font-bold text-gray-900 mb-2">Date d'ouverture</h3>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                Date d'ouverture *
                                            </label>
                                            <input
                                                type="date"
                                                className="w-full px-4 py-3 rounded-2xl border-2 border-gray-200 focus:border-yellow-500 focus:outline-none text-lg font-bold text-center"
                                                value={milkDateInput}
                                                onChange={(e) => setMilkDateInput(e.target.value)}
                                            />
                                        </div>



                                        <button
                                            onClick={saveMilkPowderDate}
                                            className="w-full bg-gradient-to-r from-yellow-500 to-yellow-600 text-white py-4 rounded-2xl font-bold active:scale-95 transition-transform"
                                        >
                                            Enregistrer la date
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* Modal Bouteille d'eau */}
                        {showWaterStockModal && (
                            <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-end sm:items-center justify-center p-0 sm:p-4 z-50">
                                <div className="bg-white w-full sm:max-w-md sm:rounded-3xl rounded-t-3xl max-h-[90vh] overflow-y-auto relative">
                                    {/* Header */}
                                    <div className="sticky top-0 bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-t-3xl z-10">
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center gap-3">
                                                <div className="w-12 h-12 bg-white/20 rounded-2xl flex items-center justify-center">
                                                    <i className="fas fa-tint text-xl"></i>
                                                </div>
                                                <div>
                                                    <h3 className="text-xl font-bold">Bouteille d'eau</h3>
                                                    <p className="text-sm opacity-80">Date et heure d'ouverture</p>
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => setShowWaterStockModal(false)}
                                                className="w-10 h-10 rounded-2xl bg-white/20 flex items-center justify-center"
                                            >
                                                <i className="fas fa-times text-lg"></i>
                                            </button>
                                        </div>
                                    </div>

                                    {/* Contenu */}
                                    <div className="p-6 space-y-6">
                                        <div className="text-center mb-6">
                                            <div className="w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center mx-auto mb-3">
                                                <i className="fas fa-tint text-blue-600 text-2xl"></i>
                                            </div>
                                            <h3 className="text-lg font-bold text-gray-900 mb-2">Ouverture de la bouteille</h3>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                Date et heure d'ouverture *
                                            </label>
                                            <input
                                                type="datetime-local"
                                                className="w-full px-4 py-3 rounded-2xl border-2 border-gray-200 focus:border-blue-500 focus:outline-none text-lg font-bold text-center"
                                                value={waterDateTimeInput}
                                                onChange={(e) => setWaterDateTimeInput(e.target.value)}
                                            />
                                        </div>


                                        <button
                                            onClick={saveWaterBottleDateTime}
                                            className="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-4 rounded-2xl font-bold active:scale-95 transition-transform"
                                        >
                                            Enregistrer la date
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                        {currentView === 'supplies' && (
                            <div className="space-y-4">


                                <div className="space-y-3">
                                    {/* Lait en poudre */}
                                    <div className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30">
                                        <div className="flex items-center justify-between mb-3">
                                            <div className="flex items-center gap-3">
                                                <div className="w-12 h-12 bg-yellow-100 rounded-2xl flex items-center justify-center">
                                                    <i className="fas fa-baby text-yellow-600 text-xl"></i>
                                                </div>
                                                <div>
                                                    <h3 className="font-bold text-gray-900">Lait en poudre</h3>
                                                    <p className="text-sm text-gray-600">Suivi de la date d'ouverture</p>
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => {
                                                    setMilkDateInput(stocks['milk-powder']?.date || '');
                                                    setShowMilkStockModal(true);
                                                }}
                                                className="bg-blue-500 text-white px-4 py-2 rounded-xl text-sm font-medium shadow-lg active:scale-95 transition-transform"
                                            >
                                                D√©finir date
                                            </button>
                                        </div>

                                        <div className="bg-gray-50 rounded-xl p-3">
                                            <div className="flex items-center gap-2 mb-2">
                                                <i className="fas fa-calendar-alt text-gray-500"></i>
                                                <span className="text-sm font-medium text-gray-700">Date d'ouverture</span>
                                            </div>
                                            <p className="text-lg font-bold text-gray-900 mb-2">
                                                {formatStockDate(stocks['milk-powder']?.date)}
                                            </p>

                                        </div>
                                    </div>

                                    {/* Bouteille d'eau */}
                                    <div className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30">
                                        <div className="flex items-center justify-between mb-3">
                                            <div className="flex items-center gap-3">
                                                <div className="w-12 h-12 bg-blue-100 rounded-2xl flex items-center justify-center">
                                                    <i className="fas fa-tint text-blue-600 text-xl"></i>
                                                </div>
                                                <div>
                                                    <h3 className="font-bold text-gray-900">Bouteille d'eau</h3>
                                                    <p className="text-sm text-gray-600">Suivi de l'ouverture</p>
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => {
                                                    setWaterDateTimeInput(stocks['water-bottle']?.datetime || '');
                                                    setShowWaterStockModal(true);
                                                }}
                                                className="bg-blue-500 text-white px-4 py-2 rounded-xl text-sm font-medium shadow-lg active:scale-95 transition-transform"
                                            >
                                                D√©finir date
                                            </button>
                                        </div>

                                        <div className="bg-gray-50 rounded-xl p-3">
                                            <div className="flex items-center gap-2 mb-2">
                                                <i className="fas fa-clock text-gray-500"></i>
                                                <span className="text-sm font-medium text-gray-700">Ouverture</span>
                                            </div>
                                            <p className="text-lg font-bold text-gray-900 mb-2">
                                                {formatStockDateTime(stocks['water-bottle']?.datetime)}
                                            </p>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* Vue Diversification avec pagination Firebase */}
                        {currentView === 'food' && (
                            <div className="space-y-4">
                                {/* Boutons ajouter EN HAUT */}
                                <div className="grid grid-cols-2 gap-3">
                                    <button
                                        onClick={() => {
                                            setIsMixMode(false);
                                            setShowFoodModal(true);
                                        }}
                                        className="bg-gradient-to-r from-orange-500 to-yellow-500 text-white px-4 py-4 rounded-2xl text-sm font-bold shadow-xl active:scale-95 transition-transform flex flex-col items-center justify-center gap-2"
                                    >
                                        <span className="text-2xl">üçé</span>
                                        <span>Aliment seul</span>
                                    </button>
                                    <button
                                        onClick={() => {
                                            setIsMixMode(true);
                                            setMixFoods([]);
                                            setMixNewFood('');
                                            setMixNewFoodCategory('');
                                            setShowFoodModal(true);
                                        }}
                                        className="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-4 py-4 rounded-2xl text-sm font-bold shadow-xl active:scale-95 transition-transform flex flex-col items-center justify-center gap-2"
                                    >
                                        <span className="text-2xl">ü•£</span>
                                        <span>Mix d'aliments</span>
                                    </button>
                                </div>
                                {/* Barre de recherche et filtres */}
                                <div className="space-y-3">
                                    {/* Recherche */}
                                    <div className="relative">
                                        <input
                                            type="text"
                                            placeholder="üîç Rechercher un aliment..."
                                            value={diversificationSearch}
                                            onChange={(e) => {
                                                setDiversificationSearch(e.target.value);
                                                if (e.target.value.trim()) {
                                                    searchDiversification(e.target.value);
                                                } else {
                                                    loadDiversificationPage(0, true);
                                                }
                                            }}
                                            className="w-full px-4 py-3 pl-12 rounded-2xl border-2 border-orange-200 focus:border-orange-400 focus:outline-none bg-white shadow-sm"
                                        />
                                        <i className="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-orange-400"></i>
                                        {diversificationSearch && (
                                            <button
                                                onClick={() => {
                                                    setDiversificationSearch('');
                                                    loadDiversificationPage(0, true);
                                                }}
                                                className="absolute right-3 top-1/2 -translate-y-1/2 w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300"
                                            >
                                                <i className="fas fa-times text-xs text-gray-600"></i>
                                            </button>
                                        )}
                                    </div>

                                    {/* Boutons de tri */}
                                    <div className="flex gap-2">
                                        <button
                                            onClick={() => {
                                                setDiversificationSort('recent');
                                                setDiversificationPage(0);
                                                setDiversificationLastDoc(null);
                                            }}
                                            className={`flex-1 py-2.5 rounded-xl font-bold text-sm transition-all ${diversificationSort === 'recent'
                                                ? 'bg-gradient-to-r from-orange-500 to-yellow-500 text-white shadow-lg'
                                                : 'bg-white border-2 border-gray-200 text-gray-600'
                                                }`}
                                        >
                                            <i className="far fa-clock mr-2"></i>
                                            Plus r√©cents
                                        </button>
                                        <button
                                            onClick={() => {
                                                setDiversificationSort('alpha');
                                                setDiversificationPage(0);
                                                setDiversificationLastDoc(null);
                                            }}
                                            className={`flex-1 py-2.5 rounded-xl font-bold text-sm transition-all ${diversificationSort === 'alpha'
                                                ? 'bg-gradient-to-r from-orange-500 to-yellow-500 text-white shadow-lg'
                                                : 'bg-white border-2 border-gray-200 text-gray-600'
                                                }`}
                                        >
                                            <i className="fas fa-sort-alpha-down mr-2"></i>
                                            A ‚Üí Z
                                        </button>
                                    </div>
                                </div>

                                {/* Statistiques */}
                                {diversificationEntries.length > 0 && !diversificationSearch && (
                                    <div className="grid grid-cols-4 gap-2">
                                        {[
                                            { category: 'legumes', icon: 'ü•ï', label: 'L√©gumes', color: 'from-green-400 to-emerald-500' },
                                            { category: 'fruits', icon: 'üçé', label: 'Fruits', color: 'from-red-400 to-pink-500' },
                                            { category: 'viande', icon: 'üçó', label: 'Prot√©ines', color: 'from-purple-400 to-indigo-500' },
                                            { category: 'cereales', icon: 'üåæ', label: 'C√©r√©ales', color: 'from-yellow-400 to-amber-500' }
                                        ].map(cat => {
                                            const count = diversificationEntries.filter(e => e.category === cat.category).length;
                                            return (
                                                <div key={cat.category} className={`bg-gradient-to-br ${cat.color} rounded-2xl p-3 shadow-lg text-white text-center`}>
                                                    <div className="text-2xl mb-1">{cat.icon}</div>
                                                    <div className="text-2xl font-bold">{count}</div>
                                                    <div className="text-xs opacity-90">{cat.label}</div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}

                                {/* Liste des aliments */}
                                {diversificationEntries.map((entry, index) => {
                                    const categoryConfig = {
                                        legumes: { icon: 'ü•ï', gradient: 'from-green-400 to-emerald-500', bgLight: 'bg-green-50', border: 'border-green-300' },
                                        fruits: { icon: 'üçé', gradient: 'from-red-400 to-pink-500', bgLight: 'bg-red-50', border: 'border-red-300' },
                                        viande: { icon: 'üçó', gradient: 'from-purple-400 to-indigo-500', bgLight: 'bg-purple-50', border: 'border-purple-300' },
                                        cereales: { icon: 'üåæ', gradient: 'from-yellow-400 to-amber-500', bgLight: 'bg-yellow-50', border: 'border-yellow-300' }
                                    }[entry.category] || { icon: 'üçΩÔ∏è', gradient: 'from-gray-400 to-gray-500', bgLight: 'bg-gray-50', border: 'border-gray-300' };

                                    const reactionEmoji = {
                                        adore: 'üòç',
                                        aime: 'üòä',
                                        neutre: 'üòê',
                                        bof: 'üòï',
                                        refuse: 'üòñ'
                                    }[entry.reaction] || 'üòä';

                                    const daysSince = Math.floor((new Date() - new Date(entry.timestamp)) / (1000 * 60 * 60 * 24));

                                    return (
                                        <div
                                            key={entry.id}
                                            className={`${entry.isMix ? 'bg-gradient-to-br from-purple-50 to-pink-50 border-purple-300' : categoryConfig.bgLight + ' ' + categoryConfig.border} rounded-3xl p-4 shadow-xl border-2 relative overflow-hidden`}
                                        >
                                            <div className="flex items-start justify-between relative">
                                                <div className="flex items-start gap-4 flex-1 pr-2">
                                                    {/* Ic√¥ne principale */}
                                                    <div className={`w-16 h-16 ${entry.isMix ? 'bg-gradient-to-br from-purple-400 to-pink-500' : 'bg-gradient-to-br ' + categoryConfig.gradient} rounded-2xl flex items-center justify-center shadow-lg flex-shrink-0`}>
                                                        <span className="text-3xl">{entry.isMix ? 'ü•£' : categoryConfig.icon}</span>
                                                    </div>

                                                    <div className="flex-1 min-w-0">
                                                        {/* Badge Mix */}
                                                        {entry.isMix && (
                                                            <div className="mb-2">
                                                                <span className="px-3 py-1 rounded-full text-xs font-bold bg-purple-200 text-purple-800 border-2 border-purple-400">
                                                                    ü•£ Mix d'aliments
                                                                </span>
                                                            </div>
                                                        )}

                                                        {/* Nom de l'aliment */}
                                                        <h5 className="font-bold text-gray-900 text-xl mb-2">
                                                            {entry.isMix ? entry.newFood : entry.food}
                                                        </h5>

                                                        {/* Aliments du mix */}
                                                        {entry.isMix && entry.mixFoods && entry.mixFoods.length > 0 && (
                                                            <div className="mb-3 bg-white/60 rounded-xl p-2 border border-purple-200">
                                                                <p className="text-xs text-gray-600 mb-1 font-semibold">M√©lang√© avec :</p>
                                                                <div className="flex flex-wrap gap-1">
                                                                    {entry.mixFoods.map((food, i) => (
                                                                        <span key={i} className="px-2 py-0.5 bg-green-100 text-green-700 rounded-full text-xs font-medium border border-green-300">
                                                                            {food}
                                                                        </span>
                                                                    ))}
                                                                </div>
                                                                <p className="text-xs text-purple-700 mt-2 font-bold">‚Üí Nouvel aliment test√© : {entry.newFood}</p>
                                                            </div>
                                                        )}

                                                        {/* Badges informations */}
                                                        <div className="flex flex-wrap gap-2 mb-3">
                                                            {/* Cat√©gorie */}
                                                            <span className={`px-3 py-1 rounded-full text-xs font-bold ${categoryConfig.bgLight} ${categoryConfig.border} border`}>
                                                                {entry.category === 'legumes' ? 'L√©gume' :
                                                                    entry.category === 'fruits' ? 'Fruit' :
                                                                        entry.category === 'viande' ? 'Prot√©ine' : 'C√©r√©ale'}
                                                            </span>

                                                            {/* Quantit√© */}
                                                            <span className="px-3 py-1 rounded-full text-xs font-bold bg-orange-100 text-orange-700 border-2 border-orange-300">
                                                                {entry.quantity === 'petite' && 'ü•Ñ Petite'}
                                                                {entry.quantity === 'moyenne' && 'üç¥ Moyenne'}
                                                                {entry.quantity === 'grande' && 'üçΩÔ∏è Grande'}
                                                                {entry.quantity === 'complete' && '‚≠ê Compl√®te'}
                                                            </span>

                                                            {/* R√©action */}
                                                            {entry.reaction && (
                                                                <span className="px-3 py-1.5 rounded-full font-bold bg-gradient-to-r from-yellow-100 to-amber-100 border-2 border-yellow-300 flex items-center gap-2 shadow-sm">
                                                                    <span className="text-xl">{reactionEmoji}</span>
                                                                    <span className="text-xs text-gray-700">
                                                                        {entry.reaction === 'adore' && 'Ador√©'}
                                                                        {entry.reaction === 'aime' && 'Aim√©'}
                                                                        {entry.reaction === 'neutre' && 'Neutre'}
                                                                        {entry.reaction === 'bof' && 'Bof'}
                                                                        {entry.reaction === 'refuse' && 'Refus√©'}
                                                                    </span>
                                                                </span>
                                                            )}
                                                        </div>

                                                        {/* Notes */}
                                                        {entry.notes && (
                                                            <div className="bg-white/80 backdrop-blur-sm rounded-xl p-3 shadow-sm border border-gray-200 mb-2">
                                                                <p className="text-sm text-gray-700">üí≠ {entry.notes}</p>
                                                            </div>
                                                        )}

                                                        {/* Date */}
                                                        <div className="text-xs text-gray-500 flex items-center gap-2 flex-wrap">
                                                            <i className="far fa-calendar"></i>
                                                            {formatDate(entry.timestamp)}
                                                            <span className="px-2 py-0.5 bg-gray-200 rounded-full font-medium">
                                                                {daysSince === 0 ? 'Aujourd\'hui' :
                                                                    daysSince === 1 ? 'Hier' :
                                                                        daysSince < 7 ? `Il y a ${daysSince} jours` :
                                                                            daysSince < 30 ? `Il y a ${Math.floor(daysSince / 7)} semaine${Math.floor(daysSince / 7) > 1 ? 's' : ''}` :
                                                                                `Il y a ${Math.floor(daysSince / 30)} mois`}
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* Bouton supprimer */}
                                                <button
                                                    onClick={() => deleteDiversificationEntry(entry.id)}
                                                    className="w-10 h-10 rounded-xl bg-red-100 flex items-center justify-center active:scale-95 transition-all hover:bg-red-200 flex-shrink-0 ml-2"
                                                >
                                                    <i className="fas fa-trash text-red-600"></i>
                                                </button>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>

                        )}
                        {/* Vue Garde-robe avec pagination */}
                        {currentView === 'wardrobe' && (
                            <div className="space-y-4">
                                {/* Bouton ajouter EN HAUT */}
                                <button
                                    onClick={() => setShowWardrobeModal(true)}
                                    className="w-full bg-gradient-to-r from-pink-500 to-purple-500 text-white px-6 py-4 rounded-2xl text-base font-bold shadow-xl active:scale-95 transition-transform flex items-center justify-center gap-3"
                                >
                                    <span className="text-2xl">üëï</span>
                                    Ajouter un v√™tement
                                </button>

                                {/* Chargement initial */}
                                {wardrobeLoading && wardrobe.length === 0 ? (
                                    <div className="bg-white rounded-2xl p-8 text-center">
                                        <div className="animate-spin w-12 h-12 border-4 border-pink-500 border-t-transparent rounded-full mx-auto mb-4"></div>
                                        <p className="text-gray-600">Chargement de la garde-robe...</p>
                                    </div>
                                ) : wardrobe.length === 0 ? (
                                    <div className="bg-gradient-to-br from-pink-50 to-purple-50 rounded-3xl p-8 shadow-xl border-2 border-pink-200 text-center">
                                        <div className="w-20 h-20 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                                            <span className="text-4xl">üëï</span>
                                        </div>
                                        <p className="text-gray-700 font-bold text-lg mb-2">Aucun v√™tement enregistr√©</p>
                                        <p className="text-gray-500 text-sm">Cr√©ez votre dressing ! üåü</p>
                                    </div>
                                ) : (
                                    <>
                                        {/* Statistiques globales */}
                                        <div className="bg-gradient-to-br from-pink-100 to-purple-100 rounded-3xl p-4 shadow-lg border-2 border-pink-200">
                                            <div className="grid grid-cols-3 gap-3">
                                                <div className="text-center">
                                                    <div className="text-3xl font-bold text-pink-600">{wardrobe.reduce((sum, item) => sum + (parseInt(item.quantity) || 1), 0)}</div>
                                                    <div className="text-xs text-gray-600">articles</div>
                                                </div>
                                                <div className="text-center">
                                                    <div className="text-3xl font-bold text-purple-600">{new Set(wardrobe.map(i => i.size)).size}</div>
                                                    <div className="text-xs text-gray-600">tailles</div>
                                                </div>
                                                <div className="text-center">
                                                    <div className="text-3xl font-bold text-indigo-600">
                                                        {new Set(wardrobe.map(i => i.type)).size}
                                                    </div>
                                                    <div className="text-xs text-gray-600">types</div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Liste par taille */}
                                        {(() => {
                                            const groupedBySize = {};
                                            wardrobe.forEach(item => {
                                                if (!groupedBySize[item.size]) {
                                                    groupedBySize[item.size] = [];
                                                }
                                                groupedBySize[item.size].push(item);
                                            });

                                            const sizes = Object.keys(groupedBySize).sort((a, b) => {
                                                const sizeOrder = ['Naissance', '1 mois', '3 mois', '6 mois', '9 mois', '12 mois', '18 mois', '2 ans', '3 ans'];
                                                return sizeOrder.indexOf(a) - sizeOrder.indexOf(b);
                                            });

                                            const sizeConfig = {
                                                'Naissance': { emoji: 'üë∂', gradient: 'from-blue-400 to-blue-500', bgLight: 'bg-blue-50' },
                                                '1 mois': { emoji: 'üçº', gradient: 'from-cyan-400 to-cyan-500', bgLight: 'bg-cyan-50' },
                                                '3 mois': { emoji: 'üå∏', gradient: 'from-teal-400 to-teal-500', bgLight: 'bg-teal-50' },
                                                '6 mois': { emoji: 'üéà', gradient: 'from-green-400 to-green-500', bgLight: 'bg-green-50' },
                                                '9 mois': { emoji: 'üåü', gradient: 'from-yellow-400 to-yellow-500', bgLight: 'bg-yellow-50' },
                                                '12 mois': { emoji: 'üéÇ', gradient: 'from-orange-400 to-orange-500', bgLight: 'bg-orange-50' },
                                                '18 mois': { emoji: 'üöÄ', gradient: 'from-red-400 to-red-500', bgLight: 'bg-red-50' },
                                                '2 ans': { emoji: 'üé™', gradient: 'from-pink-400 to-pink-500', bgLight: 'bg-pink-50' },
                                                '3 ans': { emoji: 'üé®', gradient: 'from-purple-400 to-purple-500', bgLight: 'bg-purple-50' }
                                            };

                                            const typeEmoji = {
                                                'Body manche courte': 'üëï',
                                                'Body manche longue': 'üß•',
                                                'Pyjama': 'üåô',
                                                'Pantalon': 'üëñ',
                                                'Pull': 'üß∂',
                                                'Gilet': 'ü¶∫',
                                                'Robe': 'üëó',
                                                'Gigoteuse': 'üí§',
                                                'Chaussettes': 'üß¶',
                                                'Bonnet': 'üß¢',
                                                'T-shirt manche courte': 'üëö',
                                                'T-shirt manche longue': 'üéΩ',
                                                'Autre': 'üëî'
                                            };

                                            return sizes.map((size, sizeIndex) => {
                                                const config = sizeConfig[size] || { emoji: 'üëî', gradient: 'from-gray-400 to-gray-500', bgLight: 'bg-gray-50' };

                                                return (
                                                    <div
                                                        key={size}
                                                        className={`${config.bgLight} rounded-3xl p-4 shadow-xl border-2 border-white relative overflow-hidden`}
                                                    >

                                                        <div className="flex items-center justify-between mb-4">
                                                            <div className="flex items-center gap-3">
                                                                <div className={`w-12 h-12 bg-gradient-to-br ${config.gradient} rounded-2xl flex items-center justify-center shadow-lg`}>
                                                                    <span className="text-2xl">{config.emoji}</span>
                                                                </div>
                                                                <div>
                                                                    <h3 className="font-bold text-gray-900 text-lg">Taille {size}</h3>
                                                                    <p className="text-xs text-gray-500">
                                                                        {groupedBySize[size].reduce((sum, item) => sum + (parseInt(item.quantity) || 1), 0)} article{groupedBySize[size].length > 1 ? 's' : ''}
                                                                    </p>
                                                                </div>
                                                            </div>
                                                            <div className={`px-3 py-1 rounded-full bg-gradient-to-r ${config.gradient} text-white font-bold text-sm shadow-lg`}>
                                                                {groupedBySize[size].length}
                                                            </div>
                                                        </div>

                                                        <div className="space-y-3">
                                                            {groupedBySize[size].map((item) => (
                                                                <div
                                                                    key={item.id}
                                                                    className="bg-white/80 backdrop-blur-sm rounded-2xl p-4 shadow-md border border-white/50 relative overflow-hidden hover:shadow-lg transition-all"
                                                                >
                                                                    <div className="flex items-start gap-4">
                                                                        <div className={`w-14 h-14 bg-gradient-to-br ${config.gradient} rounded-2xl flex items-center justify-center shadow-lg flex-shrink-0`}>
                                                                            <span className="text-2xl">{typeEmoji[item.type] || 'üëî'}</span>
                                                                        </div>

                                                                        <div className="flex-1 min-w-0">
                                                                            <h5 className="font-bold text-gray-900 mb-2">{item.type}</h5>

                                                                            <div className="flex flex-wrap gap-2 mb-2">
                                                                                <span className={`px-2 py-1 rounded-lg text-xs font-bold bg-gradient-to-r ${config.gradient} text-white`}>
                                                                                    {size}
                                                                                </span>

                                                                                {item.quantity > 1 && (
                                                                                    <span className="px-3 py-1 rounded-lg text-xs font-bold bg-gradient-to-r from-pink-400 to-pink-600 text-white shadow-lg">
                                                                                        x{item.quantity}
                                                                                    </span>
                                                                                )}

                                                                                {item.color && (
                                                                                    <span className="px-3 py-1 rounded-lg text-xs font-bold bg-white border-2 border-gray-200 text-gray-700 flex items-center gap-1">
                                                                                        üé® {item.color}
                                                                                    </span>
                                                                                )}
                                                                            </div>

                                                                            {item.notes && (
                                                                                <div className="bg-gray-50/80 rounded-xl p-2 mt-2">
                                                                                    <p className="text-xs text-gray-600">üí≠ {item.notes}</p>
                                                                                </div>
                                                                            )}
                                                                        </div>

                                                                        <div className="flex gap-2 flex-shrink-0">
                                                                            <button
                                                                                onClick={() => editWardrobeItem(item.id)}
                                                                                className="w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center active:scale-95 transition-transform hover:bg-blue-200"
                                                                            >
                                                                                <i className="fas fa-edit text-blue-600"></i>
                                                                            </button>
                                                                            <button
                                                                                onClick={() => deleteWardrobeItem(item.id)}
                                                                                className="w-10 h-10 rounded-xl bg-red-100 flex items-center justify-center active:scale-95 transition-transform hover:bg-red-200"
                                                                            >
                                                                                <i className="fas fa-trash text-red-600"></i>
                                                                            </button>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                );
                                            });
                                        })()}

                                        {/* Bouton "Charger plus" */}
                                        {wardrobeHasMore && (
                                            <button
                                                onClick={() => loadWardrobePage(wardrobePage + 1)}
                                                disabled={wardrobeLoading}
                                                className="w-full bg-white border-2 border-pink-300 text-pink-600 px-6 py-4 rounded-2xl text-base font-bold shadow-lg active:scale-95 transition-transform flex items-center justify-center gap-3 disabled:opacity-50"
                                            >
                                                {wardrobeLoading ? (
                                                    <>
                                                        <div className="animate-spin w-5 h-5 border-3 border-pink-500 border-t-transparent rounded-full"></div>
                                                        Chargement...
                                                    </>
                                                ) : (
                                                    <>
                                                        <i className="fas fa-chevron-down"></i>
                                                        Charger plus de v√™tements
                                                    </>
                                                )}
                                            </button>
                                        )}

                                        {/* Message de fin */}
                                        {!wardrobeHasMore && wardrobe.length > 0 && (
                                            <div className="text-center py-4">
                                                <p className="text-gray-500 text-sm">‚ú® Toute la garde-robe est affich√©e</p>
                                            </div>
                                        )}
                                    </>
                                )}
                            </div>
                        )}
                        {/* Formulaire principal biberon/couche */}
                        {showForm && (
                            <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-end sm:items-center justify-center p-0 sm:p-4 z-50">
                                <div className="bg-white w-full sm:max-w-md sm:rounded-3xl rounded-t-3xl max-h-[90vh] overflow-y-auto relative">
                                    {/* Header du formulaire */}
                                    <div className={`sticky top-0 bg-gradient-to-r ${themeColors.primary} text-white p-6 rounded-t-3xl z-10`}>
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center gap-3">
                                                <div className="w-12 h-12 bg-white/20 rounded-2xl flex items-center justify-center">
                                                    {formType === 'feeding' ? (
                                                        <i className="fas fa-bottle-water text-xl"></i>
                                                    ) : (
                                                        <i className="fas fa-baby text-xl"></i>
                                                    )}
                                                </div>
                                                <div>
                                                    <h3 className="text-xl font-bold">
                                                        {formType === 'feeding' ? 'Nouveau biberon' : 'Nouveau change'}
                                                    </h3>
                                                    <p className="text-sm opacity-80">
                                                        {editingId ? 'Modifier l\'entr√©e' : 'Ajouter une nouvelle entr√©e'}
                                                    </p>
                                                </div>
                                            </div>
                                            <button
                                                onClick={closeForm}
                                                className="w-10 h-10 rounded-2xl bg-white/20 flex items-center justify-center active:scale-95 transition-transform"
                                            >
                                                <i className="fas fa-times text-lg"></i>
                                            </button>
                                        </div>
                                    </div>

                                    {/* Contenu du formulaire */}
                                    <div className="p-6 space-y-6">
                                        {/* Date et heure */}
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                    Date *
                                                </label>
                                                <div className="relative">
                                                    <input
                                                        type="date"
                                                        className="w-full px-4 py-3 rounded-2xl border-2 border-gray-200 focus:border-blue-500 focus:outline-none transition-colors"
                                                        value={formData.date}
                                                        onChange={(e) => setFormData(prev => ({ ...prev, date: e.target.value }))}
                                                    />
                                                    <i className="fas fa-calendar absolute right-3 top-4 text-gray-400 text-sm pointer-events-none"></i>
                                                </div>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                    Heure *
                                                </label>
                                                <div className="relative">
                                                    <input
                                                        type="time"
                                                        className="w-full px-4 py-3 rounded-2xl border-2 border-gray-200 focus:border-blue-500 focus:outline-none transition-colors"
                                                        value={formData.time}
                                                        onChange={(e) => setFormData(prev => ({ ...prev, time: e.target.value }))}
                                                    />
                                                    <i className="fas fa-clock absolute right-3 top-4 text-gray-400 text-sm pointer-events-none"></i>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Formulaire biberon */}
                                        {formType === 'feeding' && (
                                            <div className="space-y-4">
                                                <div>
                                                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                        Quantit√© (ml) *
                                                    </label>
                                                    <div className="relative">
                                                        <input
                                                            type="number"
                                                            placeholder="120"
                                                            className="w-full px-4 py-3 pr-12 rounded-2xl border-2 border-gray-200 focus:border-blue-500 focus:outline-none text-lg font-bold text-center transition-colors"
                                                            value={formData.amount}
                                                            onChange={(e) => setFormData(prev => ({ ...prev, amount: e.target.value }))}
                                                        />
                                                        <span className="absolute right-4 top-4 text-gray-500 font-medium">ml</span>
                                                    </div>
                                                </div>

                                            </div>
                                        )}

                                        {/* Formulaire couche */}
                                        {formType === 'diaper' && (
                                            <div className="space-y-6">
                                                {/* Type de change */}
                                                <div>
                                                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                                                        Type de change *
                                                    </label>
                                                    <div className="grid grid-cols-2 gap-3">
                                                        <button
                                                            type="button"
                                                            onClick={() => setFormData(prev => ({ ...prev, hasPee: !prev.hasPee }))}
                                                            className={`p-4 rounded-2xl border-2 transition-all ${formData.hasPee
                                                                ? 'bg-blue-100 border-blue-300 text-blue-800'
                                                                : 'bg-gray-50 border-gray-200 text-gray-600'
                                                                }`}
                                                        >
                                                            <div className="text-2xl mb-2">üíß</div>
                                                            <div className="font-semibold">Pipi</div>
                                                        </button>
                                                        <button
                                                            type="button"
                                                            onClick={() => setFormData(prev => ({ ...prev, hasPoop: !prev.hasPoop }))}
                                                            className={`p-4 rounded-2xl border-2 transition-all ${formData.hasPoop
                                                                ? 'bg-orange-100 border-orange-300 text-orange-800'
                                                                : 'bg-gray-50 border-gray-200 text-gray-600'
                                                                }`}
                                                        >
                                                            <div className="text-2xl mb-2">üí©</div>
                                                            <div className="font-semibold">Caca</div>
                                                        </button>
                                                    </div>
                                                </div>

                                                {/* D√©tails caca si s√©lectionn√© */}
                                                {formData.hasPoop && (
                                                    <div className="space-y-4 bg-orange-50 rounded-2xl p-4 border border-orange-200">
                                                        <h4 className="font-semibold text-orange-800 mb-3">D√©tails du caca</h4>

                                                        {/* Quantit√© */}
                                                        <div>
                                                            <label className="block text-sm font-medium text-orange-700 mb-2">Quantit√©</label>
                                                            <div className="grid grid-cols-3 gap-2">
                                                                {['peu', 'moyen', 'beaucoup'].map(qty => (
                                                                    <button
                                                                        key={qty}
                                                                        type="button"
                                                                        onClick={() => setFormData(prev => ({ ...prev, poopQuantity: qty }))}
                                                                        className={`p-2 rounded-xl text-sm font-medium border-2 transition-all ${formData.poopQuantity === qty
                                                                            ? 'bg-orange-200 border-orange-400 text-orange-800'
                                                                            : 'bg-white border-orange-200 text-orange-600'
                                                                            }`}
                                                                    >
                                                                        {qty === 'peu' && 'ü§è'} {qty === 'moyen' && 'üëå'} {qty === 'beaucoup' && 'üôå'}
                                                                        <div className="capitalize">{qty}</div>
                                                                    </button>
                                                                ))}
                                                            </div>
                                                        </div>

                                                        {/* Consistance */}
                                                        <div>
                                                            <label className="block text-sm font-medium text-orange-700 mb-2">Consistance</label>
                                                            <div className="grid grid-cols-2 gap-2">
                                                                {[
                                                                    { value: 'liquide', emoji: 'üíß', label: 'Liquide' },
                                                                    { value: 'molle', emoji: 'üü°', label: 'Molle' },
                                                                    { value: 'normale', emoji: 'üü§', label: 'Normale' },
                                                                    { value: 'dure', emoji: 'üî¥', label: 'Dure' }
                                                                ].map(consistency => (
                                                                    <button
                                                                        key={consistency.value}
                                                                        type="button"
                                                                        onClick={() => setFormData(prev => ({ ...prev, poopConsistency: consistency.value }))}
                                                                        className={`p-2 rounded-xl text-sm font-medium border-2 transition-all ${formData.poopConsistency === consistency.value
                                                                            ? 'bg-orange-200 border-orange-400 text-orange-800'
                                                                            : 'bg-white border-orange-200 text-orange-600'
                                                                            }`}
                                                                    >
                                                                        <div className="text-lg mb-1">{consistency.emoji}</div>
                                                                        <div>{consistency.label}</div>
                                                                    </button>
                                                                ))}
                                                            </div>
                                                        </div>

                                                        {/* Couleur */}
                                                        <div>
                                                            <label className="block text-sm font-medium text-orange-700 mb-2">Couleur</label>
                                                            <div className="grid grid-cols-2 gap-2">
                                                                {[
                                                                    { value: 'jaune', emoji: 'üü°', label: 'Jaune' },
                                                                    { value: 'marron', emoji: 'üü§', label: 'Marron' },
                                                                    { value: 'vert', emoji: 'üü¢', label: 'Vert' },
                                                                    { value: 'noir', emoji: '‚ö´', label: 'Noir' }
                                                                ].map(color => (
                                                                    <button
                                                                        key={color.value}
                                                                        type="button"
                                                                        onClick={() => setFormData(prev => ({ ...prev, poopColor: color.value }))}
                                                                        className={`p-2 rounded-xl text-sm font-medium border-2 transition-all ${formData.poopColor === color.value
                                                                            ? 'bg-orange-200 border-orange-400 text-orange-800'
                                                                            : 'bg-white border-orange-200 text-orange-600'
                                                                            }`}
                                                                    >
                                                                        <div className="text-lg mb-1">{color.emoji}</div>
                                                                        <div>{color.label}</div>
                                                                    </button>
                                                                ))}
                                                            </div>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                    </div>

                                    {/* Footer avec boutons */}
                                    <div className="sticky bottom-0 bg-white border-t border-gray-100 p-6 space-y-3">
                                        <button
                                            onClick={saveEntry}
                                            className={`w-full bg-gradient-to-r ${themeColors.primary} text-white py-4 rounded-2xl font-bold text-lg active:scale-95 transition-transform shadow-lg`}
                                        >
                                            {editingId ? 'Mettre √† jour' : 'Enregistrer'}
                                        </button>
                                        <button
                                            onClick={closeForm}
                                            className="w-full bg-gray-100 text-gray-700 py-3 rounded-2xl font-medium active:scale-95 transition-transform"
                                        >
                                            Annuler
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* Vue Accomplissements */}
                        {currentView === 'accomplishments' && (
                            <div className="space-y-4">
                                {/* Header h√©ro√Øque avec progression globale */}
                                <div className="relative overflow-hidden">
                                    <div className="absolute inset-0 bg-gradient-to-br from-yellow-400 via-orange-400 to-pink-500 opacity-20 rounded-3xl"></div>
                                    <div className="relative bg-white/95 backdrop-blur-sm rounded-3xl p-6 shadow-2xl border-2 border-yellow-300">
                                        <div className="text-center mb-4">
                                            <div className="relative inline-block mb-4">
                                                <div className="w-24 h-24 mx-auto bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center shadow-2xl">
                                                    <i className="fas fa-trophy text-white text-4xl"></i>
                                                </div>
                                                <div className="absolute -top-2 -right-2">
                                                    <div className="w-8 h-8 bg-gradient-to-br from-pink-500 to-purple-600 rounded-full flex items-center justify-center shadow-xl">
                                                        <span className="text-white text-xs font-bold">
                                                            {Object.values(accomplishments).flat().filter(status => status === 'complete').length}
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <h2 className="text-2xl font-black text-gray-900 mb-2">
                                                Les exploits de {user?.babyName}
                                            </h2>
                                            <p className="text-sm text-gray-600 mb-4">D√©bloquez de nouvelles comp√©tences !</p>

                                            {/* Barre de progression globale */}
                                            <div className="w-full bg-gray-200 rounded-full h-4 mb-2 overflow-hidden shadow-inner">
                                                <div
                                                    className="h-full bg-gradient-to-r from-yellow-400 via-orange-500 to-pink-500 rounded-full transition-all duration-1000 ease-out relative overflow-hidden"
                                                    style={{
                                                        width: `${(() => {
                                                            // Compter tous les exploits possibles
                                                            let totalMilestones = 0;
                                                            Object.values(accomplishmentData).forEach(ageCategories => {
                                                                Object.values(ageCategories).forEach(items => {
                                                                    totalMilestones += items.length;
                                                                });
                                                            });

                                                            // Compter les exploits compl√©t√©s
                                                            let completedCount = 0;
                                                            Object.values(accomplishments).forEach(ageAccomplishments => {
                                                                if (ageAccomplishments && typeof ageAccomplishments === 'object') {
                                                                    Object.values(ageAccomplishments).forEach(status => {
                                                                        if (status === 'complete') completedCount++;
                                                                    });
                                                                }
                                                            });

                                                            return totalMilestones > 0 ? Math.round((completedCount / totalMilestones) * 100) : 0;
                                                        })()}%`
                                                    }}
                                                >
                                                    <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent"></div>
                                                </div>
                                            </div>
                                            <p className="text-xs font-bold text-gray-700">
                                                {(() => {
                                                    // Compter tous les exploits possibles
                                                    let totalMilestones = 0;
                                                    Object.values(accomplishmentData).forEach(ageCategories => {
                                                        Object.values(ageCategories).forEach(items => {
                                                            totalMilestones += items.length;
                                                        });
                                                    });

                                                    // Compter les exploits compl√©t√©s
                                                    let completedCount = 0;
                                                    Object.values(accomplishments).forEach(ageAccomplishments => {
                                                        if (ageAccomplishments && typeof ageAccomplishments === 'object') {
                                                            Object.values(ageAccomplishments).forEach(status => {
                                                                if (status === 'complete') completedCount++;
                                                            });
                                                        }
                                                    });

                                                    return `${completedCount} / ${totalMilestones} comp√©tences ma√Ætris√©es`;
                                                })()}
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                {/* Cat√©gories d'√¢ge sous forme de cartes de jeu */}
                                <div className="space-y-3">
                                    {Object.entries(accomplishmentData).map(([ageKey, categories]) => {
                                        const ageLabels = {
                                            '2months': '2 mois',
                                            '4months': '4 mois',
                                            '6months': '6 mois',
                                            '9months': '9 mois'
                                        };

                                        const ageEmojis = {
                                            '2months': 'üë∂',
                                            '4months': 'üçº',
                                            '6months': 'üéà',
                                            '9months': '‚≠ê'
                                        };

                                        const totalAccomplishments = Object.values(categories).flat().length;
                                        const completedCount = Object.values(categories).flat().filter(item =>
                                            accomplishments[ageKey]?.[item] === 'complete'
                                        ).length;
                                        const progressPercent = totalAccomplishments > 0 ? Math.round((completedCount / totalAccomplishments) * 100) : 0;
                                        const isUnlocked = calculateAge() >= parseInt(ageKey.replace('months', '')) * 30;
                                        const isCompleted = progressPercent === 100;

                                        return (
                                            <div
                                                key={ageKey}
                                                onClick={() => {
                                                    if (isUnlocked) {
                                                        setCurrentMilestoneAge(ageKey);
                                                        setShowAccomplishments(true);
                                                    }
                                                }}
                                                className={`relative overflow-hidden rounded-3xl transition-all duration-300 ${isUnlocked
                                                    ? 'cursor-pointer hover:scale-102 active:scale-98'
                                                    : 'opacity-60'
                                                    }`}
                                                style={{
                                                    background: isCompleted
                                                        ? 'linear-gradient(135deg, #fbbf24 0%, #f59e0b 50%, #ec4899 100%)'
                                                        : isUnlocked
                                                            ? 'linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%)'
                                                            : 'linear-gradient(135deg, #9ca3af 0%, #6b7280 100%)'
                                                }}
                                            >
                                                {/* Effet de brillance anim√© */}
                                                {isUnlocked && (
                                                    <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent"></div>
                                                )}

                                                <div className="relative p-5">
                                                    <div className="flex items-center justify-between mb-3">
                                                        <div className="flex items-center gap-3">
                                                            {/* Badge d'√¢ge */}
                                                            <div className="w-14 h-14 rounded-2xl bg-white/30 backdrop-blur-sm flex items-center justify-center text-3xl shadow-xl border-2 border-white/50">
                                                                {isUnlocked ? ageEmojis[ageKey] : 'üîí'}
                                                            </div>

                                                            <div>
                                                                <h3 className="text-xl font-black text-white mb-1 drop-shadow-lg">
                                                                    {ageLabels[ageKey]}
                                                                </h3>
                                                                <p className="text-sm text-white/90 font-medium">
                                                                    {isUnlocked
                                                                        ? `${completedCount}/${totalAccomplishments} comp√©tences`
                                                                        : `D√©blocage : ${parseInt(ageKey.replace('months', '')) * 30} jours`
                                                                    }
                                                                </p>
                                                            </div>
                                                        </div>

                                                        {/* Badge de statut */}
                                                        <div className={`w-12 h-12 rounded-full flex items-center justify-center shadow-xl ${isCompleted
                                                            ? 'bg-gradient-to-br from-yellow-300 to-yellow-500'
                                                            : 'bg-white/30 backdrop-blur-sm'
                                                            }`}>
                                                            {!isUnlocked ? (
                                                                <i className="fas fa-lock text-white text-xl"></i>
                                                            ) : isCompleted ? (
                                                                <i className="fas fa-crown text-white text-xl"></i>
                                                            ) : (
                                                                <span className="text-white text-lg font-black">{progressPercent}%</span>
                                                            )}
                                                        </div>
                                                    </div>

                                                    {/* Barre de progression √©l√©gante */}
                                                    {isUnlocked && (
                                                        <div className="relative">
                                                            <div className="w-full bg-white/20 backdrop-blur-sm rounded-full h-3 overflow-hidden shadow-inner">
                                                                <div
                                                                    className="h-full bg-gradient-to-r from-white/80 to-white rounded-full transition-all duration-500 relative"
                                                                    style={{ width: `${progressPercent}%` }}
                                                                >
                                                                    {progressPercent > 0 && (
                                                                        <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/50 to-transparent "></div>
                                                                    )}
                                                                </div>
                                                            </div>

                                                            {/* √âtincelles de compl√©tion */}
                                                            {isCompleted && (
                                                                <div className="absolute -top-1 -right-1">
                                                                    <div className="text-yellow-300 text-xl animate-ping">‚ú®</div>
                                                                </div>
                                                            )}
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}{/* Modal d√©tail des accomplissements - Version gamifi√©e */}

                        {showAccomplishments && (
                            <div className="fixed inset-0 bg-black/80 backdrop-blur-md flex items-center justify-center p-4 z-50">
                                <div className="bg-white w-full sm:max-w-md rounded-3xl max-h-[90vh] overflow-y-auto relative shadow-2xl">
                                    {/* Header avec gradient */}
                                    <div className="sticky top-0 bg-gradient-to-r from-purple-500 to-pink-500 text-white p-6 rounded-t-3xl z-10">
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center gap-3">
                                                <div className="w-12 h-12 bg-white/20 rounded-2xl flex items-center justify-center backdrop-blur-sm">
                                                    <i className="fas fa-gamepad text-xl"></i>
                                                </div>
                                                <div>
                                                    <h3 className="text-xl font-bold">Comp√©tences</h3>
                                                    <p className="text-sm opacity-90">
                                                        {currentMilestoneAge === '2months' ? '2 mois' :
                                                            currentMilestoneAge === '4months' ? '4 mois' :
                                                                currentMilestoneAge === '6months' ? '6 mois' : '9 mois'}
                                                    </p>
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => setShowAccomplishments(false)}
                                                className="w-10 h-10 rounded-2xl bg-white/20 flex items-center justify-center hover:bg-white/30 transition"
                                            >
                                                <i className="fas fa-times text-lg"></i>
                                            </button>
                                        </div>
                                    </div>

                                    {/* Onglets cat√©gories avec design gaming */}
                                    <div className="p-4 sticky top-24 bg-white z-10 border-b">
                                        <div className="grid grid-cols-2 gap-2">
                                            {[
                                                { id: 'movement', label: 'Mouvement', icon: 'fa-running', color: 'blue' },
                                                { id: 'cognitive', label: 'Cognitif', icon: 'fa-brain', color: 'purple' },
                                                { id: 'language', label: 'Langage', icon: 'fa-comments', color: 'green' },
                                                { id: 'social', label: 'Social', icon: 'fa-users', color: 'pink' }
                                            ].map(cat => {
                                                const categoryAccomplishments = accomplishmentData[currentMilestoneAge]?.[cat.id] || [];
                                                const completedInCategory = categoryAccomplishments.filter(item =>
                                                    accomplishments[currentMilestoneAge]?.[item] === 'complete'
                                                ).length;
                                                const isFullyCompleted = completedInCategory === categoryAccomplishments.length && categoryAccomplishments.length > 0;

                                                return (
                                                    <button
                                                        key={cat.id}
                                                        onClick={() => setSelectedCategory(cat.id)}
                                                        className={`relative flex flex-col items-center gap-2 px-3 py-3 rounded-2xl font-medium transition-all ${selectedCategory === cat.id
                                                            ? `bg-${cat.color}-100 text-${cat.color}-700 border-2 border-${cat.color}-300 shadow-lg scale-105`
                                                            : 'bg-gray-50 text-gray-600 border-2 border-gray-200'
                                                            }`}
                                                    >
                                                        <div className="relative">
                                                            <i className={`fas ${cat.icon} text-xl`}></i>
                                                            {isFullyCompleted && (
                                                                <div className="absolute -top-2 -right-2 w-5 h-5 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center shadow-lg ">
                                                                    <i className="fas fa-star text-white text-xs"></i>
                                                                </div>
                                                            )}
                                                        </div>
                                                        <span className="text-xs font-bold">{cat.label}</span>

                                                        {/* Mini barre de progression */}
                                                        {categoryAccomplishments.length > 0 && (
                                                            <div className="w-full h-1.5 bg-gray-200 rounded-full overflow-hidden">
                                                                <div
                                                                    className={`h-full bg-gradient-to-r ${isFullyCompleted
                                                                        ? 'from-yellow-400 to-orange-500'
                                                                        : `from-${cat.color}-400 to-${cat.color}-600`
                                                                        } transition-all duration-500`}
                                                                    style={{
                                                                        width: `${Math.round((completedInCategory / categoryAccomplishments.length) * 100)}%`
                                                                    }}
                                                                ></div>
                                                            </div>
                                                        )}
                                                    </button>
                                                );
                                            })}
                                        </div>
                                    </div>
                                    {/* Liste des accomplissements avec ic√¥nes anim√©es */}
                                    <div className="p-4 space-y-3 pb-24">
                                        {accomplishmentData[currentMilestoneAge]?.[selectedCategory]?.map((item, index) => {
                                            const accomplishmentText = item.replace('{babyName}', user?.babyName || 'b√©b√©');
                                            const status = accomplishments[currentMilestoneAge]?.[item] || 'none';
                                            const { icon, animation, color } = getAccomplishmentVisual(accomplishmentText);

                                            return (
                                                <div
                                                    key={index}
                                                    className={`relative overflow-hidden rounded-2xl transition-all duration-300 ${status === 'complete'
                                                        ? 'bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-300 shadow-lg'
                                                        : status === 'partial'
                                                            ? 'bg-gradient-to-br from-orange-50 to-yellow-50 border-2 border-orange-300'
                                                            : 'bg-white border-2 border-gray-200'
                                                        }`}
                                                >
                                                    {/* Effet de brillance pour compl√©t√©s */}
                                                    {status === 'complete' && (
                                                        <div className="absolute top-0 right-0 w-20 h-20 bg-gradient-to-br from-yellow-200/50 to-transparent rounded-bl-full"></div>
                                                    )}

                                                    <div className="relative p-4">
                                                        {/* Ic√¥ne illustrative avec animation */}
                                                        <div className={`accomplishment-icon bg-gradient-to-br ${color} rounded-3xl p-4 animate-[${animation}_2s_ease-in-out_infinite]`}>
                                                            {icon}
                                                        </div>

                                                        {/* Texte de la comp√©tence */}
                                                        <div className="mb-3">
                                                            <p className="text-sm text-gray-800 font-medium leading-relaxed text-center">
                                                                {accomplishmentText}
                                                            </p>
                                                        </div>

                                                        {/* Boutons d'action */}
                                                        <div className="flex gap-2">
                                                            <button
                                                                onClick={() => {
                                                                    setSelectedMilestone({ age: currentMilestoneAge, item, status: 'partial' });
                                                                    setShowAccomplishments(false);
                                                                }}
                                                                className={`flex-1 py-3 px-4 rounded-xl text-sm font-bold transition-all active:scale-95 ${status === 'partial'
                                                                    ? 'bg-gradient-to-r from-orange-400 to-yellow-500 text-white shadow-lg border-2 border-orange-300'
                                                                    : 'bg-gray-100 text-gray-700 border-2 border-gray-200 hover:border-orange-300'
                                                                    }`}
                                                            >
                                                                <i className="fas fa-star-half-alt mr-2"></i>
                                                                En cours
                                                            </button>
                                                            <button
                                                                onClick={() => {
                                                                    setSelectedMilestone({ age: currentMilestoneAge, item, status: 'complete' });
                                                                    setShowAccomplishments(false);
                                                                }}
                                                                className={`flex-1 py-3 px-4 rounded-xl text-sm font-bold transition-all active:scale-95 ${status === 'complete'
                                                                    ? 'bg-gradient-to-r from-green-400 to-emerald-500 text-white shadow-lg border-2 border-green-300'
                                                                    : 'bg-gray-100 text-gray-700 border-2 border-gray-200 hover:border-green-300'
                                                                    }`}
                                                            >
                                                                <i className="fas fa-trophy mr-2"></i>
                                                                Ma√Ætris√©
                                                            </button>
                                                        </div>

                                                        {/* Badge de statut */}
                                                        {status !== 'none' && (
                                                            <div className={`mt-3 text-center py-2 px-3 rounded-lg text-xs font-bold ${status === 'complete'
                                                                ? 'bg-green-100 text-green-700'
                                                                : 'bg-orange-100 text-orange-700'
                                                                }`}>
                                                                {status === 'complete' ? 'üéâ Comp√©tence d√©bloqu√©e !' : '‚è≥ En apprentissage'}
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* Modal confirmation statut */}
                        {selectedMilestone && (
                            <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-60">
                                <div className="bg-white rounded-2xl p-6 max-w-sm w-full shadow-2xl">
                                    <div className="text-center mb-4">
                                        <div className={`w-16 h-16 mx-auto rounded-full flex items-center justify-center mb-3 ${selectedMilestone.status === 'complete'
                                            ? 'bg-green-100'
                                            : 'bg-orange-100'
                                            }`}>
                                            <i className={`fas ${selectedMilestone.status === 'complete'
                                                ? 'fa-trophy text-green-600'
                                                : 'fa-clock text-orange-600'
                                                } text-xl`}></i>
                                        </div>
                                        <h3 className="text-lg font-bold text-gray-900 mb-2">
                                            {selectedMilestone.status === 'complete' ? 'Compl√®te' : 'Partielle'}
                                        </h3>
                                        <p className="text-sm text-gray-600 mb-4">
                                            {selectedMilestone.status === 'complete'
                                                ? `${user?.babyName} peut r√©p√©ter cette action sans votre aide`
                                                : `${user?.babyName} peut effectuer cette action temporairement ou avec votre aide`
                                            }
                                        </p>
                                        <div className="text-xs text-gray-500 mb-4">
                                            L'√¢ge de {user?.babyName} lorsque cette comp√©tence a √©t√© d√©montr√©e
                                        </div>
                                        <div className="bg-gray-100 rounded-xl p-3 mb-4">
                                            <div className="text-2xl font-bold text-gray-800">
                                                {formatAgeDisplay(calculateAge())}
                                            </div>
                                        </div>
                                    </div>

                                    <div className="flex gap-3">
                                        <button
                                            onClick={() => setSelectedMilestone(null)}
                                            className="flex-1 bg-gray-100 text-gray-700 py-3 rounded-xl font-medium active:scale-95 transition-transform"
                                        >
                                            <i className="fas fa-times mr-2"></i>
                                            Annuler
                                        </button>
                                        <button
                                            onClick={async () => {
                                                const { age, item, status } = selectedMilestone;
                                                const newAccomplishments = { ...accomplishments };
                                                if (!newAccomplishments[age]) newAccomplishments[age] = {};

                                                // V√©rifier si c'est la premi√®re fois qu'on atteint 100%
                                                const currentCompletedCount = accomplishments[age]
                                                    ? Object.values(accomplishments[age]).filter(s => s === 'complete').length
                                                    : 0;
                                                const totalItems = Object.values(accomplishmentData[age]).flat().length;
                                                const wasAlready100 = currentCompletedCount === totalItems;

                                                newAccomplishments[age][item] = status;

                                                // Calculer le nouveau pourcentage
                                                const newCompletedCount = Object.values(newAccomplishments[age]).filter(s => s === 'complete').length;
                                                const newProgress = Math.round((newCompletedCount / totalItems) * 100);

                                                setAccomplishments(newAccomplishments);

                                                // Sauvegarder dans Firebase
                                                // Sauvegarder dans Firebase
                                                try {
                                                    await db.collection('families').doc(user.code).update({
                                                        accomplishments: newAccomplishments,
                                                        lastAccomplishmentUpdate: new Date().toISOString()
                                                    });
                                                } catch (error) {
                                                    console.error('Erreur sauvegarde accomplissements:', error);
                                                    // Afficher un message d'erreur √† l'utilisateur
                                                    alert('Erreur lors de la sauvegarde. Veuillez r√©essayer.');
                                                    return; // Emp√™cher la fermeture du modal en cas d'erreur
                                                }

                                                setSelectedMilestone(null);

                                                // Animation de f√©licitations si on atteint 100% pour la premi√®re fois
                                                if (newProgress === 100 && !wasAlready100) {
                                                    setTimeout(() => {
                                                        const congratsDiv = document.createElement('div');
                                                        congratsDiv.innerHTML = `
                                    <div style="
                                        position: fixed; 
                                        top: 50%; 
                                        left: 50%; 
                                        transform: translate(-50%, -50%); 
                                        background: linear-gradient(135deg, #fbbf24, #f59e0b); 
                                        color: white; 
                                        padding: 2rem 1.5rem; 
                                        border-radius: 2rem; 
                                        box-shadow: 0 25px 60px rgba(251, 191, 36, 0.4);
                                        z-index: 9999;
                                        text-align: center;
                                        animation: bounceIn 0.8s ease-out;
                                        max-width: 280px;
                                        width: 90%;
                                        border: 3px solid rgba(255,255,255,0.2);
                                    ">
                                        <div style="font-size: 4rem; margin-bottom: 1rem;">üéâ</div>
                                        <h3 style="font-size: 1.8rem; font-weight: bold; margin-bottom: 0.5rem; text-shadow: 0 2px 4px rgba(0,0,0,0.2);">F√©licitations !</h3>
                                        <p style="margin: 0; opacity: 0.95; font-size: 1rem; line-height: 1.4;">${user?.babyName} a termin√© tous les accomplissements de ${age === '2months' ? '2 mois' : age === '4months' ? '4 mois' : age === '6months' ? '6 mois' : '9 mois'} !</p>
                                    </div>
                                    <style>
                                        @keyframes bounceIn {
                                            0% { 
                                                transform: translate(-50%, -50%) scale(0.5) rotate(-5deg); 
                                                opacity: 0; 
                                            }
                                            60% { 
                                                transform: translate(-50%, -50%) scale(1.1) rotate(2deg); 
                                                opacity: 1;
                                            }
                                            80% { 
                                                transform: translate(-50%, -50%) scale(0.95) rotate(-1deg); 
                                            }
                                            100% { 
                                                transform: translate(-50%, -50%) scale(1) rotate(0deg); 
                                                opacity: 1; 
                                            }
                                        }
                                    </style>
                                `;
                                                        document.body.appendChild(congratsDiv);

                                                        // Supprimer apr√®s 4 secondes
                                                        setTimeout(() => {
                                                            if (document.body.contains(congratsDiv)) {
                                                                document.body.removeChild(congratsDiv);
                                                            }
                                                        }, 4000);
                                                    }, 500);
                                                }
                                            }}
                                            className={`flex-1 text-white py-3 rounded-xl font-bold active:scale-95 transition-transform shadow-lg ${selectedMilestone.status === 'complete'
                                                ? 'bg-gradient-to-r from-green-500 to-green-600'
                                                : 'bg-gradient-to-r from-orange-500 to-orange-600'
                                                }`}
                                        >
                                            Enregistrer
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* Pop-up de mise √† jour */}
                        {showUpdatePopup && (
                            <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-[100]" style={{ margin: 0, padding: '1rem' }}>
                                <div className="bg-white rounded-3xl w-full max-w-sm max-h-[85vh] overflow-y-auto shadow-2xl relative">
                                    <div className="absolute top-0 left-0 right-0 h-2 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500"></div>

                                    <div className="relative pt-6 pb-3">
                                        <div className="w-20 h-20 mx-auto bg-gradient-to-br from-blue-400 to-purple-600 rounded-full flex items-center justify-center shadow-xl">
                                            <i className="fas fa-gift text-white text-3xl"></i>
                                        </div>
                                        <div className="absolute top-6 left-1/4 text-yellow-400 text-xl">‚ú®</div>
                                        <div className="absolute top-10 right-1/4 text-yellow-400 text-lg">‚≠ê</div>
                                        <div className="absolute top-14 left-1/3 text-yellow-400 text-base">üí´</div>
                                    </div>

                                    <div className="px-5 pb-5 text-center">
                                        <h3 className="text-xl font-bold text-gray-900 mb-1">
                                            üéâ Nouvelle mise √† jour !
                                        </h3>
                                        <p className="text-xs text-gray-600 mb-3">Version 1.8.0</p>

                                        <div className="space-y-3 mb-4">
                                            {/* Biberon √† la demande */}
                                            <div className="bg-gradient-to-br from-green-50 to-emerald-50 rounded-2xl p-3 text-left border-2 border-green-200">
                                                <h4 className="font-bold text-gray-800 mb-2 flex items-center gap-2 text-sm">
                                                    <span className="text-lg">üçº</span>
                                                    Biberon √† la demande
                                                </h4>
                                                <div className="space-y-1.5 text-xs text-gray-700">
                                                    <div className="flex items-start gap-2">
                                                        <div className="w-4 h-4 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                                            <i className="fas fa-check text-white text-[8px]"></i>
                                                        </div>
                                                        <p><strong>D√©sactiver l'intervalle</strong> : Nouvelle option pour donner le biberon √† la demande</p>
                                                    </div>
                                                    <div className="flex items-start gap-2">
                                                        <div className="w-4 h-4 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                                            <i className="fas fa-check text-white text-[8px]"></i>
                                                        </div>
                                                        <p><strong>Message adapt√©</strong> : "Donner quand b√©b√© r√©clame" s'affiche sur l'accueil</p>
                                                    </div>
                                                    <div className="flex items-start gap-2">
                                                        <div className="w-4 h-4 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                                            <i className="fas fa-check text-white text-[8px]"></i>
                                                        </div>
                                                        <p><strong>Plus flexible</strong> : Parfait pour les b√©b√©s qui suivent leur propre rythme</p>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Mix d'aliments */}
                                            <div className="bg-gradient-to-br from-orange-50 to-yellow-50 rounded-2xl p-3 text-left border-2 border-orange-200">
                                                <h4 className="font-bold text-gray-800 mb-2 flex items-center gap-2 text-sm">
                                                    <span className="text-lg">ü•£</span>
                                                    Mix d'aliments
                                                </h4>
                                                <div className="space-y-1.5 text-xs text-gray-700">
                                                    <div className="flex items-start gap-2">
                                                        <div className="w-4 h-4 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                                            <i className="fas fa-check text-white text-[8px]"></i>
                                                        </div>
                                                        <p><strong>Aliments m√©lang√©s</strong> : Introduisez un nouvel aliment m√©lang√© avec des aliments connus</p>
                                                    </div>
                                                    <div className="flex items-start gap-2">
                                                        <div className="w-4 h-4 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                                            <i className="fas fa-check text-white text-[8px]"></i>
                                                        </div>
                                                        <p><strong>Suivi pr√©cis</strong> : Notez quel aliment est nouveau dans le mix</p>
                                                    </div>
                                                    <div className="flex items-start gap-2">
                                                        <div className="w-4 h-4 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                                            <i className="fas fa-check text-white text-[8px]"></i>
                                                        </div>
                                                        <p><strong>Interface simplifi√©e</strong> : Bouton + pour mobile</p>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Exploits corrig√©s */}
                                            <div className="bg-gradient-to-br from-yellow-50 to-orange-50 rounded-2xl p-3 text-left border-2 border-yellow-200">
                                                <h4 className="font-bold text-gray-800 mb-2 flex items-center gap-2 text-sm">
                                                    <span className="text-lg">üèÜ</span>
                                                    Exploits corrig√©s
                                                </h4>
                                                <div className="space-y-1.5 text-xs text-gray-700">
                                                    <div className="flex items-start gap-2">
                                                        <div className="w-4 h-4 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                                            <i className="fas fa-check text-white text-[8px]"></i>
                                                        </div>
                                                        <p><strong>Barre de progression</strong> : La barre progresse maintenant correctement quand vous validez des exploits</p>
                                                    </div>
                                                    <div className="flex items-start gap-2">
                                                        <div className="w-4 h-4 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                                            <i className="fas fa-check text-white text-[8px]"></i>
                                                        </div>
                                                        <p><strong>Compteur pr√©cis</strong> : Le nombre de comp√©tences ma√Ætris√©es est exact</p>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Diversification */}
                                            <div className="bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl p-3 text-left border-2 border-purple-200">
                                                <h4 className="font-bold text-gray-800 mb-2 flex items-center gap-2 text-sm">
                                                    <span className="text-lg">üçΩÔ∏è</span>
                                                    Diversification am√©lior√©e
                                                </h4>
                                                <div className="space-y-1.5 text-xs text-gray-700">
                                                    <div className="flex items-start gap-2">
                                                        <div className="w-4 h-4 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                                            <i className="fas fa-check text-white text-[8px]"></i>
                                                        </div>
                                                        <p><strong>Suppression</strong> : Le bouton supprimer fonctionne maintenant</p>
                                                    </div>
                                                    <div className="flex items-start gap-2">
                                                        <div className="w-4 h-4 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                                            <i className="fas fa-check text-white text-[8px]"></i>
                                                        </div>
                                                        <p><strong>Affichage clair</strong> : Les mix d'aliments sont mieux pr√©sent√©s</p>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Performance */}
                                            <div className="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-3 text-left border-2 border-blue-200">
                                                <h4 className="font-bold text-gray-800 mb-2 flex items-center gap-2 text-sm">
                                                    <span className="text-lg">‚ö°</span>
                                                    Plus rapide
                                                </h4>
                                                <div className="space-y-1.5 text-xs text-gray-700">
                                                    <div className="flex items-start gap-2">
                                                        <div className="w-4 h-4 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                                            <i className="fas fa-check text-white text-[8px]"></i>
                                                        </div>
                                                        <p><strong>Chargement progressif</strong> : Les listes se chargent au fur et √† mesure</p>
                                                    </div>
                                                    <div className="flex items-start gap-2">
                                                        <div className="w-4 h-4 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                                                            <i className="fas fa-check text-white text-[8px]"></i>
                                                        </div>
                                                        <p><strong>Moins de donn√©es</strong> : L'app ne charge que ce dont vous avez besoin</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Message de remerciement */}
                                        <div className="bg-gradient-to-r from-pink-50 to-purple-50 rounded-xl p-2 mb-4">
                                            <p className="text-[10px] text-gray-600 leading-relaxed">
                                                Merci d'utiliser BabyTrack ! üíô
                                            </p>
                                        </div>

                                        {/* Bouton */}
                                        <button
                                            onClick={closeUpdatePopup}
                                            className={`w-full bg-gradient-to-r ${themeColors.primary} text-white py-3 rounded-2xl font-bold text-base shadow-lg active:scale-95 transition-transform`}
                                        >
                                            C'est parti ! üöÄ
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* Pop-up PWA - Suggestion */}
                        {showPWAPopup && pwaPopupType === 'suggest' && (
                            <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-[9999]" style={{ margin: 0, padding: '1rem' }}>
                                <div className="bg-white rounded-3xl w-full max-w-sm max-h-[85vh] overflow-y-auto shadow-2xl relative">
                                    <div className="absolute top-0 left-0 right-0 h-2 bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-500"></div>

                                    <div className="relative pt-6 pb-3">
                                        <div className="w-20 h-20 mx-auto bg-gradient-to-br from-indigo-400 to-purple-600 rounded-full flex items-center justify-center shadow-xl">
                                            <i className="fas fa-mobile-alt text-white text-3xl"></i>
                                        </div>
                                        <div className="absolute top-6 left-1/4 text-xl">üì±</div>
                                        <div className="absolute top-10 right-1/4 text-lg" style={{ animationDelay: '0.3s' }}>‚ú®</div>
                                    </div>

                                    <div className="px-5 pb-5 text-center">
                                        <h3 className="text-xl font-bold text-gray-900 mb-1">
                                            üì≤ Installer BabyTrack
                                        </h3>
                                        <p className="text-xs text-gray-600 mb-4">
                                            Pour une meilleure exp√©rience, ajoutez BabyTrack √† votre √©cran d'accueil !
                                        </p>

                                        <div className="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-3 mb-4 text-left">
                                            <div className="space-y-2 text-xs text-gray-700">
                                                <div className="flex items-center gap-2">
                                                    <div className="w-7 h-7 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0">
                                                        <i className="fas fa-bolt text-white text-[10px]"></i>
                                                    </div>
                                                    <p><strong>Acc√®s rapide</strong> depuis l'√©cran d'accueil</p>
                                                </div>
                                                <div className="flex items-center gap-2">
                                                    <div className="w-7 h-7 bg-purple-500 rounded-full flex items-center justify-center flex-shrink-0">
                                                        <i className="fas fa-expand text-white text-[10px]"></i>
                                                    </div>
                                                    <p><strong>Mode plein √©cran</strong> comme une vraie app</p>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="space-y-2">
                                            <button
                                                onClick={() => {
                                                    setShowPWAPopup(false);
                                                    setPwaPopupType('instructions');
                                                    setTimeout(() => setShowPWAPopup(true), 100);
                                                    // Le body reste bloqu√© car on r√©ouvre directement
                                                }}
                                                className="w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white py-3 rounded-2xl font-bold text-base shadow-lg active:scale-95 transition-transform"
                                            >
                                                Comment faire ? üìñ
                                            </button>
                                            <button
                                                onClick={() => {
                                                    setShowPWAPopup(false);
                                                    // D√©bloquer le scroll du body
                                                    document.body.classList.remove('modal-open');
                                                }}
                                                className="w-full bg-gray-100 text-gray-700 py-2.5 rounded-2xl font-medium text-sm active:scale-95 transition-transform"
                                            >
                                                Plus tard
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* Pop-up PWA - Instructions */}
                        {showPWAPopup && pwaPopupType === 'instructions' && (
                            <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-[9999]" style={{ margin: 0, padding: '1rem' }}>
                                <div className="bg-white rounded-3xl w-full max-w-sm max-h-[85vh] overflow-y-auto shadow-2xl relative">
                                    <div className="absolute top-0 left-0 right-0 h-2 bg-gradient-to-r from-green-500 via-teal-500 to-cyan-500"></div>

                                    <div className="relative pt-5 pb-3 px-5">
                                        <button
                                            onClick={() => {
                                                setShowPWAPopup(false);
                                                // D√©bloquer le scroll du body
                                                document.body.classList.remove('modal-open');
                                            }}
                                            className="absolute top-3 right-3 w-7 h-7 rounded-full bg-gray-100 flex items-center justify-center"
                                        >
                                            <i className="fas fa-times text-gray-600 text-xs"></i>
                                        </button>
                                        <div className="w-14 h-14 mx-auto bg-gradient-to-br from-green-400 to-teal-600 rounded-full flex items-center justify-center shadow-lg mb-2">
                                            <i className="fas fa-info-circle text-white text-xl"></i>
                                        </div>
                                        <h3 className="text-lg font-bold text-gray-900 text-center">
                                            Installation sur iOS
                                        </h3>
                                    </div>

                                    <div className="px-5 pb-5">
                                        <div className="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-3 mb-3">
                                            <div className="space-y-3 text-xs text-gray-700">
                                                <div className="flex items-start gap-2">
                                                    <div className="w-7 h-7 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0 font-bold text-white text-xs">
                                                        1
                                                    </div>
                                                    <div className="flex-1 pt-0.5">
                                                        <p className="font-semibold text-gray-900 mb-1">Appuyez sur le bouton Partager</p>
                                                        <div className="flex items-center gap-1.5 text-gray-600">
                                                            <div className="w-6 h-6 bg-blue-100 rounded-lg flex items-center justify-center">
                                                                <i className="fas fa-share text-blue-600 text-[10px]"></i>
                                                            </div>
                                                            <span className="text-[10px]">(en bas de Safari)</span>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div className="flex items-start gap-2">
                                                    <div className="w-7 h-7 bg-indigo-500 rounded-full flex items-center justify-center flex-shrink-0 font-bold text-white text-xs">
                                                        2
                                                    </div>
                                                    <div className="flex-1 pt-0.5">
                                                        <p className="font-semibold text-gray-900 mb-1">S√©lectionnez "Sur l'√©cran d'accueil"</p>
                                                        <div className="flex items-center gap-1.5 text-gray-600">
                                                            <div className="w-6 h-6 bg-indigo-100 rounded-lg flex items-center justify-center">
                                                                <i className="fas fa-plus-square text-indigo-600 text-[10px]"></i>
                                                            </div>
                                                            <span className="text-[10px]">(faites d√©filer le menu)</span>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div className="flex items-start gap-2">
                                                    <div className="w-7 h-7 bg-purple-500 rounded-full flex items-center justify-center flex-shrink-0 font-bold text-white text-xs">
                                                        3
                                                    </div>
                                                    <div className="flex-1 pt-0.5">
                                                        <p className="font-semibold text-gray-900 mb-1">Appuyez sur "Ajouter"</p>
                                                        <p className="text-[10px] text-gray-600">L'ic√¥ne appara√Ætra sur votre √©cran d'accueil !</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="bg-gradient-to-r from-green-50 to-teal-50 rounded-xl p-2 mb-3">
                                            <p className="text-[10px] text-gray-600 text-center leading-relaxed">
                                                üéâ Une fois install√©e, BabyTrack fonctionnera comme une vraie application !
                                            </p>
                                        </div>

                                        <button
                                            onClick={() => {
                                                setShowPWAPopup(false);
                                                // D√©bloquer le scroll du body
                                                document.body.classList.remove('modal-open');
                                            }}
                                            className="w-full bg-gradient-to-r from-green-500 to-teal-600 text-white py-3 rounded-2xl font-bold text-base shadow-lg active:scale-95 transition-transform"
                                        >
                                            Compris ! üëç
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };
        ReactDOM.render(<BabyTracker />, document.getElementById('root'));
    </script>
</body>

</html>