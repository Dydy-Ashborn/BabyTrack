<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>BabyTrack</title>
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#3B82F6">
    
    <!-- Favicons -->
    <link rel="icon" type="image/png" href="logo.PNG">
    
    <!-- Apple iOS Configuration -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BabyTrack">
    <link rel="apple-touch-icon" sizes="152x152" href="logo.PNG">
    <link rel="apple-touch-icon" sizes="180x180" href="logo.PNG">
    <link rel="apple-touch-icon" sizes="192x192" href="logo.PNG">
    
    <!-- Mobile Web App -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    
    <!-- Scripts et styles -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/heic2any@0.0.4/dist/heic2any.min.js"></script>

    <style>
        body {
            overscroll-behavior: none;
            -ms-overflow-style: none;
            scrollbar-width: none;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        body::-webkit-scrollbar {
            display: none;
        }

        .glass {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.7);
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .pulse-gentle {
            animation: pulse-gentle 2s ease-in-out infinite;
        }

        @keyframes pulse-gentle {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        .medication-available {
            border-color: #10b981;
            background-color: #f0fdf4;
        }

        .medication-waiting {
            border-color: #f59e0b;
            background-color: #fffbeb;
        }

        .medication-soon {
            border-color: #ef4444;
            background-color: #fef2f2;
        }

        .appointment-today {
            border-color: #ef4444;
            background-color: #fef2f2;
        }

        .appointment-upcoming {
            border-color: #f59e0b;
            background-color: #fffbeb;
        }
    </style>

    <!-- Logo BabyTrack en SVG -->
    <svg id="babytrack-logo" style="display: none;">
        <defs>
            <symbol id="logo-symbol" viewBox="0 0 200 120">
                <!-- Montre/cadre -->
                <rect x="20" y="30" width="100" height="60" rx="20" ry="20" fill="url(#gradient1)" stroke="#2563eb" stroke-width="4" />
                <rect x="25" y="35" width="90" height="50" rx="15" ry="15" fill="white" />

                <!-- Visage bÃ©bÃ© -->
                <circle cx="70" cy="60" r="20" fill="white" stroke="#2563eb" stroke-width="3" />
                <path d="M70 45 Q75 40, 80 45" fill="none" stroke="#2563eb" stroke-width="2" stroke-linecap="round" />
                <circle cx="65" cy="55" r="2" fill="#2563eb" />
                <circle cx="75" cy="55" r="2" fill="#2563eb" />
                <path d="M65 65 Q70 70, 75 65" fill="none" stroke="#2563eb" stroke-width="2" stroke-linecap="round" />

                <!-- Bracelet -->
                <rect x="10" y="45" width="15" height="30" rx="7" ry="7" fill="url(#gradient2)" />
                <rect x="115" y="45" width="15" height="30" rx="7" ry="7" fill="url(#gradient2)" />

                <!-- Gradients -->
                <defs>
                    <linearGradient id="gradient1" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#8b5cf6;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="gradient2" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#ec4899;stop-opacity:1" />
                    </linearGradient>
                </defs>
            </symbol>
        </defs>
    </svg>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCPQpB3cYk2sgbOVQ8KLbU1Qj2U67D2rZ4",
            authDomain: "suivi-loan.firebaseapp.com",
            projectId: "suivi-loan",
            storageBucket: "suivi-loan.firebasestorage.app",
            messagingSenderId: "334984699415",
            appId: "1:334984699415:web:8b41abb9360d31efabc652"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        // Constantes et donnÃ©es de rÃ©fÃ©rence
        const FEEDING_GUIDE = {
            1: { volume: '5â€“10ml', frequency: '8â€“12 fois/24h', total: '40â€“120ml', comment: 'Estomac trÃ¨s petit, petites quantitÃ©s trÃ¨s frÃ©quentes' },
            2: { volume: '10â€“20ml', frequency: '8â€“12 fois/24h', total: '80â€“240ml', comment: 'Progression rapide, petites tÃ©tÃ©es frÃ©quentes' },
            3: { volume: '20â€“30ml', frequency: '8â€“10 fois/24h', total: '160â€“300ml', comment: 'BÃ©bÃ© commence Ã  boire plus rÃ©guliÃ¨rement' },
            4: { volume: '45â€“60ml', frequency: '6â€“8 fois/24h', total: '270â€“480ml', comment: 'Adaptation au lait, souvent nÃ©cessaire de complÃ©ter un peu' },
            5: { volume: '60â€“80ml', frequency: '6â€“8 fois/24h', total: '360â€“640ml', comment: 'Volumes plus importants, espacer les biberons' },
            6: { volume: '60â€“80ml', frequency: '6â€“8 fois/24h', total: '360â€“640ml', comment: 'Rot + massages si besoin, surveiller selles et couches' },
            7: { volume: '60â€“80ml', frequency: '6â€“8 fois/24h', total: '360â€“640ml', comment: 'Fin de premiÃ¨re semaine, rythme qui se stabilise' }
        };

        const FEEDING_RANGES = [
            { days: [8, 9, 10, 11, 12, 13, 14], volume: '60â€“90ml', frequency: '6â€“8 fois/24h', total: '360â€“720ml', comment: 'DeuxiÃ¨me semaine, augmentation progressive' },
            { days: [15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28], volume: '90â€“120ml', frequency: '6â€“7 fois/24h', total: '540â€“840ml', comment: 'TroisiÃ¨me et quatriÃ¨me semaines' }
        ];
        // Guide de sommeil par Ã¢ge (basÃ© sur le document fourni)
        const SLEEP_GUIDE = {
            "0-3": {
                title: "Nouveau-nÃ© (0-3 mois)",
                totalSleep: "16-18h par 24h",
                naps: "4-6 pÃ©riodes de sommeil",
                cycles: "50 minutes environ",
                tips: [
                    "Cycles courts avec sommeil agitÃ© normal",
                    "Pas de distinction jour/nuit au dÃ©but",
                    "Utiliser alternance lumiÃ¨re/obscuritÃ©",
                    "Coucher sur le dos obligatoire"
                ],
                warning: "Le rythme est dictÃ© par l'alimentation (2-4h)"
            },
            "3-6": {
                title: "Jeune nourrisson (3-6 mois)",
                totalSleep: "14-17h par 24h",
                naps: "3-4 siestes par jour",
                cycles: "Cycles s'allongent progressivement",
                tips: [
                    "Mise en place routine de coucher",
                    "DÃ©poser bÃ©bÃ© somnolent mais Ã©veillÃ©",
                    "Observer signes de fatigue prÃ©coces",
                    "Routine calme 20-30 minutes"
                ],
                warning: "Apprentissage de l'autonomie commence"
            },
            "6-12": {
                title: "Grand nourrisson (6-12 mois)",
                totalSleep: "12-15h par 24h",
                naps: "2-3 siestes (passage Ã  2 vers 9-12 mois)",
                cycles: "Cycles plus longs, consolidation nocturne",
                tips: [
                    "RÃ©gressions normales liÃ©es au dÃ©veloppement",
                    "Angoisse sÃ©paration vers 8 mois possible",
                    "Maintenir routine stable",
                    "Sevrage nocturne envisageable si >6kg"
                ],
                warning: "Les rÃ©gressions sont des signes de bon dÃ©veloppement"
            },
            "12-36": {
                title: "Tout-petit (12-36 mois)",
                totalSleep: "12-14h par 24h",
                naps: "2 siestes â†’ 1 sieste vers 18 mois",
                cycles: "Approche du sommeil adulte",
                tips: [
                    "Possibles terreurs nocturnes (ne pas rÃ©veiller)",
                    "Cauchemars (rassurer et laisser se rendormir)",
                    "Lit rÃ©servÃ© au sommeil uniquement",
                    "Pas d'Ã©crans avant 2 ans"
                ],
                warning: "Maintenir cadre ferme et cohÃ©rent"
            }
        };

        const FEEDING_MONTHS = {
            1: { volume: '120â€“150ml', frequency: '5â€“6 fois/24h', total: '600â€“900ml', comment: '1 mois - Volumes stabilisÃ©s' },
            2: { volume: '150â€“180ml', frequency: '5â€“6 fois/24h', total: '750â€“1080ml', comment: '2 mois - Croissance rÃ©guliÃ¨re' },
            3: { volume: '180â€“210ml', frequency: '5 fois/24h', total: '900â€“1050ml', comment: '3 mois - Rythme bien Ã©tabli' },
            4: { volume: '210ml env.', frequency: '4â€“5 fois/24h', total: '840â€“1050ml', comment: '4 mois - PrÃ©paration diversification' },
            5: { volume: '210â€“240ml', frequency: '4â€“5 fois/24h', total: '840â€“1200ml', comment: '5 mois - Possible dÃ©but diversification' },
            6: {
                volume: '180â€“210ml (avec repas)',
                frequency: '4 biberons/24h',
                total: '500ml minimum + laitages',
                comment: '6 mois - Diversification : introduction lÃ©gumes puis fruits'
            },
            7: {
                volume: '180â€“210ml (avec repas)',
                frequency: '4 biberons/24h',
                total: '500ml minimum + laitages',
                comment: '7 mois - Diversification active : lÃ©gumes variÃ©s, fruits en compote'
            },
            8: {
                volume: '150â€“180ml (en complÃ©ment)',
                frequency: '3â€“4 biberons/24h',
                total: '500ml minimum + laitages',
                comment: '8 mois - Introduction protÃ©ines (10g/j) et fÃ©culents'
            },
            9: {
                volume: '150â€“180ml (en complÃ©ment)',
                frequency: '3â€“4 biberons/24h',
                total: '500ml minimum + laitages',
                comment: '9 mois - Texture moins lisse, premiers morceaux fondants'
            },
            10: {
                volume: '150â€“180ml',
                frequency: '3 biberons/24h',
                total: '500ml minimum + laitages',
                comment: '10 mois - Tous fruits et lÃ©gumes, fromages pasteurisÃ©s'
            },
            11: {
                volume: '150â€“180ml',
                frequency: '3 biberons/24h',
                total: '500ml minimum + laitages',
                comment: '11 mois - Morceaux plus gros, apprentissage mastication'
            },
            12: {
                volume: '210â€“240ml',
                frequency: '2â€“3 biberons/24h',
                total: '500ml minimum',
                comment: '12 mois - Lait de croissance, alimentation diversifiÃ©e'
            },
            13: {
                volume: '210â€“240ml',
                frequency: '2â€“3 biberons/24h',
                total: '500ml minimum',
                comment: '13 mois - Repas comme la famille (adaptÃ©), 20g protÃ©ines'
            },
            14: {
                volume: '210â€“240ml',
                frequency: '2â€“3 biberons/24h',
                total: '500ml minimum',
                comment: '14 mois - Introduction miel possible, tous fromages'
            },
            15: {
                volume: '250â€“300ml',
                frequency: '2 biberons/24h',
                total: '500ml minimum',
                comment: '15 mois - Transition vers tasse, autonomie alimentaire'
            },
            18: {
                volume: '250â€“300ml',
                frequency: '2 biberons/24h',
                total: '500ml minimum',
                comment: '18 mois - ArrÃªt progressif biberon, lait de croissance jusqu\'Ã  3 ans'
            },
            24: {
                volume: '250ml (tasse/verre)',
                frequency: '2 prises/24h',
                total: '500ml minimum',
                comment: '24 mois - Lait en tasse, alimentation complÃ¨te comme famille'
            }
        };
        // Guide de diversification alimentaire
        const DIVERSIFICATION_GUIDE = {
            "4-6": {
                phase: "DÃ©couverte des saveurs (4-6 mois)",
                principles: [
                    "Le lait reste l'aliment principal",
                    "Un seul aliment nouveau Ã  la fois",
                    "Textures trÃ¨s lisses uniquement",
                    "Commencer par les lÃ©gumes au dÃ©jeuner"
                ],
                legumes: [
                    { nom: "Carotte", preparation: "Cuite et mixÃ©e", quantite: "1-2 c. Ã  cafÃ©" },
                    { nom: "Haricot vert", preparation: "Cuit et mixÃ©", quantite: "1-2 c. Ã  cafÃ©" },
                    { nom: "Courgette", preparation: "Sans pÃ©pins ni peau", quantite: "1-2 c. Ã  cafÃ©" },
                    { nom: "Potiron", preparation: "Chair uniquement", quantite: "1-2 c. Ã  cafÃ©" },
                    { nom: "Brocoli", preparation: "Fleurettes cuites", quantite: "1-2 c. Ã  cafÃ©" }
                ],
                fruits: [
                    { nom: "Pomme", preparation: "Cuite sans sucre", quantite: "1-2 c. Ã  cafÃ©" },
                    { nom: "Poire", preparation: "Cuite sans sucre", quantite: "1-2 c. Ã  cafÃ©" },
                    { nom: "Banane", preparation: "Bien mÃ»re Ã©crasÃ©e", quantite: "1-2 c. Ã  cafÃ©" }
                ],
                feculents: [],
                proteines: [],
                produits_laitiers: [],
                matieres_grasses: [],
                interdits: ["ProtÃ©ines", "FÃ©culents", "Sel", "Sucre", "Miel"]
            },
            "6-8": {
                phase: "Diversification active (6-8 mois)",
                principles: [
                    "Introduction des protÃ©ines et fÃ©culents",
                    "Textures moins lisses progressivement",
                    "10g de protÃ©ines maximum par jour",
                    "1 c. Ã  cafÃ© d'huile vÃ©gÃ©tale par repas"
                ],
                legumes: [
                    { nom: "Tous les prÃ©cÃ©dents", preparation: "PurÃ©e Ã©paisse â†’ Ã©crasÃ©s", quantite: "100-130g" },
                    { nom: "Ã‰pinard", preparation: "Bien cuits", quantite: "100-130g" },
                    { nom: "Blanc de poireau", preparation: "Partie blanche uniquement", quantite: "100-130g" },
                    { nom: "Petits pois", preparation: "Sans peau", quantite: "100-130g" }
                ],
                fruits: [
                    { nom: "PÃªche", preparation: "Sans peau, compote Ã©paisse", quantite: "60-80g" },
                    { nom: "Abricot", preparation: "Sans noyau, compote Ã©paisse", quantite: "60-80g" },
                    { nom: "Fruits prÃ©cÃ©dents", preparation: "Texture Ã©volutive", quantite: "60-80g" }
                ],
                feculents: [
                    { nom: "Pomme de terre", preparation: "PurÃ©e lisse", quantite: "MÃ©langÃ© aux lÃ©gumes" },
                    { nom: "Patate douce", preparation: "Bien cuite", quantite: "MÃ©langÃ© aux lÃ©gumes" },
                    { nom: "Riz", preparation: "TrÃ¨s cuit et mixÃ©", quantite: "MÃ©langÃ© aux lÃ©gumes" }
                ],
                proteines: [
                    { nom: "Viande blanche", preparation: "MixÃ©e fine, bien cuite", quantite: "10g (2 c. Ã  cafÃ©)" },
                    { nom: "Poisson blanc", preparation: "MixÃ© fin, sans arÃªtes", quantite: "10g (2 c. Ã  cafÃ©)" },
                    { nom: "Jaune d'Å“uf", preparation: "Å’uf dur mixÃ©", quantite: "1/4 d'Å“uf dur" }
                ],
                produits_laitiers: [
                    { nom: "Yaourt bÃ©bÃ©", preparation: "SpÃ©cifique bÃ©bÃ©", quantite: "1 pot" },
                    { nom: "Fromage blanc bÃ©bÃ©", preparation: "SpÃ©cifique bÃ©bÃ©", quantite: "1 pot" }
                ],
                matieres_grasses: [
                    { nom: "Huile vÃ©gÃ©tale", preparation: "Crue dans les purÃ©es", quantite: "1 c. Ã  cafÃ©/repas" }
                ],
                interdits: ["Sel", "Sucre", "Miel", "Charcuterie"]
            },
            "8-12": {
                phase: "Premiers morceaux (8-12 mois)",
                principles: [
                    "Introduction de tous les aliments",
                    "Morceaux fondants et Ã©crasÃ©s",
                    "DÃ©veloppement de la mastication",
                    "20g de protÃ©ines par jour"
                ],
                legumes: [
                    { nom: "Tous lÃ©gumes", preparation: "Ã‰crasÃ©s/petits morceaux fondants", quantite: "120-150g" },
                    { nom: "LÃ©gumes crus", preparation: "RÃ¢pÃ©s fins, bien mÃ»rs", quantite: "En petite quantitÃ©" }
                ],
                fruits: [
                    { nom: "Tous fruits", preparation: "Ã‰crasÃ©s/morceaux mÃ»rs et tendres", quantite: "80-100g" },
                    { nom: "Banane", preparation: "Morceaux fondants", quantite: "Libre" }
                ],
                feculents: [
                    { nom: "PÃ¢tes", preparation: "Petites/Ã©crasÃ©es, bien cuites", quantite: "Selon appÃ©tit" },
                    { nom: "Pain", preparation: "CroÃ»tons pour mastication", quantite: "Quelques morceaux" },
                    { nom: "CÃ©rÃ©ales", preparation: "Semoule, quinoa bien cuits", quantite: "Selon appÃ©tit" }
                ],
                proteines: [
                    { nom: "Viande rouge", preparation: "HachÃ©e, bien cuite", quantite: "20g" },
                    { nom: "Poisson gras", preparation: "Ã‰miettÃ©, 1 fois/semaine", quantite: "20g" },
                    { nom: "Å’uf entier", preparation: "Dur et hachÃ©", quantite: "1/2 Å“uf dur" }
                ],
                produits_laitiers: [
                    { nom: "Fromages Ã  pÃ¢te cuite", preparation: "Petits morceaux", quantite: "15g/jour" },
                    { nom: "Yaourt nature", preparation: "Non sucrÃ©", quantite: "1 pot" }
                ],
                matieres_grasses: [
                    { nom: "Huile vÃ©gÃ©tale", preparation: "Crue", quantite: "1 c. Ã  cafÃ©/repas" },
                    { nom: "Beurre", preparation: "Cru, en petite quantitÃ©", quantite: "1/2 c. Ã  cafÃ©" }
                ],
                interdits: ["Sel", "Sucre", "Miel", "Charcuterie", "Fruits Ã  coque entiers"]
            },
            "12+": {
                phase: "Alimentation de grand (12+ mois)",
                principles: [
                    "Alimentation comme la famille adaptÃ©e",
                    "Ã‰viter sel, sucre et miel avant 12 mois",
                    "20g de protÃ©ines par jour",
                    "Lait de croissance jusqu'Ã  3 ans"
                ],
                legumes: [
                    { nom: "Tous lÃ©gumes", preparation: "Normaux, comme la famille", quantite: "Selon appÃ©tit" }
                ],
                fruits: [
                    { nom: "Tous fruits", preparation: "Crus ou cuits", quantite: "Selon appÃ©tit" }
                ],
                feculents: [
                    { nom: "Tous fÃ©culents", preparation: "VariÃ©s", quantite: "Selon appÃ©tit" }
                ],
                proteines: [
                    { nom: "Toutes viandes", preparation: "CoupÃ©es, bien cuites", quantite: "20g" },
                    { nom: "Tous poissons", preparation: "Sans arÃªtes", quantite: "20g" },
                    { nom: "Å’uf", preparation: "Toutes cuissons", quantite: "1/2 Ã  1 Å“uf" }
                ],
                produits_laitiers: [
                    { nom: "Tous fromages au lait cru", preparation: "QualitÃ©", quantite: "20g/jour" },
                    { nom: "Lait de croissance", preparation: "Jusqu'Ã  3 ans", quantite: "500ml/jour" }
                ],
                matieres_grasses: [
                    { nom: "Toutes matiÃ¨res grasses", preparation: "VariÃ©es", quantite: "1 c. Ã  cafÃ©/repas" }
                ],
                nouveautes: [
                    { nom: "Miel", age: "12 mois", note: "Possible aprÃ¨s 1 an" },
                    { nom: "Fruits de mer", age: "12 mois", note: "Bien cuits" },
                    { nom: "Fruits Ã  coque", age: "12 mois", note: "En poudre ou purÃ©e" }
                ],
                interdits: ["Charcuterie grasse", "ExcÃ¨s de sel/sucre"]
            }
        };
        // Guide de motricitÃ© par Ã¢ge
        const MOTOR_DEVELOPMENT_GUIDE = {
            0: {
                title: 'La dÃ©couverte du corps (0-3 mois)',
                description: 'Mouvements principalement rÃ©flexes. Le bÃ©bÃ© travaille sur le renforcement de son cou et de son dos.',
                skills: [
                    'LÃ¨ve et tourne la tÃªte en position ventrale',
                    'Agite les bras et jambes de faÃ§on non coordonnÃ©e',
                    'Saisit des objets par rÃ©flexe d\'agrippement',
                    'Fixe du regard et suit des yeux'
                ],
                exercises: [
                    {
                        name: 'Tummy Time',
                        description: 'Placer bÃ©bÃ© sur le ventre sur un tapis',
                        duration: 'Commencer 2-3 minutes, augmenter progressivement',
                        benefits: 'Renforce cou, dos et Ã©paules',
                        safety: 'Toujours sous surveillance'
                    },
                    {
                        name: 'Massage doux',
                        description: 'Masser doucement bras et jambes',
                        duration: '5-10 minutes',
                        benefits: 'Stimule les muscles et la circulation',
                        safety: 'Mouvements trÃ¨s doux'
                    },
                    {
                        name: 'Jouets suspendus',
                        description: 'Portique d\'Ã©veil au-dessus de bÃ©bÃ©',
                        duration: '10-15 minutes',
                        benefits: 'Encourage Ã  lever la tÃªte et suivre du regard',
                        safety: 'Jouets bien fixÃ©s'
                    }
                ]
            },
            3: {
                title: 'Le contrÃ´le et le roulÃ©-boulÃ© (3-6 mois)',
                description: 'BÃ©bÃ© commence Ã  mieux contrÃ´ler ses mouvements et Ã  se dÃ©placer.',
                skills: [
                    'Se retourne du dos sur le ventre',
                    'Se redresse sur les bras en position ventrale',
                    'Saisit volontairement des objets',
                    'Porte les objets Ã  sa bouche'
                ],
                exercises: [
                    {
                        name: 'Encourager le retournement',
                        description: 'Placer un jouet sur le cÃ´tÃ© pour inciter Ã  se tourner',
                        duration: '5-10 minutes plusieurs fois/jour',
                        benefits: 'DÃ©veloppe force du tronc',
                        safety: 'Surface sÃ©curisÃ©e'
                    },
                    {
                        name: 'Position "avion"',
                        description: 'Tenir bÃ©bÃ© sur le ventre, lÃ©gÃ¨rement surÃ©levÃ©',
                        duration: '1-2 minutes',
                        benefits: 'Renforce muscles du dos et du cou',
                        safety: 'Tenir fermement'
                    },
                    {
                        name: 'Tapis d\'Ã©veil',
                        description: 'Jouets suspendus Ã  attraper',
                        duration: '15-20 minutes',
                        benefits: 'Coordination Å“il-main',
                        safety: 'Jouets adaptÃ©s Ã  l\'Ã¢ge'
                    }
                ]
            },
            6: {
                title: 'Le quatre pattes et la position assise (6-9 mois)',
                description: 'PÃ©riode d\'explosion motrice. BÃ©bÃ© devient mobile et explore activement.',
                skills: [
                    'S\'assied seul sans soutien',
                    'Commence Ã  ramper ou faire du quatre pattes',
                    'Se dÃ©place en roulant ou glissant',
                    'Utilise la pince pouce-index (motricitÃ© fine)'
                ],
                exercises: [
                    {
                        name: 'Espace sÃ©curisÃ© d\'exploration',
                        description: 'Zone avec coussins et jouets pour ramper',
                        duration: '30-45 minutes/jour',
                        benefits: 'DÃ©veloppe mobilitÃ© et confiance',
                        safety: 'SÃ©curiser l\'environnement'
                    },
                    {
                        name: 'Encourager le quatre pattes',
                        description: 'Placer jouet hors de portÃ©e pour motiver dÃ©placement',
                        duration: '10-15 minutes',
                        benefits: 'Coordination et force des membres',
                        safety: 'Objets sÃ©curisÃ©s'
                    },
                    {
                        name: 'Bouteille sensorielle',
                        description: 'Bouteille avec pÃ¢tes ou billes (fermÃ©e)',
                        duration: '10-15 minutes',
                        benefits: 'Stimulation auditive et manipulation',
                        safety: 'Bouteille bien fermÃ©e'
                    }
                ]
            },
            9: {
                title: 'Les premiers pas (9-12 mois)',
                description: 'BÃ©bÃ© se prÃ©pare Ã  la marche. Il cherche Ã  se hisser debout.',
                skills: [
                    'Se hisse debout en s\'appuyant sur les meubles',
                    'Se dÃ©place en "longeant" les meubles',
                    'Se tient debout sans soutien quelques secondes',
                    'Fait ses premiers pas'
                ],
                exercises: [
                    {
                        name: 'Jouets Ã  pousser',
                        description: 'Chariot de marche ou jouet Ã  pousser',
                        duration: '15-20 minutes',
                        benefits: 'Ã‰quilibre et confiance en marchant',
                        safety: 'Jouet stable et adaptÃ©'
                    },
                    {
                        name: 'Objets en hauteur',
                        description: 'Jouets sur canapÃ© bas pour se redresser',
                        duration: '10-15 minutes',
                        benefits: 'Force des jambes',
                        safety: 'Hauteur adaptÃ©e'
                    },
                    {
                        name: 'Marche accompagnÃ©e',
                        description: 'Tenir les deux mains et marcher ensemble',
                        duration: '5-10 minutes',
                        benefits: 'Confiance et Ã©quilibre',
                        safety: 'Ne pas forcer'
                    }
                ]
            },
            12: {
                title: 'La marche en toute confiance (12-18 mois)',
                description: 'BÃ©bÃ© devient un petit explorateur sur deux jambes.',
                skills: [
                    'Marche seul avec assurance',
                    'Monte et descend escaliers avec aide',
                    'S\'accroupit et se relÃ¨ve facilement',
                    'Lance une balle'
                ],
                exercises: [
                    {
                        name: 'Jeu du ballon',
                        description: 'Faire rouler un ballon pour encourager Ã  courir',
                        duration: '10-15 minutes',
                        benefits: 'Coordination et Ã©quilibre dynamique',
                        safety: 'Espace dÃ©gagÃ©'
                    },
                    {
                        name: 'Jeux de construction',
                        description: 'Blocs Ã  empiler et encastrer',
                        duration: '15-20 minutes',
                        benefits: 'MotricitÃ© fine et coordination',
                        safety: 'PiÃ¨ces adaptÃ©es Ã  l\'Ã¢ge'
                    },
                    {
                        name: 'Mini-parcours',
                        description: 'Coussins et tunnels Ã  franchir',
                        duration: '20-30 minutes',
                        benefits: 'Confiance motrice et exploration',
                        safety: 'Obstacles bas et sÃ»rs'
                    }
                ]
            },
            18: {
                title: 'Exploration et affinement (18-24 mois)',
                description: 'Perfectionnement des acquis et dÃ©veloppement de l\'agilitÃ©.',
                skills: [
                    'Court avec plus d\'assurance',
                    'Monte escaliers en alternant les pieds',
                    'Commence Ã  sauter sur place',
                    'Manipule objets avec prÃ©cision'
                ],
                exercises: [
                    {
                        name: 'Parcours d\'obstacles',
                        description: 'Slalom, marches, tunnels',
                        duration: '20-30 minutes',
                        benefits: 'AgilitÃ© et planification motrice',
                        safety: 'Supervision constante'
                    },
                    {
                        name: 'Jeux de prÃ©cision',
                        description: 'Enfiler grosses perles, puzzles simples',
                        duration: '10-15 minutes',
                        benefits: 'MotricitÃ© fine et concentration',
                        safety: 'PiÃ¨ces non avalables'
                    },
                    {
                        name: 'Danse et musique',
                        description: 'Bouger en rythme sur la musique',
                        duration: '10-15 minutes',
                        benefits: 'Coordination et expression corporelle',
                        safety: 'Espace libre'
                    }
                ]
            }
        };

        // Calendrier vaccinal franÃ§ais
        const VACCINE_SCHEDULE = {
            2: [
                { name: 'DTC-Polio-Hib (1Ã¨re injection)', required: true },
                { name: 'Pneumocoque (1Ã¨re injection)', required: true },
                { name: 'MÃ©ningocoque C (1Ã¨re injection)', required: true }
            ],
            4: [
                { name: 'DTC-Polio-Hib (2Ã¨me injection)', required: true },
                { name: 'Pneumocoque (2Ã¨me injection)', required: true }
            ],
            11: [
                { name: 'DTC-Polio-Hib (3Ã¨me injection)', required: true },
                { name: 'Pneumocoque (3Ã¨me injection)', required: true },
                { name: 'MÃ©ningocoque C (2Ã¨me injection)', required: true },
                { name: 'ROR (1Ã¨re injection)', required: true }
            ],
            12: [
                { name: 'HÃ©patite B (si pas fait Ã  la naissance)', required: false }
            ],
            16: [
                { name: 'ROR (2Ã¨me injection)', required: true }
            ]
        };
        const BabyTracker = () => {
            // Ã‰tats principaux
            const [user, setUser] = useState(null);
            const [entries, setEntries] = useState([]);
            const [medications, setMedications] = useState([]);
            const [appointments, setAppointments] = useState([]);
            const [stocks, setStocks] = useState({});
            // Ã‰tat pour le suivi du poids
            const [currentWeight, setCurrentWeight] = useState(null);
            const [lastWeightUpdate, setLastWeightUpdate] = useState(null);
            // Ã‰tat pour le suivi des vaccins
            const [vaccines, setVaccines] = useState([]);
            const [vaccineData, setVaccineData] = useState({
                name: '',
                date: '',
                nextDue: '',
                notes: ''
            });
            // Ã‰tat pour le suivi de la diversification alimentaire
            const [diversificationEntries, setDiversificationEntries] = useState([]);
            const [diversificationData, setDiversificationData] = useState({
                food: '',
                date: '',
                rating: 5,
                notes: ''
            });

            const [wardrobe, setWardrobe] = useState([]);
            const [wardrobeData, setWardrobeData] = useState({
                type: '',
                size: '',
                quantity: 1,
                notes: ''
            });
            // Ã‰tats pour le suivi du sommeil
            const [sleepSessions, setSleepSessions] = useState([]);
            const [currentSleep, setCurrentSleep] = useState(null); // Session en cours
            const [sleepData, setSleepData] = useState({
                startTime: '',
                endTime: '',
                date: new Date().toISOString().slice(0, 10)
            });
            // Ã‰tat pour le suivi de la croissance
            const [currentHeight, setCurrentHeight] = useState(null);
            const [lastHeightUpdate, setLastHeightUpdate] = useState(null);

            // Ã‰tats d'interface
            const [showAuth, setShowAuth] = useState(true);
            const [authMode, setAuthMode] = useState('login');
            const [currentView, setCurrentView] = useState('daily');
            const [periodView, setPeriodView] = useState('daily');
            const [showForm, setShowForm] = useState(false);
            const [formType, setFormType] = useState('');
            const [editingId, setEditingId] = useState(null);
            const [currentPage, setCurrentPage] = useState(0);
            const [historyFilter, setHistoryFilter] = useState('today');
            const [tipsExpanded, setTipsExpanded] = useState(0);
            const [showMoreMenu, setShowMoreMenu] = useState(false);
            const [showPlusMenu, setShowPlusMenu] = useState(false);
            const [editingWardrobeId, setEditingWardrobeId] = useState(null);
            const [editingSleepId, setEditingSleepId] = useState(null);
            // Ã‰tat pour le suivi des soins quotidiens
            const [dailyCare, setDailyCare] = useState(null); // null pendant le chargement
            // Ã‰tats des formulaires
            const [authData, setAuthData] = useState({
                code: '',
                babyName: '',
                birthDate: '',
                birthTime: '06:00',
                birthWeight: '',
                birthHeight: '',
                parents: '',
                gender: 'boy'
            });

            const [formData, setFormData] = useState({
                time: '',
                date: '',
                amount: '',
                hasPee: false,
                hasPoop: false,
                poopQuantity: '',
                poopConsistency: '',
                poopColor: ''
            });

            const [medicationData, setMedicationData] = useState({
                name: '',
                dosage: '',
                date: '',
                time: '',
                interval: ''
            });

            const [appointmentData, setAppointmentData] = useState({
                type: '',
                doctor: '',
                date: '',
                time: '',
                location: ''
            });
            // Etats pour les pÃ©diatres et hÃ´pitaux
            const [showExportMenu, setShowExportMenu] = useState(false);
            const [exportPeriod, setExportPeriod] = useState('week');
            const [isExporting, setIsExporting] = useState(false);

            //Etats pour les graphiques sommeil
            const [sleepPeriodView, setSleepPeriodView] = useState('week');
            const sleepChartRef = useRef(null);
            const sleepChartInstance = useRef(null);

            // Ã‰tats pour les notifications
            const [notificationPermission, setNotificationPermission] = useState('default');
            const [activeNotifications, setActiveNotifications] = useState([]);
            // Ajoutez ceci avec vos autres dÃ©clarations useState
            const [scheduledNotifications, setScheduledNotifications] = useState(new Map());




            // Demander la permission pour les notifications
            const requestNotificationPermission = async () => {
                if ('Notification' in window) {
                    const permission = await Notification.requestPermission();
                    setNotificationPermission(permission);
                    if (permission === 'granted') {
                        console.log('Notifications autorisÃ©es');
                        scheduleAllNotifications();
                    }
                    return permission === 'granted';
                }
                return false;
            };

            const scheduleAllNotifications = () => {
                if (notificationPermission !== 'granted') return;

                console.log('Programmation de toutes les notifications...');

                // Effacer les anciennes notifications
                clearAllNotifications();

                // Reprogrammer toutes les notifications
                scheduleNextFeedingNotification();
                scheduleMedicationNotifications();
                scheduleAppointmentNotifications();

                console.log(`${scheduledNotifications.size} notifications programmÃ©es`);
            };

            // Envoyer une notification immÃ©diate
            const sendNotification = (title, body) => {
                if (notificationPermission === 'granted' && 'Notification' in window) {
                    const notification = new Notification(title, {
                        body,
                        icon: 'logo.PNG',
                        badge: 'logo.PNG',
                        requireInteraction: false
                    });

                    notification.onclick = () => {
                        window.focus();
                        notification.close();
                    };

                    return notification;
                }
            };

            // Programmer une notification avec setTimeout
            const scheduleNotification = (title, body, delayMinutes, uniqueKey) => {
                if (notificationPermission !== 'granted') return null;

                // Annuler l'ancienne notification si elle existe
                if (scheduledNotifications.has(uniqueKey)) {
                    clearTimeout(scheduledNotifications.get(uniqueKey));
                }

                // Programmer la nouvelle notification
                const timeoutId = setTimeout(() => {
                    sendNotification(title, body);
                    // Nettoyer la rÃ©fÃ©rence
                    setScheduledNotifications(prev => {
                        const newMap = new Map(prev);
                        newMap.delete(uniqueKey);
                        return newMap;
                    });
                }, delayMinutes * 60 * 1000);

                // Stocker la rÃ©fÃ©rence
                setScheduledNotifications(prev => {
                    const newMap = new Map(prev);
                    newMap.set(uniqueKey, timeoutId);
                    return newMap;
                });

                console.log(`Notification programmÃ©e: ${title} dans ${delayMinutes} minutes`);
                return timeoutId;
            };

            // Annuler toutes les notifications
            const clearAllNotifications = () => {
                scheduledNotifications.forEach((timeoutId) => {
                    clearTimeout(timeoutId);
                });
                setScheduledNotifications(new Map());
            };// Notifications pour biberon
            const scheduleNextFeedingNotification = () => {
                if (notificationPermission !== 'granted') return;

                const nextFeeding = calculateNextFeeding();
                if (!nextFeeding) return;

                const now = new Date();
                const timeDiff = nextFeeding.nextTime - now;
                const minutesUntilFeeding = Math.ceil(timeDiff / (1000 * 60));

                // Seulement si c'est dans les prochaines 8 heures et pas dÃ©jÃ  passÃ©
                if (minutesUntilFeeding > 0 && minutesUntilFeeding <= 480) {
                    scheduleNotification(
                        'ðŸ¼ C\'est l\'heure du biberon !',
                        `Il est temps de donner le biberon Ã  ${user?.babyName}`,
                        minutesUntilFeeding,
                        'next-feeding'
                    );
                }
            };
            // Notifswitch (periodView) {ications pour mÃ©dicaments
            const scheduleMedicationNotifications = () => {
                if (notificationPermission !== 'granted') return;

                medications.forEach(medication => {
                    if (!medication.interval || !medication.lastGiven) return;

                    const lastGiven = new Date(medication.lastGiven);
                    const nextDue = new Date(lastGiven.getTime() + (medication.interval * 60 * 60 * 1000));
                    const now = new Date();
                    const minutesUntilDue = Math.ceil((nextDue - now) / (1000 * 60));

                    // Programmer si c'est dans les prochaines 24h
                    if (minutesUntilDue > 0 && minutesUntilDue <= 1440) {
                        scheduleNotification(
                            'ðŸ’Š MÃ©dicament Ã  donner',
                            `Il est temps de donner ${medication.name} (${medication.dosage})`,
                            minutesUntilDue,
                            `medication-${medication.id}`
                        );
                    }
                });
            };
            // Notifications pour rendez-vous
            const scheduleAppointmentNotifications = () => {
                if (notificationPermission !== 'granted') return;

                appointments.forEach(appointment => {
                    const appointmentTime = new Date(appointment.timestamp);
                    const now = new Date();
                    const minutesUntilAppointment = Math.ceil((appointmentTime - now) / (1000 * 60));

                    // Notification 1h avant (seulement si le RDV est dans plus d'1h)
                    if (minutesUntilAppointment > 60 && minutesUntilAppointment <= 1440) {
                        scheduleNotification(
                            'ðŸ“… Rendez-vous dans 1h',
                            `${appointment.type} avec ${appointment.doctor || 'le praticien'}`,
                            minutesUntilAppointment - 60,
                            `appointment-1h-${appointment.id}`
                        );
                    }

                    // Notification 15 min avant (seulement si le RDV est dans plus de 15min)
                    if (minutesUntilAppointment > 15 && minutesUntilAppointment <= 1440) {
                        scheduleNotification(
                            'ðŸš¨ Rendez-vous dans 15 min',
                            `${appointment.type} avec ${appointment.doctor || 'le praticien'}`,
                            minutesUntilAppointment - 15,
                            `appointment-15min-${appointment.id}`
                        );
                    }
                });
            };
            // Notifications pour vaccins
            const scheduleVaccineReminders = () => {
                const ageInMonths = Math.floor(calculateAge() / 30);

                Object.keys(VACCINE_SCHEDULE).forEach(monthKey => {
                    const month = parseInt(monthKey);
                    if (month === ageInMonths || month === ageInMonths + 1) {
                        VACCINE_SCHEDULE[month].forEach(vaccine => {
                            const isAlreadyDone = vaccines.some(v =>
                                v.name.includes(vaccine.name.split('(')[0].trim())
                            );

                            if (!isAlreadyDone && vaccine.required) {
                                // Notification pour rappel vaccin
                                scheduleNotification(
                                    'ðŸ’‰ Rappel vaccination',
                                    `Il est temps de programmer le vaccin : ${vaccine.name}`,
                                    60, // Dans 1h (pour test, ajustez selon besoin)
                                    `vaccine-${month}-${vaccine.name.replace(/\s+/g, '-')}`
                                );
                            }
                        });
                    }
                });
            };

            const chartRef = useRef(null);
            const chartInstance = useRef(null);

            // Fonctions utilitaires
            const generateCode = () => Math.random().toString(36).substring(2, 8).toUpperCase();
            const getCurrentTime = () => new Date().toTimeString().slice(0, 5);
            const getCurrentDate = () => new Date().toISOString().slice(0, 10);

            const calculateAge = () => {
                if (!user) return 0;
                const birth = new Date(user.birthDate);
                const today = new Date();
                return Math.floor((today - birth) / (1000 * 60 * 60 * 24));
            };

            const formatAgeDisplay = (ageInDays) => {
                if (ageInDays <= 30) {
                    return `Jour ${ageInDays}`;
                }

                const months = Math.floor(ageInDays / 30);
                const remainingDays = ageInDays % 30;

                if (remainingDays === 0) {
                    return `${months} mois`;
                } else {
                    return `${months} mois ${remainingDays}j`;
                }
            };

            const formatTime = (timestamp) => {
                return new Date(timestamp).toLocaleTimeString('fr-FR', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            };

            const formatDate = (timestamp) => {
                return new Date(timestamp).toLocaleDateString('fr-FR', {
                    weekday: 'long',
                    day: 'numeric',
                    month: 'long'
                });
            };

            const formatDateTime = (timestamp) => {
                const date = new Date(timestamp);
                const today = new Date();
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);

                if (date.toDateString() === today.toDateString()) {
                    return formatTime(timestamp);
                } else if (date.toDateString() === yesterday.toDateString()) {
                    return `Hier ${formatTime(timestamp)}`;
                } else {
                    return `${date.getDate()}/${date.getMonth() + 1} ${formatTime(timestamp)}`;
                }
            };

            const getDayStart = (date) => {
                const dayStart = new Date(date);
                dayStart.setHours(0, 0, 0, 0);
                return dayStart;
            };

            const getDayEnd = (date) => {
                const dayEnd = new Date(date);
                dayEnd.setHours(23, 59, 59, 999);
                return dayEnd;
            };

            // Fonction pour les couleurs selon le sexe
            const getThemeColors = () => {
                return user?.gender === 'girl' ? {
                    primary: 'from-pink-500 to-pink-600',
                    primaryBg: 'bg-pink-500',
                    primaryText: 'text-pink-600',
                    primaryBorder: 'border-pink-200',
                    primaryHover: 'hover:bg-pink-50',
                    primaryLight: 'bg-pink-100',
                    primaryDark: 'text-pink-800'
                } : {
                    primary: 'from-blue-500 to-blue-600',
                    primaryBg: 'bg-blue-500',
                    primaryText: 'text-blue-600',
                    primaryBorder: 'border-blue-200',
                    primaryHover: 'hover:bg-blue-50',
                    primaryLight: 'bg-blue-100',
                    primaryDark: 'text-blue-800'
                };
            };

            // Fonction pour obtenir les recommandations de diversification
            const getDiversificationRecommendations = (ageInDays) => {
                if (ageInDays < 120) { // < 4 mois
                    return {
                        phase: 'Pas encore',
                        message: 'La diversification commence gÃ©nÃ©ralement entre 4 et 6 mois. Le lait reste l\'aliment unique et complet.',
                        recommendation: 'Continuer l\'allaitement ou le biberon exclusivement'
                    };
                } else if (ageInDays < 150) { // 4-5 mois
                    return {
                        ...DIVERSIFICATION_GUIDE["4-6"],
                        phase: "DÃ©but de diversification (4-5 mois)",
                        note: "Phase d'initiation trÃ¨s progressive. PrivilÃ©gier les lÃ©gumes doux."
                    };
                } else if (ageInDays < 180) { // 5-6 mois  
                    return {
                        ...DIVERSIFICATION_GUIDE["4-6"],
                        phase: "Diversification confirmÃ©e (5-6 mois)",
                        note: "Ã‰largir progressivement la gamme de lÃ©gumes et fruits."
                    };
                } else if (ageInDays < 210) { // 6-7 mois
                    return {
                        ...DIVERSIFICATION_GUIDE["6-8"],
                        phase: "Introduction protÃ©ines (6-7 mois)",
                        note: "Commencer les protÃ©ines (viande, poisson, Å“uf) et fÃ©culents."
                    };
                } else if (ageInDays < 240) { // 7-8 mois
                    return {
                        ...DIVERSIFICATION_GUIDE["6-8"],
                        phase: "Textures Ã©volutives (7-8 mois)",
                        note: "Passage aux textures moins lisses, morceaux fondants."
                    };
                } else if (ageInDays < 300) { // 8-10 mois
                    return {
                        ...DIVERSIFICATION_GUIDE["8-12"],
                        phase: "Morceaux et mastication (8-10 mois)",
                        note: "DÃ©veloppement de la mastication, morceaux plus gros."
                    };
                } else if (ageInDays < 365) { // 10-12 mois
                    return {
                        ...DIVERSIFICATION_GUIDE["8-12"],
                        phase: "Alimentation familiale (10-12 mois)",
                        note: "PrÃ©paration Ã  l'alimentation familiale adaptÃ©e."
                    };
                } else {
                    return DIVERSIFICATION_GUIDE["12+"];
                }
            };
            // Fonction pour obtenir le guide de motricitÃ©
            const getMotorDevelopmentForAge = (ageInDays) => {
                const ageInMonths = Math.floor(ageInDays / 30);

                if (ageInMonths < 3) {
                    return MOTOR_DEVELOPMENT_GUIDE[0];
                } else if (ageInMonths >= 3 && ageInMonths < 6) {
                    return MOTOR_DEVELOPMENT_GUIDE[3];
                } else if (ageInMonths >= 6 && ageInMonths < 9) {
                    return MOTOR_DEVELOPMENT_GUIDE[6];
                } else if (ageInMonths >= 9 && ageInMonths < 12) {
                    return MOTOR_DEVELOPMENT_GUIDE[9];
                } else if (ageInMonths >= 12 && ageInMonths < 18) {
                    return MOTOR_DEVELOPMENT_GUIDE[12];
                } else {
                    return MOTOR_DEVELOPMENT_GUIDE[18];
                }
            };
            // Fonctions d'alimentation
            const getFeedingRecommendations = (ageInDays) => {
                if (FEEDING_GUIDE[ageInDays]) {
                    return FEEDING_GUIDE[ageInDays];
                }

                for (const range of FEEDING_RANGES) {
                    if (range.days.includes(ageInDays)) {
                        return {
                            volume: range.volume,
                            frequency: range.frequency,
                            total: range.total,
                            comment: range.comment
                        };
                    }
                }

                if (ageInDays >= 29) {
                    const ageInMonths = Math.floor(ageInDays / 30);

                    // Chercher d'abord une correspondance exacte
                    if (FEEDING_MONTHS[ageInMonths]) {
                        return FEEDING_MONTHS[ageInMonths];
                    }

                    // Puis chercher la tranche la plus proche
                    const availableMonths = Object.keys(FEEDING_MONTHS).map(m => parseInt(m)).sort((a, b) => a - b);
                    let closestMonth = availableMonths[availableMonths.length - 1]; // Par dÃ©faut le plus Ã©levÃ©

                    for (const month of availableMonths) {
                        if (ageInMonths <= month) {
                            closestMonth = month;
                            break;
                        }
                    }

                    return FEEDING_MONTHS[closestMonth];
                }

                return null;
            };
            const getDefaultAmount = (volumeRange) => {
                const ranges = volumeRange.match(/(\d+)(?:â€“(\d+))?/);
                if (!ranges) return null;

                const min = parseInt(ranges[1]);
                const max = ranges[2] ? parseInt(ranges[2]) : min;

                const average = Math.round((min + max) / 2);
                return Math.round(average / 5) * 5;
            };

            const calculateMilkByWeight = (weightKg, ageInDays) => {
                if (!weightKg || weightKg <= 0) return null;

                // Calcul de base : 150ml par kg de poids par jour
                const baseMilk = Math.round(weightKg * 150);

                // Nombre de biberons selon l'Ã¢ge
                let feedingsPerDay;
                if (ageInDays <= 30) feedingsPerDay = 6;
                else if (ageInDays <= 60) feedingsPerDay = 5;
                else if (ageInDays <= 120) feedingsPerDay = 5;
                else if (ageInDays <= 150) feedingsPerDay = 4;
                else if (ageInDays <= 240) feedingsPerDay = 4;
                else feedingsPerDay = 3;

                const mlPerFeeding = Math.round(baseMilk / feedingsPerDay);

                return {
                    totalPerDay: baseMilk,
                    feedingsPerDay,
                    mlPerFeeding,
                    weightUsed: weightKg
                };
            };
            // Calcul du prochain biberon
            const calculateNextFeeding = () => {
                const age = calculateAge();
                const now = new Date();
                const dayStart = getDayStart(now);
                const dayEnd = getDayEnd(now);

                const todayFeedings = entries.filter(entry => {
                    const entryDate = new Date(entry.timestamp);
                    return entry.type === 'feeding' && entryDate >= dayStart && entryDate <= dayEnd;
                });

                if (todayFeedings.length === 0) {
                    return null;
                }

                todayFeedings.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                const lastFeeding = todayFeedings[0];
                const lastFeedingTime = new Date(lastFeeding.timestamp);

                let intervalMinutes;
                if (age <= 7) {
                    intervalMinutes = 180; // 3h (modifiÃ© de 2h30)
                } else if (age <= 14) {
                    intervalMinutes = 180; // 3h
                } else if (age <= 30) {
                    intervalMinutes = 210; // 3h30
                } else if (age <= 60) {
                    intervalMinutes = 240; // 4h
                } else if (age <= 120) {
                    intervalMinutes = 270; // 4h30
                } else {
                    intervalMinutes = 300; // 5h
                }

                const nextFeeding = new Date(lastFeedingTime);
                nextFeeding.setMinutes(nextFeeding.getMinutes() + intervalMinutes);

                return {
                    nextTime: nextFeeding,
                    lastFeeding: lastFeedingTime,
                    intervalMinutes: intervalMinutes,
                    intervalHours: intervalMinutes / 60,
                    age: age
                };
            };

            // Calculs statistiques
            const getFilteredEntries = (period) => {
                const now = new Date();
                let startDate, endDate;

                switch (period) {
                    case 'daily':
                        startDate = getDayStart(now);
                        endDate = getDayEnd(now);
                        break;
                    case 'weekly':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 7);
                        endDate = new Date(now);
                        break;
                    case 'monthly':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 30);
                        endDate = new Date(now);
                        break;
                    default:
                        return [];
                }

                return entries.filter(entry => {
                    const entryDate = new Date(entry.timestamp);
                    return entryDate >= startDate && entryDate <= endDate;
                });
            };

            const getStats = (period) => {
                const now = new Date();
                let startDate, endDate;

                switch (period) {
                    case 'daily':
                        startDate = getDayStart(now);
                        endDate = getDayEnd(now);
                        break;
                    case 'weekly':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 7);
                        startDate.setHours(0, 0, 0, 0);
                        endDate = getDayEnd(now);
                        break;
                    case 'monthly':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 30);
                        startDate.setHours(0, 0, 0, 0);
                        endDate = getDayEnd(now);
                        break;
                    default:
                        return { totalMilk: 0, totalPees: 0, totalPoops: 0, feedingCount: 0 };
                }

                const filteredEntries = entries.filter(entry => {
                    const entryDate = new Date(entry.timestamp);
                    return entryDate >= startDate && entryDate <= endDate;
                });

                const feedings = filteredEntries.filter(entry => entry.type === 'feeding');
                const totalMilk = feedings.reduce((sum, entry) => sum + parseInt(entry.amount || 0), 0);
                const totalPees = filteredEntries.filter(entry => entry.hasPee).length;
                const totalPoops = filteredEntries.filter(entry => entry.hasPoop).length;

                return { totalMilk, totalPees, totalPoops, feedingCount: feedings.length };
            };
            // Filtrage de l'historique avec pagination
            const getFilteredHistory = () => {
                const now = new Date();
                let startDate, endDate;

                switch (historyFilter) {
                    case 'today':
                        startDate = getDayStart(now);
                        endDate = getDayEnd(now);
                        break;
                    case 'yesterday':
                        const yesterday = new Date(now);
                        yesterday.setDate(yesterday.getDate() - 1);
                        startDate = getDayStart(yesterday);
                        endDate = getDayEnd(yesterday);
                        break;
                    case 'week':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 7);
                        startDate.setHours(0, 0, 0, 0);
                        endDate = getDayEnd(now);
                        break;
                    default:
                        startDate = new Date(0);
                        endDate = new Date();
                }

                // Filtrer les entrÃ©es normales (biberon, couche)
                const filteredEntries = entries.filter(entry => {
                    const entryDate = new Date(entry.timestamp);
                    return entryDate >= startDate && entryDate <= endDate;
                });

                // Filtrer les sessions de sommeil terminÃ©es
                const filteredSleep = sleepSessions.filter(session => {
                    if (!session.startTime || session.status !== 'completed') return false;
                    const sessionDate = new Date(session.startTime);
                    return sessionDate >= startDate && sessionDate <= endDate;
                }).map(session => ({
                    ...session,
                    type: 'sleep',
                    timestamp: session.startTime
                }));

                console.log('Sessions de sommeil filtrÃ©es:', filteredSleep); // Debug
                console.log('EntrÃ©es normales:', filteredEntries.length);
                console.log('Sessions sommeil:', filteredSleep.length);
                console.log('Total combinÃ©:', [...filteredEntries, ...filteredSleep].length);

                return [...filteredEntries, ...filteredSleep].sort((a, b) =>
                    new Date(b.timestamp) - new Date(a.timestamp)
                );
                // Combiner et trier par timestamp (plus rÃ©cent en premier)
                return [...filteredEntries, ...filteredSleep].sort((a, b) =>
                    new Date(b.timestamp) - new Date(a.timestamp)
                );
            };
            // VÃ©rification connexion au chargement
            useEffect(() => {
                const savedCode = localStorage.getItem('familyCode');
                if (savedCode) {
                    setAuthData(prev => ({ ...prev, code: savedCode }));
                    handleLogin(savedCode);
                }

            }, []);


            // Ã‰coute des donnÃ©es Firebase
            useEffect(() => {
                if (!user) return;

                const familyCode = user.code;
                const unsubscribers = [];

                // Ã‰coute des entrÃ©es filtrÃ©es par famille
                const entriesUnsubscribe = db.collection('entries')
                    .where('familyCode', '==', familyCode)
                    .orderBy('timestamp', 'desc')
                    .onSnapshot((snapshot) => {
                        const entriesData = [];
                        snapshot.forEach((doc) => {
                            entriesData.push({ id: doc.id, ...doc.data() });
                        });
                        setEntries(entriesData);
                        localStorage.setItem('babyTrackerEntries', JSON.stringify(entriesData));
                    });
                unsubscribers.push(entriesUnsubscribe);

                // Ã‰coute des mÃ©dicaments filtrÃ©s par famille
                const medicationsUnsubscribe = db.collection('medications')
                    .where('familyCode', '==', familyCode)
                    .orderBy('timestamp', 'desc')
                    .onSnapshot((snapshot) => {
                        const medicationsData = [];
                        snapshot.forEach((doc) => {
                            medicationsData.push({ id: doc.id, ...doc.data() });
                        });
                        setMedications(medicationsData);
                    });
                unsubscribers.push(medicationsUnsubscribe);

                // Ã‰coute des rendez-vous filtrÃ©s par famille
                const appointmentsUnsubscribe = db.collection('appointments')
                    .where('familyCode', '==', familyCode)
                    .orderBy('timestamp', 'desc')
                    .onSnapshot((snapshot) => {
                        const appointmentsData = [];
                        snapshot.forEach((doc) => {
                            appointmentsData.push({ id: doc.id, ...doc.data() });
                        });
                        setAppointments(appointmentsData);
                    });
                unsubscribers.push(appointmentsUnsubscribe);

                // Ã‰coute des stocks filtrÃ©s par famille
                const stocksUnsubscribe = db.collection('stocks')
                    .where('familyCode', '==', familyCode)
                    .onSnapshot((snapshot) => {
                        const stocksData = {};
                        snapshot.forEach((doc) => {
                            const data = doc.data();
                            stocksData[data.type] = data;
                        });
                        setStocks(stocksData);
                    });
                unsubscribers.push(stocksUnsubscribe);

                // Ã‰coute des vaccins filtrÃ©s par famille
                const vaccinesUnsubscribe = db.collection('vaccines')
                    .where('familyCode', '==', familyCode)
                    .orderBy('timestamp', 'desc')
                    .onSnapshot((snapshot) => {
                        const vaccinesData = [];
                        snapshot.forEach((doc) => {
                            vaccinesData.push({ id: doc.id, ...doc.data() });
                        });
                        setVaccines(vaccinesData);
                    });
                unsubscribers.push(vaccinesUnsubscribe);

                // Ã‰coute de la diversification filtrÃ©e par famille
                const diversificationUnsubscribe = db.collection('diversification')
                    .where('familyCode', '==', familyCode)
                    .orderBy('timestamp', 'desc')
                    .onSnapshot((snapshot) => {
                        const diversificationData = [];
                        snapshot.forEach((doc) => {
                            diversificationData.push({ id: doc.id, ...doc.data() });
                        });
                        setDiversificationEntries(diversificationData);
                    });
                unsubscribers.push(diversificationUnsubscribe);

                // Ã‰coute de la garde-robe filtrÃ©e par famille
                const wardrobeUnsubscribe = db.collection('wardrobe')
                    .where('familyCode', '==', familyCode)
                    .orderBy('timestamp', 'desc')
                    .onSnapshot((snapshot) => {
                        const wardrobeData = [];
                        snapshot.forEach((doc) => {
                            wardrobeData.push({ id: doc.id, ...doc.data() });
                        });
                        setWardrobe(wardrobeData);
                    });

                // Ã‰coute du sommeil filtrÃ© par famille
                const sleepUnsubscribe = db.collection('sleep_sessions')
                    .where('familyCode', '==', familyCode)
                    .onSnapshot((snapshot) => {
                        const sleepData = [];
                        let ongoingSession = null;

                        snapshot.forEach((doc) => {
                            const sessionData = { id: doc.id, ...doc.data() };
                            sleepData.push(sessionData);

                            if (sessionData.status === 'ongoing') {
                                ongoingSession = sessionData;
                            }
                        });

                        // Trier cÃ´tÃ© client
                        sleepData.sort((a, b) => new Date(b.timestamp || b.startTime) - new Date(a.timestamp || a.startTime));

                        console.log('Sessions chargÃ©es depuis Firebase:', sleepData);
                        setSleepSessions(sleepData);
                        setCurrentSleep(ongoingSession);
                    });
                unsubscribers.push(sleepUnsubscribe);
                unsubscribers.push(wardrobeUnsubscribe);
                return () => {
                    unsubscribers.forEach(unsubscribe => unsubscribe());
                };
            }, [user]);
            // Mise Ã  jour du graphique
            useEffect(() => {
                if (currentView === 'daily' && chartRef.current && entries.length > 0) {
                    updateChart();
                }
            }, [entries, currentView, periodView]);
            // Mise Ã  jour du graphique sommeil
            useEffect(() => {
                if (currentView === 'sleep-tracker' && sleepChartRef.current && sleepSessions.length > 0) {
                    updateSleepChart();
                }
            }, [sleepSessions, currentView, sleepPeriodView]);
            // Fermer le menu "Plus" quand on clique ailleurs
            useEffect(() => {
                const handleClickOutside = (event) => {
                    // VÃ©rifier si le clic est en dehors des menus
                    const isOutsideMoreMenu = !event.target.closest('.relative') ||
                        !event.target.closest('[data-menu="more"]');
                    const isOutsidePlusMenu = !event.target.closest('[data-menu="plus"]');

                    if (showMoreMenu && isOutsideMoreMenu) {
                        setShowMoreMenu(false);
                    }
                    if (showPlusMenu && isOutsidePlusMenu) {
                        setShowPlusMenu(false);
                    }
                };

                document.addEventListener('mousedown', handleClickOutside);
                return () => {
                    document.removeEventListener('mousedown', handleClickOutside);
                };
            }, [showMoreMenu, showPlusMenu]);
            // Mise Ã  jour automatique du prochain biberon
            useEffect(() => {
                if (currentView !== 'daily') return;

                // VÃ©rifier le statut des soins au chargement
                checkCareStatus();

                // Mettre Ã  jour toutes les minutes
                const interval = setInterval(() => {
                    checkCareStatus();
                    // Forcer le re-rendu pour mettre Ã  jour les temps affichÃ©s
                    setCurrentView(prevView => prevView);
                }, 60000); // 60 secondes

                return () => clearInterval(interval);
            }, [currentView, user, entries]);

            // Charger les soins depuis Firebase
            // Charger les soins depuis Firebase
            useEffect(() => {
                if (!user) return;

                const today = getCurrentDate();

                // Ã‰couter les changements en temps rÃ©el
                const unsubscribe = db.collection('daily_care')
                    .doc(`${user.code}_${today}`)
                    .onSnapshot(async (doc) => {
                        if (doc.exists) {
                            const data = doc.data();

                            // VÃ©rifier que les donnÃ©es sont bien du jour actuel
                            if (data.date === today) {
                                console.log('Chargement soins du jour:', data.care);
                                setDailyCare(data.care);
                            } else {
                                // DonnÃ©es d'un autre jour, rÃ©initialiser
                                console.log('RÃ©initialisation des soins pour nouveau jour');
                                const freshCare = {
                                    cordon: {
                                        active: data.care?.cordon?.active ?? true,
                                        morning_done: false,
                                        evening_done: false,
                                        last_updated: null
                                    },
                                    visage: { done: false, last_updated: null },
                                    vitamines: { done: false, last_updated: null }
                                };
                                setDailyCare(freshCare);
                                await saveDailyCareToFirebase(freshCare, today);
                            }
                        } else {
                            // Aucune donnÃ©e pour aujourd'hui, crÃ©er l'initial
                            console.log('CrÃ©ation initiale des soins');
                            const initialCare = {
                                cordon: {
                                    active: true,
                                    morning_done: false,
                                    evening_done: false,
                                    last_updated: null
                                },
                                visage: { done: false, last_updated: null },
                                vitamines: { done: false, last_updated: null }
                            };
                            setDailyCare(initialCare);
                            await saveDailyCareToFirebase(initialCare, today);
                        }
                    }, (error) => {
                        console.error('Erreur chargement soins:', error);
                    });

                return () => unsubscribe();
            }, [user]);
            // Initialiser les notifications
            useEffect(() => {
                if ('Notification' in window) {
                    setNotificationPermission(Notification.permission);

                    // Si dÃ©jÃ  autorisÃ©, programmer les notifications
                    if (Notification.permission === 'granted' && user) {
                        scheduleAllNotifications();
                    }
                }
            }, []);

            // Reprogrammer quand les donnÃ©es changent
            useEffect(() => {
                if (notificationPermission === 'granted' && user) {
                    scheduleAllNotifications();
                }
            }, [user, entries, medications, appointments, notificationPermission]);

            // Cleanup au dÃ©montage
            useEffect(() => {
                return () => {
                    clearAllNotifications();
                };
            }, []);
            // Reprogrammer les notifications quand une nouvelle entrÃ©e est ajoutÃ©e
            useEffect(() => {
                if (notificationPermission === 'granted' && user) {
                    // Attendre un peu pour que les donnÃ©es soient mises Ã  jour
                    setTimeout(() => {
                        scheduleNextFeedingNotification();
                    }, 1000);
                }
            }, [entries.length]);

            // VÃ©rifier permission au chargement
            useEffect(() => {
                if ('Notification' in window) {
                    setNotificationPermission(Notification.permission);
                }
            }, []);
           
           useEffect(() => {
        // DÃ©tection iOS pour les notifications
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        
        if (isIOS) {
            // Message spÃ©cifique pour iOS
            console.log('iOS dÃ©tectÃ© - PWA mode');
            
            // VÃ©rifier si l'app est en mode PWA
            const isStandalone = window.navigator.standalone === true;
            if (!isStandalone) {
                // SuggÃ©rer d'ajouter Ã  l'Ã©cran d'accueil aprÃ¨s 5 secondes
                setTimeout(() => {
                    if (window.confirm('Pour une meilleure expÃ©rience, ajoutez BabyTrack Ã  votre Ã©cran d\'accueil !')) {
                        alert('Appuyez sur le bouton Partager puis "Sur l\'Ã©cran d\'accueil"');
                    }
                }, 5000);
            }
        }
    }, []);
            // Authentification
            const handleCreateAccount = async () => {
                const { babyName, birthDate, birthTime, birthWeight, birthHeight, parents, gender } = authData;

                if (!babyName || !birthDate) {
                    alert('Nom du bÃ©bÃ© et date de naissance obligatoires');
                    return;
                }

                const familyCode = generateCode();
                const familyData = {
                    code: familyCode,
                    babyName,
                    birthDate,
                    birthTime: birthTime || '06:00',
                    birthWeight: parseFloat(birthWeight) || 3.290,
                    birthHeight: parseInt(birthHeight) || 48,
                    parents: parents || 'Papa & Maman',
                    gender: gender,
                    createdAt: new Date().toISOString()
                };

                try {
                    await db.collection('families').doc(familyCode).set(familyData);
                    alert(`Famille crÃ©Ã©e avec succÃ¨s!\n\nCode famille: ${familyCode}\n\nNotez bien ce code!`);

                    setUser(familyData);
                    localStorage.setItem('familyCode', familyCode);
                    setShowAuth(false);
                } catch (error) {
                    console.error('Erreur crÃ©ation:', error);
                    alert('Erreur lors de la crÃ©ation du compte');
                }
            };

            const handleLogin = async (code = authData.code) => {
                if (!code || code.length !== 6) {
                    alert('Code famille invalide (6 caractÃ¨res requis)');
                    return;
                }

                try {
                    console.log('Tentative de connexion avec le code:', code.toUpperCase());

                    const doc = await db.collection('families').doc(code.toUpperCase()).get();

                    if (doc.exists) {
                        const userData = doc.data();
                        console.log('DonnÃ©es utilisateur trouvÃ©es:', userData);

                        setUser(userData);

                        // Charger le poids et la taille sauvegardÃ©s
                        if (userData.currentWeight) {
                            setCurrentWeight(userData.currentWeight);
                            console.log('Poids chargÃ©:', userData.currentWeight);
                        }
                        if (userData.lastWeightUpdate) {
                            setLastWeightUpdate(userData.lastWeightUpdate);
                        }
                        if (userData.currentHeight) {
                            setCurrentHeight(userData.currentHeight);
                        }
                        if (userData.lastHeightUpdate) {
                            setLastHeightUpdate(userData.lastHeightUpdate);
                        }

                        localStorage.setItem('familyCode', code.toUpperCase());
                        setShowAuth(false);
                        console.log('Connexion rÃ©ussie');
                    } else {
                        console.log('Code famille introuvable dans la base');
                        alert('Code famille introuvable. VÃ©rifiez le code ou crÃ©ez un nouveau compte.');
                    }
                } catch (error) {
                    console.error('Erreur connexion dÃ©taillÃ©e:', error);

                    if (error.code === 'permission-denied') {
                        alert('Erreur de permissions Firebase. VÃ©rifiez la configuration.');
                    } else if (error.code === 'unavailable') {
                        alert('Service Firebase temporairement indisponible. RÃ©essayez dans quelques instants.');
                    } else if (error.code === 'failed-precondition') {
                        alert('Configuration Firebase incomplÃ¨te.');
                    } else {
                        alert(`Erreur de connexion: ${error.message || 'Erreur inconnue'}`);
                    }
                }
            };
            // Fonctions d'exportation
            const exportToCSV = async () => {
                setIsExporting(true);

                try {
                    // DÃ©terminer la pÃ©riode
                    const now = new Date();
                    let startDate, endDate;

                    switch (exportPeriod) {
                        case 'day':
                            startDate = getDayStart(now);
                            endDate = getDayEnd(now);
                            break;
                        case 'week':
                            startDate = new Date(now);
                            startDate.setDate(startDate.getDate() - 7);
                            startDate.setHours(0, 0, 0, 0);
                            endDate = getDayEnd(now);
                            break;
                        case 'month':
                            startDate = new Date(now);
                            startDate.setDate(startDate.getDate() - 30);
                            startDate.setHours(0, 0, 0, 0);
                            endDate = getDayEnd(now);
                            break;
                    }

                    // Filtrer les donnÃ©es
                    const exportEntries = entries.filter(entry => {
                        const entryDate = new Date(entry.timestamp);
                        return entryDate >= startDate && entryDate <= endDate;
                    });

                    const exportSleep = sleepSessions.filter(session => {
                        const sessionDate = new Date(session.startTime);
                        return session.status === 'completed' && sessionDate >= startDate && sessionDate <= endDate;
                    });

                    // CrÃ©er le CSV
                    let csvContent = 'Date,Heure,Type,DÃ©tails,Notes\n';

                    // Ajouter les biberons et changes
                    exportEntries.forEach(entry => {
                        const date = new Date(entry.timestamp).toLocaleDateString('fr-FR');
                        const time = new Date(entry.timestamp).toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });

                        if (entry.type === 'feeding') {
                            csvContent += `${date},${time},Biberon,${entry.amount}ml,\n`;
                        } else if (entry.type === 'diaper') {
                            const details = [];
                            if (entry.hasPee) details.push('Pipi');
                            if (entry.hasPoop) {
                                let poopDetails = 'Caca';
                                if (entry.poopQuantity) poopDetails += ` (${entry.poopQuantity})`;
                                if (entry.poopConsistency) poopDetails += ` - ${entry.poopConsistency}`;
                                if (entry.poopColor) poopDetails += ` - ${entry.poopColor}`;
                                details.push(poopDetails);
                            }
                            csvContent += `${date},${time},Change,"${details.join(' + ')}",\n`;
                        }
                    });

                    // Ajouter les sessions de sommeil
                    exportSleep.forEach(session => {
                        const startDate = new Date(session.startTime).toLocaleDateString('fr-FR');
                        const startTime = new Date(session.startTime).toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
                        const endTime = new Date(session.endTime).toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
                        const duration = formatSleepDuration(session.duration);

                        csvContent += `${startDate},${startTime},Sommeil,"${startTime} â†’ ${endTime} (${duration})",\n`;
                    });

                    // Ajouter les mÃ©dicaments
                    medications.forEach(med => {
                        const date = new Date(med.timestamp).toLocaleDateString('fr-FR');
                        const time = new Date(med.timestamp).toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
                        csvContent += `${date},${time},MÃ©dicament,"${med.name} - ${med.dosage}",\n`;
                    });

                    // TÃ©lÃ©charger le fichier
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    const url = URL.createObjectURL(blob);
                    link.setAttribute('href', url);
                    link.setAttribute('download', `BabyTrack_${user.babyName}_${exportPeriod}_${new Date().toISOString().slice(0, 10)}.csv`);
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);

                    setShowExportMenu(false);
                } catch (error) {
                    console.error('Erreur export CSV:', error);
                    alert('Erreur lors de l\'export CSV');
                } finally {
                    setIsExporting(false);
                }
            };

            const exportToPDF = async () => {
                setIsExporting(true);

                try {
                    const stats = getStats(exportPeriod === 'day' ? 'daily' : exportPeriod === 'week' ? 'weekly' : 'monthly');

                    const now = new Date();
                    let startDate, endDate, periodLabel;
                    switch (exportPeriod) {
                        case 'day':
                            startDate = getDayStart(now);
                            endDate = getDayEnd(now);
                            periodLabel = 'Aujourd\'hui';
                            break;
                        case 'week':
                            startDate = new Date(now);
                            startDate.setDate(startDate.getDate() - 7);
                            endDate = getDayEnd(now);
                            periodLabel = '7 derniers jours';
                            break;
                        case 'month':
                            startDate = new Date(now);
                            startDate.setDate(startDate.getDate() - 30);
                            endDate = getDayEnd(now);
                            periodLabel = '30 derniers jours';
                            break;
                    }

                    const exportEntries = entries.filter(entry => {
                        const entryDate = new Date(entry.timestamp);
                        return entryDate >= startDate && entryDate <= endDate;
                    });

                    // CrÃ©er un contenu texte structurÃ© et professionnel
                    let content = '';
                    content += 'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n';
                    content += 'â•‘                    BABYTRACK                         â•‘\n';
                    content += 'â•‘                RAPPORT DE SUIVI                      â•‘\n';
                    content += 'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n';

                    content += 'INFORMATIONS GÃ‰NÃ‰RALES\n';
                    content += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';
                    content += 'BÃ©bÃ©:     ' + user.babyName + '\n';
                    content += 'Parents:  ' + user.parents + '\n';
                    content += 'Ã‚ge:      ' + formatAgeDisplay(calculateAge()) + '\n';
                    content += 'Poids:    ' + (currentWeight || user.birthWeight) + 'kg\n';
                    content += 'Taille:   ' + (currentHeight || user.birthHeight) + 'cm\n';
                    content += 'PÃ©riode:  ' + periodLabel + '\n';
                    content += 'Date:     ' + new Date().toLocaleDateString('fr-FR') + '\n\n';

                    content += 'STATISTIQUES\n';
                    content += 'â”â”â”â”â”â”â”â”â”â”â”â”\n';
                    content += 'â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n';
                    content += 'â”‚ Lait consommÃ©       â”‚ ' + stats.totalMilk.toString().padStart(8) + ' ml â”‚\n';
                    content += 'â”‚ Nombre de biberons  â”‚ ' + stats.feedingCount.toString().padStart(11) + ' â”‚\n';
                    content += 'â”‚ Nombre de pipis     â”‚ ' + stats.totalPees.toString().padStart(11) + ' â”‚\n';
                    content += 'â”‚ Nombre de cacas     â”‚ ' + stats.totalPoops.toString().padStart(11) + ' â”‚\n';
                    content += 'â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n';

                    if (exportEntries.length > 0) {
                        content += 'HISTORIQUE DÃ‰TAILLÃ‰\n';
                        content += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';

                        exportEntries.slice(0, 20).forEach((entry, index) => {
                            const date = new Date(entry.timestamp).toLocaleDateString('fr-FR');
                            const time = new Date(entry.timestamp).toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });

                            content += (index + 1).toString().padStart(2) + '. ';
                            content += date + ' ' + time + ' - ';

                            if (entry.type === 'feeding') {
                                content += 'BIBERON: ' + entry.amount + 'ml\n';
                            } else if (entry.type === 'diaper') {
                                const details = [];
                                if (entry.hasPee) details.push('Pipi');
                                if (entry.hasPoop) {
                                    let poopDetail = 'Caca';
                                    if (entry.poopQuantity) poopDetail += ' (' + entry.poopQuantity + ')';
                                    details.push(poopDetail);
                                }
                                content += 'CHANGE: ' + details.join(' + ') + '\n';
                            }
                        });
                    }

                    content += '\n';
                    content += 'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n';
                    content += 'â•‘                    BABYTRACK                         â•‘\n';
                    content += 'â•‘            Application de suivi pour bÃ©bÃ©            â•‘\n';
                    content += 'â•‘          Rapport gÃ©nÃ©rÃ© automatiquement             â•‘\n';
                    content += 'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•';

                    // TÃ©lÃ©charger le fichier
                    const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                    const link = document.createElement('a');
                    const url = URL.createObjectURL(blob);
                    link.href = url;
                    link.download = 'BabyTrack_Rapport_' + user.babyName + '_' + new Date().toISOString().slice(0, 10) + '.txt';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);

                    setShowExportMenu(false);

                } catch (error) {
                    console.error('Erreur export:', error);
                    alert('Erreur lors de l\'export');
                } finally {
                    setIsExporting(false);
                }
            };

            const logout = () => {
                setUser(null);
                localStorage.removeItem('familyCode');
                setShowAuth(true);
                setAuthMode('login');
            };
            // Gestion des entrÃ©es
            const openForm = (type) => {
                setFormType(type);
                setEditingId(null);
                setFormData({
                    time: getCurrentTime(),
                    date: getCurrentDate(),
                    amount: '',
                    hasPee: false,
                    hasPoop: false,
                    poopQuantity: '',
                    poopConsistency: '',
                    poopColor: ''
                });

                // Suggestion automatique pour biberon
                if (type === 'feeding') {
                    const age = calculateAge();
                    let suggestedAmount = '';

                    // Calcul par poids si disponible
                    if (currentWeight) {
                        const calculation = calculateMilkByWeight(currentWeight, age);
                        if (calculation) {
                            suggestedAmount = calculation.mlPerFeeding.toString();
                        }
                    } else {
                        // Fallback sur l'ancien systÃ¨me
                        const recommendations = getFeedingRecommendations(age);
                        if (recommendations) {
                            const defaultAmount = getDefaultAmount(recommendations.volume);
                            if (defaultAmount) {
                                suggestedAmount = defaultAmount.toString();
                            }
                        }
                    }

                    if (suggestedAmount) {
                        setFormData(prev => ({ ...prev, amount: suggestedAmount }));
                    }
                }
                setShowForm(true);
            };

            const editEntry = (entryId) => {
                const entry = entries.find(e => e.id === entryId);
                if (!entry) return;

                setEditingId(entryId);
                setFormType(entry.type);

                const entryDate = new Date(entry.timestamp);
                setFormData({
                    time: entryDate.toTimeString().slice(0, 5),
                    date: entryDate.toISOString().slice(0, 10),
                    amount: entry.amount || '',
                    hasPee: entry.hasPee || false,
                    hasPoop: entry.hasPoop || false,
                    poopQuantity: entry.poopQuantity || '',
                    poopConsistency: entry.poopConsistency || '',
                    poopColor: entry.poopColor || ''
                });

                setShowForm(true);
            };

            const closeForm = () => {
                setShowForm(false);
                setFormType('');
                setEditingId(null);
            };

            const saveEntry = async () => {
                const { time, date, amount, hasPee, hasPoop, poopQuantity, poopConsistency, poopColor } = formData;

                if (!time || !date) {
                    alert('Heure et date obligatoires');
                    return;
                }

                if (formType === 'feeding' && !amount) {
                    alert('QuantitÃ© obligatoire pour le biberon');
                    return;
                }

                if (formType === 'diaper' && !hasPee && !hasPoop) {
                    alert('Indiquez au moins pipi ou caca');
                    return;
                }

                const entry = {
                    type: formType,
                    timestamp: new Date(`${date}T${time}:00`).toISOString(),
                    familyCode: user.code, // Ajout du code famille
                    hasPee,
                    hasPoop,
                    poopQuantity,
                    poopConsistency,
                    poopColor
                };

                if (formType === 'feeding') {
                    entry.amount = parseInt(amount);
                }

                try {
                    if (editingId) {
                        await db.collection('entries').doc(editingId).update(entry);
                    } else {
                        await db.collection('entries').add(entry);
                    }
                    closeForm();
                } catch (error) {
                    console.error('Erreur sauvegarde:', error);
                    alert('Erreur lors de la sauvegarde');
                }
            };
            const deleteEntry = async (entryId) => {
                if (!confirm('Supprimer cette entrÃ©e ?')) return;

                try {
                    await db.collection('entries').doc(entryId).delete();
                } catch (error) {
                    console.error('Erreur suppression:', error);
                }
            };

            // Gestion des mÃ©dicaments
            const saveMedication = async () => {
                const { name, dosage, date, time, interval } = medicationData;

                if (!name || !dosage || !date || !time) {
                    alert('Veuillez remplir tous les champs obligatoires');
                    return;
                }

                const medication = {
                    name,
                    dosage,
                    timestamp: new Date(`${date}T${time}:00`).toISOString(),
                    familyCode: user.code, // Ajout du code famille
                    interval: interval ? parseInt(interval) : null,
                    lastGiven: new Date(`${date}T${time}:00`).toISOString()
                };

                try {
                    await db.collection('medications').add(medication);
                    setMedicationData({ name: '', dosage: '', date: '', time: '', interval: '' });
                    setCurrentView('medical');
                } catch (error) {
                    console.error('Erreur sauvegarde mÃ©dicament:', error);
                    alert('Erreur lors de la sauvegarde du mÃ©dicament');
                }
            };
            const giveMedication = async (medicationId) => {
                const medication = medications.find(m => m.id === medicationId);
                if (!medication) return;

                const newLastGiven = new Date().toISOString();

                try {
                    await db.collection('medications').doc(medicationId).update({
                        lastGiven: newLastGiven
                    });
                } catch (error) {
                    console.error('Erreur mise Ã  jour mÃ©dicament:', error);
                    alert('Erreur lors de la mise Ã  jour');
                }
            };

            const deleteMedication = async (medicationId) => {
                if (!confirm('Supprimer ce mÃ©dicament ?')) return;

                try {
                    await db.collection('medications').doc(medicationId).delete();
                } catch (error) {
                    console.error('Erreur suppression mÃ©dicament:', error);
                }
            };

            // Gestion des rendez-vous
            const saveAppointment = async () => {
                const { type, doctor, date, time, location } = appointmentData;

                if (!type || !date || !time) {
                    alert('Veuillez remplir tous les champs obligatoires');
                    return;
                }

                const appointment = {
                    type,
                    doctor,
                    location,
                    timestamp: new Date(`${date}T${time}:00`).toISOString(),
                    familyCode: user.code // Ajout du code famille
                };

                try {
                    await db.collection('appointments').add(appointment);
                    setAppointmentData({ type: '', doctor: '', date: '', time: '', location: '' });
                    setCurrentView('medical');
                } catch (error) {
                    console.error('Erreur sauvegarde RDV:', error);
                    alert('Erreur lors de la sauvegarde du rendez-vous');
                }
            };
            const deleteAppointment = async (appointmentId) => {
                if (!confirm('Supprimer ce rendez-vous ?')) return;

                try {
                    await db.collection('appointments').doc(appointmentId).delete();
                } catch (error) {
                    console.error('Erreur suppression RDV:', error);
                }
            };
            // Gestion des stocks
            const setMilkPowderDate = async () => {
                const date = prompt('Date d\'ouverture du lait en poudre (JJ/MM/AAAA):');
                if (!date) return;

                try {
                    // Supprimer l'ancien s'il existe pour cette famille
                    const existingDocs = await db.collection('stocks')
                        .where('type', '==', 'milk-powder')
                        .where('familyCode', '==', user.code)
                        .get();
                    existingDocs.forEach(doc => doc.ref.delete());

                    await db.collection('stocks').add({
                        type: 'milk-powder',
                        date: date,
                        timestamp: new Date().toISOString(),
                        familyCode: user.code // Ajout du code famille
                    });
                } catch (error) {
                    console.error('Erreur sauvegarde date lait:', error);
                    alert('Erreur lors de la sauvegarde');
                }
            };

            // Gestion des vaccins
            const saveVaccine = async () => {
                const { name, date, nextDue, notes } = vaccineData;

                if (!name || !date) {
                    alert('Nom du vaccin et date obligatoires');
                    return;
                }

                const vaccine = {
                    name,
                    timestamp: new Date(`${date}T12:00:00`).toISOString(),
                    nextDue,
                    notes,
                    familyCode: user.code
                };

                try {
                    await db.collection('vaccines').add(vaccine);
                    setVaccineData({ name: '', date: '', nextDue: '', notes: '' });
                    setCurrentView('medical');
                } catch (error) {
                    console.error('Erreur sauvegarde vaccin:', error);
                    alert('Erreur lors de la sauvegarde du vaccin');
                }
            };

            const deleteVaccine = async (vaccineId) => {
                if (!confirm('Supprimer ce vaccin ?')) return;

                try {
                    await db.collection('vaccines').doc(vaccineId).delete();
                } catch (error) {
                    console.error('Erreur suppression vaccin:', error);
                }
            };
            const setWaterBottleDateTime = async () => {
                const datetime = prompt('Date et heure d\'ouverture de la bouteille d\'eau (JJ/MM/AAAA HH:MM):');
                if (!datetime) return;

                try {
                    // Supprimer l'ancien s'il existe pour cette famille
                    const existingDocs = await db.collection('stocks')
                        .where('type', '==', 'water-bottle')
                        .where('familyCode', '==', user.code)
                        .get();
                    existingDocs.forEach(doc => doc.ref.delete());

                    await db.collection('stocks').add({
                        type: 'water-bottle',
                        datetime: datetime,
                        timestamp: new Date().toISOString(),
                        familyCode: user.code // Ajout du code famille
                    });
                } catch (error) {
                    console.error('Erreur sauvegarde datetime eau:', error);
                    alert('Erreur lors de la sauvegarde');
                }
            };
            // Gestion de la diversification
            const saveDiversificationEntry = async () => {
                const { food, date, rating, notes } = diversificationData;

                if (!food || !date) {
                    alert('Aliment et date obligatoires');
                    return;
                }

                const entry = {
                    food,
                    timestamp: new Date(`${date}T12:00:00`).toISOString(),
                    rating: parseInt(rating),
                    notes,
                    familyCode: user.code
                };

                try {
                    await db.collection('diversification').add(entry);
                    setDiversificationData({ food: '', date: '', rating: 5, notes: '' });
                    setCurrentView('food');
                } catch (error) {
                    console.error('Erreur sauvegarde diversification:', error);
                    alert('Erreur lors de la sauvegarde');
                }
            };

            const deleteDiversificationEntry = async (entryId) => {
                if (!confirm('Supprimer cette entrÃ©e ?')) return;

                try {
                    await db.collection('diversification').doc(entryId).delete();
                } catch (error) {
                    console.error('Erreur suppression diversification:', error);
                }
            };
            // Gestion de la garde-robe
            const saveWardrobeItem = async () => {
                const { type, size, quantity, notes } = wardrobeData;

                if (!type || !size) {
                    alert('Type de vÃªtement et taille obligatoires');
                    return;
                }

                const item = {
                    type,
                    size,
                    quantity: parseInt(quantity),
                    notes,
                    familyCode: user.code,
                    timestamp: new Date().toISOString()
                };

                try {
                    if (editingWardrobeId) {
                        await db.collection('wardrobe').doc(editingWardrobeId).update(item);
                    } else {
                        await db.collection('wardrobe').add(item);
                    }
                    setWardrobeData({ type: '', size: '', quantity: 1, notes: '' });
                    setEditingWardrobeId(null);
                    setCurrentView('wardrobe');
                } catch (error) {
                    console.error('Erreur sauvegarde garde-robe:', error);
                    alert('Erreur lors de la sauvegarde');
                }
            };
            const deleteWardrobeItem = async (itemId) => {
                if (!confirm('Supprimer cet article ?')) return;

                try {
                    await db.collection('wardrobe').doc(itemId).delete();
                } catch (error) {
                    console.error('Erreur suppression garde-robe:', error);
                }
            };

            // Gestion du sommeil
            const startSleep = async () => {
                const now = new Date().toISOString();
                const sleepSession = {
                    familyCode: user.code,
                    startTime: now,
                    endTime: null,
                    duration: null,
                    timestamp: now,
                    status: 'ongoing'
                };

                try {
                    const docRef = await db.collection('sleep_sessions').add(sleepSession);
                    console.log('Session crÃ©Ã©e avec ID:', docRef.id);
                    console.log('DonnÃ©es envoyÃ©es:', sleepSession); // Debug
                    setCurrentSleep({ id: docRef.id, ...sleepSession });
                } catch (error) {
                    console.error('Erreur dÃ©marrage sommeil:', error);
                    alert('Erreur lors du dÃ©marrage');
                }
            };
            const stopSleep = async () => {
                if (!currentSleep) return;

                const now = new Date().toISOString();
                const startTime = new Date(currentSleep.startTime);
                const endTime = new Date(now);
                const durationMs = endTime - startTime;
                const durationMinutes = Math.max(1, Math.floor(durationMs / (1000 * 60)));

                const updatedSession = {
                    endTime: now,
                    duration: durationMinutes,
                    status: 'completed',
                    timestamp: now // Mettre Ã  jour le timestamp
                };

                try {
                    await db.collection('sleep_sessions').doc(currentSleep.id).update(updatedSession);
                    console.log('Session terminÃ©e:', durationMinutes, 'minutes');
                    setCurrentSleep(null);
                } catch (error) {
                    console.error('Erreur arrÃªt sommeil:', error);
                    alert('Erreur lors de l\'arrÃªt');
                }
            };
            const saveSleepEdit = async () => {
                const { startTime, endTime, date } = sleepData;

                if (!startTime || !endTime || !date) {
                    alert('Veuillez remplir tous les champs');
                    return;
                }

                const start = new Date(`${date}T${startTime}:00`);
                let end = new Date(`${date}T${endTime}:00`);

                // Si l'heure de fin est antÃ©rieure Ã  l'heure de dÃ©but, 
                // on suppose que c'est le lendemain
                if (end <= start) {
                    end.setDate(end.getDate() + 1);
                }

                const durationMs = end - start;
                const durationMinutes = Math.floor(durationMs / (1000 * 60));

                // VÃ©rification que la durÃ©e reste raisonnable (max 15h)
                if (durationMinutes > 900) {
                    alert('La durÃ©e de sommeil semble trop longue (plus de 15h). VÃ©rifiez les heures saisies.');
                    return;
                }

                const sleepSession = {
                    familyCode: user.code,
                    startTime: start.toISOString(),
                    endTime: end.toISOString(),
                    duration: durationMinutes,
                    timestamp: start.toISOString(),
                    status: 'completed'
                };

                try {
                    if (editingSleepId) {
                        await db.collection('sleep_sessions').doc(editingSleepId).update(sleepSession);
                    } else {
                        await db.collection('sleep_sessions').add(sleepSession);
                    }

                    setSleepData({ startTime: '', endTime: '', date: getCurrentDate() });
                    setEditingSleepId(null);
                    setCurrentView('sleep-tracker');
                } catch (error) {
                    console.error('Erreur sauvegarde sommeil:', error);
                    alert('Erreur lors de la sauvegarde');
                }
            };
            const formatSleepDuration = (minutes) => {
                const hours = Math.floor(minutes / 60);
                const mins = minutes % 60;
                return hours > 0 ? `${hours}h${mins.toString().padStart(2, '0')}` : `${mins}min`;
            };
            // Nouveau graphique croissance Ã  ajouter aprÃ¨s formatSleepDuration
            const GrowthChart = () => {
                const chartRef = useRef(null);
                const chartInstance = useRef(null);

                useEffect(() => {
                    if (!chartRef.current) return;

                    const ctx = chartRef.current.getContext('2d');

                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }

                    // DonnÃ©es de croissance (exemple avec donnÃ©es actuelles)
                    const growthData = [];

                    // Poids de naissance
                    if (user?.birthDate && user?.birthWeight) {
                        growthData.push({
                            date: new Date(user.birthDate),
                            weight: user.birthWeight,
                            height: user.birthHeight || null
                        });
                    }

                    // Poids actuel si disponible
                    if (currentWeight && lastWeightUpdate) {
                        growthData.push({
                            date: new Date(lastWeightUpdate),
                            weight: currentWeight,
                            height: currentHeight || null
                        });
                    }

                    const labels = growthData.map(point =>
                        point.date.toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' })
                    );

                    chartInstance.current = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [
                                {
                                    label: 'Poids (kg)',
                                    data: growthData.map(point => point.weight),
                                    borderColor: '#3B82F6',
                                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                    tension: 0.4,
                                    pointRadius: 5,
                                    yAxisID: 'y'
                                },
                                {
                                    label: 'Taille (cm)',
                                    data: growthData.map(point => point.height),
                                    borderColor: '#10B981',
                                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                    tension: 0.4,
                                    pointRadius: 5,
                                    yAxisID: 'y1'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    type: 'linear',
                                    display: true,
                                    position: 'left',
                                    title: { display: true, text: 'Poids (kg)' },
                                    ticks: { callback: value => value + 'kg' }
                                },
                                y1: {
                                    type: 'linear',
                                    display: true,
                                    position: 'right',
                                    title: { display: true, text: 'Taille (cm)' },
                                    ticks: { callback: value => value + 'cm' },
                                    grid: { drawOnChartArea: false }
                                }
                            }
                        }
                    });

                    return () => {
                        if (chartInstance.current) {
                            chartInstance.current.destroy();
                        }
                    };
                }, [currentWeight, currentHeight, user]);

                return (
                    <div className="bg-white/90 rounded-2xl p-4 shadow-xl border border-white/50 mb-4">
                        <h3 className="font-bold text-gray-900 mb-3 flex items-center gap-2">
                            <div className="w-8 h-8 bg-indigo-100 rounded-xl flex items-center justify-center">
                                <i className="fas fa-chart-line text-indigo-600"></i>
                            </div>
                            Ã‰volution de la croissance
                        </h3>
                        <div className="h-48">
                            <canvas ref={chartRef} className="w-full h-full"></canvas>
                        </div>
                    </div>
                );
            };

            const getSleepRecommendations = (ageInDays) => {
                if (ageInDays <= 90) return SLEEP_GUIDE["0-3"];
                else if (ageInDays <= 180) return SLEEP_GUIDE["3-6"];
                else if (ageInDays <= 365) return SLEEP_GUIDE["6-12"];
                else return SLEEP_GUIDE["12-36"];
            };

            const editWardrobeItem = (itemId) => {
                const item = wardrobe.find(w => w.id === itemId);
                if (!item) return;

                setWardrobeData({
                    type: item.type,
                    size: item.size,
                    quantity: item.quantity,
                    notes: item.notes || ''
                });
                setEditingWardrobeId(itemId);
                setCurrentView('wardrobe-form');
            };

            const editSleepSession = (sessionId) => {
                const session = sleepSessions.find(s => s.id === sessionId);
                if (!session) return;

                const startDate = new Date(session.startTime);
                const endDate = new Date(session.endTime);

                setSleepData({
                    startTime: startDate.toTimeString().slice(0, 5),
                    endTime: endDate.toTimeString().slice(0, 5),
                    date: startDate.toISOString().slice(0, 10)
                });
                setEditingSleepId(sessionId);
                setCurrentView('sleep-manual');
            };

            const deleteSleepSession = async (sessionId) => {
                if (!confirm('Supprimer cette session de sommeil ?')) return;

                try {
                    await db.collection('sleep_sessions').doc(sessionId).delete();
                } catch (error) {
                    console.error('Erreur suppression session:', error);
                    alert('Erreur lors de la suppression');
                }
            };
            // Gestion des soins quotidiens
            const checkCareStatus = () => {
                if (!dailyCare) return;

                const today = getCurrentDate();
                const newCareStatus = { ...dailyCare };
                let hasChanges = false;

                // VÃ©rifier si c'est un nouveau jour
                Object.keys(newCareStatus).forEach(careType => {
                    if (careType === 'cordon') {
                        if (newCareStatus.cordon.active &&
                            (!newCareStatus.cordon.lastDate || newCareStatus.cordon.lastDate !== today)) {
                            newCareStatus.cordon.morning_done = false;
                            newCareStatus.cordon.evening_done = false;
                            newCareStatus.cordon.lastDate = today;
                            hasChanges = true;
                        }
                    } else {
                        if (!newCareStatus[careType].lastDate || newCareStatus[careType].lastDate !== today) {
                            newCareStatus[careType].done = false;
                            newCareStatus[careType].lastDate = today;
                            newCareStatus[careType].last_updated = null;
                            hasChanges = true;
                        }
                    }
                });

                if (hasChanges) {
                    console.log('Reset des soins pour nouveau jour:', today);
                    setDailyCare(newCareStatus);
                    saveDailyCareToFirebase(newCareStatus, today);
                }
            };
            const saveDailyCareToFirebase = async (careData, date) => {
                if (!user) return;

                try {
                    const docId = `${user.code}_${date}`;
                    await db.collection('daily_care').doc(docId).set({
                        familyCode: user.code,
                        date: date,
                        care: careData,
                        timestamp: new Date().toISOString()
                    });

                    console.log('Soins sauvegardÃ©s:', careData);
                } catch (error) {
                    console.error('Erreur sauvegarde soins:', error);
                }
            };
            const toggleCare = async (careType, timeOfDay = null) => {
                const today = getCurrentDate();
                const now = new Date().toISOString();
                let updatedCare = { ...dailyCare };

                if (careType === 'cordon' && timeOfDay) {
                    const field = timeOfDay === 'morning' ? 'morning_done' : 'evening_done';
                    const currentValue = updatedCare.cordon[field];

                    updatedCare.cordon = {
                        ...updatedCare.cordon,
                        [field]: !currentValue,
                        last_updated: now
                    };
                } else if (careType !== 'cordon') {
                    const newStatus = !dailyCare[careType].done;
                    updatedCare[careType] = {
                        done: newStatus,
                        last_updated: newStatus ? now : null,
                        lastDate: newStatus ? today : null
                    };
                }

                setDailyCare(updatedCare);
                await saveDailyCareToFirebase(updatedCare, today);
            };
            const toggleCordonActive = async () => {
                const today = getCurrentDate();
                const now = new Date().toISOString();

                const updatedCare = {
                    ...dailyCare,
                    cordon: {
                        active: !dailyCare.cordon.active,
                        morning_done: false,
                        evening_done: false,
                        last_updated: now
                    }
                };

                setDailyCare(updatedCare);
                await saveDailyCareToFirebase(updatedCare, today);
            };
            const getCareReminders = () => {
                if (!dailyCare) return [];

                const today = getCurrentDate();
                const reminders = [];

                // Cordon (si actif et pas fait 2 fois)
                if (dailyCare.cordon.active &&
                    (!dailyCare.cordon.morning_done || !dailyCare.cordon.evening_done)) {
                    reminders.push('Soin du cordon');
                }

                // Autres soins
                ['visage', 'vitamines'].forEach(careType => {
                    if (!dailyCare[careType].done) {
                        const careNames = {
                            visage: 'Nettoyage du visage',
                            vitamines: 'Vitamines'
                        };
                        reminders.push(careNames[careType]);
                    }
                });

                return reminders;
            };
            // Graphique quotidien
            const updateChart = () => {
                if (!chartRef.current) return;

                const ctx = chartRef.current.getContext('2d');

                if (chartInstance.current) {
                    chartInstance.current.destroy();
                }

                const now = new Date();
                let startDate, endDate, filteredFeedings, labels, data, labelFormat;

                // Configuration selon la pÃ©riode
                switch (periodView) {
                    case 'daily':
                        startDate = getDayStart(now);
                        endDate = getDayEnd(now);

                        filteredFeedings = entries.filter(entry => {
                            const entryDate = new Date(entry.timestamp);
                            return entry.type === 'feeding' && entryDate >= startDate && entryDate <= endDate;
                        });

                        // Labels par heure pour la vue quotidienne
                        labels = [];
                        data = [];
                        for (let h = 0; h < 24; h++) {
                            const hourStr = `${h}h`;
                            labels.push(hourStr);

                            let cumulativeMilk = 0;
                            const currentTime = new Date(startDate);
                            currentTime.setHours(h, 59, 59, 999);

                            filteredFeedings.forEach(feeding => {
                                const feedingTime = new Date(feeding.timestamp);
                                if (feedingTime <= currentTime) {
                                    cumulativeMilk += parseInt(feeding.amount || 0);
                                }
                            });

                            data.push(cumulativeMilk);
                        }
                        labelFormat = 'Lait cumulÃ© par heure';
                        break;

                    case 'weekly':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 6);
                        startDate.setHours(0, 0, 0, 0);
                        endDate = getDayEnd(now);

                        filteredFeedings = entries.filter(entry => {
                            const entryDate = new Date(entry.timestamp);
                            return entry.type === 'feeding' && entryDate >= startDate && entryDate <= endDate;
                        });

                        // Labels par jour pour la vue hebdomadaire
                        labels = [];
                        data = [];
                        for (let d = 0; d < 7; d++) {
                            const currentDay = new Date(startDate);
                            currentDay.setDate(startDate.getDate() + d);

                            const dayStart = getDayStart(currentDay);
                            const dayEnd = getDayEnd(currentDay);

                            const dayLabel = currentDay.toLocaleDateString('fr-FR', {
                                weekday: 'short',
                                day: 'numeric'
                            });
                            labels.push(dayLabel);

                            const dayTotal = filteredFeedings
                                .filter(feeding => {
                                    const feedingTime = new Date(feeding.timestamp);
                                    return feedingTime >= dayStart && feedingTime <= dayEnd;
                                })
                                .reduce((sum, feeding) => sum + parseInt(feeding.amount || 0), 0);

                            data.push(dayTotal);
                        }
                        labelFormat = 'Lait total par jour';
                        break;

                    case 'monthly':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 29);
                        startDate.setHours(0, 0, 0, 0);
                        endDate = getDayEnd(now);

                        filteredFeedings = entries.filter(entry => {
                            const entryDate = new Date(entry.timestamp);
                            return entry.type === 'feeding' && entryDate >= startDate && entryDate <= endDate;
                        });

                        // Labels par jour pour la vue mensuelle (plus dÃ©taillÃ©e)
                        labels = [];
                        data = [];
                        for (let d = 0; d < 30; d++) {
                            const currentDay = new Date(startDate);
                            currentDay.setDate(startDate.getDate() + d);

                            const dayStart = getDayStart(currentDay);
                            const dayEnd = getDayEnd(currentDay);

                            // Afficher que certains jours pour Ã©viter l'encombrement
                            const dayLabel = d % 5 === 0 ? currentDay.getDate().toString() : '';
                            labels.push(dayLabel);

                            const dayTotal = filteredFeedings
                                .filter(feeding => {
                                    const feedingTime = new Date(feeding.timestamp);
                                    return feedingTime >= dayStart && feedingTime <= dayEnd;
                                })
                                .reduce((sum, feeding) => sum + parseInt(feeding.amount || 0), 0);

                            data.push(dayTotal);
                        }
                        labelFormat = 'Lait total par jour';
                        break;

                    default:
                        return;
                }

                chartInstance.current = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: labelFormat,
                            data: data,
                            borderColor: user?.gender === 'girl' ? '#ec4899' : '#3B82F6',
                            backgroundColor: user?.gender === 'girl' ? 'rgba(236, 72, 153, 0.1)' : 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            fill: true,
                            pointBackgroundColor: user?.gender === 'girl' ? '#ec4899' : '#3B82F6',
                            pointRadius: periodView === 'daily' ? 2 : periodView === 'monthly' ? 1 : 4,
                            pointHoverRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    fontSize: 10,
                                    callback: function (value) {
                                        return value + 'ml';
                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'Volume (ml)'
                                }
                            },
                            x: {
                                ticks: { fontSize: periodView === 'monthly' ? 8 : 10 },
                                title: {
                                    display: true,
                                    text: periodView === 'daily' ? 'Heures' : 'Jours'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        return `${context.parsed.y}ml`;
                                    }
                                }
                            }
                        }
                    }
                });
            };
            const updateSleepChart = () => {
                if (!sleepChartRef.current) return;

                const ctx = sleepChartRef.current.getContext('2d');

                if (sleepChartInstance.current) {
                    sleepChartInstance.current.destroy();
                }

                const now = new Date();
                let startDate, endDate, filteredSleep, labels, data;

                switch (sleepPeriodView) {
                    case 'week':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 6);
                        startDate.setHours(0, 0, 0, 0);
                        endDate = getDayEnd(now);

                        filteredSleep = sleepSessions.filter(session => {
                            const sessionDate = new Date(session.startTime);
                            return session.status === 'completed' &&
                                sessionDate >= startDate && sessionDate <= endDate;
                        });

                        // Par jour
                        labels = [];
                        data = [];
                        for (let d = 0; d < 7; d++) {
                            const currentDay = new Date(startDate);
                            currentDay.setDate(startDate.getDate() + d);

                            const dayStart = getDayStart(currentDay);
                            const dayEnd = getDayEnd(currentDay);

                            const dayLabel = currentDay.toLocaleDateString('fr-FR', {
                                weekday: 'short',
                                day: 'numeric'
                            });
                            labels.push(dayLabel);

                            const dayTotal = filteredSleep
                                .filter(session => {
                                    const sessionTime = new Date(session.startTime);
                                    return sessionTime >= dayStart && sessionTime <= dayEnd;
                                })
                                .reduce((sum, session) => sum + (session.duration || 0), 0);

                            data.push(Math.round(dayTotal / 60 * 10) / 10); // Convertir en heures
                        }
                        break;

                    case 'month':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 29);
                        startDate.setHours(0, 0, 0, 0);
                        endDate = getDayEnd(now);

                        filteredSleep = sleepSessions.filter(session => {
                            const sessionDate = new Date(session.startTime);
                            return session.status === 'completed' &&
                                sessionDate >= startDate && sessionDate <= endDate;
                        });

                        // Par semaine
                        labels = [];
                        data = [];
                        for (let w = 0; w < 4; w++) {
                            const weekStart = new Date(startDate);
                            weekStart.setDate(startDate.getDate() + (w * 7));
                            const weekEnd = new Date(weekStart);
                            weekEnd.setDate(weekStart.getDate() + 6);
                            weekEnd.setHours(23, 59, 59, 999);

                            labels.push(`S${w + 1}`);

                            const weekTotal = filteredSleep
                                .filter(session => {
                                    const sessionTime = new Date(session.startTime);
                                    return sessionTime >= weekStart && sessionTime <= weekEnd;
                                })
                                .reduce((sum, session) => sum + (session.duration || 0), 0);

                            data.push(Math.round(weekTotal / 60 * 10) / 10); // Convertir en heures
                        }
                        break;
                }

                sleepChartInstance.current = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Sommeil (heures)',
                            data: data,
                            backgroundColor: 'rgba(147, 51, 234, 0.6)',
                            borderColor: 'rgba(147, 51, 234, 1)',
                            borderWidth: 2,
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    fontSize: 8,
                                    callback: function (value) {
                                        return value + 'h';
                                    }
                                }
                            },
                            x: {
                                ticks: { fontSize: 8 }
                            }
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        const hours = Math.floor(context.parsed.y);
                                        const minutes = Math.round((context.parsed.y - hours) * 60);
                                        return `${hours}h${minutes.toString().padStart(2, '0')}`;
                                    }
                                }
                            }
                        }
                    }
                });
            };
            // Fonctions d'information sur les selles
            const getPoopInfo = (quantity, consistency, color) => {
                const quantities = {
                    'peu': { label: 'Un peu', emoji: 'ðŸ¤' },
                    'moyen': { label: 'Moyen', emoji: 'ðŸ‘Œ' },
                    'beaucoup': { label: 'Beaucoup', emoji: 'ðŸ™Œ' }
                };

                const consistencies = {
                    'liquide': { label: 'Liquide', emoji: 'ðŸ’§' },
                    'molle': { label: 'Molle', emoji: 'ðŸŸ¡' },
                    'normale': { label: 'Normale', emoji: 'ðŸŸ¤' },
                    'dure': { label: 'Dure', emoji: 'ðŸ”´' }
                };

                const colors = {
                    'noir': { label: 'Noir', emoji: 'âš«', bgColor: 'bg-gray-800', textColor: 'text-white' },
                    'marron': { label: 'Marron', emoji: 'ðŸŸ¤', bgColor: 'bg-amber-700', textColor: 'text-white' },
                    'vert': { label: 'Vert', emoji: 'ðŸŸ¢', bgColor: 'bg-green-600', textColor: 'text-white' },
                    'jaune': { label: 'Jaune', emoji: 'ðŸŸ¡', bgColor: 'bg-yellow-400', textColor: 'text-gray-800' }
                };

                return {
                    quantity: quantities[quantity] || { label: '', emoji: '' },
                    consistency: consistencies[consistency] || { label: '', emoji: '' },
                    color: colors[color] || { label: '', emoji: '', bgColor: 'bg-orange-100', textColor: 'text-orange-800' }
                };
            };
            // Conseils par Ã¢ge complets
            const getTipsForAge = (age) => {
                if (age <= 7) {
                    return {
                        title: `ðŸ¼ Premiers jours (${age} jours)`,
                        sections: [
                            {
                                title: 'ðŸ’ Contact et lien affectif',
                                color: 'bg-blue-50',
                                textColor: 'text-blue-800',
                                tips: [
                                    'Contact peau Ã  peau : rÃ©gule la tempÃ©rature et favorise la mise au sein',
                                    'RÃ©pondre aux sourires spontanÃ©s pour crÃ©er des associations positives',
                                    'Parler doucement, chanter des berceuses, maintenir le contact visuel',
                                    'Le toucher est le premier sens dÃ©veloppÃ© - chaque caresse compte'
                                ]
                            },
                            {
                                title: 'ðŸ¼ Alimentation Ã  la demande',
                                color: 'bg-green-50',
                                textColor: 'text-green-800',
                                tips: [
                                    '6-8 tÃ©tÃ©es par 24h - suivre les signaux de faim du bÃ©bÃ©',
                                    'Signes prÃ©coces : lÃ¨che les lÃ¨vres, agite les mains, tourne la tÃªte',
                                    'Consoler d\'abord si bÃ©bÃ© pleure, puis proposer le sein/biberon',
                                    'Contact peau Ã  peau avant la tÃ©tÃ©e pour Ã©veiller les rÃ©flexes'
                                ]
                            },
                            {
                                title: 'ðŸŒ™ Rythmes et sommeil',
                                color: 'bg-yellow-50',
                                textColor: 'text-yellow-800',
                                tips: [
                                    'Pas de routine fixe encore - c\'est normal',
                                    'Jour : lumiÃ¨re naturelle, atmosphÃ¨re animÃ©e',
                                    'Nuit : obscuritÃ©, voix basse, changes rapides sans jeu',
                                    'Coucher sur le dos, matelas ferme, tempÃ©rature 18-20Â°C'
                                ]
                            },
                            {
                                title: 'ðŸ˜¢ Comprendre les pleurs',
                                color: 'bg-purple-50',
                                textColor: 'text-purple-800',
                                tips: [
                                    'Les pleurs = communication d\'un besoin, pas un caprice',
                                    'Consoler ne "gÃ¢te" pas - construit la confiance',
                                    'Acceptable de dÃ©poser bÃ©bÃ© en sÃ©curitÃ© et prendre une pause'
                                ]
                            }
                        ]
                    };
                } else if (age >= 8 && age <= 30) {
                    return {
                        title: `ðŸ‘¶ Premier mois (${age} jours)`,
                        sections: [
                            {
                                title: 'ðŸƒ DÃ©veloppement moteur',
                                color: 'bg-blue-50',
                                textColor: 'text-blue-800',
                                tips: [
                                    '"Tummy time" : renforce le cou et les bras',
                                    'Exploration des mains et pieds',
                                    'Meilleure maÃ®trise de la tÃªte',
                                    'Mouvements plus coordonnÃ©s'
                                ]
                            },
                            {
                                title: 'ðŸ˜Š Ã‰veil social',
                                color: 'bg-green-50',
                                textColor: 'text-green-800',
                                tips: [
                                    'Premiers vrais sourires en rÃ©ponse',
                                    'Suit les objets du regard',
                                    'DÃ©but du babillage pour exprimer la joie',
                                    'Distingue ses parents des autres'
                                ]
                            },
                            {
                                title: 'ðŸŽ® Jeux et activitÃ©s',
                                color: 'bg-orange-50',
                                textColor: 'text-orange-800',
                                tips: [
                                    'Jeux de "coucou" - apprend la permanence de l\'objet',
                                    'Cartes Ã  contraste Ã©levÃ©',
                                    'Mobiles colorÃ©s, miroirs incassables',
                                    'Le parent est le meilleur "jouet"'
                                ]
                            },
                            {
                                title: 'ðŸ˜£ Gestion des coliques',
                                color: 'bg-red-50',
                                textColor: 'text-red-800',
                                tips: [
                                    'Massages doux du ventre (sens horaire)',
                                    'Position "paresseux" sur l\'avant-bras',
                                    'Portage en Ã©charpe, bercements, bruits blancs',
                                    'Chaleur douce sur le ventre'
                                ]
                            }
                        ]
                    };
                } else if (age >= 31 && age <= 60) {
                    return {
                        title: `ðŸ‘¶ DeuxiÃ¨me mois (${age} jours)`,
                        sections: [
                            {
                                title: 'ðŸ’ª Grandes Ã©tapes motrices',
                                color: 'bg-blue-50',
                                textColor: 'text-blue-800',
                                tips: [
                                    'Se soulÃ¨ve sur les avant-bras en position ventrale',
                                    'Muscles du cou plus forts',
                                    'Exploration active mains/pieds',
                                    'Coordination Å“il-main s\'amÃ©liore'
                                ]
                            },
                            {
                                title: 'ðŸ—£ï¸ Communication avancÃ©e',
                                color: 'bg-green-50',
                                textColor: 'text-green-800',
                                tips: [
                                    'Babillage structurÃ© : "ba-ba", "ma-ma"',
                                    'Distingue les Ã©motions par le ton',
                                    'Peut reconnaÃ®tre son prÃ©nom',
                                    'Interactions sociales plus riches'
                                ]
                            },
                            {
                                title: 'ðŸŒ™ RÃ©gression du sommeil (possible)',
                                color: 'bg-purple-50',
                                textColor: 'text-purple-800',
                                tips: [
                                    'Normal entre 2-4 mois : signe de dÃ©veloppement sain',
                                    'Maturation vers cycles de sommeil adulte',
                                    'Encourager l\'auto-apaisement',
                                    'Rituel de coucher rÃ©gulier et apaisant'
                                ]
                            },
                            {
                                title: 'ðŸŽ¯ Stimulation appropriÃ©e',
                                color: 'bg-yellow-50',
                                textColor: 'text-yellow-800',
                                tips: [
                                    'Limiter transats/siÃ¨ges-auto',
                                    'Tapis de jeu pour Ã©veil supervisÃ©',
                                    'Objets colorÃ©s, textures variÃ©es',
                                    'Lecture Ã  voix haute'
                                ]
                            }
                        ]
                    };
                } else if (age >= 61 && age <= 120) {
                    return {
                        title: `ðŸŒŸ 3-4 mois (${age} jours)`,
                        sections: [
                            {
                                title: 'ðŸ¤¸ MobilitÃ© accrue',
                                color: 'bg-blue-50',
                                textColor: 'text-blue-800',
                                tips: [
                                    'DÃ©but des retournements dos-ventre',
                                    'Prend appui sur les jambes',
                                    'Coordination Å“il-main dÃ©veloppÃ©e',
                                    'Attrape volontairement les objets'
                                ]
                            },
                            {
                                title: 'ðŸ‘ï¸ Vision et perception',
                                color: 'bg-green-50',
                                textColor: 'text-green-800',
                                tips: [
                                    'Meilleure distinction des couleurs',
                                    'Suit les objets en mouvement',
                                    'Exploration bouche = dÃ©couverte sensorielle',
                                    'Vision s\'affine considÃ©rablement'
                                ]
                            },
                            {
                                title: 'ðŸ¼ PrÃ©paration diversification',
                                color: 'bg-orange-50',
                                textColor: 'text-orange-800',
                                tips: [
                                    'Lait reste la source principale jusqu\'Ã  1 an',
                                    'Possible introduction lÃ©gumes/fruits vers 4-6 mois',
                                    'Observer les signaux de prÃªtesse',
                                    'Un aliment Ã  la fois pour tester les rÃ©actions'
                                ]
                            },
                            {
                                title: 'ðŸ˜´ RÃ©gression sommeil 4 mois',
                                color: 'bg-red-50',
                                textColor: 'text-red-800',
                                tips: [
                                    'Dure 2-6 semaines - patience nÃ©cessaire',
                                    'RÃ©sultat de la maturation neurologique',
                                    'Encourager l\'auto-apaisement',
                                    'Demander de l\'aide si besoin'
                                ]
                            }
                        ]
                    };
                } else if (age >= 121 && age <= 180) {
                    return {
                        title: `ðŸš€ 4-6 mois (${age} jours)`,
                        sections: [
                            {
                                title: 'ðŸŽ¯ Grand bond moteur',
                                color: 'bg-blue-50',
                                textColor: 'text-blue-800',
                                tips: [
                                    'Se retourne dans les 2 sens',
                                    'S\'assoit avec soutien puis seul',
                                    'Force du haut du corps dÃ©veloppÃ©e',
                                    'Exploration active de l\'environnement'
                                ]
                            },
                            {
                                title: 'ðŸŽ Diversification alimentaire',
                                color: 'bg-green-50',
                                textColor: 'text-green-800',
                                tips: [
                                    'LÃ©gumes/fruits : purÃ©es lisses, un Ã  la fois',
                                    'CÃ©rÃ©ales infantiles dÃ¨s 4 mois',
                                    'ProtÃ©ines : 10g viande/poisson ou 1/4 Å“uf',
                                    'Ne jamais forcer - exploration sensorielle'
                                ]
                            },
                            {
                                title: 'ðŸ—£ï¸ Communication complexe',
                                color: 'bg-purple-50',
                                textColor: 'text-purple-800',
                                tips: [
                                    'ChaÃ®nes de sons : "ba-ba", "dee-dee"',
                                    'RÃ©pond Ã  la nÃ©gation "non"',
                                    'ReconnaÃ®t son prÃ©nom',
                                    'Exprime la joie par la voix'
                                ]
                            },
                            {
                                title: 'ðŸŽ® Jeux adaptÃ©s',
                                color: 'bg-yellow-50',
                                textColor: 'text-yellow-800',
                                tips: [
                                    'Jouets Ã  saisir et manipuler',
                                    'Miroirs incassables',
                                    'Jeux de mains et comptines',
                                    'Objets de textures variÃ©es'
                                ]
                            }
                        ]
                    };
                } else {
                    return {
                        title: `ðŸŒŸ Croissance avancÃ©e (${age} jours)`,
                        sections: [
                            {
                                title: 'ðŸš€ DÃ©veloppement avancÃ©',
                                color: 'bg-green-50',
                                textColor: 'text-green-800',
                                tips: [
                                    'Exploration active et curiositÃ© intense',
                                    'Interaction sociale complexe',
                                    'PersonnalitÃ© qui s\'affirme',
                                    'PrÃ©paration aux prochaines Ã©tapes'
                                ]
                            },
                            {
                                title: 'ðŸ¼ Alimentation diversifiÃ©e',
                                color: 'bg-blue-50',
                                textColor: 'text-blue-800',
                                tips: [
                                    'Lait reste principal jusqu\'Ã  1 an',
                                    'Diversification en cours',
                                    'Texture adaptÃ©e Ã  l\'Ã¢ge',
                                    'Consulter le pÃ©diatre pour conseils'
                                ]
                            },
                            {
                                title: 'ðŸ‘¨â€âš•ï¸ Suivi mÃ©dical',
                                color: 'bg-purple-50',
                                textColor: 'text-purple-800',
                                tips: [
                                    'Consultations rÃ©guliÃ¨res importantes',
                                    'Stimulation sensorielle et motrice',
                                    'Adaptation selon la croissance',
                                    'Chaque enfant Ã©volue Ã  son rythme'
                                ]
                            }
                        ]
                    };
                }
            };


            // Calculer les recommandations alimentaires
            const age = calculateAge();
            const recommendations = getFeedingRecommendations(age);
            const nextFeedingInfo = calculateNextFeeding();
            const themeColors = getThemeColors();

            // Rendu conditionnel - Ã‰cran d'authentification
            if (showAuth) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl p-6 max-w-md w-full shadow-xl">
                            <div className="text-center mb-6">
                                <div className="inline-block mb-4">
                                    <img src="logo.PNG" alt="BabyTrack Logo" className="w-40 h-40 mx-auto rounded-2xl" />                                </div>

                            </div>

                            {authMode === 'login' ? (
                                <div className="space-y-4">
                                    <h2 className="text-lg font-semibold">Se connecter</h2>
                                    <input
                                        type="text"
                                        placeholder="Code famille (6 caractÃ¨res)"
                                        className="w-full border rounded-xl px-4 py-3 text-center uppercase"
                                        maxLength="6"
                                        value={authData.code}
                                        onChange={(e) => setAuthData(prev => ({ ...prev, code: e.target.value }))}
                                    />
                                    <button
                                        onClick={() => handleLogin()}
                                        className="w-full bg-blue-500 text-white py-3 rounded-xl font-medium"
                                    >
                                        Se connecter
                                    </button>
                                    <button
                                        onClick={() => setAuthMode('create')}
                                        className="w-full bg-gray-200 text-gray-700 py-3 rounded-xl font-medium"
                                    >
                                        CrÃ©er un compte famille
                                    </button>
                                </div>
                            ) : (
                                <div className="space-y-4">
                                    <h2 className="text-lg font-semibold">Nouvelle famille</h2>
                                    <input
                                        type="text"
                                        placeholder="Nom du bÃ©bÃ©"
                                        className="w-full border rounded-xl px-4 py-3"
                                        value={authData.babyName}
                                        onChange={(e) => setAuthData(prev => ({ ...prev, babyName: e.target.value }))}
                                    />
                                    <input
                                        type="date"
                                        className="w-full border rounded-xl px-4 py-3"
                                        value={authData.birthDate}
                                        onChange={(e) => setAuthData(prev => ({ ...prev, birthDate: e.target.value }))}
                                    />
                                    <input
                                        type="time"
                                        className="w-full border rounded-xl px-4 py-3"
                                        value={authData.birthTime}
                                        onChange={(e) => setAuthData(prev => ({ ...prev, birthTime: e.target.value }))}
                                    />
                                    <div className="grid grid-cols-2 gap-3">
                                        <input
                                            type="number"
                                            placeholder="Poids (kg)"
                                            step="0.001"
                                            className="w-full border rounded-xl px-4 py-3"
                                            value={authData.birthWeight}
                                            onChange={(e) => setAuthData(prev => ({ ...prev, birthWeight: e.target.value }))}
                                        />
                                        <input
                                            type="number"
                                            placeholder="Taille (cm)"
                                            className="w-full border rounded-xl px-4 py-3"
                                            value={authData.birthHeight}
                                            onChange={(e) => setAuthData(prev => ({ ...prev, birthHeight: e.target.value }))}
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Sexe</label>
                                        <select
                                            className="w-full border rounded-xl px-4 py-3"
                                            value={authData.gender}
                                            onChange={(e) => setAuthData(prev => ({ ...prev, gender: e.target.value }))}
                                        >
                                            <option value="boy">GarÃ§on</option>
                                            <option value="girl">Fille</option>
                                        </select>
                                    </div>
                                    <input
                                        type="text"
                                        placeholder="Noms des parents"
                                        className="w-full border rounded-xl px-4 py-3"
                                        value={authData.parents}
                                        onChange={(e) => setAuthData(prev => ({ ...prev, parents: e.target.value }))}
                                    />
                                    <button
                                        onClick={handleCreateAccount}
                                        className="w-full bg-green-500 text-white py-3 rounded-xl font-medium"
                                    >
                                        CrÃ©er la famille
                                    </button>
                                    <button
                                        onClick={() => setAuthMode('login')}
                                        className="w-full bg-gray-200 text-gray-700 py-3 rounded-xl font-medium"
                                    >
                                        Retour
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            // Navigation tabs
            const TabButton = ({ id, label, icon, active, onClick }) => (
                <button
                    onClick={onClick}
                    className={`flex flex-col items-center justify-center p-2 rounded-lg text-xs font-medium transition-all ${active
                        ? `${themeColors.primaryBg} text-white shadow-md`
                        : 'text-gray-600 hover:text-gray-800'
                        }`}
                >
                    <i className={`${icon} text-lg mb-1`}></i>
                    <span>{label}</span>
                </button>
            );


            return (

                <div className="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50">
                    <div className="max-w-md mx-auto p-4 pb-24">

                        {/* Header masquÃ© sur toutes les vues sauf daily */}
                        {currentView === 'daily' && (
                            <div className="relative mb-4">
                                <div className="bg-white/95 backdrop-blur-xl rounded-2xl shadow-lg border border-white/50 p-3">
                                    <div className="flex items-center justify-end mb-2">
                                        <button
                                            onClick={logout}
                                            className="w-6 h-6 rounded-lg bg-gray-50 flex items-center justify-center"
                                        >
                                            <i className="fas fa-sign-out-alt text-xs text-gray-400"></i>
                                        </button>

                                    </div>

                                    <div className="flex items-center gap-3 mb-2">
                                        {/* Photo/Avatar amÃ©liorÃ© avec support HEIC */}
                                        <div className="relative">
                                            <input
                                                type="file"
                                                accept="image/*,.heic,.HEIC"
                                                onChange={async (e) => {
                                                    const file = e.target.files[0];
                                                    if (file) {
                                                        try {
                                                            // Support HEIC avec heic2any
                                                            let processedFile = file;

                                                            if (file.type === 'image/heic' || file.name.toLowerCase().endsWith('.heic')) {
                                                                // Convertir HEIC en JPEG
                                                                if (window.heic2any) {
                                                                    processedFile = await heic2any({
                                                                        blob: file,
                                                                        toType: "image/jpeg",
                                                                        quality: 0.8
                                                                    });
                                                                }
                                                            }

                                                            const reader = new FileReader();
                                                            reader.onload = async (e) => {
                                                                const imageData = e.target.result;

                                                                // Sauvegarder la photo dans Firebase
                                                                try {
                                                                    await db.collection('families').doc(user.code).update({
                                                                        photo: imageData
                                                                    });
                                                                    setUser(prev => ({ ...prev, photo: imageData }));
                                                                } catch (error) {
                                                                    console.error('Erreur sauvegarde photo:', error);
                                                                    // Garder la photo localement mÃªme si Firebase Ã©choue
                                                                    setUser(prev => ({ ...prev, photo: imageData }));
                                                                }
                                                            };
                                                            reader.readAsDataURL(processedFile);
                                                        } catch (error) {
                                                            console.error('Erreur traitement photo:', error);
                                                            alert('Erreur lors du traitement de la photo');
                                                        }
                                                    }
                                                }}
                                                className="hidden"
                                                id="photo-upload"
                                            />
                                            <label
                                                htmlFor="photo-upload"
                                                className="group block w-24 h-24 rounded-xl overflow-hidden cursor-pointer border-2 border-gray-200 hover:border-blue-400 transition-all duration-200 relative"
                                            >
                                                {user?.photo ? (
                                                    <>
                                                        <img
                                                            src={user.photo}
                                                            alt={user.babyName}
                                                            className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-200"
                                                        />
                                                        {/* Overlay pour indiquer qu'on peut changer */}
                                                        <div className="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center">
                                                            <i className="fas fa-camera text-white text-sm"></i>
                                                        </div>
                                                    </>
                                                ) : (
                                                    <div
                                                        className="w-full h-full flex items-center justify-center text-2xl group-hover:scale-105 transition-transform duration-200 relative"
                                                        style={{
                                                            background: `linear-gradient(135deg, ${user?.gender === 'girl' ? '#ec4899' : '#3b82f6'} 0%, ${user?.gender === 'girl' ? '#f472b6' : '#6366f1'} 100%)`
                                                        }}
                                                    >
                                                        <span className="text-white">
                                                            {user?.gender === 'girl' ? 'ðŸ‘§' : 'ðŸ‘¦'}
                                                        </span>
                                                        {/* Indicateur pour ajouter une photo */}
                                                        <div className="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center">
                                                            <i className="fas fa-plus text-white text-sm"></i>
                                                        </div>
                                                    </div>
                                                )}
                                            </label>
                                        </div>
                                        <div className="flex-1">
                                            <h1 className="text-lg font-bold text-gray-900 mb-1">{user?.babyName}</h1>
                                            <div className="text-sm font-semibold text-gray-600">{formatAgeDisplay(age)}</div>

                                            {/* Prochain biberon avec dernier en petit */}
                                            {nextFeedingInfo && (
                                                <div className="mt-2">
                                                    {(() => {
                                                        const now = new Date();
                                                        const lastFeedingTime = new Date(nextFeedingInfo.lastFeeding);
                                                        const nextFeedingTime = new Date(nextFeedingInfo.nextTime);

                                                        const minutesSinceLastFeeding = Math.floor((now - lastFeedingTime) / (1000 * 60));
                                                        const minutesUntilNextFeeding = Math.ceil((nextFeedingTime - now) / (1000 * 60));

                                                        // Formatage du temps Ã©coulÃ©
                                                        const formatTime = (minutes) => {
                                                            if (minutes < 0) return "0 min";
                                                            if (minutes < 60) return `${minutes} min`;
                                                            const hours = Math.floor(minutes / 60);
                                                            const mins = minutes % 60;
                                                            return mins > 0 ? `${hours}h${mins.toString().padStart(2, '0')}` : `${hours}h`;
                                                        };

                                                        // Formatage de l'heure exacte
                                                        const formatExactTime = (date) => {
                                                            return date.toLocaleTimeString('fr-FR', {
                                                                hour: '2-digit',
                                                                minute: '2-digit'
                                                            });
                                                        };

                                                        let bgClass, textClass, emoji, mainMessage;

                                                        if (minutesUntilNextFeeding <= 0) {
                                                            // C'est l'heure ou en retard
                                                            bgClass = 'bg-gradient-to-r from-red-500 to-red-600';
                                                            textClass = 'text-white';
                                                            emoji = 'ðŸš¨';
                                                            mainMessage = 'C\'est l\'heure !';
                                                        } else if (minutesUntilNextFeeding <= 30) {
                                                            // BientÃ´t (dans moins de 30 min)
                                                            bgClass = 'bg-gradient-to-r from-orange-500 to-orange-600';
                                                            textClass = 'text-white';
                                                            emoji = 'â°';
                                                            mainMessage = `Prochain biberon Ã  ${formatExactTime(nextFeedingTime)}`;
                                                        } else if (minutesUntilNextFeeding <= 120) {
                                                            // Normal (30min - 2h)
                                                            bgClass = 'bg-gradient-to-r from-blue-500 to-blue-600';
                                                            textClass = 'text-white';
                                                            emoji = 'ðŸ¼';
                                                            mainMessage = `Prochain biberon Ã  ${formatExactTime(nextFeedingTime)}`;
                                                        } else {
                                                            // Loin (plus de 2h)
                                                            bgClass = 'bg-gradient-to-r from-green-500 to-green-600';
                                                            textClass = 'text-white';
                                                            emoji = 'ðŸ˜´';
                                                            mainMessage = `Prochain biberon Ã  ${formatExactTime(nextFeedingTime)}`;
                                                        }

                                                        return (
                                                            <div className={`${bgClass} ${textClass} px-3 py-2 rounded-xl text-xs font-medium shadow-lg`}>
                                                                <div className="flex items-center gap-2">
                                                                    <span className="text-sm">{emoji}</span>
                                                                    <div className="flex-1">
                                                                        <div className="font-bold">{mainMessage}</div>
                                                                        <div className="text-xs opacity-80">
                                                                            Dernier Ã  {formatExactTime(lastFeedingTime)}
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        );
                                                    })()}
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    {/* Stats en ligne cliquables sans icÃ´nes */}
                                    <div className="grid grid-cols-3 gap-2">
                                        {/* Poids cliquable */}
                                        <button
                                            onClick={() => setCurrentView('weight-update')}
                                            className="bg-white/60 hover:bg-white/80 rounded-lg p-2 text-center transition-all duration-200 active:scale-95"
                                        >
                                            <div className="text-base font-bold" style={{ color: user?.gender === 'girl' ? '#ec4899' : '#3b82f6' }}>
                                                {currentWeight ? `${currentWeight}` : `${user?.birthWeight?.toFixed(2)}`}
                                            </div>
                                            <div className="text-xs text-gray-500">kg</div>
                                        </button>

                                        {/* Taille cliquable */}
                                        <button
                                            onClick={() => setCurrentView('height-update')}
                                            className="bg-white/60 hover:bg-white/80 rounded-lg p-2 text-center transition-all duration-200 active:scale-95"
                                        >
                                            <div className="text-base font-bold" style={{ color: user?.gender === 'girl' ? '#ec4899' : '#3b82f6' }}>
                                                {currentHeight || user?.birthHeight}
                                            </div>
                                            <div className="text-xs text-gray-500">cm</div>
                                        </button>

                                        {/* Ã‚ge non cliquable */}
                                        <div className="bg-white/60 rounded-lg p-2 text-center">
                                            <div className="text-base font-bold" style={{ color: user?.gender === 'girl' ? '#ec4899' : '#3b82f6' }}>
                                                {age}
                                            </div>
                                            <div className="text-xs text-gray-500">jours</div>
                                        </div>
                                    </div>

                                    {/* Calcul personnalisÃ© intÃ©grÃ© plus compact */}
                                    {currentWeight && periodView === 'daily' && (
                                        <div className="mt-2 bg-green-50 rounded-lg p-2 border border-green-200">
                                            <div className="flex items-center justify-between mb-1">
                                                <span className="text-xs font-medium text-green-700">Calcul personnalisÃ©</span>
                                                <span className="text-xs bg-green-500 text-white px-2 py-0.5 rounded-full font-bold">PRÃ‰CIS</span>
                                            </div>

                                            {(() => {
                                                const calculation = calculateMilkByWeight(currentWeight, age);
                                                return calculation ? (
                                                    <div className="space-y-1">
                                                        <div className="text-xs font-semibold text-green-800">
                                                            {calculation.mlPerFeeding}ml Ã— {calculation.feedingsPerDay} = {calculation.totalPerDay}ml/jour
                                                        </div>

                                                        <div className="text-xs text-gray-500">
                                                            Ses chiffres sont une estimation en cas de doute consultez votre pÃ©diatre.
                                                        </div>

                                                        <div className="flex items-center gap-1 text-xs text-blue-700 bg-blue-50 rounded px-2 py-1">

                                                            {age <= 60 && (
                                                                <div className="flex items-center gap-1 text-xs text-blue-700 bg-blue-50 rounded px-2 py-1">
                                                                    <span>ðŸ’¡</span>
                                                                    <span>
                                                                        {age <= 14
                                                                            ? "Encore faim avant 2h30 ? +10ml possible"
                                                                            : age <= 30
                                                                                ? "Encore faim avant 3h ? +10ml possible"
                                                                                : "Encore faim avant 3h30 ? +10ml possible"
                                                                        }
                                                                    </span>
                                                                </div>
                                                            )}
                                                        </div>
                                                    </div>
                                                ) : null;
                                            })()}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}
                        {/* Menu d'export */}
                        {showExportMenu && (
                            <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                                <div className="bg-white rounded-2xl p-6 max-w-sm w-full shadow-2xl">
                                    <div className="flex items-center justify-between mb-4">
                                        <h3 className="text-lg font-bold text-gray-900">Export des donnÃ©es</h3>
                                        <button
                                            onClick={() => setShowExportMenu(false)}
                                            className="w-8 h-8 rounded-lg bg-gray-100 flex items-center justify-center"
                                        >
                                            <i className="fas fa-times text-gray-600"></i>
                                        </button>
                                    </div>

                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">PÃ©riode</label>
                                            <select
                                                className="w-full px-3 py-2 border rounded-xl"
                                                value={exportPeriod}
                                                onChange={(e) => setExportPeriod(e.target.value)}
                                            >
                                                <option value="day">Aujourd'hui</option>
                                                <option value="week">7 derniers jours</option>
                                                <option value="month">30 derniers jours</option>
                                            </select>
                                        </div>

                                        <div className="grid grid-cols-2 gap-3">
                                            <button
                                                onClick={exportToCSV}
                                                disabled={isExporting}
                                                className="bg-green-500 text-white py-3 rounded-xl font-medium disabled:opacity-50"
                                            >
                                                {isExporting ? 'Export...' : 'CSV'}
                                            </button>
                                            <button
                                                onClick={exportToPDF}
                                                disabled={isExporting}
                                                className="bg-blue-500 text-white py-3 rounded-xl font-medium disabled:opacity-50"
                                            >
                                                {isExporting ? 'Export...' : 'PDF'}
                                            </button>
                                        </div>

                                        <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                                            <p className="text-xs text-yellow-800">
                                                <i className="fas fa-info-circle mr-1"></i>
                                                Ces exports sont parfaits Ã  partager avec votre pÃ©diatre lors des consultations.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* Navigation fixe en bas */}
                        <div className="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-lg border-t border-gray-200 shadow-xl z-50">
                            <div className="max-w-md mx-auto px-4 py-2">
                                <div className="flex items-center justify-around">
                                    {/* Accueil */}
                                    <button
                                        onClick={() => {
                                            setCurrentView('daily');
                                            window.scrollTo({ top: 0, behavior: 'smooth' });
                                        }}
                                        className={`flex flex-col items-center p-3 rounded-2xl transition-all ${currentView === 'daily'
                                            ? `text-${user?.gender === 'girl' ? 'pink' : 'blue'}-600`
                                            : 'text-gray-500'
                                            }`}
                                    >
                                        <i className="fas fa-home text-xl mb-1"></i>
                                        <span className="text-xs font-medium">Accueil</span>
                                    </button>

                                    {/* MÃ©dical */}
                                    <button
                                        onClick={() => {
                                            setCurrentView('medical');
                                            window.scrollTo({ top: 0, behavior: 'smooth' });
                                        }}
                                        className={`flex flex-col items-center p-3 rounded-2xl transition-all ${currentView === 'medical'
                                            ? 'text-green-600'
                                            : 'text-gray-500'
                                            }`}
                                    >
                                        <i className="fas fa-stethoscope text-xl mb-1"></i>
                                        <span className="text-xs font-medium">MÃ©dical</span>
                                    </button>

                                    {/* Bouton + central */}
                                    {/* Bouton + central */}
                                    <div className="relative -mt-6" data-menu="plus">
                                        <button
                                            onClick={() => setShowPlusMenu(!showPlusMenu)}
                                            className={`w-16 h-16 bg-gradient-to-r ${themeColors.primary} text-white rounded-full shadow-xl flex items-center justify-center`}
                                        >
                                            <i className={`fas ${showPlusMenu ? 'fa-times' : 'fa-plus'} text-2xl`}></i>
                                        </button>

                                        {/* Menu flottant du bouton + */}
                                        {showPlusMenu && (
                                            <div className="absolute bottom-20 left-1/2 transform -translate-x-1/2 bg-white rounded-2xl shadow-2xl border p-4 min-w-[200px]">
                                                <button
                                                    onClick={() => {
                                                        openForm('feeding');
                                                        setShowPlusMenu(false);
                                                    }}
                                                    className="w-full flex items-center gap-3 p-3 hover:bg-gray-50 rounded-xl mb-2"
                                                >
                                                    <div className="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center">
                                                        <i className="fas fa-bottle-water text-blue-600"></i>
                                                    </div>
                                                    <span className="font-medium">Biberon</span>
                                                </button>
                                                <button
                                                    onClick={() => {
                                                        openForm('diaper');
                                                        setShowPlusMenu(false);
                                                    }}
                                                    className="w-full flex items-center gap-3 p-3 hover:bg-gray-50 rounded-xl"
                                                >
                                                    <div className="w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center">
                                                        <i className="fas fa-baby text-green-600"></i>
                                                    </div>
                                                    <span className="font-medium">Couche</span>
                                                </button>
                                                <button
                                                    onClick={() => {
                                                        setCurrentView('sleep-tracker');
                                                        setShowPlusMenu(false);
                                                    }}
                                                    className="w-full flex items-center gap-3 p-3 hover:bg-gray-50 rounded-xl"
                                                >
                                                    <div className="w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center">
                                                        <i className="fas fa-moon text-purple-600"></i>
                                                    </div>
                                                    <span className="font-medium">Sommeil</span>
                                                </button>
                                            </div>
                                        )}
                                    </div>
                                    {/* Conseils */}
                                    <button
                                        onClick={() => {
                                            setCurrentView('tips');
                                            window.scrollTo({ top: 0, behavior: 'smooth' });
                                        }}
                                        className={`flex flex-col items-center p-3 rounded-2xl transition-all ${currentView === 'tips'
                                            ? 'text-amber-600'
                                            : 'text-gray-500'
                                            }`}
                                    >
                                        <i className="fas fa-lightbulb text-xl mb-1"></i>
                                        <span className="text-xs font-medium">Conseils</span>
                                    </button>


                                    {/* Plus */}
                                    <div className="relative" data-menu="more">
                                        <button
                                            onClick={() => setShowMoreMenu(!showMoreMenu)}
                                            className={`flex flex-col items-center p-3 rounded-2xl transition-all ${['supplies', 'food', 'wardrobe'].includes(currentView)
                                                ? 'text-purple-600'
                                                : 'text-gray-500'
                                                }`}
                                        >
                                            <i className="fas fa-ellipsis-h text-xl mb-1"></i>
                                            <span className="text-xs font-medium">Plus</span>
                                        </button>

                                        {/* Dropdown menu Plus */}
                                        {showMoreMenu && (
                                            <div className="absolute bottom-16 right-0 bg-white rounded-2xl shadow-2xl border border-gray-200 py-2 min-w-[140px] z-50">
                                                <button
                                                    onClick={() => {
                                                        setCurrentView('food');
                                                        setShowMoreMenu(false);
                                                        window.scrollTo({ top: 0, behavior: 'smooth' });
                                                    }}
                                                    className="w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center gap-3"
                                                >
                                                    <i className="fas fa-utensils text-orange-500"></i>
                                                    <span className="text-sm font-medium">Diversification</span>
                                                </button>
                                                <button
                                                    onClick={() => {
                                                        setCurrentView('supplies');
                                                        setShowMoreMenu(false);
                                                        window.scrollTo({ top: 0, behavior: 'smooth' });
                                                    }}
                                                    className="w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center gap-3"
                                                >
                                                    <i className="fas fa-boxes text-blue-500"></i>
                                                    <span className="text-sm font-medium">Stocks</span>
                                                </button>
                                                <button
                                                    onClick={() => {
                                                        setCurrentView('wardrobe');
                                                        setShowMoreMenu(false);
                                                        window.scrollTo({ top: 0, behavior: 'smooth' });
                                                    }}
                                                    className="w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center gap-3"
                                                >
                                                    <i className="fas fa-tshirt text-pink-500"></i>
                                                    <span className="text-sm font-medium">Garde-robe</span>
                                                </button>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {/* Contenu selon la vue */}
                        {currentView === 'daily' && (
                            <>
                                {/* Onglets de pÃ©riode */}
                                <div className="bg-white/80 glass rounded-xl p-2 mb-4 shadow-sm border border-white/50">
                                    <div className="flex gap-1">
                                        <button
                                            onClick={() => setPeriodView('daily')}
                                            className={`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${periodView === 'daily'
                                                ? `${themeColors.primaryBg} text-white shadow-md`
                                                : 'text-gray-600 hover:text-gray-800'
                                                }`}
                                        >
                                            Aujourd'hui
                                        </button>
                                        <button
                                            onClick={() => setPeriodView('weekly')}
                                            className={`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${periodView === 'weekly'
                                                ? `${themeColors.primaryBg} text-white shadow-md`
                                                : 'text-gray-600 hover:text-gray-800'
                                                }`}
                                        >
                                            7 jours
                                        </button>
                                        <button
                                            onClick={() => setPeriodView('monthly')}
                                            className={`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${periodView === 'monthly'
                                                ? `${themeColors.primaryBg} text-white shadow-md`
                                                : 'text-gray-600 hover:text-gray-800'
                                                }`}
                                        >
                                            30 jours
                                        </button>
                                    </div>
                                </div>


                                {/* Statistiques selon la pÃ©riode */}
                                {(() => {
                                    const currentStats = getStats(periodView);
                                    const age = calculateAge();

                                    // Calculs pour les recommandations
                                    const weightCalculation = currentWeight ? calculateMilkByWeight(currentWeight, age) : null;
                                    const recommendations = getFeedingRecommendations(age);

                                    let expectedDailyMilk = null;
                                    if (weightCalculation) {
                                        expectedDailyMilk = weightCalculation.totalPerDay;
                                    } else if (recommendations) {
                                        const avgVolume = getDefaultAmount(recommendations.volume);
                                        const avgFrequency = recommendations.frequency.split('â€“')[0].trim().split(' ')[0];
                                        expectedDailyMilk = avgVolume * parseInt(avgFrequency);
                                    }

                                    return (
                                        <div className="grid grid-cols-3 gap-3 mb-6">
                                            {/* Carte Lait avec progression */}
                                            <div className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30 relative overflow-hidden">
                                                {/* Background dÃ©coratif */}
                                                <div className={`absolute top-0 right-0 w-12 h-12 ${themeColors.primary} opacity-5 rounded-full -translate-y-2 translate-x-2`} />

                                                <div className="relative">
                                                    <div className="flex items-center justify-center mb-2">
                                                        <div className={`w-8 h-8 rounded-xl ${themeColors.primaryLight} flex items-center justify-center`}>
                                                            <i className={`fas fa-bottle-water ${themeColors.primaryText} text-sm`}></i>
                                                        </div>
                                                    </div>

                                                    <div className="text-center">
                                                        <div className="text-xl font-bold text-gray-900 mb-1">
                                                            {currentStats.totalMilk}
                                                            <span className="text-sm font-medium text-gray-600">ml</span>
                                                        </div>

                                                        {/* Barre de progression pour le lait quotidien */}
                                                        {periodView === 'daily' && expectedDailyMilk && (
                                                            <div className="mb-2">
                                                                <div className="w-full bg-gray-200 rounded-full h-1.5 mb-1">
                                                                    <div
                                                                        className={`h-1.5 rounded-full ${themeColors.primaryBg}`}
                                                                        style={{ width: `${Math.min((currentStats.totalMilk / expectedDailyMilk) * 100, 100)}%` }}
                                                                    />
                                                                </div>
                                                                <div className="text-xs text-gray-500">
                                                                    {Math.round((currentStats.totalMilk / expectedDailyMilk) * 100)}% objectif
                                                                </div>
                                                            </div>
                                                        )}

                                                        <div className="text-xs font-medium text-gray-500">
                                                            {periodView === 'daily' ? 'Aujourd\'hui' :
                                                                periodView === 'weekly' ? '7 jours' : '30 jours'}
                                                        </div>

                                                        {/* Moyenne par biberon */}
                                                        {currentStats.feedingCount > 0 && (
                                                            <div className="text-xs text-gray-400 mt-1">
                                                                ~{Math.round(currentStats.totalMilk / currentStats.feedingCount)}ml/biberon
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Carte Pipi avec frÃ©quence */}
                                            <div className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30 relative overflow-hidden">
                                                {/* Background dÃ©coratif */}
                                                <div className="absolute top-0 right-0 w-12 h-12 bg-blue-500 opacity-5 rounded-full -translate-y-2 translate-x-2" />

                                                <div className="relative">
                                                    <div className="flex items-center justify-center mb-2">
                                                        <div className="w-8 h-8 rounded-xl bg-blue-100 flex items-center justify-center">
                                                            <span className="text-sm">ðŸ’§</span>
                                                        </div>
                                                    </div>

                                                    <div className="text-center">
                                                        <div className="text-xl font-bold text-gray-900 mb-1">
                                                            {currentStats.totalPees}
                                                        </div>

                                                        {/* Indicateur de frÃ©quence */}
                                                        {periodView === 'daily' && (


                                                            <div className="mb-2">
                                                                <div className={`text-xs px-2 py-1 rounded-full font-medium ${currentStats.totalPees >= 6
                                                                    ? 'bg-green-100 text-green-700'
                                                                    : currentStats.totalPees >= 4
                                                                        ? 'bg-yellow-100 text-yellow-700'
                                                                        : 'bg-orange-100 text-orange-700'
                                                                    }`}>
                                                                    {currentStats.totalPees >= 6 ? 'Normal' :
                                                                        currentStats.totalPees >= 4 ? 'Correct' : 'Surveiller'}
                                                                </div>
                                                            </div>
                                                        )}

                                                        <div className="text-xs font-medium text-gray-500">
                                                            Pipis
                                                        </div>

                                                        {periodView === 'daily' && (

                                                            <div className="text-xs text-gray-400 mt-1">
                                                                6+ attendus/jour
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Carte Caca avec analyse */}
                                            <div className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30 relative overflow-hidden">
                                                {/* Background dÃ©coratif */}
                                                <div className="absolute top-0 right-0 w-12 h-12 bg-orange-500 opacity-5 rounded-full -translate-y-2 translate-x-2" />

                                                <div className="relative">
                                                    <div className="flex items-center justify-center mb-2">
                                                        <div className="w-8 h-8 rounded-xl bg-orange-100 flex items-center justify-center">
                                                            <span className="text-sm">ðŸ’©</span>
                                                        </div>
                                                    </div>

                                                    <div className="text-center">
                                                        <div className="text-xl font-bold text-gray-900 mb-1">
                                                            {currentStats.totalPoops}
                                                        </div>

                                                        {/* Indicateur de frÃ©quence selles */}
                                                        {periodView === 'daily' && (
                                                            <div className="mb-2">
                                                                <div className={`text-xs px-2 py-1 rounded-full font-medium ${currentStats.totalPoops >= 1
                                                                    ? 'bg-green-100 text-green-700'
                                                                    : 'bg-orange-100 text-orange-700'
                                                                    }`}>
                                                                    {currentStats.totalPoops >= 1 ? 'Normal' : 'Ã€ surveiller'}
                                                                </div>
                                                            </div>
                                                        )}

                                                        <div className="text-xs font-medium text-gray-500">
                                                            Cacas
                                                        </div>

                                                        {periodView === 'weekly' && currentStats.totalPoops > 0 && (
                                                            <div className="text-xs text-gray-400 mt-1">
                                                                ~{(currentStats.totalPoops / 7).toFixed(1)}/jour
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    );

                                })()}


                                {/* Graphique lait moderne - toujours affichÃ© */}
                                <div className="bg-white/95 backdrop-blur-sm rounded-3xl p-5 shadow-xl border border-white/20 mb-6 relative overflow-hidden">
                                    {/* Background dÃ©coratif */}
                                    <div className={`absolute top-0 right-0 w-16 h-16 opacity-5 rounded-full -translate-y-4 translate-x-4 ${user?.gender === 'girl' ? 'bg-pink-500' : 'bg-blue-500'}`} />

                                    <div className="relative">
                                        {/* Header du graphique */}
                                        <div className="flex items-center justify-between mb-4">
                                            <div className="flex items-center gap-2">
                                                <div className={`w-8 h-8 ${themeColors.primaryLight} rounded-xl flex items-center justify-center`}>
                                                    <span className="text-sm">ðŸ“Š</span>
                                                </div>
                                                <div>
                                                    <h4 className="font-bold text-gray-900">
                                                        {periodView === 'daily' ? 'Ã‰volution quotidienne' :
                                                            periodView === 'weekly' ? 'Ã‰volution sur 7 jours' :
                                                                'Ã‰volution sur 30 jours'}
                                                    </h4>
                                                    <p className="text-xs text-gray-500">
                                                        {periodView === 'daily' ? 'Lait consommÃ© par heure' : 'Lait consommÃ© par jour'}
                                                    </p>
                                                </div>
                                            </div>
                                            <div className={`${themeColors.primaryBg} text-white px-3 py-1 rounded-full text-xs font-bold`}>
                                                TEMPS RÃ‰EL
                                            </div>
                                        </div>

                                        {/* Zone du graphique */}
                                        <div className="h-40 mb-4 bg-gradient-to-b from-gray-50 to-gray-100 rounded-2xl p-4 flex items-center justify-center">
                                            <canvas ref={chartRef} className="w-full h-full"></canvas>
                                        </div>

                                        {/* RÃ©sumÃ© sous le graphique */}
                                        {(() => {
                                            if (periodView === 'daily') {
                                                const currentStats = getStats('daily');
                                                const now = new Date();
                                                const dayStart = getDayStart(now);
                                                const dayEnd = getDayEnd(now);

                                                const todayFeedings = entries.filter(entry => {
                                                    const entryDate = new Date(entry.timestamp);
                                                    return entry.type === 'feeding' && entryDate >= dayStart && entryDate <= dayEnd;
                                                });

                                                return todayFeedings.length > 0 ? (
                                                    <div className="grid grid-cols-3 gap-3">
                                                        <div className="text-center">
                                                            <div className={`text-lg font-bold ${themeColors.primaryText}`}>
                                                                {todayFeedings.length}
                                                            </div>
                                                            <div className="text-xs text-gray-600">Biberons</div>
                                                        </div>
                                                        <div className="text-center">
                                                            <div className="text-lg font-bold text-gray-800">
                                                                {Math.round(currentStats.totalMilk / todayFeedings.length)}ml
                                                            </div>
                                                            <div className="text-xs text-gray-600">Moyenne</div>
                                                        </div>
                                                        <div className="text-center">
                                                            {(() => {
                                                                if (todayFeedings.length >= 2) {
                                                                    const sortedFeedings = [...todayFeedings].sort((a, b) =>
                                                                        new Date(a.timestamp) - new Date(b.timestamp)
                                                                    );
                                                                    const intervals = [];
                                                                    for (let i = 1; i < sortedFeedings.length; i++) {
                                                                        const prev = new Date(sortedFeedings[i - 1].timestamp);
                                                                        const curr = new Date(sortedFeedings[i].timestamp);
                                                                        intervals.push((curr - prev) / (1000 * 60));
                                                                    }
                                                                    const avgInterval = intervals.reduce((a, b) => a + b, 0) / intervals.length;
                                                                    return (
                                                                        <>
                                                                            <div className="text-lg font-bold text-gray-800">
                                                                                {Math.round(avgInterval / 60 * 10) / 10}h
                                                                            </div>
                                                                            <div className="text-xs text-gray-600">Intervalle</div>
                                                                        </>
                                                                    );
                                                                }
                                                                return (
                                                                    <>
                                                                        <div className="text-lg font-bold text-gray-400">-</div>
                                                                        <div className="text-xs text-gray-600">Intervalle</div>
                                                                    </>
                                                                );
                                                            })()}
                                                        </div>
                                                    </div>
                                                ) : (
                                                    <div className="text-center py-6">
                                                        <div className="text-4xl mb-2">ðŸ¼</div>
                                                        <p className="text-sm text-gray-500 font-medium">Aucun biberon aujourd'hui</p>
                                                        <p className="text-xs text-gray-400">Ajoutez un biberon pour voir le graphique</p>
                                                    </div>
                                                );
                                            } else {
                                                // Pour les vues hebdomadaires et mensuelles
                                                const currentStats = getStats(periodView === 'weekly' ? 'weekly' : 'monthly');
                                                const feedingCount = currentStats.feedingCount;
                                                const totalMilk = currentStats.totalMilk;

                                                return feedingCount > 0 ? (
                                                    <div className="grid grid-cols-3 gap-3">
                                                        <div className="text-center">
                                                            <div className={`text-lg font-bold ${themeColors.primaryText}`}>
                                                                {feedingCount}
                                                            </div>
                                                            <div className="text-xs text-gray-600">Biberons</div>
                                                        </div>
                                                        <div className="text-center">
                                                            <div className="text-lg font-bold text-gray-800">
                                                                {totalMilk}ml
                                                            </div>
                                                            <div className="text-xs text-gray-600">Total</div>
                                                        </div>
                                                        <div className="text-center">
                                                            <div className="text-lg font-bold text-gray-800">
                                                                {Math.round(totalMilk / feedingCount)}ml
                                                            </div>
                                                            <div className="text-xs text-gray-600">Moyenne</div>
                                                        </div>
                                                    </div>
                                                ) : (
                                                    <div className="text-center py-6">
                                                        <div className="text-4xl mb-2">ðŸ¼</div>
                                                        <p className="text-sm text-gray-500 font-medium">
                                                            {periodView === 'weekly' ? 'Aucun biberon sur 7 jours' : 'Aucun biberon sur 30 jours'}
                                                        </p>
                                                        <p className="text-xs text-gray-400">Ajoutez des biberons pour voir le graphique</p>
                                                    </div>
                                                );
                                            }
                                        })()}
                                    </div>
                                </div>
                                {/* Panneau notifications */}
                                {notificationPermission !== 'granted' && (
                                    <div className="bg-blue-50 border border-blue-200 rounded-2xl p-4 mb-4">
                                        <div className="flex items-center gap-3">
                                            <div className="w-12 h-12 bg-blue-100 rounded-2xl flex items-center justify-center">
                                                <i className="fas fa-bell text-blue-600 text-xl"></i>
                                            </div>
                                            <div className="flex-1">
                                                <h3 className="font-bold text-blue-800">Activer les notifications</h3>
                                                <p className="text-sm text-blue-700">Recevez des rappels automatiques pour les biberons, mÃ©dicaments et RDV</p>
                                                {scheduledNotifications.size > 0 && (
                                                    <p className="text-xs text-blue-600 mt-1">{scheduledNotifications.size} notifications programmÃ©es</p>
                                                )}
                                            </div>
                                            <button
                                                onClick={requestNotificationPermission}
                                                className="bg-blue-500 text-white px-4 py-2 rounded-xl text-sm font-medium shadow-lg active:scale-95 transition-transform"
                                            >
                                                Activer
                                            </button>
                                        </div>
                                    </div>
                                )}
                                {/* Historique avec pagination */}
                                <div className="space-y-3">
                                    <div className="flex items-center justify-between">
                                        <h3 className="text-lg font-bold text-gray-800">Historique</h3>
                                        <select
                                            value={historyFilter}
                                            onChange={(e) => {
                                                setHistoryFilter(e.target.value);
                                                setCurrentPage(0);
                                            }}
                                            className="text-sm border rounded-lg px-2 py-1"
                                        >
                                            <option value="today">Aujourd'hui</option>
                                            <option value="yesterday">Hier</option>
                                            <option value="week">7 derniers jours</option>
                                            <option value="all">Tout</option>
                                        </select>
                                    </div>

                                    <div className="space-y-3">
                                        {(() => {
                                            const combinedEntries = getFilteredHistory();
                                            const itemsPerPage = 10;
                                            const startIndex = currentPage * itemsPerPage;
                                            const endIndex = startIndex + itemsPerPage;
                                            const currentEntries = combinedEntries.slice(startIndex, endIndex);
                                            const totalPages = Math.ceil(combinedEntries.length / itemsPerPage);
                                            return (
                                                <>
                                                    {currentEntries.length === 0 ? (
                                                        <p className="text-gray-500 text-center py-8">Aucune entrÃ©e pour cette pÃ©riode</p>
                                                    ) : (
                                                        currentEntries.map((entry) => {
                                                            // Rendu spÃ©cial pour les sessions de sommeil
                                                            if (entry.type === 'sleep') {
                                                                return (
                                                                    <div key={entry.id} className="bg-white/95 backdrop-blur-sm rounded-3xl shadow-xl border border-white/20 overflow-hidden">
                                                                        {/* Barre de couleur latÃ©rale violette */}
                                                                        <div className="absolute left-0 top-0 bottom-0 w-1 bg-gradient-to-b from-purple-500 to-purple-600" />

                                                                        <div className="p-5 pl-6 relative">
                                                                            <div className="flex items-start justify-between mb-4">
                                                                                <div className="flex items-center gap-4 flex-1">
                                                                                    <div className="w-14 h-14 rounded-2xl flex items-center justify-center bg-purple-100 border-2 border-purple-200">
                                                                                        <i className="fas fa-moon text-purple-600 text-xl"></i>
                                                                                    </div>

                                                                                    <div className="flex-1 min-w-0">
                                                                                        <div className="flex items-center gap-2 mb-1 flex-wrap">
                                                                                            <h4 className="font-bold text-gray-900 text-lg">Sommeil</h4>
                                                                                            <div className="px-2 py-0.5 rounded-full text-xs font-medium border bg-purple-50 text-purple-700 border-purple-200">
                                                                                                Repos
                                                                                            </div>
                                                                                        </div>

                                                                                        <div className="flex items-center gap-2 flex-wrap">
                                                                                            <p className="text-sm font-medium text-gray-600">
                                                                                                {formatDateTime(entry.startTime)}
                                                                                            </p>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>

                                                                                <div className="flex items-center gap-2 ml-2">
                                                                                    <button
                                                                                        onClick={() => editSleepSession(entry.id)}
                                                                                        className="w-9 h-9 rounded-2xl bg-blue-50 flex items-center justify-center active:scale-95 transition-transform"
                                                                                    >
                                                                                        <i className="fas fa-edit text-sm text-blue-600"></i>
                                                                                    </button>
                                                                                    <button
                                                                                        onClick={() => deleteSleepSession(entry.id)}
                                                                                        className="w-9 h-9 rounded-2xl bg-red-50 flex items-center justify-center active:scale-95 transition-transform"
                                                                                    >
                                                                                        <i className="fas fa-trash text-sm text-red-600"></i>
                                                                                    </button>
                                                                                </div>
                                                                            </div>

                                                                            <div className="h-px bg-gradient-to-r from-transparent via-gray-200 to-transparent mb-4 opacity-60"></div>

                                                                            <div className="space-y-3">
                                                                                <div className="flex items-center gap-3 flex-wrap">
                                                                                    <div className="flex items-center gap-2 px-4 py-2 rounded-2xl bg-purple-100 border border-purple-200">
                                                                                        <i className="fas fa-clock text-sm opacity-70"></i>
                                                                                        <span className="font-bold text-base">{formatSleepDuration(entry.duration)}</span>
                                                                                    </div>

                                                                                    <div className="flex items-center gap-2 px-3 py-1 rounded-full bg-purple-50 border border-purple-200">
                                                                                        <span className="text-xs text-purple-700">
                                                                                            {formatTime(entry.startTime)} â†’ {formatTime(entry.endTime)}
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                            </div>

                                                                            <div className="mt-4 pt-3 border-t border-gray-100">
                                                                                <div className="flex items-center justify-between text-xs text-gray-500">
                                                                                    <span>#{entry.id.slice(-6)}</span>
                                                                                    <span>Session de {formatSleepDuration(entry.duration)}</span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                );
                                                            }

                                                            // Continuer avec le code existant pour biberon/couche...
                                                            let poopDisplay = '';
                                                            if (entry.hasPoop) {
                                                                const poopInfo = getPoopInfo(entry.poopQuantity, entry.poopConsistency, entry.poopColor);
                                                                const parts = [];

                                                                if (poopInfo.quantity.label) parts.push(`${poopInfo.quantity.emoji} ${poopInfo.quantity.label}`);
                                                                if (poopInfo.consistency.label) parts.push(`${poopInfo.consistency.emoji} ${poopInfo.consistency.label}`);
                                                                if (poopInfo.color.label) parts.push(`${poopInfo.color.emoji} ${poopInfo.color.label}`);

                                                                const displayText = parts.length > 0 ? parts.join(' â€¢ ') : 'ðŸ’© Caca';
                                                                poopDisplay = (
                                                                    <span className={`${poopInfo.color.bgColor || 'bg-orange-100'} ${poopInfo.color.textColor || 'text-orange-800'} px-3 py-1 rounded-full text-xs font-medium`}>
                                                                        {displayText}
                                                                    </span>
                                                                );
                                                            }

                                                            // Calcul du temps Ã©coulÃ©
                                                            const timeElapsed = new Date() - new Date(entry.timestamp);
                                                            const minutesAgo = Math.floor(timeElapsed / (1000 * 60));
                                                            const hoursAgo = Math.floor(minutesAgo / 60);

                                                            let timeDisplayClass = 'text-gray-500';
                                                            if (minutesAgo < 30) timeDisplayClass = 'text-green-600 font-medium';
                                                            else if (minutesAgo < 120) timeDisplayClass = 'text-blue-600';

                                                            return (
                                                                <div key={entry.id} className="bg-white/95 backdrop-blur-sm rounded-3xl shadow-xl border border-white/20 overflow-hidden">
                                                                    {/* Barre de couleur latÃ©rale */}
                                                                    <div
                                                                        className={`absolute left-0 top-0 bottom-0 w-1 ${entry.type === 'feeding'
                                                                            ? `bg-gradient-to-b ${themeColors.primary}`
                                                                            : 'bg-gradient-to-b from-emerald-500 to-emerald-600'
                                                                            }`}
                                                                    />

                                                                    {/* Contenu principal */}
                                                                    <div className="p-5 pl-6 relative">
                                                                        {/* Header de la carte */}
                                                                        <div className="flex items-start justify-between mb-4">
                                                                            <div className="flex items-center gap-4 flex-1">
                                                                                {/* IcÃ´ne */}
                                                                                <div className={`w-14 h-14 rounded-2xl flex items-center justify-center ${entry.type === 'feeding'
                                                                                    ? `${themeColors.primaryLight} ${themeColors.primaryBorder} border-2`
                                                                                    : 'bg-emerald-100 border-2 border-emerald-200'
                                                                                    }`}>
                                                                                    {entry.type === 'feeding' ? (
                                                                                        <i className={`fas fa-bottle-water ${themeColors.primaryText} text-xl`}></i>
                                                                                    ) : (
                                                                                        <i className="fas fa-baby text-emerald-600 text-xl"></i>
                                                                                    )}

                                                                                    {/* Badge nouveau pour les entrÃ©es < 5 min */}
                                                                                    {minutesAgo < 5 && (
                                                                                        <div className="absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full flex items-center justify-center">
                                                                                            <div className="w-2 h-2 bg-white rounded-full" />
                                                                                        </div>
                                                                                    )}
                                                                                </div>

                                                                                {/* Titre et infos */}
                                                                                <div className="flex-1 min-w-0">
                                                                                    <div className="flex items-center gap-2 mb-1 flex-wrap">
                                                                                        <h4 className="font-bold text-gray-900 text-lg">
                                                                                            {entry.type === 'feeding' ? 'Biberon' : 'Change'}
                                                                                        </h4>

                                                                                        {/* Badge de statut */}
                                                                                        <div className={`px-2 py-0.5 rounded-full text-xs font-medium border ${entry.type === 'feeding'
                                                                                            ? `${themeColors.primaryLight} ${themeColors.primaryText} ${themeColors.primaryBorder}`
                                                                                            : 'bg-emerald-50 text-emerald-700 border-emerald-200'
                                                                                            }`}>
                                                                                            {entry.type === 'feeding' ? 'Nutrition' : 'HygiÃ¨ne'}
                                                                                        </div>
                                                                                    </div>

                                                                                    <div className="flex items-center gap-2 flex-wrap">
                                                                                        <p className={`text-sm font-medium ${timeDisplayClass}`}>
                                                                                            {formatDateTime(entry.timestamp)}
                                                                                        </p>

                                                                                        {/* Indicateur de fraÃ®cheur */}
                                                                                        {minutesAgo < 30 && (
                                                                                            <div className="flex items-center gap-1 bg-green-50 px-2 py-0.5 rounded-full">
                                                                                                <div className="w-2 h-2 bg-green-500 rounded-full"></div>
                                                                                                <span className="text-xs text-green-700 font-medium">RÃ©cent</span>
                                                                                            </div>
                                                                                        )}
                                                                                    </div>
                                                                                </div>
                                                                            </div>

                                                                            {/* Actions toujours visibles sur mobile */}
                                                                            <div className="flex items-center gap-2 ml-2">
                                                                                <button
                                                                                    onClick={() => editEntry(entry.id)}
                                                                                    className="w-9 h-9 rounded-2xl bg-blue-50 flex items-center justify-center active:scale-95 transition-transform"
                                                                                >
                                                                                    <i className="fas fa-edit text-sm text-blue-600"></i>
                                                                                </button>
                                                                                <button
                                                                                    onClick={() => deleteEntry(entry.id)}
                                                                                    className="w-9 h-9 rounded-2xl bg-red-50 flex items-center justify-center active:scale-95 transition-transform"
                                                                                >
                                                                                    <i className="fas fa-trash text-sm text-red-600"></i>
                                                                                </button>
                                                                            </div>
                                                                        </div>

                                                                        {/* SÃ©parateur */}
                                                                        <div className="h-px bg-gradient-to-r from-transparent via-gray-200 to-transparent mb-4 opacity-60"></div>

                                                                        {/* Contenu principal */}
                                                                        <div className="space-y-3">
                                                                            {/* DonnÃ©es biberon */}
                                                                            {entry.type === 'feeding' && entry.amount && (
                                                                                <div className="flex items-center gap-3 flex-wrap">
                                                                                    <div className={`flex items-center gap-2 px-4 py-2 rounded-2xl ${themeColors.primaryLight} ${themeColors.primaryBorder} border`}>
                                                                                        <i className="fas fa-tint text-sm opacity-70"></i>
                                                                                        <span className="font-bold text-base">{entry.amount}ml</span>
                                                                                    </div>

                                                                                    {/* Pourcentage de la recommandation */}
                                                                                    {(() => {
                                                                                        const age = calculateAge();
                                                                                        const weightCalculation = currentWeight ? calculateMilkByWeight(currentWeight, age) : null;
                                                                                        const recommendations = getFeedingRecommendations(age);

                                                                                        let expectedAmount = null;
                                                                                        if (weightCalculation) {
                                                                                            expectedAmount = weightCalculation.mlPerFeeding;
                                                                                        } else if (recommendations) {
                                                                                            expectedAmount = getDefaultAmount(recommendations.volume);
                                                                                        }

                                                                                        if (expectedAmount) {
                                                                                            const percentage = Math.round((entry.amount / expectedAmount) * 100);
                                                                                            let percentageClass = 'bg-green-100 text-green-800 border-green-200';
                                                                                            if (percentage < 80) percentageClass = 'bg-orange-100 text-orange-800 border-orange-200';
                                                                                            if (percentage < 60) percentageClass = 'bg-red-100 text-red-800 border-red-200';
                                                                                            if (percentage > 120) percentageClass = 'bg-blue-100 text-blue-800 border-blue-200';

                                                                                            return (
                                                                                                <div className={`px-3 py-1 rounded-full text-xs font-medium border ${percentageClass}`}>
                                                                                                    {percentage}% recommandÃ©
                                                                                                </div>
                                                                                            );
                                                                                        }
                                                                                        return null;
                                                                                    })()}
                                                                                </div>
                                                                            )}

                                                                            {/* Informations change */}
                                                                            {(entry.hasPee || entry.hasPoop) && (
                                                                                <div className="flex items-center gap-3 flex-wrap">
                                                                                    {entry.hasPee && (
                                                                                        <div className="flex items-center gap-2 px-4 py-2 rounded-2xl bg-blue-100 border border-blue-200">
                                                                                            <span className="text-base">ðŸ’§</span>
                                                                                            <span className="font-medium text-blue-800 text-sm">Pipi</span>
                                                                                        </div>
                                                                                    )}
                                                                                    {entry.hasPoop && (
                                                                                        <div className="flex items-center gap-2 px-4 py-2 rounded-2xl bg-amber-100 border border-amber-200">
                                                                                            {poopDisplay}
                                                                                        </div>
                                                                                    )}
                                                                                </div>
                                                                            )}
                                                                        </div>

                                                                        {/* Footer informatif */}
                                                                        <div className="mt-4 pt-3 border-t border-gray-100">
                                                                            <div className="flex items-center justify-between text-xs text-gray-500">
                                                                                <span>#{entry.id.slice(-6)}</span>
                                                                                <span>
                                                                                    {minutesAgo < 60
                                                                                        ? `Il y a ${minutesAgo} min`
                                                                                        : `Il y a ${Math.floor(minutesAgo / 60)}h${minutesAgo % 60 > 0 ? `${minutesAgo % 60}min` : ''}`
                                                                                    }
                                                                                </span>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            );
                                                        })
                                                    )}

                                                    {/* Pagination */}
                                                    {totalPages > 1 && (
                                                        <div className="flex items-center justify-center gap-2 mt-4">
                                                            <button
                                                                onClick={() => setCurrentPage(Math.max(0, currentPage - 1))}
                                                                disabled={currentPage === 0}
                                                                className="px-3 py-1 rounded-lg border disabled:opacity-50"
                                                            >
                                                                â†
                                                            </button>
                                                            <span className="text-sm text-gray-600">
                                                                Page {currentPage + 1} sur {totalPages}
                                                            </span>
                                                            <button
                                                                onClick={() => setCurrentPage(Math.min(totalPages - 1, currentPage + 1))}
                                                                disabled={currentPage === totalPages - 1}
                                                                className="px-3 py-1 rounded-lg border disabled:opacity-50"
                                                            >
                                                                â†’
                                                            </button>
                                                        </div>
                                                    )}
                                                </>
                                            );
                                        })()}
                                    </div>
                                </div>

                            </>
                        )}
                        {/* Vue MÃ©dical */}
                        {currentView === 'medical' && (
                            <div className="space-y-4">
                                {/* Header avec style unifiÃ© */}
                                <div className="bg-white/95 backdrop-blur-xl rounded-2xl shadow-lg border border-white/50 p-4">
                                    <div className="flex items-center justify-between mb-4">
                                        <h2 className="text-xl font-bold text-gray-900">Suivi mÃ©dical</h2>
                                        <button
                                            onClick={() => setShowExportMenu(true)}
                                            className="bg-blue-500 text-white px-4 py-2 rounded-xl text-sm font-medium shadow-lg active:scale-95 transition-transform flex items-center gap-2"
                                        >
                                            <i className="fas fa-download"></i>
                                            Export pÃ©diatre
                                        </button>
                                    </div>

                                    {/* Boutons actions dans des cartes */}
                                    <div className="grid grid-cols-2 gap-3">
                                        <button
                                            onClick={() => {
                                                setMedicationData({
                                                    name: '',
                                                    dosage: '',
                                                    date: getCurrentDate(),
                                                    time: getCurrentTime(),
                                                    interval: ''
                                                });
                                                setCurrentView('medication-form');
                                            }}
                                            className="bg-white/80 border border-white/30 rounded-2xl p-4 shadow-xl active:scale-95 transition-transform"
                                        >
                                            <div className="w-12 h-12 bg-green-100 rounded-2xl flex items-center justify-center mb-3 mx-auto">
                                                <i className="fas fa-pills text-green-600 text-xl"></i>
                                            </div>
                                            <div className="text-center">
                                                <h3 className="font-semibold text-gray-900 mb-1">MÃ©dicament</h3>
                                                <p className="text-xs text-gray-600">Ajouter un traitement</p>
                                            </div>
                                        </button>

                                        <button
                                            onClick={() => {
                                                setAppointmentData({
                                                    type: '',
                                                    doctor: '',
                                                    date: getCurrentDate(),
                                                    time: '',
                                                    location: ''
                                                });
                                                setCurrentView('appointment-form');
                                            }}
                                            className="bg-white/80 border border-white/30 rounded-2xl p-4 shadow-xl active:scale-95 transition-transform"
                                        >
                                            <div className="w-12 h-12 bg-purple-100 rounded-2xl flex items-center justify-center mb-3 mx-auto">
                                                <i className="fas fa-calendar-plus text-purple-600 text-xl"></i>
                                            </div>
                                            <div className="text-center">
                                                <h3 className="font-semibold text-gray-900 mb-1">Rendez-vous</h3>
                                                <p className="text-xs text-gray-600">Programmer un RDV</p>
                                            </div>
                                        </button>
                                    </div>
                                </div>
                                {/* Soins quotidiens */}
                                <div>
                                    <div className="flex items-center justify-between mb-3">
                                        <h3 className="text-lg font-semibold text-gray-800">ðŸ§¼ Soins quotidiens</h3>
                                        {(() => {
                                            const reminders = getCareReminders();
                                            return reminders.length > 0 && (
                                                <div className="bg-orange-100 text-orange-800 px-2 py-1 rounded-full text-xs font-bold">
                                                    {reminders.length} restant
                                                </div>
                                            );
                                        })()}
                                    </div>

                                    <div className="space-y-3">
                                        {!dailyCare ? (
                                            <div className="text-center py-4">
                                                <div className="animate-spin w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full mx-auto mb-2"></div>
                                                <p className="text-gray-500 text-sm">Chargement des soins...</p>
                                            </div>
                                        ) : (
                                            <>
                                                {/* Soin du cordon */}
                                                <div className={`p-3 rounded-xl border-2 ${!dailyCare.cordon.active
                                                    ? 'bg-gray-100 border-gray-300'
                                                    : (dailyCare.cordon.morning_done && dailyCare.cordon.evening_done)
                                                        ? 'bg-green-50 border-green-200'
                                                        : 'bg-orange-50 border-orange-200'}`}>

                                                    <div className="flex items-center justify-between mb-2">
                                                        <div className="flex items-center gap-3">
                                                            <span className="text-xl">
                                                                {!dailyCare.cordon.active ? 'âšª' :
                                                                    (dailyCare.cordon.morning_done && dailyCare.cordon.evening_done) ? 'âœ…' : 'ðŸ©¹'}
                                                            </span>
                                                            <div>
                                                                <h4 className="font-medium text-gray-800">
                                                                    Soin du cordon
                                                                    {!dailyCare.cordon.active && <span className="text-sm text-gray-500">(DÃ©sactivÃ©)</span>}
                                                                </h4>
                                                                <p className="text-xs text-gray-600">
                                                                    {dailyCare.cordon.active ? 'Nettoyage matin et soir' : 'Cordon tombÃ©'}
                                                                </p>
                                                            </div>
                                                        </div>

                                                        <button
                                                            onClick={toggleCordonActive}
                                                            className={`text-xs px-2 py-1 rounded ${dailyCare.cordon.active
                                                                ? 'bg-red-100 text-red-700 hover:bg-red-200'
                                                                : 'bg-blue-100 text-blue-700 hover:bg-blue-200'}`}
                                                        >
                                                            {dailyCare.cordon.active ? 'DÃ©sactiver' : 'RÃ©activer'}
                                                        </button>
                                                    </div>

                                                    {dailyCare.cordon.active && (
                                                        <div className="flex gap-4">
                                                            <button
                                                                onClick={() => toggleCare('cordon', 'morning')}
                                                                className={`px-3 py-1 rounded-lg text-sm font-medium transition-all ${dailyCare.cordon.morning_done
                                                                    ? 'bg-green-500 text-white'
                                                                    : 'bg-gray-200 text-gray-600 hover:bg-gray-300'
                                                                    }`}
                                                            >
                                                                {dailyCare.cordon.morning_done ? 'âœ“ Fait' : 'Matin'}
                                                            </button>

                                                            <button
                                                                onClick={() => toggleCare('cordon', 'evening')}
                                                                className={`px-3 py-1 rounded-lg text-sm font-medium transition-all ${dailyCare.cordon.evening_done
                                                                    ? 'bg-green-500 text-white'
                                                                    : 'bg-gray-200 text-gray-600 hover:bg-gray-300'
                                                                    }`}
                                                            >
                                                                {dailyCare.cordon.evening_done ? 'âœ“ Fait' : 'Soir'}
                                                            </button>
                                                        </div>
                                                    )}
                                                </div>

                                                {/* Nettoyage visage */}
                                                <div className={`flex items-center justify-between p-3 rounded-xl border-2 ${dailyCare.visage.done
                                                    ? 'bg-green-50 border-green-200'
                                                    : 'bg-orange-50 border-orange-200'}`}>
                                                    <div className="flex items-center gap-3">
                                                        <span className="text-xl">{dailyCare.visage.done ? 'âœ…' : 'ðŸ§¼'}</span>
                                                        <div>
                                                            <h4 className="font-medium text-gray-800">Nettoyage du visage</h4>
                                                            <p className="text-xs text-gray-600">Yeux, nez, oreilles</p>
                                                        </div>
                                                    </div>
                                                    <button
                                                        onClick={() => toggleCare('visage')}
                                                        className={`px-3 py-1 rounded-lg text-sm font-medium transition-all ${dailyCare.visage.done
                                                            ? 'bg-green-500 text-white'
                                                            : 'bg-gray-200 text-gray-600 hover:bg-gray-300'
                                                            }`}
                                                    >
                                                        {dailyCare.visage.done ? 'âœ“ Fait' : 'Ã  faire'}
                                                    </button>
                                                </div>

                                                {/* Vitamines */}
                                                <div className={`flex items-center justify-between p-3 rounded-xl border-2 ${dailyCare.vitamines.done
                                                    ? 'bg-green-50 border-green-200'
                                                    : 'bg-orange-50 border-orange-200'}`}>
                                                    <div className="flex items-center gap-3">
                                                        <span className="text-xl">{dailyCare.vitamines.done ? 'âœ…' : 'ðŸ’Š'}</span>
                                                        <div>
                                                            <h4 className="font-medium text-gray-800">Vitamines</h4>
                                                            <p className="text-xs text-gray-600">Vitamine D, K si prescrites</p>
                                                        </div>
                                                    </div>
                                                    <button
                                                        onClick={() => toggleCare('vitamines')}
                                                        className={`px-3 py-1 rounded-lg text-sm font-medium transition-all ${dailyCare.vitamines.done
                                                            ? 'bg-green-500 text-white'
                                                            : 'bg-gray-200 text-gray-600 hover:bg-gray-300'
                                                            }`}
                                                    >
                                                        {dailyCare.vitamines.done ? 'âœ“ Fait' : 'Ã  faire'}
                                                    </button>
                                                </div>
                                            </>
                                        )}
                                    </div></div>

                                {/* MÃ©dicaments */}
                                <div>
                                    <h3 className="text-lg font-semibold text-gray-800 mb-3">ðŸ’Š MÃ©dicaments</h3>
                                    <div className="space-y-3">
                                        {medications.length === 0 ? (
                                            <p className="text-gray-500 text-center py-6">Aucun mÃ©dicament enregistrÃ©</p>
                                        ) : (
                                            medications.map(medication => {
                                                const now = new Date();
                                                const lastGiven = new Date(medication.lastGiven);
                                                const hoursSinceLastDose = (now - lastGiven) / (1000 * 60 * 60);

                                                let statusClass = 'medication-available';
                                                let statusText = 'Peut Ãªtre donnÃ©';
                                                let statusIcon = 'âœ…';

                                                if (medication.interval) {
                                                    if (hoursSinceLastDose < medication.interval) {
                                                        const nextDose = new Date(lastGiven);
                                                        nextDose.setHours(nextDose.getHours() + medication.interval);

                                                        const hoursRemaining = medication.interval - hoursSinceLastDose;

                                                        if (hoursRemaining <= 1) {
                                                            statusClass = 'medication-soon pulse-gentle';
                                                            statusText = `Prochaine prise Ã  : ${formatTime(nextDose.toISOString())}`;
                                                            statusIcon = 'â°';
                                                        } else {
                                                            statusClass = 'medication-waiting';
                                                            statusText = `Prochaine prise Ã  : ${formatTime(nextDose.toISOString())}`;
                                                            statusIcon = 'â³';
                                                        }
                                                    }
                                                }

                                                return (
                                                    <div key={medication.id} className={`${statusClass} rounded-xl p-3 border-2`}>
                                                        <div className="flex items-center justify-between mb-2">
                                                            <div className="flex items-center gap-2">
                                                                <span className="text-lg">{statusIcon}</span>
                                                                <div>
                                                                    <h5 className="font-semibold text-gray-800">{medication.name}</h5>
                                                                    <p className="text-sm text-gray-600">{medication.dosage}</p>
                                                                </div>
                                                            </div>
                                                            <div className="text-right">
                                                                <p className="text-xs text-gray-500">{formatDateTime(medication.lastGiven)}</p>
                                                                <p className="text-xs font-medium">{statusText}</p>
                                                            </div>
                                                        </div>
                                                        <div className="flex gap-2">
                                                            {hoursSinceLastDose >= (medication.interval || 0) ? (
                                                                <button
                                                                    onClick={() => giveMedication(medication.id)}
                                                                    className="flex-1 bg-green-500 text-white py-2 rounded-lg text-sm font-medium"
                                                                >
                                                                    Donner maintenant
                                                                </button>
                                                            ) : (
                                                                <button
                                                                    disabled
                                                                    className="flex-1 bg-gray-300 text-gray-500 py-2 rounded-lg text-sm font-medium"
                                                                >
                                                                    Pas encore
                                                                </button>
                                                            )}
                                                            <button
                                                                onClick={() => deleteMedication(medication.id)}
                                                                className="px-3 bg-red-100 text-red-600 rounded-lg text-sm"
                                                            >
                                                                <i className="fas fa-trash"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                );
                                            })
                                        )}
                                    </div>
                                </div>

                                {/* Rendez-vous */}
                                <div className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30">
                                    <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
                                        <div className="w-8 h-8 bg-purple-100 rounded-xl flex items-center justify-center">
                                            <i className="fas fa-calendar text-purple-600"></i>
                                        </div>
                                        Rendez-vous
                                    </h3>
                                    <div className="space-y-3">
                                        {appointments.length === 0 ? (
                                            <div className="text-center py-8">
                                                <div className="w-16 h-16 bg-purple-100 rounded-2xl flex items-center justify-center mx-auto mb-3">
                                                    <i className="fas fa-calendar-plus text-purple-600 text-2xl"></i>
                                                </div>
                                                <p className="text-gray-500 font-medium">Aucun rendez-vous programmÃ©</p>
                                                <p className="text-gray-400 text-sm">Ajoutez un RDV mÃ©dical</p>
                                            </div>
                                        ) : (

                                            appointments.map(appointment => {
                                                const appointmentDate = new Date(appointment.timestamp);
                                                const now = new Date();
                                                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                                                const appointmentDay = new Date(appointmentDate.getFullYear(), appointmentDate.getMonth(), appointmentDate.getDate());

                                                let statusClass = '';
                                                let statusIcon = 'ðŸ“…';

                                                if (appointmentDay.getTime() === today.getTime()) {
                                                    statusClass = 'appointment-today pulse-gentle';
                                                    statusIcon = 'ðŸš¨';
                                                } else if (appointmentDate > now && appointmentDate < new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000)) {
                                                    statusClass = 'appointment-upcoming';
                                                    statusIcon = 'â°';
                                                }

                                                return (
                                                    <div key={appointment.id} className={`${statusClass} rounded-xl p-3 border-2 border-gray-200`}>
                                                        <div className="flex items-center justify-between mb-2">
                                                            <div className="flex items-center gap-2">
                                                                <span className="text-lg">{statusIcon}</span>
                                                                <div>
                                                                    <h5 className="font-semibold text-gray-800">{appointment.type}</h5>
                                                                    <p className="text-sm text-gray-600">{appointment.doctor || 'Praticien non renseignÃ©'}</p>
                                                                </div>
                                                            </div>
                                                            <button
                                                                onClick={() => deleteAppointment(appointment.id)}
                                                                className="text-red-500 hover:text-red-700"
                                                            >
                                                                <i className="fas fa-trash"></i>
                                                            </button>
                                                        </div>
                                                        <div className="text-sm text-gray-600">
                                                            <p><i className="far fa-calendar mr-2"></i>{formatDateTime(appointment.timestamp)}</p>
                                                            {appointment.location && (
                                                                <p><i className="fas fa-map-marker-alt mr-2"></i>{appointment.location}</p>
                                                            )}
                                                        </div>
                                                    </div>
                                                );
                                            })
                                        )}
                                    </div>
                                </div>

                                {/* Vaccins */}
                                <div className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30">
                                    <div className="flex items-center justify-between mb-4">
                                        <h3 className="text-lg font-semibold text-gray-900 flex items-center gap-2">
                                            <div className="w-8 h-8 bg-green-100 rounded-xl flex items-center justify-center">
                                                <i className="fas fa-syringe text-green-600"></i>
                                            </div>
                                            Suivi vaccinal
                                        </h3>
                                        <button
                                            onClick={() => setCurrentView('vaccine-form')}
                                            className="bg-green-500 text-white px-4 py-2 rounded-xl text-sm font-medium shadow-lg active:scale-95 transition-transform"
                                        >
                                            + Vaccin
                                        </button>
                                    </div>

                                    {/* Vaccins Ã  venir selon l'Ã¢ge */}
                                    {(() => {
                                        const ageInMonths = Math.floor(age / 30);
                                        const upcomingVaccines = [];

                                        Object.keys(VACCINE_SCHEDULE).forEach(monthKey => {
                                            const month = parseInt(monthKey);
                                            if (month >= ageInMonths && month <= ageInMonths + 2) {
                                                VACCINE_SCHEDULE[month].forEach(vaccine => {
                                                    const isAlreadyDone = vaccines.some(v => v.name.includes(vaccine.name.split('(')[0].trim()));
                                                    if (!isAlreadyDone) {
                                                        upcomingVaccines.push({ ...vaccine, dueMonth: month });
                                                    }
                                                });
                                            }
                                        });

                                        return upcomingVaccines.length > 0 && (
                                            <div className="bg-blue-50 rounded-lg p-3 mb-3">
                                                <h4 className="font-medium text-blue-800 mb-2">ðŸ“… Vaccins Ã  prÃ©voir :</h4>
                                                <div className="space-y-1">
                                                    {upcomingVaccines.map((vaccine, index) => (
                                                        <div key={index} className="text-sm text-blue-700">
                                                            <span className="font-medium">{vaccine.dueMonth} mois :</span> {vaccine.name}
                                                            {vaccine.required && <span className="text-red-600"> *</span>}
                                                        </div>
                                                    ))}
                                                </div>
                                                <p className="text-xs text-blue-600 mt-2">* = Obligatoire</p>
                                            </div>
                                        );
                                    })()}

                                    {/* Liste des vaccins effectuÃ©s */}
                                    <div className="space-y-3">
                                        {vaccines.length === 0 ? (
                                            <p className="text-gray-500 text-center py-6">Aucun vaccin enregistrÃ©</p>
                                        ) : (
                                            vaccines.map(vaccine => (
                                                <div key={vaccine.id} className="bg-white/80 rounded-xl p-3 shadow-sm border border-white/50">
                                                    <div className="flex items-center justify-between mb-2">
                                                        <h5 className="font-semibold text-gray-800">{vaccine.name}</h5>
                                                        <button
                                                            onClick={() => deleteVaccine(vaccine.id)}
                                                            className="text-red-500 hover:text-red-700"
                                                        >
                                                            <i className="fas fa-trash text-sm"></i>
                                                        </button>
                                                    </div>
                                                    <div className="text-sm text-gray-600">
                                                        <p><i className="fas fa-calendar mr-2"></i>{formatDate(vaccine.timestamp)}</p>
                                                        {vaccine.nextDue && (
                                                            <p><i className="fas fa-clock mr-2"></i>Prochain : {vaccine.nextDue}</p>
                                                        )}
                                                        {vaccine.notes && (
                                                            <p><i className="fas fa-note-sticky mr-2"></i>{vaccine.notes}</p>
                                                        )}
                                                    </div>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}{/* Vue Stocks */}
                        {currentView === 'supplies' && (
                            <div className="space-y-4">


                                <div className="space-y-3">
                                    {/* Lait en poudre */}
                                    <div className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30">
                                        <div className="flex items-center justify-between mb-3">
                                            <div className="flex items-center gap-3">
                                                <div className="w-12 h-12 bg-yellow-100 rounded-2xl flex items-center justify-center">
                                                    <i className="fas fa-baby text-yellow-600 text-xl"></i>
                                                </div>
                                                <div>
                                                    <h3 className="font-bold text-gray-900">Lait en poudre</h3>
                                                    <p className="text-sm text-gray-600">Suivi de la date d'ouverture</p>
                                                </div>
                                            </div>
                                            <button
                                                onClick={setMilkPowderDate}
                                                className="bg-blue-500 text-white px-4 py-2 rounded-xl text-sm font-medium shadow-lg active:scale-95 transition-transform"
                                            >
                                                DÃ©finir date
                                            </button>
                                        </div>

                                        <div className="bg-gray-50 rounded-xl p-3">
                                            <div className="flex items-center gap-2 mb-2">
                                                <i className="fas fa-calendar-alt text-gray-500"></i>
                                                <span className="text-sm font-medium text-gray-700">Date d'ouverture</span>
                                            </div>
                                            <p className="text-lg font-bold text-gray-900 mb-2">
                                                {stocks['milk-powder']?.date || 'Non renseignÃ©e'}
                                            </p>
                                            {stocks['milk-powder']?.date && (
                                                <div className="bg-orange-100 border border-orange-200 rounded-lg p-2">
                                                    <div className="flex items-center gap-2">
                                                        <i className="fas fa-exclamation-triangle text-orange-600 text-sm"></i>
                                                        <span className="text-xs text-orange-800 font-medium">
                                                            Ã€ consommer dans les 3-4 semaines aprÃ¨s ouverture
                                                        </span>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    {/* Bouteille d'eau */}
                                    <div className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30">
                                        <div className="flex items-center justify-between mb-3">
                                            <div className="flex items-center gap-3">
                                                <div className="w-12 h-12 bg-blue-100 rounded-2xl flex items-center justify-center">
                                                    <i className="fas fa-tint text-blue-600 text-xl"></i>
                                                </div>
                                                <div>
                                                    <h3 className="font-bold text-gray-900">Bouteille d'eau</h3>
                                                    <p className="text-sm text-gray-600">Suivi de l'ouverture</p>
                                                </div>
                                            </div>
                                            <button
                                                onClick={setWaterBottleDateTime}
                                                className="bg-blue-500 text-white px-4 py-2 rounded-xl text-sm font-medium shadow-lg active:scale-95 transition-transform"
                                            >
                                                DÃ©finir date/heure
                                            </button>
                                        </div>

                                        <div className="bg-gray-50 rounded-xl p-3">
                                            <div className="flex items-center gap-2 mb-2">
                                                <i className="fas fa-clock text-gray-500"></i>
                                                <span className="text-sm font-medium text-gray-700">Ouverture</span>
                                            </div>
                                            <p className="text-lg font-bold text-gray-900 mb-2">
                                                {stocks['water-bottle']?.datetime || 'Non renseignÃ©e'}
                                            </p>
                                            {stocks['water-bottle']?.datetime && (
                                                <div className="bg-orange-100 border border-orange-200 rounded-lg p-2">
                                                    <div className="flex items-center gap-2">
                                                        <i className="fas fa-exclamation-triangle text-orange-600 text-sm"></i>
                                                        <span className="text-xs text-orange-800 font-medium">
                                                            Ã€ consommer dans les 48-72h aprÃ¨s ouverture
                                                        </span>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* Vue Diversification */}
                        {currentView === 'food' && (
                            <div className="space-y-4">

                                {(() => {
                                    const diversification = getDiversificationRecommendations(age);

                                    if (diversification.phase === 'Pas encore') {
                                        return (
                                            <div className="bg-white/90 backdrop-blur-sm rounded-2xl p-6 shadow-xl border border-white/30 text-center">
                                                <div className="w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                                                    <i className="fas fa-baby-carriage text-blue-600 text-2xl"></i>
                                                </div>
                                                <h3 className="text-lg font-bold text-gray-900 mb-2">{diversification.phase}</h3>
                                                <p className="text-sm text-gray-700 mb-3">{diversification.message}</p>
                                                <div className="bg-blue-50 rounded-xl p-3">
                                                    <p className="text-xs text-blue-800 font-medium">{diversification.recommendation}</p>
                                                </div>
                                            </div>
                                        );
                                    }

                                    return (
                                        <div className="space-y-4">
                                            {/* Phase actuelle */}
                                            <div className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30">
                                                <div className="flex items-center gap-3 mb-3">
                                                    <div className="w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center">
                                                        <i className="fas fa-calendar-check text-green-600"></i>
                                                    </div>
                                                    <div>
                                                        <h3 className="text-lg font-bold text-gray-900">Phase : {diversification.phase}</h3>
                                                        <p className="text-sm text-gray-600">Principes Ã  suivre</p>
                                                    </div>
                                                </div>
                                                <div className="bg-green-50 rounded-xl p-3">
                                                    {diversification.principles.map((principle, index) => (
                                                        <div key={index} className="flex items-start gap-2 mb-1 last:mb-0">
                                                            <div className="w-1.5 h-1.5 bg-green-500 rounded-full mt-2 flex-shrink-0"></div>
                                                            <span className="text-sm text-green-800">{principle}</span>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>

                                            {/* LÃ©gumes */}
                                            {/* LÃ©gumes */}
                                            {diversification.legumes && diversification.legumes.length > 0 && (
                                                <div className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30">
                                                    <h4 className="font-bold text-gray-900 mb-3 flex items-center gap-2">
                                                        <div className="w-8 h-8 bg-green-100 rounded-xl flex items-center justify-center">
                                                            <i className="fas fa-carrot text-green-600"></i>
                                                        </div>
                                                        LÃ©gumes recommandÃ©s
                                                    </h4>
                                                    <div className="space-y-2">
                                                        {diversification.legumes.map((legume, index) => (
                                                            <div key={index} className="bg-green-50 rounded-xl p-3 border border-green-200">
                                                                <div className="flex items-center justify-between mb-1">
                                                                    <span className="font-semibold text-green-800">{legume.nom}</span>
                                                                    <span className="text-xs bg-green-200 text-green-800 px-2 py-1 rounded-full">{legume.quantite}</span>
                                                                </div>
                                                                <div className="text-xs text-green-700">
                                                                    <span className="font-medium">PrÃ©paration:</span> {legume.preparation}
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}

                                            {/* Fruits */}
                                            {diversification.fruits && diversification.fruits.length > 0 && (
                                                <div className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30">
                                                    <h4 className="font-bold text-gray-900 mb-3 flex items-center gap-2">
                                                        <div className="w-8 h-8 bg-orange-100 rounded-xl flex items-center justify-center">
                                                            <i className="fas fa-apple-alt text-orange-600"></i>
                                                        </div>
                                                        Fruits recommandÃ©s
                                                    </h4>
                                                    <div className="space-y-2">
                                                        {diversification.fruits.map((fruit, index) => (
                                                            <div key={index} className="bg-orange-50 rounded-xl p-3 border border-orange-200">
                                                                <div className="flex items-center justify-between mb-1">
                                                                    <span className="font-semibold text-orange-800">{fruit.nom}</span>
                                                                    <span className="text-xs bg-orange-200 text-orange-800 px-2 py-1 rounded-full">{fruit.quantite}</span>
                                                                </div>
                                                                <div className="text-xs text-orange-700">
                                                                    <span className="font-medium">PrÃ©paration:</span> {fruit.preparation}
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}

                                            {/* FÃ©culents (si applicable) */}
                                            {diversification.feculents && diversification.feculents.length > 0 && (
                                                <div className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30">
                                                    <h4 className="font-bold text-gray-900 mb-3 flex items-center gap-2">
                                                        <div className="w-8 h-8 bg-yellow-100 rounded-xl flex items-center justify-center">
                                                            <i className="fas fa-bread-slice text-yellow-600"></i>
                                                        </div>
                                                        FÃ©culents
                                                    </h4>
                                                    <div className="space-y-2">
                                                        {diversification.feculents.map((feculent, index) => (
                                                            <div key={index} className="bg-yellow-50 rounded-xl p-3 border border-yellow-200">
                                                                <div className="flex items-center justify-between mb-1">
                                                                    <span className="font-semibold text-yellow-800">{feculent.nom}</span>
                                                                    <span className="text-xs bg-yellow-200 text-yellow-800 px-2 py-1 rounded-full">{feculent.quantite}</span>
                                                                </div>
                                                                <div className="text-xs text-yellow-700">
                                                                    <span className="font-medium">PrÃ©paration:</span> {feculent.preparation}
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}

                                            {/* ProtÃ©ines (si applicable) */}
                                            {diversification.proteines && diversification.proteines.length > 0 && (
                                                <div className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30">
                                                    <h4 className="font-bold text-gray-900 mb-3 flex items-center gap-2">
                                                        <div className="w-8 h-8 bg-red-100 rounded-xl flex items-center justify-center">
                                                            <i className="fas fa-drumstick-bite text-red-600"></i>
                                                        </div>
                                                        ProtÃ©ines
                                                    </h4>
                                                    <div className="space-y-2">
                                                        {diversification.proteines.map((proteine, index) => (
                                                            <div key={index} className="bg-red-50 rounded-xl p-3 border border-red-200">
                                                                <div className="flex items-center justify-between mb-1">
                                                                    <span className="font-semibold text-red-800">{proteine.nom}</span>
                                                                    <span className="text-xs bg-red-200 text-red-800 px-2 py-1 rounded-full">{proteine.quantite}</span>
                                                                </div>
                                                                <div className="text-xs text-red-700">
                                                                    <span className="font-medium">PrÃ©paration:</span> {proteine.preparation}
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}

                                            {/* Aliments interdits */}
                                            {diversification.interdits && diversification.interdits.length > 0 && (
                                                <div className="bg-red-50 border border-red-200 rounded-xl p-3">
                                                    <h4 className="font-medium text-red-800 mb-2 flex items-center gap-2">
                                                        <i className="fas fa-ban text-red-600"></i>
                                                        Ã€ Ã©viter Ã  cet Ã¢ge
                                                    </h4>
                                                    <div className="flex flex-wrap gap-2">
                                                        {diversification.interdits.map((interdit, index) => (
                                                            <span key={index} className="text-xs bg-red-200 text-red-800 px-2 py-1 rounded-full">
                                                                {interdit}
                                                            </span>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}
                                            {/* Suivi personnalisÃ© */}
                                            <div className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30">
                                                <div className="flex items-center justify-between mb-3">
                                                    <h3 className="text-lg font-bold text-gray-900 flex items-center gap-2">
                                                        <div className="w-8 h-8 bg-purple-100 rounded-xl flex items-center justify-center">
                                                            <i className="fas fa-clipboard-list text-purple-600"></i>
                                                        </div>
                                                        Mon suivi personnalisÃ©
                                                    </h3>
                                                    <button
                                                        onClick={() => setCurrentView('diversification-form')}
                                                        className="bg-orange-500 text-white px-3 py-1 rounded-lg text-sm font-medium shadow-lg active:scale-95 transition-transform"
                                                    >
                                                        + Aliment testÃ©
                                                    </button>
                                                </div>

                                                <div className="space-y-3">
                                                    {diversificationEntries.length === 0 ? (
                                                        <div className="text-center py-6">
                                                            <div className="w-12 h-12 bg-gray-100 rounded-xl flex items-center justify-center mx-auto mb-3">
                                                                <i className="fas fa-utensils text-gray-400"></i>
                                                            </div>
                                                            <p className="text-gray-500 font-medium">Aucun aliment testÃ©</p>
                                                            <p className="text-gray-400 text-sm">Commencez Ã  enregistrer les tests</p>
                                                        </div>
                                                    ) : (
                                                        diversificationEntries.map(entry => (
                                                            <div key={entry.id} className="bg-white/80 rounded-xl p-3 shadow-sm border border-white/50">
                                                                <div className="flex items-center justify-between mb-2">
                                                                    <div className="flex items-center gap-2">
                                                                        <h5 className="font-semibold text-gray-800">{entry.food}</h5>
                                                                        <div className="flex items-center gap-1">
                                                                            {[...Array(Math.floor(entry.rating / 2))].map((_, i) => (
                                                                                <i key={i} className="fas fa-star text-yellow-400 text-xs"></i>
                                                                            ))}
                                                                            <span className="text-xs text-gray-600 ml-1">{entry.rating}/10</span>
                                                                        </div>
                                                                    </div>
                                                                    <button
                                                                        onClick={() => deleteDiversificationEntry(entry.id)}
                                                                        className="text-red-500 hover:text-red-700 p-1"
                                                                    >
                                                                        <i className="fas fa-trash text-sm"></i>
                                                                    </button>
                                                                </div>
                                                                <div className="text-sm text-gray-600">
                                                                    <p className="flex items-center gap-2">
                                                                        <i className="fas fa-calendar text-gray-400"></i>
                                                                        {formatDate(entry.timestamp)}
                                                                    </p>
                                                                    {entry.notes && (
                                                                        <p className="flex items-start gap-2 mt-1">
                                                                            <i className="fas fa-sticky-note text-gray-400 mt-0.5"></i>
                                                                            {entry.notes}
                                                                        </p>
                                                                    )}
                                                                </div>
                                                            </div>
                                                        ))
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })()}
                            </div>
                        )}
                        {/* Vue Garde-robe */}
                        {currentView === 'wardrobe' && (
                            <div className="space-y-4">
                                {/* Header avec style unifiÃ© */}
                                <div className="flex justify-end">
                                    <button
                                        onClick={() => setCurrentView('wardrobe-form')}
                                        className="bg-pink-500 text-white px-4 py-2 rounded-xl text-sm font-medium shadow-lg active:scale-95 transition-transform"
                                    >
                                        + Article
                                    </button>
                                </div>
                                {/* Tri par taille */}
                                {(() => {
                                    const groupedBySize = {};
                                    wardrobe.forEach(item => {
                                        if (!groupedBySize[item.size]) {
                                            groupedBySize[item.size] = [];
                                        }
                                        groupedBySize[item.size].push(item);
                                    });

                                    const sizes = Object.keys(groupedBySize).sort((a, b) => {
                                        const sizeOrder = ['Naissance', '1 mois', '3 mois', '6 mois', '9 mois', '12 mois', '18 mois', '2 ans', '3 ans'];
                                        return sizeOrder.indexOf(a) - sizeOrder.indexOf(b);
                                    });

                                    return sizes.length === 0 ? (
                                        <div className="bg-white/90 backdrop-blur-sm rounded-2xl p-6 shadow-xl border border-white/30 text-center">
                                            <div className="w-16 h-16 bg-pink-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                                                <i className="fas fa-tshirt text-pink-600 text-2xl"></i>
                                            </div>
                                            <p className="text-gray-500 font-medium">Aucun vÃªtement enregistrÃ©</p>
                                            <p className="text-gray-400 text-sm">Commencez Ã  crÃ©er votre inventaire</p>
                                        </div>
                                    ) : (
                                        sizes.map(size => (
                                            <div key={size} className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30">
                                                <h3 className="font-bold text-gray-900 mb-3 flex items-center gap-2">
                                                    <div className="w-8 h-8 bg-blue-100 rounded-xl flex items-center justify-center">
                                                        <i className="fas fa-ruler text-blue-600"></i>
                                                    </div>
                                                    Taille {size}
                                                    <span className="text-sm bg-gray-100 text-gray-600 px-2 py-1 rounded-full font-medium ml-auto">
                                                        {groupedBySize[size].length} article{groupedBySize[size].length > 1 ? 's' : ''}
                                                    </span>
                                                </h3>
                                                <div className="space-y-2">
                                                    {groupedBySize[size].map(item => (
                                                        <div key={item.id} className="bg-white/80 rounded-xl p-3 shadow-sm border border-white/50">
                                                            <div className="flex items-center justify-between mb-2">
                                                                <div className="flex items-center gap-3">
                                                                    <div className="w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center">
                                                                        <i className={`text-lg text-purple-600 ${item.type === 'Body manche courte' ? 'fas fa-tshirt' :
                                                                            item.type === 'Body manche longue' ? 'fas fa-tshirt' :
                                                                                item.type === 'T-shirt manche courte' ? 'fas fa-tshirt' :
                                                                                    item.type === 'T-shirt manche longue' ? 'fas fa-tshirt' :
                                                                                        item.type === 'Pull' ? 'fas fa-user-tie' :
                                                                                            item.type === 'Pyjama' ? 'fas fa-bed' :
                                                                                                item.type === 'Pantalon' ? 'fas fa-child' :
                                                                                                    item.type === 'Robe' ? 'fas fa-female' :
                                                                                                        item.type === 'Gigoteuse' ? 'fas fa-baby' :
                                                                                                            item.type === 'Chaussettes' ? 'fas fa-socks' :
                                                                                                                item.type === 'Bonnet' ? 'fas fa-hat-wizard' :
                                                                                                                    item.type === 'Gilet' ? 'fas fa-vest' :
                                                                                                                        'fas fa-question'
                                                                            }`}></i>
                                                                    </div>
                                                                    <div>
                                                                        <span className="font-semibold text-gray-800">{item.type}</span>
                                                                        <div className="flex items-center gap-2 mt-1">
                                                                            <span className="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded-full font-medium">
                                                                                QuantitÃ©: {item.quantity}
                                                                            </span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div className="flex items-center gap-2">
                                                                    <button
                                                                        onClick={() => editWardrobeItem(item.id)}
                                                                        className="w-8 h-8 rounded-lg bg-blue-50 flex items-center justify-center active:scale-95 transition-transform"
                                                                    >
                                                                        <i className="fas fa-edit text-blue-600 text-sm"></i>
                                                                    </button>
                                                                    <button
                                                                        onClick={() => deleteWardrobeItem(item.id)}
                                                                        className="w-8 h-8 rounded-lg bg-red-50 flex items-center justify-center active:scale-95 transition-transform"
                                                                    >
                                                                        <i className="fas fa-trash text-red-600 text-sm"></i>
                                                                    </button>
                                                                </div>
                                                            </div>
                                                            {item.notes && (
                                                                <div className="bg-gray-50 rounded-lg p-2 mt-2">
                                                                    <p className="text-sm text-gray-600 flex items-start gap-2">
                                                                        <i className="fas fa-sticky-note text-gray-400 mt-0.5"></i>
                                                                        {item.notes}
                                                                    </p>
                                                                </div>
                                                            )}
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        ))
                                    );
                                })()}
                            </div>
                        )}
                        {/* Vue Conseils - maintenant avec motricitÃ© */}
                        {currentView === 'tips' && (
                            <div className="space-y-4">
                                {(() => {
                                    const motorGuide = getMotorDevelopmentForAge(age);

                                    return (
                                        <div className="space-y-4">
                                            {/* Guide de motricitÃ© principal */}
                                            <div className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30">
                                                <div className="flex items-center gap-3 mb-3">
                                                    <div className="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center">
                                                        <i className="fas fa-running text-blue-600"></i>
                                                    </div>
                                                    <div>
                                                        <h3 className="text-lg font-bold text-gray-900">{motorGuide.title}</h3>
                                                        <p className="text-sm text-gray-600">{motorGuide.description}</p>
                                                    </div>
                                                </div>

                                                {/* CapacitÃ©s attendues */}
                                                <div className="bg-blue-50 rounded-xl p-3 mb-4">
                                                    <h4 className="text-sm font-semibold text-blue-800 mb-2 flex items-center gap-2">
                                                        <i className="fas fa-check-circle text-blue-600"></i>
                                                        CapacitÃ©s dÃ©veloppÃ©es
                                                    </h4>
                                                    <div className="space-y-2">
                                                        {motorGuide.skills.map((skill, index) => (
                                                            <div key={index} className="flex items-start gap-2">
                                                                <div className="w-1.5 h-1.5 bg-blue-500 rounded-full mt-2 flex-shrink-0"></div>
                                                                <span className="text-sm text-blue-700">{skill}</span>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Exercices recommandÃ©s */}
                                            <div className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30">
                                                <h4 className="text-lg font-bold text-gray-900 mb-3 flex items-center gap-2">
                                                    <div className="w-8 h-8 bg-green-100 rounded-xl flex items-center justify-center">
                                                        <i className="fas fa-dumbbell text-green-600"></i>
                                                    </div>
                                                    Exercices recommandÃ©s
                                                </h4>
                                                <div className="space-y-3">
                                                    {motorGuide.exercises.map((exercise, index) => (
                                                        <div key={index} className="bg-white/80 rounded-xl p-3 shadow-sm border border-white/50">
                                                            <div className="flex items-center justify-between mb-2">
                                                                <h5 className="font-semibold text-gray-800">{exercise.name}</h5>
                                                                <span className="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full font-medium">
                                                                    {exercise.duration}
                                                                </span>
                                                            </div>
                                                            <p className="text-sm text-gray-700 mb-3">{exercise.description}</p>

                                                            <div className="grid grid-cols-1 gap-2">
                                                                <div className="bg-green-50 rounded-lg p-2">
                                                                    <div className="flex items-start gap-2">
                                                                        <i className="fas fa-heart text-green-600 text-xs mt-1"></i>
                                                                        <span className="text-xs text-green-800">
                                                                            <strong>BÃ©nÃ©fices:</strong> {exercise.benefits}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                                <div className="bg-orange-50 rounded-lg p-2">
                                                                    <div className="flex items-start gap-2">
                                                                        <i className="fas fa-shield-alt text-orange-600 text-xs mt-1"></i>
                                                                        <span className="text-xs text-orange-800">
                                                                            <strong>SÃ©curitÃ©:</strong> {exercise.safety}
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>

                                            {/* Conseils gÃ©nÃ©raux */}
                                            <div className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30">
                                                <h4 className="text-lg font-bold text-gray-900 mb-3 flex items-center gap-2">
                                                    <div className="w-8 h-8 bg-purple-100 rounded-xl flex items-center justify-center">
                                                        <i className="fas fa-lightbulb text-purple-600"></i>
                                                    </div>
                                                    Conseils gÃ©nÃ©raux
                                                </h4>
                                                {(() => {
                                                    const tips = getTipsForAge(age);
                                                    return (
                                                        <div className="space-y-3">
                                                            {tips.sections.slice(0, 2).map((section, index) => (
                                                                <div key={index} className={`${section.color} rounded-xl p-3 border border-white/50`}>
                                                                    <h5 className={`font-semibold ${section.textColor} mb-2`}>{section.title}</h5>
                                                                    <div className="space-y-1">
                                                                        {section.tips.slice(0, 3).map((tip, tipIndex) => (
                                                                            <div key={tipIndex} className="flex items-start gap-2">
                                                                                <div className="w-1 h-1 bg-current rounded-full mt-2 flex-shrink-0 opacity-60"></div>
                                                                                <span className="text-xs">{tip}</span>
                                                                            </div>
                                                                        ))}
                                                                    </div>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    );
                                                })()}
                                            </div>

                                            {/* Note importante */}
                                            <div className="bg-blue-50 border border-blue-200 rounded-xl p-3">
                                                <div className="flex items-start gap-2">
                                                    <i className="fas fa-info-circle text-blue-500 text-sm mt-0.5"></i>
                                                    <div className="text-xs text-blue-700">
                                                        <strong>Important:</strong> Chaque bÃ©bÃ© se dÃ©veloppe Ã  son propre rythme. Ces Ã¢ges sont des repÃ¨res, pas une rÃ¨gle stricte. L'essentiel est d'offrir un environnement sÃ»r et stimulant, sans jamais forcer. En cas de prÃ©occupation, consultez votre pÃ©diatre.
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })()}
                            </div>
                        )}
                        {/* Vue Mise Ã  jour du poids */}
                        {currentView === 'weight-update' && (
                            <div className="space-y-6">
                                <div className="flex items-center justify-between">
                                    <h2 className="text-xl font-bold text-gray-800">âš–ï¸ Mise Ã  jour du poids</h2>
                                    <button
                                        onClick={() => setCurrentView('daily')}
                                        className="text-gray-500 hover:text-gray-700"
                                    >
                                        <i className="fas fa-times text-xl"></i>
                                    </button>
                                </div>

                                <div className="bg-white/90 rounded-2xl p-6 shadow-xl border border-white/50">
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                Poids actuel (kg) *
                                            </label>
                                            <input
                                                type="number"
                                                step="0.001"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                placeholder="3.500"
                                                value={currentWeight || ''}
                                                onChange={(e) => setCurrentWeight(parseFloat(e.target.value) || null)}
                                            />
                                        </div>

                                        {currentWeight && (
                                            <div className={`${themeColors.primaryLight} rounded-lg p-3`}>
                                                <h4 className="font-medium text-gray-800 mb-2">ðŸ“Š Nouveau calcul automatique :</h4>
                                                {(() => {
                                                    const calculation = calculateMilkByWeight(currentWeight, age);
                                                    return calculation ? (
                                                        <div className="space-y-3">
                                                            <div className="text-sm text-gray-700">
                                                                <p>â€¢ <strong>Total par jour :</strong> {calculation.totalPerDay}ml</p>
                                                                <p>â€¢ <strong>Biberons recommandÃ©s :</strong> {calculation.feedingsPerDay} par jour</p>
                                                                <p>â€¢ <strong>Volume par biberon :</strong> {calculation.mlPerFeeding}ml</p>
                                                            </div>

                                                            {/* Message explicatif */}
                                                            <div className="bg-gray-50 rounded-lg p-3 border border-gray-200">
                                                                <p className="text-xs text-gray-500 leading-relaxed">
                                                                    Ce calcul est une estimation pour vous donner une idÃ©e de la dose adaptÃ©e.
                                                                    Chaque bÃ©bÃ© est diffÃ©rent, en cas de doute consultez toujours votre pÃ©diatre.
                                                                </p>
                                                            </div>

                                                            {/* Astuce pratique */}
                                                            <div className="bg-blue-50 rounded-lg p-3 border border-blue-200">
                                                                <div className="flex items-start gap-2">
                                                                    <span className="text-blue-500 text-sm">ðŸ’¡</span>
                                                                    <div>
                                                                        <p className="text-xs font-medium text-blue-800 mb-1">Astuce pratique</p>
                                                                        <p className="text-xs text-blue-700 leading-relaxed">
                                                                            Si votre bÃ©bÃ© a encore faim avant 2 heures d'intervalle,
                                                                            vous pouvez augmenter la dose de 10 ml.
                                                                        </p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ) : null;
                                                })()}
                                            </div>
                                        )}
                                        <button
                                            onClick={async () => {
                                                if (currentWeight) {
                                                    try {
                                                        // Sauvegarder dans Firebase
                                                        await db.collection('families').doc(user.code).update({
                                                            currentWeight: currentWeight,
                                                            lastWeightUpdate: new Date().toISOString()
                                                        });

                                                        // Mettre Ã  jour l'Ã©tat local
                                                        setUser(prev => ({ ...prev, currentWeight: currentWeight }));
                                                        setLastWeightUpdate(new Date().toISOString());
                                                        setCurrentView('daily');
                                                        alert('Poids mis Ã  jour et sauvegardÃ© !');
                                                    } catch (error) {
                                                        console.error('Erreur sauvegarde poids:', error);
                                                        alert('Erreur lors de la sauvegarde');
                                                    }
                                                } else {
                                                    alert('Veuillez entrer un poids valide');
                                                }
                                            }}
                                            className="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-4 rounded-xl font-bold"
                                        >
                                            Mettre Ã  jour le poids
                                        </button>
                                    </div>
                                </div>

                                {lastWeightUpdate && (
                                    <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                                        <p className="text-sm text-yellow-800">
                                            â„¹ï¸ DerniÃ¨re mise Ã  jour : {formatDateTime(lastWeightUpdate)}
                                        </p>
                                        <p className="text-xs text-yellow-700 mt-1">
                                            Pensez Ã  mettre Ã  jour le poids rÃ©guliÃ¨rement pour des calculs prÃ©cis.
                                        </p>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Vue Mise Ã  jour de la taille */}
                        {currentView === 'height-update' && (
                            <div className="space-y-6">
                                <div className="flex items-center justify-between">
                                    <h2 className="text-xl font-bold text-gray-800">ðŸ“ Mise Ã  jour de la taille</h2>
                                    <button
                                        onClick={() => setCurrentView('daily')}
                                        className="text-gray-500 hover:text-gray-700"
                                    >
                                        <i className="fas fa-times text-xl"></i>
                                    </button>
                                </div>

                                <div className="bg-white/90 rounded-2xl p-6 shadow-xl border border-white/50">
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                Taille actuelle (cm) *
                                            </label>
                                            <input
                                                type="number"
                                                step="0.1"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                placeholder="52.5"
                                                value={currentHeight || ''}
                                                onChange={(e) => setCurrentHeight(parseFloat(e.target.value) || null)}
                                            />
                                        </div>

                                        <button
                                            onClick={async () => {
                                                if (currentHeight) {
                                                    try {
                                                        await db.collection('families').doc(user.code).update({
                                                            birthHeight: currentHeight
                                                        });
                                                        setUser(prev => ({ ...prev, birthHeight: currentHeight }));
                                                        setLastHeightUpdate(new Date().toISOString());
                                                        setCurrentView('daily');
                                                        alert('Taille mise Ã  jour !');
                                                    } catch (error) {
                                                        console.error('Erreur mise Ã  jour taille:', error);
                                                        alert('Erreur lors de la mise Ã  jour');
                                                    }
                                                } else {
                                                    alert('Veuillez entrer une taille valide');
                                                }
                                            }}
                                            className="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-4 rounded-xl font-bold"
                                        >
                                            Mettre Ã  jour la taille
                                        </button>
                                    </div>
                                </div>

                                {lastHeightUpdate && (
                                    <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                                        <p className="text-sm text-yellow-800">
                                            â„¹ï¸ DerniÃ¨re mise Ã  jour : {formatDateTime(lastHeightUpdate)}
                                        </p>
                                        <p className="text-xs text-yellow-700 mt-1">
                                            La taille peut Ãªtre mesurÃ©e moins frÃ©quemment que le poids.
                                        </p>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Formulaire mÃ©dicament */}
                        {currentView === 'medication-form' && (
                            <div className="space-y-6">
                                <div className="flex items-center justify-between">
                                    <h2 className="text-xl font-bold text-gray-800">ðŸ’Š Nouveau mÃ©dicament</h2>
                                    <button
                                        onClick={() => setCurrentView('medical')}
                                        className="text-gray-500 hover:text-gray-700"
                                    >
                                        <i className="fas fa-times text-xl"></i>
                                    </button>
                                </div>

                                <div className="bg-white/90 rounded-2xl p-6 shadow-xl border border-white/50">
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Nom du mÃ©dicament *</label>
                                            <input
                                                type="text"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                placeholder="Ex: Doliprane"
                                                value={medicationData.name}
                                                onChange={(e) => setMedicationData(prev => ({ ...prev, name: e.target.value }))}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Dosage *</label>
                                            <input
                                                type="text"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                placeholder="Ex: 2.5ml"
                                                value={medicationData.dosage}
                                                onChange={(e) => setMedicationData(prev => ({ ...prev, dosage: e.target.value }))}
                                            />
                                        </div>

                                        <div className="grid grid-cols-2 gap-3">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Date *</label>
                                                <input
                                                    type="date"
                                                    className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                    value={medicationData.date}
                                                    onChange={(e) => setMedicationData(prev => ({ ...prev, date: e.target.value }))}
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Heure *</label>
                                                <input
                                                    type="time"
                                                    className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                    value={medicationData.time}
                                                    onChange={(e) => setMedicationData(prev => ({ ...prev, time: e.target.value }))}
                                                />
                                            </div>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Intervalle (heures)</label>
                                            <input
                                                type="number"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                placeholder="Ex: 6 (pour toutes les 6h)"
                                                value={medicationData.interval}
                                                onChange={(e) => setMedicationData(prev => ({ ...prev, interval: e.target.value }))}
                                            />
                                        </div>

                                        <button
                                            onClick={saveMedication}
                                            className="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-4 rounded-xl font-bold"
                                        >
                                            Enregistrer le mÃ©dicament
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Formulaire rendez-vous */}
                        {currentView === 'appointment-form' && (
                            <div className="space-y-6">
                                <div className="flex items-center justify-between">
                                    <h2 className="text-xl font-bold text-gray-800">ðŸ“… Nouveau rendez-vous</h2>
                                    <button
                                        onClick={() => setCurrentView('medical')}
                                        className="text-gray-500 hover:text-gray-700"
                                    >
                                        <i className="fas fa-times text-xl"></i>
                                    </button>
                                </div>

                                <div className="bg-white/90 rounded-2xl p-6 shadow-xl border border-white/50">
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Type de rendez-vous *</label>
                                            <input
                                                type="text"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                placeholder="Ex: PÃ©diatre, Vaccination"
                                                value={appointmentData.type}
                                                onChange={(e) => setAppointmentData(prev => ({ ...prev, type: e.target.value }))}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">MÃ©decin/Praticien</label>
                                            <input
                                                type="text"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                placeholder="Ex: Dr. Martin"
                                                value={appointmentData.doctor}
                                                onChange={(e) => setAppointmentData(prev => ({ ...prev, doctor: e.target.value }))}
                                            />
                                        </div>

                                        <div className="grid grid-cols-2 gap-3">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Date *</label>
                                                <input
                                                    type="date"
                                                    className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                    value={appointmentData.date}
                                                    onChange={(e) => setAppointmentData(prev => ({ ...prev, date: e.target.value }))}
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Heure *</label>
                                                <input
                                                    type="time"
                                                    className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                    value={appointmentData.time}
                                                    onChange={(e) => setAppointmentData(prev => ({ ...prev, time: e.target.value }))}
                                                />
                                            </div>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Lieu</label>
                                            <input
                                                type="text"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                placeholder="Ex: Clinique Saint-Vincent"
                                                value={appointmentData.location}
                                                onChange={(e) => setAppointmentData(prev => ({ ...prev, location: e.target.value }))}
                                            />
                                        </div>

                                        <button
                                            onClick={saveAppointment}
                                            className="w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white py-4 rounded-xl font-bold"
                                        >
                                            Enregistrer le rendez-vous
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Formulaire principal */}
                        {/* Formulaire vaccin */}
                        {currentView === 'vaccine-form' && (
                            <div className="space-y-6">
                                <div className="flex items-center justify-between">
                                    <h2 className="text-xl font-bold text-gray-800">ðŸ’‰ Nouveau vaccin</h2>
                                    <button
                                        onClick={() => setCurrentView('medical')}
                                        className="text-gray-500 hover:text-gray-700"
                                    >
                                        <i className="fas fa-times text-xl"></i>
                                    </button>
                                </div>

                                <div className="bg-white/90 rounded-2xl p-6 shadow-xl border border-white/50">
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Nom du vaccin *</label>
                                            <input
                                                type="text"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                placeholder="Ex: DTC-Polio-Hib (1Ã¨re injection)"
                                                value={vaccineData.name}
                                                onChange={(e) => setVaccineData(prev => ({ ...prev, name: e.target.value }))}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Date du vaccin *</label>
                                            <input
                                                type="date"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                value={vaccineData.date}
                                                onChange={(e) => setVaccineData(prev => ({ ...prev, date: e.target.value }))}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Prochain rappel</label>
                                            <input
                                                type="text"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                placeholder="Ex: Dans 2 mois"
                                                value={vaccineData.nextDue}
                                                onChange={(e) => setVaccineData(prev => ({ ...prev, nextDue: e.target.value }))}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Notes</label>
                                            <textarea
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                rows="3"
                                                placeholder="RÃ©action, remarques..."
                                                value={vaccineData.notes}
                                                onChange={(e) => setVaccineData(prev => ({ ...prev, notes: e.target.value }))}
                                            />
                                        </div>

                                        <button
                                            onClick={saveVaccine}
                                            className="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-4 rounded-xl font-bold"
                                        >
                                            Enregistrer le vaccin
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* Formulaire diversification */}
                        {currentView === 'diversification-form' && (
                            <div className="space-y-6">
                                <div className="flex items-center justify-between">
                                    <h2 className="text-xl font-bold text-gray-800">ðŸ¥„ Nouvel aliment testÃ©</h2>
                                    <button
                                        onClick={() => setCurrentView('food')}
                                        className="text-gray-500 hover:text-gray-700"
                                    >
                                        <i className="fas fa-times text-xl"></i>
                                    </button>
                                </div>

                                <div className="bg-white/90 rounded-2xl p-6 shadow-xl border border-white/50">
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Aliment testÃ© *</label>
                                            <input
                                                type="text"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                placeholder="Ex: Carotte, Pomme, Courgette..."
                                                value={diversificationData.food}
                                                onChange={(e) => setDiversificationData(prev => ({ ...prev, food: e.target.value }))}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Date du test *</label>
                                            <input
                                                type="date"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                value={diversificationData.date}
                                                onChange={(e) => setDiversificationData(prev => ({ ...prev, date: e.target.value }))}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                RÃ©action du bÃ©bÃ© (sur 10) *
                                            </label>
                                            <div className="flex items-center gap-2 mb-2">
                                                <input
                                                    type="range"
                                                    min="1"
                                                    max="10"
                                                    className="flex-1"
                                                    value={diversificationData.rating}
                                                    onChange={(e) => setDiversificationData(prev => ({ ...prev, rating: e.target.value }))}
                                                />
                                                <span className="text-lg font-bold text-gray-700 min-w-[3rem]">
                                                    {diversificationData.rating}/10
                                                </span>
                                            </div>
                                            <div className="flex justify-between text-xs text-gray-500">
                                                <span>ðŸ˜£ Refus total</span>
                                                <span>ðŸ˜‹ AdorÃ©</span>
                                            </div>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Notes</label>
                                            <textarea
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                rows="3"
                                                placeholder="Texture donnÃ©e, rÃ©action, quantitÃ© mangÃ©e, allergies..."
                                                value={diversificationData.notes}
                                                onChange={(e) => setDiversificationData(prev => ({ ...prev, notes: e.target.value }))}
                                            />
                                        </div>

                                        <button
                                            onClick={saveDiversificationEntry}
                                            className="w-full bg-gradient-to-r from-orange-500 to-orange-600 text-white py-4 rounded-xl font-bold"
                                        >
                                            Enregistrer le test
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* Vue Tracker de sommeil */}
                        {currentView === 'sleep-tracker' && (
                            <div className="space-y-6">
                                <div className="flex items-center justify-between">
                                    <h2 className="text-xl font-bold text-gray-800">ðŸ’¤ Suivi du sommeil</h2>
                                    <button
                                        onClick={() => setCurrentView('daily')}
                                        className="text-gray-500 hover:text-gray-700"
                                    >
                                        <i className="fas fa-times text-xl"></i>
                                    </button>
                                </div>

                                <div className="bg-white/90 rounded-2xl p-6 shadow-xl border border-white/50">
                                    {currentSleep ? (
                                        <div className="text-center">
                                            <div className="w-20 h-20 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                                <i className="fas fa-moon text-purple-600 text-2xl"></i>
                                            </div>
                                            <h3 className="text-lg font-bold text-gray-900 mb-2">Sommeil en cours</h3>
                                            <p className="text-sm text-gray-600 mb-4">
                                                DÃ©marrÃ© Ã  {formatTime(currentSleep.startTime)}
                                            </p>
                                            <button
                                                onClick={stopSleep}
                                                className="w-full bg-gradient-to-r from-red-500 to-red-600 text-white py-4 rounded-xl font-bold"
                                            >
                                                ArrÃªter le sommeil
                                            </button>
                                        </div>
                                    ) : (
                                        <div className="text-center">
                                            <div className="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                                <i className="fas fa-play text-green-600 text-2xl"></i>
                                            </div>
                                            <h3 className="text-lg font-bold text-gray-900 mb-2">DÃ©marrer une session</h3>
                                            <p className="text-sm text-gray-600 mb-4">
                                                Lancez le suivi quand bÃ©bÃ© s'endort
                                            </p>
                                            <button
                                                onClick={startSleep}
                                                className="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-4 rounded-xl font-bold mb-4"
                                            >
                                                Commencer le sommeil
                                            </button>

                                            <div className="border-t pt-4">
                                                <button
                                                    onClick={() => {
                                                        setEditingSleepId(null);
                                                        setSleepData({ startTime: '', endTime: '', date: getCurrentDate() });
                                                        setCurrentView('sleep-manual');
                                                    }}
                                                    className="w-full bg-gray-100 text-gray-700 py-3 rounded-xl font-medium"
                                                >
                                                    Saisie manuelle
                                                </button>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {/* DerniÃ¨res sessions */}
                                {/* Graphique sommeil */}
                                <div className="bg-white/90 rounded-2xl p-4 shadow-xl border border-white/50 mb-4">
                                    <div className="flex items-center justify-between mb-3">
                                        <h3 className="font-bold text-gray-900">Ã‰volution du sommeil</h3>
                                        <div className="flex gap-1">
                                            <button
                                                onClick={() => setSleepPeriodView('week')}
                                                className={`px-2 py-1 text-xs rounded ${sleepPeriodView === 'week'
                                                    ? 'bg-purple-500 text-white'
                                                    : 'bg-gray-100 text-gray-600'}`}
                                            >
                                                7j
                                            </button>
                                            <button
                                                onClick={() => setSleepPeriodView('month')}
                                                className={`px-2 py-1 text-xs rounded ${sleepPeriodView === 'month'
                                                    ? 'bg-purple-500 text-white'
                                                    : 'bg-gray-100 text-gray-600'}`}
                                            >
                                                30j
                                            </button>
                                        </div>
                                    </div>
                                    <div className="h-32 bg-gradient-to-b from-purple-50 to-purple-100 rounded-xl p-2">
                                        <canvas ref={sleepChartRef} className="w-full h-full"></canvas>
                                    </div>
                                </div>
                                <div className="bg-white/90 rounded-2xl p-4 shadow-xl border border-white/50">
                                    <h3 className="font-bold text-gray-900 mb-3">DerniÃ¨res sessions</h3>
                                    <div className="space-y-2">
                                        {sleepSessions.filter(s => s.status === 'completed').slice(0, 3).map(session => (
                                            <div key={session.id} className="bg-purple-50 rounded-xl p-3 border border-purple-200">
                                                <div className="flex items-center justify-between">
                                                    <div>
                                                        <div className="font-medium text-purple-800">
                                                            {formatSleepDuration(session.duration)}
                                                        </div>
                                                        <div className="text-xs text-purple-600">
                                                            {formatDateTime(session.startTime)}
                                                        </div>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <button
                                                            onClick={() => editSleepSession(session.id)}
                                                            className="w-8 h-8 rounded-lg bg-blue-50 flex items-center justify-center active:scale-95 transition-transform"
                                                        >
                                                            <i className="fas fa-edit text-sm text-blue-600"></i>
                                                        </button>
                                                        <button
                                                            onClick={() => deleteSleepSession(session.id)}
                                                            className="w-8 h-8 rounded-lg bg-red-50 flex items-center justify-center active:scale-95 transition-transform"
                                                        >
                                                            <i className="fas fa-trash text-sm text-red-600"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                        {sleepSessions.filter(s => s.status === 'completed').length === 0 && (
                                            <p className="text-gray-500 text-center py-4">Aucune session enregistrÃ©e</p>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Vue Saisie manuelle sommeil */}
                        {currentView === 'sleep-manual' && (
                            <div className="space-y-6">
                                <div className="flex items-center justify-between">
                                    <h2 className="text-xl font-bold text-gray-800">
                                        ðŸ’¤ {editingSleepId ? 'Modifier la session' : 'Saisie manuelle'}
                                    </h2>
                                    <button
                                        onClick={() => {
                                            setEditingSleepId(null);
                                            setSleepData({ startTime: '', endTime: '', date: getCurrentDate() });
                                            setCurrentView('sleep-tracker');
                                        }}
                                        className="text-gray-500 hover:text-gray-700"
                                    >
                                        <i className="fas fa-times text-xl"></i>
                                    </button>
                                </div>

                                <div className="bg-white/90 rounded-2xl p-6 shadow-xl border border-white/50">
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Date</label>
                                            <input
                                                type="date"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                value={sleepData.date}
                                                onChange={(e) => setSleepData(prev => ({ ...prev, date: e.target.value }))}
                                            />
                                        </div>

                                        <div className="grid grid-cols-2 gap-3">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">DÃ©but</label>
                                                <input
                                                    type="time"
                                                    className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                    value={sleepData.startTime}
                                                    onChange={(e) => setSleepData(prev => ({ ...prev, startTime: e.target.value }))}
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Fin</label>
                                                <input
                                                    type="time"
                                                    className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                    value={sleepData.endTime}
                                                    onChange={(e) => setSleepData(prev => ({ ...prev, endTime: e.target.value }))}
                                                />
                                            </div>
                                        </div>

                                        <button
                                            onClick={saveSleepEdit}
                                            className="w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white py-4 rounded-xl font-bold"
                                        >
                                            {editingSleepId ? 'Mettre Ã  jour la session' : 'Enregistrer la session'}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* Formulaire garde-robe */}
                        {currentView === 'wardrobe-form' && (
                            <div className="space-y-6">
                                <div className="flex items-center justify-between">
                                    <h2 className="text-xl font-bold text-gray-800">ðŸ‘• Nouvel article</h2>
                                    <button
                                        onClick={() => setCurrentView('wardrobe')}
                                        className="text-gray-500 hover:text-gray-700"
                                    >
                                        <i className="fas fa-times text-xl"></i>
                                    </button>
                                </div>

                                <div className="bg-white/90 rounded-2xl p-6 shadow-xl border border-white/50">
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Type de vÃªtement *</label>
                                            <select
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                value={wardrobeData.type}
                                                onChange={(e) => setWardrobeData(prev => ({ ...prev, type: e.target.value }))}
                                            >
                                                <option value="">Choisir...</option>
                                                <option value="Body manche courte">Body manche courte</option>
                                                <option value="Body manche longue">Body manche longue</option>
                                                <option value="Bonnet">Bonnet</option>
                                                <option value="Chaussettes">Chaussettes</option>
                                                <option value="Gigoteuse">Gigoteuse</option>
                                                <option value="Gilet">Gilet</option>
                                                <option value="Pantalon">Pantalon</option>
                                                <option value="Pull">Pull</option>
                                                <option value="Pyjama">Pyjama</option>
                                                <option value="Robe">Robe</option>
                                                <option value="T-shirt manche courte">T-shirt manche courte</option>
                                                <option value="T-shirt manche longue">T-shirt manche longue</option>
                                                <option value="Autre">Autre</option>
                                            </select>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Taille *</label>
                                            <select
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                value={wardrobeData.size}
                                                onChange={(e) => setWardrobeData(prev => ({ ...prev, size: e.target.value }))}
                                            >
                                                <option value="">Choisir...</option>
                                                <option value="Naissance">Naissance</option>
                                                <option value="1 mois">1 mois</option>
                                                <option value="3 mois">3 mois</option>
                                                <option value="6 mois">6 mois</option>
                                                <option value="9 mois">9 mois</option>
                                                <option value="12 mois">12 mois</option>
                                                <option value="18 mois">18 mois</option>
                                                <option value="2 ans">2 ans</option>
                                                <option value="3 ans">3 ans</option>
                                            </select>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">QuantitÃ©</label>
                                            <input
                                                type="number"
                                                min="1"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                value={wardrobeData.quantity}
                                                onChange={(e) => setWardrobeData(prev => ({ ...prev, quantity: e.target.value }))}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Notes</label>
                                            <textarea
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                rows="3"
                                                placeholder="Couleur, marque, Ã©tat..."
                                                value={wardrobeData.notes}
                                                onChange={(e) => setWardrobeData(prev => ({ ...prev, notes: e.target.value }))}
                                            />
                                        </div>

                                        <button
                                            onClick={saveWardrobeItem}
                                            className="w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white py-4 rounded-xl font-bold"
                                        >
                                            Ajouter Ã  la garde-robe
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* Formulaire principal biberon/couche */}
                        {showForm && (
                            <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-end sm:items-center justify-center p-0 sm:p-4 z-50">
                                <div className="bg-white w-full sm:max-w-md sm:rounded-3xl rounded-t-3xl max-h-[90vh] overflow-y-auto relative">
                                    {/* Header du formulaire */}
                                    <div className={`sticky top-0 bg-gradient-to-r ${themeColors.primary} text-white p-6 rounded-t-3xl z-10`}>
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center gap-3">
                                                <div className="w-12 h-12 bg-white/20 rounded-2xl flex items-center justify-center">
                                                    {formType === 'feeding' ? (
                                                        <i className="fas fa-bottle-water text-xl"></i>
                                                    ) : (
                                                        <i className="fas fa-baby text-xl"></i>
                                                    )}
                                                </div>
                                                <div>
                                                    <h3 className="text-xl font-bold">
                                                        {formType === 'feeding' ? 'Nouveau biberon' : 'Nouveau change'}
                                                    </h3>
                                                    <p className="text-sm opacity-80">
                                                        {editingId ? 'Modifier l\'entrÃ©e' : 'Ajouter une nouvelle entrÃ©e'}
                                                    </p>
                                                </div>
                                            </div>
                                            <button
                                                onClick={closeForm}
                                                className="w-10 h-10 rounded-2xl bg-white/20 flex items-center justify-center active:scale-95 transition-transform"
                                            >
                                                <i className="fas fa-times text-lg"></i>
                                            </button>
                                        </div>
                                    </div>

                                    {/* Contenu du formulaire */}
                                    <div className="p-6 space-y-6">
                                        {/* Date et heure */}
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                    Date *
                                                </label>
                                                <div className="relative">
                                                    <input
                                                        type="date"
                                                        className="w-full px-4 py-3 rounded-2xl border-2 border-gray-200 focus:border-blue-500 focus:outline-none transition-colors"
                                                        value={formData.date}
                                                        onChange={(e) => setFormData(prev => ({ ...prev, date: e.target.value }))}
                                                    />
                                                    <i className="fas fa-calendar absolute right-3 top-4 text-gray-400 text-sm pointer-events-none"></i>
                                                </div>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                    Heure *
                                                </label>
                                                <div className="relative">
                                                    <input
                                                        type="time"
                                                        className="w-full px-4 py-3 rounded-2xl border-2 border-gray-200 focus:border-blue-500 focus:outline-none transition-colors"
                                                        value={formData.time}
                                                        onChange={(e) => setFormData(prev => ({ ...prev, time: e.target.value }))}
                                                    />
                                                    <i className="fas fa-clock absolute right-3 top-4 text-gray-400 text-sm pointer-events-none"></i>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Formulaire biberon */}
                                        {formType === 'feeding' && (
                                            <div className="space-y-4">
                                                <div>
                                                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                        QuantitÃ© (ml) *
                                                    </label>
                                                    <div className="relative">
                                                        <input
                                                            type="number"
                                                            placeholder="120"
                                                            className="w-full px-4 py-3 pr-12 rounded-2xl border-2 border-gray-200 focus:border-blue-500 focus:outline-none text-lg font-bold text-center transition-colors"
                                                            value={formData.amount}
                                                            onChange={(e) => setFormData(prev => ({ ...prev, amount: e.target.value }))}
                                                        />
                                                        <span className="absolute right-4 top-4 text-gray-500 font-medium">ml</span>
                                                    </div>
                                                </div>

                                                {/* Suggestions rapides */}
                                                {(() => {
                                                    const age = calculateAge();
                                                    const weightCalculation = currentWeight ? calculateMilkByWeight(currentWeight, age) : null;
                                                    const recommendations = getFeedingRecommendations(age);

                                                    const suggestions = [];

                                                    if (weightCalculation) {
                                                        const base = weightCalculation.mlPerFeeding;
                                                        suggestions.push(
                                                            { label: 'RecommandÃ©', value: base, color: 'bg-green-500' },
                                                            { label: '-20ml', value: Math.max(base - 20, 30), color: 'bg-blue-500' },
                                                            { label: '+20ml', value: base + 20, color: 'bg-purple-500' }
                                                        );
                                                    } else if (recommendations) {
                                                        const base = getDefaultAmount(recommendations.volume);
                                                        if (base) {
                                                            suggestions.push(
                                                                { label: 'Moyenne', value: base, color: 'bg-green-500' },
                                                                { label: '-20ml', value: Math.max(base - 20, 30), color: 'bg-blue-500' },
                                                                { label: '+20ml', value: base + 20, color: 'bg-purple-500' }
                                                            );
                                                        }
                                                    }

                                                    return suggestions.length > 0 && (
                                                        <div>
                                                            <p className="text-sm text-gray-600 mb-3">Suggestions rapides :</p>
                                                            <div className="flex gap-2 flex-wrap">
                                                                {suggestions.map((suggestion, index) => (
                                                                    <button
                                                                        key={index}
                                                                        type="button"
                                                                        onClick={() => setFormData(prev => ({ ...prev, amount: suggestion.value.toString() }))}
                                                                        className={`${suggestion.color} text-white px-4 py-2 rounded-xl text-sm font-medium active:scale-95 transition-transform`}
                                                                    >
                                                                        {suggestion.label}
                                                                        <span className="ml-1 opacity-80">({suggestion.value}ml)</span>
                                                                    </button>
                                                                ))}
                                                            </div>
                                                        </div>
                                                    );
                                                })()}
                                            </div>
                                        )}

                                        {/* Formulaire couche */}
                                        {formType === 'diaper' && (
                                            <div className="space-y-6">
                                                {/* Type de change */}
                                                <div>
                                                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                                                        Type de change *
                                                    </label>
                                                    <div className="grid grid-cols-2 gap-3">
                                                        <button
                                                            type="button"
                                                            onClick={() => setFormData(prev => ({ ...prev, hasPee: !prev.hasPee }))}
                                                            className={`p-4 rounded-2xl border-2 transition-all ${formData.hasPee
                                                                ? 'bg-blue-100 border-blue-300 text-blue-800'
                                                                : 'bg-gray-50 border-gray-200 text-gray-600'
                                                                }`}
                                                        >
                                                            <div className="text-2xl mb-2">ðŸ’§</div>
                                                            <div className="font-semibold">Pipi</div>
                                                        </button>
                                                        <button
                                                            type="button"
                                                            onClick={() => setFormData(prev => ({ ...prev, hasPoop: !prev.hasPoop }))}
                                                            className={`p-4 rounded-2xl border-2 transition-all ${formData.hasPoop
                                                                ? 'bg-orange-100 border-orange-300 text-orange-800'
                                                                : 'bg-gray-50 border-gray-200 text-gray-600'
                                                                }`}
                                                        >
                                                            <div className="text-2xl mb-2">ðŸ’©</div>
                                                            <div className="font-semibold">Caca</div>
                                                        </button>
                                                    </div>
                                                </div>

                                                {/* DÃ©tails caca si sÃ©lectionnÃ© */}
                                                {formData.hasPoop && (
                                                    <div className="space-y-4 bg-orange-50 rounded-2xl p-4 border border-orange-200">
                                                        <h4 className="font-semibold text-orange-800 mb-3">DÃ©tails du caca</h4>

                                                        {/* QuantitÃ© */}
                                                        <div>
                                                            <label className="block text-sm font-medium text-orange-700 mb-2">QuantitÃ©</label>
                                                            <div className="grid grid-cols-3 gap-2">
                                                                {['peu', 'moyen', 'beaucoup'].map(qty => (
                                                                    <button
                                                                        key={qty}
                                                                        type="button"
                                                                        onClick={() => setFormData(prev => ({ ...prev, poopQuantity: qty }))}
                                                                        className={`p-2 rounded-xl text-sm font-medium border-2 transition-all ${formData.poopQuantity === qty
                                                                            ? 'bg-orange-200 border-orange-400 text-orange-800'
                                                                            : 'bg-white border-orange-200 text-orange-600'
                                                                            }`}
                                                                    >
                                                                        {qty === 'peu' && 'ðŸ¤'} {qty === 'moyen' && 'ðŸ‘Œ'} {qty === 'beaucoup' && 'ðŸ™Œ'}
                                                                        <div className="capitalize">{qty}</div>
                                                                    </button>
                                                                ))}
                                                            </div>
                                                        </div>

                                                        {/* Consistance */}
                                                        <div>
                                                            <label className="block text-sm font-medium text-orange-700 mb-2">Consistance</label>
                                                            <div className="grid grid-cols-2 gap-2">
                                                                {[
                                                                    { value: 'liquide', emoji: 'ðŸ’§', label: 'Liquide' },
                                                                    { value: 'molle', emoji: 'ðŸŸ¡', label: 'Molle' },
                                                                    { value: 'normale', emoji: 'ðŸŸ¤', label: 'Normale' },
                                                                    { value: 'dure', emoji: 'ðŸ”´', label: 'Dure' }
                                                                ].map(consistency => (
                                                                    <button
                                                                        key={consistency.value}
                                                                        type="button"
                                                                        onClick={() => setFormData(prev => ({ ...prev, poopConsistency: consistency.value }))}
                                                                        className={`p-2 rounded-xl text-sm font-medium border-2 transition-all ${formData.poopConsistency === consistency.value
                                                                            ? 'bg-orange-200 border-orange-400 text-orange-800'
                                                                            : 'bg-white border-orange-200 text-orange-600'
                                                                            }`}
                                                                    >
                                                                        <div className="text-lg mb-1">{consistency.emoji}</div>
                                                                        <div>{consistency.label}</div>
                                                                    </button>
                                                                ))}
                                                            </div>
                                                        </div>

                                                        {/* Couleur */}
                                                        <div>
                                                            <label className="block text-sm font-medium text-orange-700 mb-2">Couleur</label>
                                                            <div className="grid grid-cols-2 gap-2">
                                                                {[
                                                                    { value: 'jaune', emoji: 'ðŸŸ¡', label: 'Jaune' },
                                                                    { value: 'marron', emoji: 'ðŸŸ¤', label: 'Marron' },
                                                                    { value: 'vert', emoji: 'ðŸŸ¢', label: 'Vert' },
                                                                    { value: 'noir', emoji: 'âš«', label: 'Noir' }
                                                                ].map(color => (
                                                                    <button
                                                                        key={color.value}
                                                                        type="button"
                                                                        onClick={() => setFormData(prev => ({ ...prev, poopColor: color.value }))}
                                                                        className={`p-2 rounded-xl text-sm font-medium border-2 transition-all ${formData.poopColor === color.value
                                                                            ? 'bg-orange-200 border-orange-400 text-orange-800'
                                                                            : 'bg-white border-orange-200 text-orange-600'
                                                                            }`}
                                                                    >
                                                                        <div className="text-lg mb-1">{color.emoji}</div>
                                                                        <div>{color.label}</div>
                                                                    </button>
                                                                ))}
                                                            </div>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                    </div>

                                    {/* Footer avec boutons */}
                                    <div className="sticky bottom-0 bg-white border-t border-gray-100 p-6 space-y-3">
                                        <button
                                            onClick={saveEntry}
                                            className={`w-full bg-gradient-to-r ${themeColors.primary} text-white py-4 rounded-2xl font-bold text-lg active:scale-95 transition-transform shadow-lg`}
                                        >
                                            {editingId ? 'Mettre Ã  jour' : 'Enregistrer'}
                                        </button>
                                        <button
                                            onClick={closeForm}
                                            className="w-full bg-gray-100 text-gray-700 py-3 rounded-2xl font-medium active:scale-95 transition-transform"
                                        >
                                            Annuler
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<BabyTracker />, document.getElementById('root'));
    </script>
</body>

</html>