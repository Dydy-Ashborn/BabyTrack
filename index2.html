<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>BabyTrack</title>

    <!-- PWA Configuration -->
    <link rel="icon" type="image/png" href="logo.PNG" />
    <link rel="apple-touch-icon" href="logo.PNG" />
    <link rel="apple-touch-icon" sizes="180x180" href="logo.PNG" />
    <link rel="manifest" href="manifest.json">

    <!-- PWA Métadonnées -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BabyTrack">
    <meta name="theme-color" content="#3B82F6">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">

    <!-- Scripts et styles -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        body {
            overscroll-behavior: none;
            -ms-overflow-style: none;
            scrollbar-width: none;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        body::-webkit-scrollbar {
            display: none;
        }

        .glass {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.7);
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .pulse-gentle {
            animation: pulse-gentle 2s ease-in-out infinite;
        }

        @keyframes pulse-gentle {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        .medication-available {
            border-color: #10b981;
            background-color: #f0fdf4;
        }

        .medication-waiting {
            border-color: #f59e0b;
            background-color: #fffbeb;
        }

        .medication-soon {
            border-color: #ef4444;
            background-color: #fef2f2;
        }

        .appointment-today {
            border-color: #ef4444;
            background-color: #fef2f2;
        }

        .appointment-upcoming {
            border-color: #f59e0b;
            background-color: #fffbeb;
        }
    </style>

    <!-- Logo BabyTrack en SVG -->
    <svg id="babytrack-logo" style="display: none;">
        <defs>
            <symbol id="logo-symbol" viewBox="0 0 200 120">
                <!-- Montre/cadre -->
                <rect x="20" y="30" width="100" height="60" rx="20" ry="20" fill="url(#gradient1)" stroke="#2563eb"
                    stroke-width="4" />
                <rect x="25" y="35" width="90" height="50" rx="15" ry="15" fill="white" />

                <!-- Visage bébé -->
                <circle cx="70" cy="60" r="20" fill="white" stroke="#2563eb" stroke-width="3" />
                <path d="M70 45 Q75 40, 80 45" fill="none" stroke="#2563eb" stroke-width="2" stroke-linecap="round" />
                <circle cx="65" cy="55" r="2" fill="#2563eb" />
                <circle cx="75" cy="55" r="2" fill="#2563eb" />
                <path d="M65 65 Q70 70, 75 65" fill="none" stroke="#2563eb" stroke-width="2" stroke-linecap="round" />

                <!-- Bracelet -->
                <rect x="10" y="45" width="15" height="30" rx="7" ry="7" fill="url(#gradient2)" />
                <rect x="115" y="45" width="15" height="30" rx="7" ry="7" fill="url(#gradient2)" />

                <!-- Gradients -->
                <defs>
                    <linearGradient id="gradient1" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#8b5cf6;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="gradient2" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#ec4899;stop-opacity:1" />
                    </linearGradient>
                </defs>
            </symbol>
        </defs>
    </svg>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCPQpB3cYk2sgbOVQ8KLbU1Qj2U67D2rZ4",
            authDomain: "suivi-loan.firebaseapp.com",
            projectId: "suivi-loan",
            storageBucket: "suivi-loan.firebasestorage.app",
            messagingSenderId: "334984699415",
            appId: "1:334984699415:web:8b41abb9360d31efabc652"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        // Constantes et données de référence
        const FEEDING_GUIDE = {
            1: { volume: '5–10ml', frequency: '8–12 fois/24h', total: '40–120ml', comment: 'Estomac très petit, petites quantités très fréquentes' },
            2: { volume: '10–20ml', frequency: '8–12 fois/24h', total: '80–240ml', comment: 'Progression rapide, petites tétées fréquentes' },
            3: { volume: '20–30ml', frequency: '8–10 fois/24h', total: '160–300ml', comment: 'Bébé commence à boire plus régulièrement' },
            4: { volume: '45–60ml', frequency: '6–8 fois/24h', total: '270–480ml', comment: 'Adaptation au lait, souvent nécessaire de compléter un peu' },
            5: { volume: '60–80ml', frequency: '6–8 fois/24h', total: '360–640ml', comment: 'Volumes plus importants, espacer les biberons' },
            6: { volume: '60–80ml', frequency: '6–8 fois/24h', total: '360–640ml', comment: 'Rot + massages si besoin, surveiller selles et couches' },
            7: { volume: '60–80ml', frequency: '6–8 fois/24h', total: '360–640ml', comment: 'Fin de première semaine, rythme qui se stabilise' }
        };

        const FEEDING_RANGES = [
            { days: [8, 9, 10, 11, 12, 13, 14], volume: '60–90ml', frequency: '6–8 fois/24h', total: '360–720ml', comment: 'Deuxième semaine, augmentation progressive' },
            { days: [15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28], volume: '90–120ml', frequency: '6–7 fois/24h', total: '540–840ml', comment: 'Troisième et quatrième semaines' }
        ];

        const FEEDING_MONTHS = {
            1: { volume: '120–150ml', frequency: '5–6 fois/24h', total: '600–900ml', comment: '1 mois - Volumes stabilisés' },
            2: { volume: '150–180ml', frequency: '5–6 fois/24h', total: '750–1080ml', comment: '2 mois - Croissance régulière' },
            3: { volume: '180–210ml', frequency: '5 fois/24h', total: '900–1050ml', comment: '3 mois - Rythme bien établi' },
            4: { volume: '210ml env.', frequency: '4–5 fois/24h', total: '840–1050ml', comment: '4 mois - Préparation diversification' },
            5: { volume: '210–240ml', frequency: '4–5 fois/24h', total: '840–1200ml', comment: '5 mois - Possible début diversification' },
            6: {
                volume: '180–210ml (avec repas)',
                frequency: '4 biberons/24h',
                total: '500ml minimum + laitages',
                comment: '6 mois - Diversification : introduction légumes puis fruits'
            },
            7: {
                volume: '180–210ml (avec repas)',
                frequency: '4 biberons/24h',
                total: '500ml minimum + laitages',
                comment: '7 mois - Diversification active : légumes variés, fruits en compote'
            },
            8: {
                volume: '150–180ml (en complément)',
                frequency: '3–4 biberons/24h',
                total: '500ml minimum + laitages',
                comment: '8 mois - Introduction protéines (10g/j) et féculents'
            },
            9: {
                volume: '150–180ml (en complément)',
                frequency: '3–4 biberons/24h',
                total: '500ml minimum + laitages',
                comment: '9 mois - Texture moins lisse, premiers morceaux fondants'
            },
            10: {
                volume: '150–180ml',
                frequency: '3 biberons/24h',
                total: '500ml minimum + laitages',
                comment: '10 mois - Tous fruits et légumes, fromages pasteurisés'
            },
            11: {
                volume: '150–180ml',
                frequency: '3 biberons/24h',
                total: '500ml minimum + laitages',
                comment: '11 mois - Morceaux plus gros, apprentissage mastication'
            },
            12: {
                volume: '210–240ml',
                frequency: '2–3 biberons/24h',
                total: '500ml minimum',
                comment: '12 mois - Lait de croissance, alimentation diversifiée'
            },
            13: {
                volume: '210–240ml',
                frequency: '2–3 biberons/24h',
                total: '500ml minimum',
                comment: '13 mois - Repas comme la famille (adapté), 20g protéines'
            },
            14: {
                volume: '210–240ml',
                frequency: '2–3 biberons/24h',
                total: '500ml minimum',
                comment: '14 mois - Introduction miel possible, tous fromages'
            },
            15: {
                volume: '250–300ml',
                frequency: '2 biberons/24h',
                total: '500ml minimum',
                comment: '15 mois - Transition vers tasse, autonomie alimentaire'
            },
            18: {
                volume: '250–300ml',
                frequency: '2 biberons/24h',
                total: '500ml minimum',
                comment: '18 mois - Arrêt progressif biberon, lait de croissance jusqu\'à 3 ans'
            },
            24: {
                volume: '250ml (tasse/verre)',
                frequency: '2 prises/24h',
                total: '500ml minimum',
                comment: '24 mois - Lait en tasse, alimentation complète comme famille'
            }
        };
        // Guide de diversification alimentaire
        const DIVERSIFICATION_GUIDE = {
            // 4-6 mois : Découverte des saveurs
            4: {
                phase: 'Découverte des saveurs',
                principles: [
                    'Le lait reste l\'aliment principal',
                    'Un seul aliment nouveau à la fois',
                    'Textures très lisses uniquement',
                    'Commencer par les légumes au déjeuner'
                ],
                vegetables: [
                    { name: 'Carotte', texture: 'Purée lisse', quantity: '1-2 c. à café', preparation: 'Bien cuite et mixée' },
                    { name: 'Haricot vert', texture: 'Purée lisse', quantity: '1-2 c. à café', preparation: 'Bien cuits et mixés' },
                    { name: 'Courgette', texture: 'Purée lisse', quantity: '1-2 c. à café', preparation: 'Sans pépins ni peau' },
                    { name: 'Potiron', texture: 'Purée lisse', quantity: '1-2 c. à café', preparation: 'Chair uniquement' },
                    { name: 'Brocoli', texture: 'Purée lisse', quantity: '1-2 c. à café', preparation: 'Fleurettes cuites' }
                ],
                fruits: [
                    { name: 'Pomme', texture: 'Compote lisse', quantity: '1-2 c. à café', preparation: 'Cuite sans sucre' },
                    { name: 'Poire', texture: 'Compote lisse', quantity: '1-2 c. à café', preparation: 'Cuite sans sucre' },
                    { name: 'Banane', texture: 'Écrasée lisse', quantity: '1-2 c. à café', preparation: 'Bien mûre' }
                ],
                avoid: ['Protéines', 'Féculents', 'Sel', 'Sucre', 'Miel']
            },
            6: {
                phase: 'Diversification active',
                principles: [
                    'Introduction des protéines et féculents',
                    'Textures moins lisses progressivement',
                    'Alternance viande/poisson/œuf',
                    '10g de protéines maximum par jour'
                ],
                vegetables: [
                    { name: 'Tous les légumes précédents', texture: 'Purée épaisse', quantity: '100-130g', preparation: 'Moulinés' },
                    { name: 'Épinard', texture: 'Purée épaisse', quantity: '100-130g', preparation: 'Bien cuits' },
                    { name: 'Blanc de poireau', texture: 'Purée épaisse', quantity: '100-130g', preparation: 'Partie blanche uniquement' },
                    { name: 'Petits pois', texture: 'Purée épaisse', quantity: '100-130g', preparation: 'Sans peau' }
                ],
                fruits: [
                    { name: 'Pêche', texture: 'Compote épaisse', quantity: '60-80g', preparation: 'Sans peau' },
                    { name: 'Abricot', texture: 'Compote épaisse', quantity: '60-80g', preparation: 'Sans noyau' },
                    { name: 'Fruits précédents', texture: 'Compote épaisse', quantity: '60-80g', preparation: 'Texture évolutive' }
                ],
                proteins: [
                    { name: 'Viande blanche', texture: 'Mixée fine', quantity: '10g (2 c. à café)', preparation: 'Bien cuite' },
                    { name: 'Poisson blanc', texture: 'Mixé fin', quantity: '10g (2 c. à café)', preparation: 'Sans arêtes' },
                    { name: 'Jaune d\'œuf', texture: 'Mixé', quantity: '1/4 d\'œuf dur', preparation: 'Bien cuit' }
                ],
                starches: [
                    { name: 'Pomme de terre', texture: 'Purée lisse', quantity: 'Mélangé aux légumes', preparation: 'Bien cuite' },
                    { name: 'Patate douce', texture: 'Purée lisse', quantity: 'Mélangé aux légumes', preparation: 'Bien cuite' },
                    { name: 'Riz', texture: 'Très cuit et mixé', quantity: 'Mélangé aux légumes', preparation: 'Bien cuit' }
                ],
                dairy: [
                    { name: 'Yaourt bébé', texture: 'Lisse', quantity: '1 pot', preparation: 'Spécifique bébé' },
                    { name: 'Fromage blanc bébé', texture: 'Lisse', quantity: '1 pot', preparation: 'Spécifique bébé' }
                ]
            },
            8: {
                phase: 'Premiers morceaux',
                principles: [
                    'Introduction de tous les aliments',
                    'Morceaux fondants et écrasés',
                    'Développement de la mastication',
                    'Fromages pasteurisés autorisés'
                ],
                vegetables: [
                    { name: 'Tous légumes', texture: 'Écrasés/petits morceaux', quantity: '120-150g', preparation: 'Morceaux fondants' },
                    { name: 'Légumes crus', texture: 'Râpés fins', quantity: 'En petite quantité', preparation: 'Bien mûrs' }
                ],
                fruits: [
                    { name: 'Tous fruits', texture: 'Écrasés/morceaux', quantity: '80-100g', preparation: 'Mûrs et tendres' },
                    { name: 'Banane', texture: 'Morceaux', quantity: 'Libre', preparation: 'En morceaux fondants' }
                ],
                proteins: [
                    { name: 'Viande rouge', texture: 'Hachée', quantity: '10g', preparation: 'Bien cuite et hachée' },
                    { name: 'Poisson gras', texture: 'Émietté', quantity: '10g', preparation: '1 fois par semaine' },
                    { name: 'Œuf entier', texture: 'Haché', quantity: '1/4 d\'œuf dur', preparation: 'Dur et haché' }
                ],
                starches: [
                    { name: 'Pâtes', texture: 'Petites/écrasées', quantity: 'Selon appétit', preparation: 'Bien cuites' },
                    { name: 'Pain', texture: 'Croûtons', quantity: 'Quelques morceaux', preparation: 'Pour la mastication' },
                    { name: 'Céréales', texture: 'Cuites', quantity: 'Selon appétit', preparation: 'Semoule, quinoa...' }
                ],
                dairy: [
                    { name: 'Fromages à pâte cuite', texture: 'Petits morceaux', quantity: '15g/jour', preparation: 'Gruyère, comté...' },
                    { name: 'Yaourt nature', texture: 'Standard', quantity: '1 pot', preparation: 'Non sucré' }
                ]
            },
            12: {
                phase: 'Alimentation de grand',
                principles: [
                    'Alimentation comme la famille',
                    'Éviter sel, sucre et miel',
                    '20g de protéines par jour',
                    'Lait de croissance jusqu\'à 3 ans'
                ],
                vegetables: [
                    { name: 'Tous légumes', texture: 'Normaux', quantity: 'Selon appétit', preparation: 'Comme la famille' }
                ],
                fruits: [
                    { name: 'Tous fruits', texture: 'Normaux', quantity: 'Selon appétit', preparation: 'Crus ou cuits' }
                ],
                proteins: [
                    { name: 'Toutes viandes', texture: 'Coupée', quantity: '20g', preparation: 'Bien cuites' },
                    { name: 'Tous poissons', texture: 'Coupé', quantity: '20g', preparation: 'Sans arêtes' },
                    { name: 'Œuf', texture: 'Normal', quantity: '1/2 œuf', preparation: 'Toutes cuissons' }
                ],
                starches: [
                    { name: 'Tous féculents', texture: 'Normaux', quantity: 'Selon appétit', preparation: 'Variés' }
                ],
                dairy: [
                    { name: 'Tous fromages au lait cru', texture: 'Normaux', quantity: '20g/jour', preparation: 'Qualité' }
                ],
                newFoods: [
                    { name: 'Miel', age: '12 mois', note: 'Possible après 1 an' },
                    { name: 'Fruits de mer', age: '12 mois', note: 'Bien cuits' },
                    { name: 'Fruits à coque', age: '12 mois', note: 'En poudre ou purée' }
                ]
            }
        };
        // Guide de motricité par âge
        const MOTOR_DEVELOPMENT_GUIDE = {
            0: {
                title: 'La découverte du corps (0-3 mois)',
                description: 'Mouvements principalement réflexes. Le bébé travaille sur le renforcement de son cou et de son dos.',
                skills: [
                    'Lève et tourne la tête en position ventrale',
                    'Agite les bras et jambes de façon non coordonnée',
                    'Saisit des objets par réflexe d\'agrippement',
                    'Fixe du regard et suit des yeux'
                ],
                exercises: [
                    {
                        name: 'Tummy Time',
                        description: 'Placer bébé sur le ventre sur un tapis',
                        duration: 'Commencer 2-3 minutes, augmenter progressivement',
                        benefits: 'Renforce cou, dos et épaules',
                        safety: 'Toujours sous surveillance'
                    },
                    {
                        name: 'Massage doux',
                        description: 'Masser doucement bras et jambes',
                        duration: '5-10 minutes',
                        benefits: 'Stimule les muscles et la circulation',
                        safety: 'Mouvements très doux'
                    },
                    {
                        name: 'Jouets suspendus',
                        description: 'Portique d\'éveil au-dessus de bébé',
                        duration: '10-15 minutes',
                        benefits: 'Encourage à lever la tête et suivre du regard',
                        safety: 'Jouets bien fixés'
                    }
                ]
            },
            3: {
                title: 'Le contrôle et le roulé-boulé (3-6 mois)',
                description: 'Bébé commence à mieux contrôler ses mouvements et à se déplacer.',
                skills: [
                    'Se retourne du dos sur le ventre',
                    'Se redresse sur les bras en position ventrale',
                    'Saisit volontairement des objets',
                    'Porte les objets à sa bouche'
                ],
                exercises: [
                    {
                        name: 'Encourager le retournement',
                        description: 'Placer un jouet sur le côté pour inciter à se tourner',
                        duration: '5-10 minutes plusieurs fois/jour',
                        benefits: 'Développe force du tronc',
                        safety: 'Surface sécurisée'
                    },
                    {
                        name: 'Position "avion"',
                        description: 'Tenir bébé sur le ventre, légèrement surélevé',
                        duration: '1-2 minutes',
                        benefits: 'Renforce muscles du dos et du cou',
                        safety: 'Tenir fermement'
                    },
                    {
                        name: 'Tapis d\'éveil',
                        description: 'Jouets suspendus à attraper',
                        duration: '15-20 minutes',
                        benefits: 'Coordination œil-main',
                        safety: 'Jouets adaptés à l\'âge'
                    }
                ]
            },
            6: {
                title: 'Le quatre pattes et la position assise (6-9 mois)',
                description: 'Période d\'explosion motrice. Bébé devient mobile et explore activement.',
                skills: [
                    'S\'assied seul sans soutien',
                    'Commence à ramper ou faire du quatre pattes',
                    'Se déplace en roulant ou glissant',
                    'Utilise la pince pouce-index (motricité fine)'
                ],
                exercises: [
                    {
                        name: 'Espace sécurisé d\'exploration',
                        description: 'Zone avec coussins et jouets pour ramper',
                        duration: '30-45 minutes/jour',
                        benefits: 'Développe mobilité et confiance',
                        safety: 'Sécuriser l\'environnement'
                    },
                    {
                        name: 'Encourager le quatre pattes',
                        description: 'Placer jouet hors de portée pour motiver déplacement',
                        duration: '10-15 minutes',
                        benefits: 'Coordination et force des membres',
                        safety: 'Objets sécurisés'
                    },
                    {
                        name: 'Bouteille sensorielle',
                        description: 'Bouteille avec pâtes ou billes (fermée)',
                        duration: '10-15 minutes',
                        benefits: 'Stimulation auditive et manipulation',
                        safety: 'Bouteille bien fermée'
                    }
                ]
            },
            9: {
                title: 'Les premiers pas (9-12 mois)',
                description: 'Bébé se prépare à la marche. Il cherche à se hisser debout.',
                skills: [
                    'Se hisse debout en s\'appuyant sur les meubles',
                    'Se déplace en "longeant" les meubles',
                    'Se tient debout sans soutien quelques secondes',
                    'Fait ses premiers pas'
                ],
                exercises: [
                    {
                        name: 'Jouets à pousser',
                        description: 'Chariot de marche ou jouet à pousser',
                        duration: '15-20 minutes',
                        benefits: 'Équilibre et confiance en marchant',
                        safety: 'Jouet stable et adapté'
                    },
                    {
                        name: 'Objets en hauteur',
                        description: 'Jouets sur canapé bas pour se redresser',
                        duration: '10-15 minutes',
                        benefits: 'Force des jambes',
                        safety: 'Hauteur adaptée'
                    },
                    {
                        name: 'Marche accompagnée',
                        description: 'Tenir les deux mains et marcher ensemble',
                        duration: '5-10 minutes',
                        benefits: 'Confiance et équilibre',
                        safety: 'Ne pas forcer'
                    }
                ]
            },
            12: {
                title: 'La marche en toute confiance (12-18 mois)',
                description: 'Bébé devient un petit explorateur sur deux jambes.',
                skills: [
                    'Marche seul avec assurance',
                    'Monte et descend escaliers avec aide',
                    'S\'accroupit et se relève facilement',
                    'Lance une balle'
                ],
                exercises: [
                    {
                        name: 'Jeu du ballon',
                        description: 'Faire rouler un ballon pour encourager à courir',
                        duration: '10-15 minutes',
                        benefits: 'Coordination et équilibre dynamique',
                        safety: 'Espace dégagé'
                    },
                    {
                        name: 'Jeux de construction',
                        description: 'Blocs à empiler et encastrer',
                        duration: '15-20 minutes',
                        benefits: 'Motricité fine et coordination',
                        safety: 'Pièces adaptées à l\'âge'
                    },
                    {
                        name: 'Mini-parcours',
                        description: 'Coussins et tunnels à franchir',
                        duration: '20-30 minutes',
                        benefits: 'Confiance motrice et exploration',
                        safety: 'Obstacles bas et sûrs'
                    }
                ]
            },
            18: {
                title: 'Exploration et affinement (18-24 mois)',
                description: 'Perfectionnement des acquis et développement de l\'agilité.',
                skills: [
                    'Court avec plus d\'assurance',
                    'Monte escaliers en alternant les pieds',
                    'Commence à sauter sur place',
                    'Manipule objets avec précision'
                ],
                exercises: [
                    {
                        name: 'Parcours d\'obstacles',
                        description: 'Slalom, marches, tunnels',
                        duration: '20-30 minutes',
                        benefits: 'Agilité et planification motrice',
                        safety: 'Supervision constante'
                    },
                    {
                        name: 'Jeux de précision',
                        description: 'Enfiler grosses perles, puzzles simples',
                        duration: '10-15 minutes',
                        benefits: 'Motricité fine et concentration',
                        safety: 'Pièces non avalables'
                    },
                    {
                        name: 'Danse et musique',
                        description: 'Bouger en rythme sur la musique',
                        duration: '10-15 minutes',
                        benefits: 'Coordination et expression corporelle',
                        safety: 'Espace libre'
                    }
                ]
            }
        };

        // Calendrier vaccinal français
        const VACCINE_SCHEDULE = {
            2: [
                { name: 'DTC-Polio-Hib (1ère injection)', required: true },
                { name: 'Pneumocoque (1ère injection)', required: true },
                { name: 'Méningocoque C (1ère injection)', required: true }
            ],
            4: [
                { name: 'DTC-Polio-Hib (2ème injection)', required: true },
                { name: 'Pneumocoque (2ème injection)', required: true }
            ],
            11: [
                { name: 'DTC-Polio-Hib (3ème injection)', required: true },
                { name: 'Pneumocoque (3ème injection)', required: true },
                { name: 'Méningocoque C (2ème injection)', required: true },
                { name: 'ROR (1ère injection)', required: true }
            ],
            12: [
                { name: 'Hépatite B (si pas fait à la naissance)', required: false }
            ],
            16: [
                { name: 'ROR (2ème injection)', required: true }
            ]
        };
        const BabyTracker = () => {
            // États principaux
            const [user, setUser] = useState(null);
            const [entries, setEntries] = useState([]);
            const [medications, setMedications] = useState([]);
            const [appointments, setAppointments] = useState([]);
            const [stocks, setStocks] = useState({});
            // État pour le suivi du poids
            const [currentWeight, setCurrentWeight] = useState(null);
            const [lastWeightUpdate, setLastWeightUpdate] = useState(null);
            // État pour le suivi des vaccins
            const [vaccines, setVaccines] = useState([]);
            const [vaccineData, setVaccineData] = useState({
                name: '',
                date: '',
                nextDue: '',
                notes: ''
            });
            // État pour le suivi de la diversification alimentaire
            const [diversificationEntries, setDiversificationEntries] = useState([]);
            const [diversificationData, setDiversificationData] = useState({
                food: '',
                date: '',
                rating: 5,
                notes: ''
            });

            const [wardrobe, setWardrobe] = useState([]);
            const [wardrobeData, setWardrobeData] = useState({
                type: '',
                size: '',
                quantity: 1,
                notes: ''
            });
            // État pour le suivi de la croissance
            const [currentHeight, setCurrentHeight] = useState(null);
            const [lastHeightUpdate, setLastHeightUpdate] = useState(null);

            // États d'interface
            const [showAuth, setShowAuth] = useState(true);
            const [authMode, setAuthMode] = useState('login');
            const [currentView, setCurrentView] = useState('daily');
            const [periodView, setPeriodView] = useState('daily');
            const [showForm, setShowForm] = useState(false);
            const [formType, setFormType] = useState('');
            const [editingId, setEditingId] = useState(null);
            const [currentPage, setCurrentPage] = useState(0);
            const [historyFilter, setHistoryFilter] = useState('today');
            const [tipsExpanded, setTipsExpanded] = useState(0);
            const [showMoreMenu, setShowMoreMenu] = useState(false);
            const [showPlusMenu, setShowPlusMenu] = useState(false);
            const [editingWardrobeId, setEditingWardrobeId] = useState(null);
            // État pour le suivi des soins quotidiens
            const [dailyCare, setDailyCare] = useState({
                cordon: {
                    active: true, // Peut être désactivé quand le cordon tombe
                    morningDone: false,
                    eveningDone: false,
                    lastDate: null
                },
                visage: { done: false, lastDate: null },
                vitamines: { done: false, lastDate: null }
            });

            // États des formulaires
            const [authData, setAuthData] = useState({
                code: '',
                babyName: '',
                birthDate: '',
                birthTime: '06:00',
                birthWeight: '',
                birthHeight: '',
                parents: '',
                gender: 'boy'
            });

            const [formData, setFormData] = useState({
                time: '',
                date: '',
                amount: '',
                hasPee: false,
                hasPoop: false,
                poopQuantity: '',
                poopConsistency: '',
                poopColor: ''
            });

            const [medicationData, setMedicationData] = useState({
                name: '',
                dosage: '',
                date: '',
                time: '',
                interval: ''
            });

            const [appointmentData, setAppointmentData] = useState({
                type: '',
                doctor: '',
                date: '',
                time: '',
                location: ''
            });

            // États pour les notifications
            const [notificationPermission, setNotificationPermission] = useState('default');
            const [activeNotifications, setActiveNotifications] = useState([]);

            // Demander la permission pour les notifications
            const requestNotificationPermission = async () => {
                if ('Notification' in window) {
                    const permission = await Notification.requestPermission();
                    setNotificationPermission(permission);
                    return permission === 'granted';
                }
                return false;
            };

            // Envoyer une notification
            const sendNotification = (title, body, icon = 'logo.PNG', tag = null) => {
                if (notificationPermission === 'granted' && 'Notification' in window) {
                    const notification = new Notification(title, {
                        body,
                        icon,
                        badge: 'logo.PNG',
                        tag,
                        requireInteraction: true,
                        actions: [
                            { action: 'open', title: 'Ouvrir BabyTrack' },
                            { action: 'dismiss', title: 'Ignorer' }
                        ]
                    });

                    notification.onclick = () => {
                        window.focus();
                        notification.close();
                    };

                    return notification;
                }
            };

            // Programmer une notification
            const scheduleNotification = (title, body, delayMinutes, tag = null) => {
                if (notificationPermission !== 'granted') return null;

                const timeoutId = setTimeout(() => {
                    sendNotification(title, body, 'logo.PNG', tag);
                    // Retirer de la liste des notifications actives
                    setActiveNotifications(prev => prev.filter(n => n.id !== timeoutId));
                }, delayMinutes * 60 * 1000);

                // Ajouter à la liste des notifications actives
                const notification = {
                    id: timeoutId,
                    title,
                    body,
                    scheduledFor: new Date(Date.now() + (delayMinutes * 60 * 1000)),
                    tag,
                    type: tag?.split('-')[0] || 'general'
                };

                setActiveNotifications(prev => [...prev, notification]);
                return timeoutId;
            };

            // Annuler une notification programmée
            const cancelScheduledNotification = (notificationId) => {
                clearTimeout(notificationId);
                setActiveNotifications(prev => prev.filter(n => n.id !== notificationId));
            };

            // Notifications pour biberon
            const scheduleNextFeedingNotification = () => {
                const nextFeeding = calculateNextFeeding();
                if (!nextFeeding) return;

                const now = new Date();
                const timeDiff = nextFeeding.nextTime - now;
                const minutesUntilFeeding = Math.ceil(timeDiff / (1000 * 60));

                if (minutesUntilFeeding > 0 && minutesUntilFeeding <= 480) { // Max 8h
                    // Annuler les anciennes notifications de biberon
                    activeNotifications
                        .filter(n => n.type === 'feeding')
                        .forEach(n => cancelScheduledNotification(n.id));

                    // Programmer nouvelle notification
                    scheduleNotification(
                        '🍼 C\'est l\'heure du biberon !',
                        `Il est temps de donner le biberon à ${user?.babyName}`,
                        minutesUntilFeeding,
                        'feeding-reminder'
                    );
                }
            };

            // Notifications pour médicaments
            const scheduleMedicationNotifications = () => {
                medications.forEach(medication => {
                    if (!medication.interval) return;

                    const lastGiven = new Date(medication.lastGiven);
                    const nextDue = new Date(lastGiven.getTime() + (medication.interval * 60 * 60 * 1000));
                    const now = new Date();
                    const minutesUntilDue = Math.ceil((nextDue - now) / (1000 * 60));

                    if (minutesUntilDue > 0 && minutesUntilDue <= 1440) { // Max 24h
                        scheduleNotification(
                            '💊 Médicament à donner',
                            `Il est temps de donner ${medication.name} (${medication.dosage}) à ${user?.babyName}`,
                            minutesUntilDue,
                            `medication-${medication.id}`
                        );
                    }
                });
            };

            // Notifications pour rendez-vous
            const scheduleAppointmentNotifications = () => {
                appointments.forEach(appointment => {
                    const appointmentTime = new Date(appointment.timestamp);
                    const now = new Date();
                    const minutesUntilAppointment = Math.ceil((appointmentTime - now) / (1000 * 60));

                    // Notification 1h avant
                    if (minutesUntilAppointment > 60 && minutesUntilAppointment <= 1440) {
                        scheduleNotification(
                            '📅 Rendez-vous dans 1h',
                            `${appointment.type} avec ${appointment.doctor || 'le praticien'} dans 1 heure`,
                            minutesUntilAppointment - 60,
                            `appointment-1h-${appointment.id}`
                        );
                    }

                    // Notification 15 min avant
                    if (minutesUntilAppointment > 15 && minutesUntilAppointment <= 1440) {
                        scheduleNotification(
                            '🚨 Rendez-vous dans 15 min',
                            `${appointment.type} avec ${appointment.doctor || 'le praticien'} dans 15 minutes`,
                            minutesUntilAppointment - 15,
                            `appointment-15min-${appointment.id}`
                        );
                    }
                });
            };

            // Notifications pour vaccins
            const scheduleVaccineReminders = () => {
                const ageInMonths = Math.floor(calculateAge() / 30);

                Object.keys(VACCINE_SCHEDULE).forEach(monthKey => {
                    const month = parseInt(monthKey);
                    if (month === ageInMonths || month === ageInMonths + 1) {
                        VACCINE_SCHEDULE[month].forEach(vaccine => {
                            const isAlreadyDone = vaccines.some(v =>
                                v.name.includes(vaccine.name.split('(')[0].trim())
                            );

                            if (!isAlreadyDone && vaccine.required) {
                                // Notification pour rappel vaccin
                                scheduleNotification(
                                    '💉 Rappel vaccination',
                                    `Il est temps de programmer le vaccin : ${vaccine.name}`,
                                    60, // Dans 1h (pour test, ajustez selon besoin)
                                    `vaccine-${month}-${vaccine.name.replace(/\s+/g, '-')}`
                                );
                            }
                        });
                    }
                });
            };

            const chartRef = useRef(null);
            const chartInstance = useRef(null);

            // Fonctions utilitaires
            const generateCode = () => Math.random().toString(36).substring(2, 8).toUpperCase();
            const getCurrentTime = () => new Date().toTimeString().slice(0, 5);
            const getCurrentDate = () => new Date().toISOString().slice(0, 10);

            const calculateAge = () => {
                if (!user) return 0;
                const birth = new Date(user.birthDate);
                const today = new Date();
                return Math.floor((today - birth) / (1000 * 60 * 60 * 24));
            };

            const formatAgeDisplay = (ageInDays) => {
                if (ageInDays <= 30) {
                    return `Jour ${ageInDays}`;
                }

                const months = Math.floor(ageInDays / 30);
                const remainingDays = ageInDays % 30;

                if (remainingDays === 0) {
                    return `${months} mois`;
                } else {
                    return `${months} mois ${remainingDays}j`;
                }
            };

            const formatTime = (timestamp) => {
                return new Date(timestamp).toLocaleTimeString('fr-FR', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            };

            const formatDate = (timestamp) => {
                return new Date(timestamp).toLocaleDateString('fr-FR', {
                    weekday: 'long',
                    day: 'numeric',
                    month: 'long'
                });
            };

            const formatDateTime = (timestamp) => {
                const date = new Date(timestamp);
                const today = new Date();
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);

                if (date.toDateString() === today.toDateString()) {
                    return formatTime(timestamp);
                } else if (date.toDateString() === yesterday.toDateString()) {
                    return `Hier ${formatTime(timestamp)}`;
                } else {
                    return `${date.getDate()}/${date.getMonth() + 1} ${formatTime(timestamp)}`;
                }
            };

            const getDayStart = (date) => {
                const dayStart = new Date(date);
                dayStart.setHours(7, 0, 0, 0);
                if (date.getHours() < 7) {
                    dayStart.setDate(dayStart.getDate() - 1);
                }
                return dayStart;
            };

            const getDayEnd = (date) => {
                const dayEnd = new Date(date);
                dayEnd.setHours(6, 30, 0, 0);
                dayEnd.setDate(dayEnd.getDate() + 1);
                if (date.getHours() >= 7) {
                    dayEnd.setDate(dayEnd.getDate() + 1);
                }
                return dayEnd;
            };

            // Fonction pour les couleurs selon le sexe
            const getThemeColors = () => {
                return user?.gender === 'girl' ? {
                    primary: 'from-pink-500 to-pink-600',
                    primaryBg: 'bg-pink-500',
                    primaryText: 'text-pink-600',
                    primaryBorder: 'border-pink-200',
                    primaryHover: 'hover:bg-pink-50',
                    primaryLight: 'bg-pink-100',
                    primaryDark: 'text-pink-800'
                } : {
                    primary: 'from-blue-500 to-blue-600',
                    primaryBg: 'bg-blue-500',
                    primaryText: 'text-blue-600',
                    primaryBorder: 'border-blue-200',
                    primaryHover: 'hover:bg-blue-50',
                    primaryLight: 'bg-blue-100',
                    primaryDark: 'text-blue-800'
                };
            };

            // Fonction pour obtenir les recommandations de diversification
            const getDiversificationRecommendations = (ageInDays) => {
                const ageInMonths = Math.floor(ageInDays / 30);

                if (ageInMonths < 4) {
                    return {
                        phase: 'Pas encore',
                        message: 'La diversification commence généralement entre 4 et 6 mois. Le lait reste l\'aliment unique et complet.',
                        recommendation: 'Continuer l\'allaitement ou le biberon exclusivement'
                    };
                } else if (ageInMonths >= 4 && ageInMonths < 6) {
                    return DIVERSIFICATION_GUIDE[4];
                } else if (ageInMonths >= 6 && ageInMonths < 8) {
                    return DIVERSIFICATION_GUIDE[6];
                } else if (ageInMonths >= 8 && ageInMonths < 12) {
                    return DIVERSIFICATION_GUIDE[8];
                } else {
                    return DIVERSIFICATION_GUIDE[12];
                }
            };

            // Fonction pour obtenir le guide de motricité
            const getMotorDevelopmentForAge = (ageInDays) => {
                const ageInMonths = Math.floor(ageInDays / 30);

                if (ageInMonths < 3) {
                    return MOTOR_DEVELOPMENT_GUIDE[0];
                } else if (ageInMonths >= 3 && ageInMonths < 6) {
                    return MOTOR_DEVELOPMENT_GUIDE[3];
                } else if (ageInMonths >= 6 && ageInMonths < 9) {
                    return MOTOR_DEVELOPMENT_GUIDE[6];
                } else if (ageInMonths >= 9 && ageInMonths < 12) {
                    return MOTOR_DEVELOPMENT_GUIDE[9];
                } else if (ageInMonths >= 12 && ageInMonths < 18) {
                    return MOTOR_DEVELOPMENT_GUIDE[12];
                } else {
                    return MOTOR_DEVELOPMENT_GUIDE[18];
                }
            };
            // Fonctions d'alimentation
            const getFeedingRecommendations = (ageInDays) => {
                if (FEEDING_GUIDE[ageInDays]) {
                    return FEEDING_GUIDE[ageInDays];
                }

                for (const range of FEEDING_RANGES) {
                    if (range.days.includes(ageInDays)) {
                        return {
                            volume: range.volume,
                            frequency: range.frequency,
                            total: range.total,
                            comment: range.comment
                        };
                    }
                }

                if (ageInDays >= 29) {
                    const ageInMonths = Math.floor(ageInDays / 30);

                    // Chercher d'abord une correspondance exacte
                    if (FEEDING_MONTHS[ageInMonths]) {
                        return FEEDING_MONTHS[ageInMonths];
                    }

                    // Puis chercher la tranche la plus proche
                    const availableMonths = Object.keys(FEEDING_MONTHS).map(m => parseInt(m)).sort((a, b) => a - b);
                    let closestMonth = availableMonths[availableMonths.length - 1]; // Par défaut le plus élevé

                    for (const month of availableMonths) {
                        if (ageInMonths <= month) {
                            closestMonth = month;
                            break;
                        }
                    }

                    return FEEDING_MONTHS[closestMonth];
                }

                return null;
            };
            const getDefaultAmount = (volumeRange) => {
                const ranges = volumeRange.match(/(\d+)(?:–(\d+))?/);
                if (!ranges) return null;

                const min = parseInt(ranges[1]);
                const max = ranges[2] ? parseInt(ranges[2]) : min;

                const average = Math.round((min + max) / 2);
                return Math.round(average / 5) * 5;
            };

            const calculateMilkByWeight = (weightKg, ageInDays) => {
                if (!weightKg || weightKg <= 0) return null;

                // Calcul de base : 150ml par kg de poids par jour
                const baseMilk = Math.round(weightKg * 150);

                // Nombre de biberons selon l'âge
                let feedingsPerDay;
                if (ageInDays <= 30) feedingsPerDay = 6;
                else if (ageInDays <= 60) feedingsPerDay = 5;
                else if (ageInDays <= 120) feedingsPerDay = 5;
                else if (ageInDays <= 150) feedingsPerDay = 4;
                else if (ageInDays <= 240) feedingsPerDay = 4;
                else feedingsPerDay = 3;

                const mlPerFeeding = Math.round(baseMilk / feedingsPerDay);

                return {
                    totalPerDay: baseMilk,
                    feedingsPerDay,
                    mlPerFeeding,
                    weightUsed: weightKg
                };
            };
            // Calcul du prochain biberon
            const calculateNextFeeding = () => {
                const age = calculateAge();
                const now = new Date();
                const dayStart = getDayStart(now);
                const dayEnd = getDayEnd(now);

                const todayFeedings = entries.filter(entry => {
                    const entryDate = new Date(entry.timestamp);
                    return entry.type === 'feeding' && entryDate >= dayStart && entryDate <= dayEnd;
                });

                if (todayFeedings.length === 0) {
                    return null;
                }

                todayFeedings.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                const lastFeeding = todayFeedings[0];
                const lastFeedingTime = new Date(lastFeeding.timestamp);

                let intervalMinutes;
                if (age <= 7) {
                    intervalMinutes = 180; // 3h (modifié de 2h30)
                } else if (age <= 14) {
                    intervalMinutes = 180; // 3h
                } else if (age <= 30) {
                    intervalMinutes = 210; // 3h30
                } else if (age <= 60) {
                    intervalMinutes = 240; // 4h
                } else if (age <= 120) {
                    intervalMinutes = 270; // 4h30
                } else {
                    intervalMinutes = 300; // 5h
                }

                const nextFeeding = new Date(lastFeedingTime);
                nextFeeding.setMinutes(nextFeeding.getMinutes() + intervalMinutes);

                return {
                    nextTime: nextFeeding,
                    lastFeeding: lastFeedingTime,
                    intervalMinutes: intervalMinutes,
                    intervalHours: intervalMinutes / 60,
                    age: age
                };
            };

            // Calculs statistiques
            const getFilteredEntries = (period) => {
                const now = new Date();
                let startDate, endDate;

                switch (period) {
                    case 'daily':
                        startDate = getDayStart(now);
                        endDate = getDayEnd(now);
                        break;
                    case 'weekly':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 7);
                        endDate = new Date(now);
                        break;
                    case 'monthly':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 30);
                        endDate = new Date(now);
                        break;
                    default:
                        return [];
                }

                return entries.filter(entry => {
                    const entryDate = new Date(entry.timestamp);
                    return entryDate >= startDate && entryDate <= endDate;
                });
            };

            const getStats = (period) => {
                const filteredEntries = getFilteredEntries(period);
                const feedings = filteredEntries.filter(entry => entry.type === 'feeding');
                const totalMilk = feedings.reduce((sum, entry) => sum + parseInt(entry.amount || 0), 0);
                const totalPees = filteredEntries.filter(entry => entry.hasPee).length;
                const totalPoops = filteredEntries.filter(entry => entry.hasPoop).length;

                return { totalMilk, totalPees, totalPoops, feedingCount: feedings.length };
            };

            // Filtrage de l'historique avec pagination
            const getFilteredHistory = () => {
                const now = new Date();
                let filteredEntries = [];

                switch (historyFilter) {
                    case 'today':
                        const dayStart = getDayStart(now);
                        const dayEnd = getDayEnd(now);
                        filteredEntries = entries.filter(entry => {
                            const entryDate = new Date(entry.timestamp);
                            return entryDate >= dayStart && entryDate <= dayEnd;
                        });
                        break;
                    case 'yesterday':
                        const yesterday = new Date(now);
                        yesterday.setDate(yesterday.getDate() - 1);
                        const yestStart = getDayStart(yesterday);
                        const yestEnd = getDayEnd(yesterday);
                        filteredEntries = entries.filter(entry => {
                            const entryDate = new Date(entry.timestamp);
                            return entryDate >= yestStart && entryDate <= yestEnd;
                        });
                        break;
                    case 'week':
                        const weekStart = new Date(now);
                        weekStart.setDate(weekStart.getDate() - 7);
                        filteredEntries = entries.filter(entry => {
                            const entryDate = new Date(entry.timestamp);
                            return entryDate >= weekStart;
                        });
                        break;
                    default:
                        filteredEntries = entries;
                }

                return filteredEntries;
            };
            // Vérification connexion au chargement
            useEffect(() => {
                const savedCode = localStorage.getItem('familyCode');
                if (savedCode) {
                    setAuthData(prev => ({ ...prev, code: savedCode }));
                    handleLogin(savedCode);
                }

            }, []);


            // Écoute des données Firebase
            useEffect(() => {
                if (!user) return;

                const familyCode = user.code;
                const unsubscribers = [];

                // Écoute des entrées filtrées par famille
                const entriesUnsubscribe = db.collection('entries')
                    .where('familyCode', '==', familyCode)
                    .orderBy('timestamp', 'desc')
                    .onSnapshot((snapshot) => {
                        const entriesData = [];
                        snapshot.forEach((doc) => {
                            entriesData.push({ id: doc.id, ...doc.data() });
                        });
                        setEntries(entriesData);
                        localStorage.setItem('babyTrackerEntries', JSON.stringify(entriesData));
                    });
                unsubscribers.push(entriesUnsubscribe);

                // Écoute des médicaments filtrés par famille
                const medicationsUnsubscribe = db.collection('medications')
                    .where('familyCode', '==', familyCode)
                    .orderBy('timestamp', 'desc')
                    .onSnapshot((snapshot) => {
                        const medicationsData = [];
                        snapshot.forEach((doc) => {
                            medicationsData.push({ id: doc.id, ...doc.data() });
                        });
                        setMedications(medicationsData);
                    });
                unsubscribers.push(medicationsUnsubscribe);

                // Écoute des rendez-vous filtrés par famille
                const appointmentsUnsubscribe = db.collection('appointments')
                    .where('familyCode', '==', familyCode)
                    .orderBy('timestamp', 'desc')
                    .onSnapshot((snapshot) => {
                        const appointmentsData = [];
                        snapshot.forEach((doc) => {
                            appointmentsData.push({ id: doc.id, ...doc.data() });
                        });
                        setAppointments(appointmentsData);
                    });
                unsubscribers.push(appointmentsUnsubscribe);

                // Écoute des stocks filtrés par famille
                const stocksUnsubscribe = db.collection('stocks')
                    .where('familyCode', '==', familyCode)
                    .onSnapshot((snapshot) => {
                        const stocksData = {};
                        snapshot.forEach((doc) => {
                            const data = doc.data();
                            stocksData[data.type] = data;
                        });
                        setStocks(stocksData);
                    });
                unsubscribers.push(stocksUnsubscribe);

                // Écoute des vaccins filtrés par famille
                const vaccinesUnsubscribe = db.collection('vaccines')
                    .where('familyCode', '==', familyCode)
                    .orderBy('timestamp', 'desc')
                    .onSnapshot((snapshot) => {
                        const vaccinesData = [];
                        snapshot.forEach((doc) => {
                            vaccinesData.push({ id: doc.id, ...doc.data() });
                        });
                        setVaccines(vaccinesData);
                    });
                unsubscribers.push(vaccinesUnsubscribe);

                // Écoute de la diversification filtrée par famille
                const diversificationUnsubscribe = db.collection('diversification')
                    .where('familyCode', '==', familyCode)
                    .orderBy('timestamp', 'desc')
                    .onSnapshot((snapshot) => {
                        const diversificationData = [];
                        snapshot.forEach((doc) => {
                            diversificationData.push({ id: doc.id, ...doc.data() });
                        });
                        setDiversificationEntries(diversificationData);
                    });
                unsubscribers.push(diversificationUnsubscribe);

                // Écoute de la garde-robe filtrée par famille
                const wardrobeUnsubscribe = db.collection('wardrobe')
                    .where('familyCode', '==', familyCode)
                    .orderBy('timestamp', 'desc')
                    .onSnapshot((snapshot) => {
                        const wardrobeData = [];
                        snapshot.forEach((doc) => {
                            wardrobeData.push({ id: doc.id, ...doc.data() });
                        });
                        setWardrobe(wardrobeData);
                    });
                unsubscribers.push(wardrobeUnsubscribe);
                return () => {
                    unsubscribers.forEach(unsubscribe => unsubscribe());
                };
            }, [user]);
            // Mise à jour du graphique
            useEffect(() => {
                if (currentView === 'daily' && periodView === 'daily' && chartRef.current && entries.length > 0) {
                    updateDailyChart();
                }
            }, [entries, currentView, periodView]);
            // Fermer le menu "Plus" quand on clique ailleurs
            useEffect(() => {
                const handleClickOutside = (event) => {
                    // Vérifier si le clic est en dehors des menus
                    const isOutsideMoreMenu = !event.target.closest('.relative') ||
                        !event.target.closest('[data-menu="more"]');
                    const isOutsidePlusMenu = !event.target.closest('[data-menu="plus"]');

                    if (showMoreMenu && isOutsideMoreMenu) {
                        setShowMoreMenu(false);
                    }
                    if (showPlusMenu && isOutsidePlusMenu) {
                        setShowPlusMenu(false);
                    }
                };

                document.addEventListener('mousedown', handleClickOutside);
                return () => {
                    document.removeEventListener('mousedown', handleClickOutside);
                };
            }, [showMoreMenu, showPlusMenu]);
            // Mise à jour automatique du prochain biberon
            useEffect(() => {
                if (currentView !== 'daily') return;

                // Vérifier le statut des soins au chargement
                checkCareStatus();

                // Mettre à jour toutes les minutes
                const interval = setInterval(() => {
                    checkCareStatus();
                    // Forcer le re-rendu pour mettre à jour les temps affichés
                    setCurrentView(prevView => prevView);
                }, 60000); // 60 secondes

                return () => clearInterval(interval);
            }, [currentView, user, entries]);

            // Charger les soins depuis Firebase
            useEffect(() => {
                if (!user) return;

                const today = getCurrentDate();
                const unsubscribe = db.collection('dailyCare')
                    .doc(`${user.code}_${today}`)
                    .onSnapshot((doc) => {
                        if (doc.exists) {
                            const data = doc.data();
                            setDailyCare(data.care || {
                                cordon: {
                                    active: true,
                                    morningDone: false,
                                    eveningDone: false,
                                    lastDate: null
                                },
                                visage: { done: false, lastDate: null },
                                vitamines: { done: false, lastDate: null }
                            });
                        }
                    });

                return () => unsubscribe();
            }, [user]);

            // Initialiser les notifications
            useEffect(() => {
                if (!user) return;

                // Demander permission au premier chargement
                if (notificationPermission === 'default') {
                    requestNotificationPermission().then(granted => {
                        if (granted) {
                            console.log('Notifications autorisées');
                        }
                    });
                }

                // Programmer les notifications si permission accordée
                if (notificationPermission === 'granted') {
                    scheduleNextFeedingNotification();
                    scheduleMedicationNotifications();
                    scheduleAppointmentNotifications();
                    scheduleVaccineReminders();
                }
            }, [user, entries, medications, appointments, vaccines, notificationPermission]);

            // Reprogrammer les notifications quand une nouvelle entrée est ajoutée
            useEffect(() => {
                if (notificationPermission === 'granted' && user) {
                    // Attendre un peu pour que les données soient mises à jour
                    setTimeout(() => {
                        scheduleNextFeedingNotification();
                    }, 1000);
                }
            }, [entries.length]);

            // Vérifier permission au chargement
            useEffect(() => {
                if ('Notification' in window) {
                    setNotificationPermission(Notification.permission);
                }
            }, []);
            // Authentification
            const handleCreateAccount = async () => {
                const { babyName, birthDate, birthTime, birthWeight, birthHeight, parents, gender } = authData;

                if (!babyName || !birthDate) {
                    alert('Nom du bébé et date de naissance obligatoires');
                    return;
                }

                const familyCode = generateCode();
                const familyData = {
                    code: familyCode,
                    babyName,
                    birthDate,
                    birthTime: birthTime || '06:00',
                    birthWeight: parseFloat(birthWeight) || 3.290,
                    birthHeight: parseInt(birthHeight) || 48,
                    parents: parents || 'Papa & Maman',
                    gender: gender,
                    createdAt: new Date().toISOString()
                };

                try {
                    await db.collection('families').doc(familyCode).set(familyData);
                    alert(`Famille créée avec succès!\n\nCode famille: ${familyCode}\n\nNotez bien ce code!`);

                    setUser(familyData);
                    localStorage.setItem('familyCode', familyCode);
                    setShowAuth(false);
                } catch (error) {
                    console.error('Erreur création:', error);
                    alert('Erreur lors de la création du compte');
                }
            };

            const handleLogin = async (code = authData.code) => {
                if (!code || code.length !== 6) {
                    alert('Code famille invalide (6 caractères requis)');
                    return;
                }

                try {
                    const doc = await db.collection('families').doc(code.toUpperCase()).get();

                    if (doc.exists) {
                        const userData = doc.data();
                        setUser(userData);

                        // Charger le poids et la taille sauvegardés
                        if (userData.currentWeight) {
                            setCurrentWeight(userData.currentWeight);
                        }
                        if (userData.lastWeightUpdate) {
                            setLastWeightUpdate(userData.lastWeightUpdate);
                        }
                        if (userData.currentHeight) {
                            setCurrentHeight(userData.currentHeight);
                        }
                        if (userData.lastHeightUpdate) {
                            setLastHeightUpdate(userData.lastHeightUpdate);
                        }

                        localStorage.setItem('familyCode', code.toUpperCase());
                        setShowAuth(false);
                    } else {
                        alert('Code famille introuvable');
                    }
                } catch (error) {
                    console.error('Erreur connexion:', error);
                    alert('Erreur de connexion');
                }
            };

            const logout = () => {
                setUser(null);
                localStorage.removeItem('familyCode');
                setShowAuth(true);
                setAuthMode('login');
            };
            // Gestion des entrées
            const openForm = (type) => {
                setFormType(type);
                setEditingId(null);
                setFormData({
                    time: getCurrentTime(),
                    date: getCurrentDate(),
                    amount: '',
                    hasPee: false,
                    hasPoop: false,
                    poopQuantity: '',
                    poopConsistency: '',
                    poopColor: ''
                });

                // Suggestion automatique pour biberon
                if (type === 'feeding') {
                    const age = calculateAge();
                    let suggestedAmount = '';

                    // Calcul par poids si disponible
                    if (currentWeight) {
                        const calculation = calculateMilkByWeight(currentWeight, age);
                        if (calculation) {
                            suggestedAmount = calculation.mlPerFeeding.toString();
                        }
                    } else {
                        // Fallback sur l'ancien système
                        const recommendations = getFeedingRecommendations(age);
                        if (recommendations) {
                            const defaultAmount = getDefaultAmount(recommendations.volume);
                            if (defaultAmount) {
                                suggestedAmount = defaultAmount.toString();
                            }
                        }
                    }

                    if (suggestedAmount) {
                        setFormData(prev => ({ ...prev, amount: suggestedAmount }));
                    }
                }
                setShowForm(true);
            };

            const editEntry = (entryId) => {
                const entry = entries.find(e => e.id === entryId);
                if (!entry) return;

                setEditingId(entryId);
                setFormType(entry.type);

                const entryDate = new Date(entry.timestamp);
                setFormData({
                    time: entryDate.toTimeString().slice(0, 5),
                    date: entryDate.toISOString().slice(0, 10),
                    amount: entry.amount || '',
                    hasPee: entry.hasPee || false,
                    hasPoop: entry.hasPoop || false,
                    poopQuantity: entry.poopQuantity || '',
                    poopConsistency: entry.poopConsistency || '',
                    poopColor: entry.poopColor || ''
                });

                setShowForm(true);
            };

            const closeForm = () => {
                setShowForm(false);
                setFormType('');
                setEditingId(null);
            };

            const saveEntry = async () => {
                const { time, date, amount, hasPee, hasPoop, poopQuantity, poopConsistency, poopColor } = formData;

                if (!time || !date) {
                    alert('Heure et date obligatoires');
                    return;
                }

                if (formType === 'feeding' && !amount) {
                    alert('Quantité obligatoire pour le biberon');
                    return;
                }

                if (formType === 'diaper' && !hasPee && !hasPoop) {
                    alert('Indiquez au moins pipi ou caca');
                    return;
                }

                const entry = {
                    type: formType,
                    timestamp: new Date(`${date}T${time}:00`).toISOString(),
                    familyCode: user.code, // Ajout du code famille
                    hasPee,
                    hasPoop,
                    poopQuantity,
                    poopConsistency,
                    poopColor
                };

                if (formType === 'feeding') {
                    entry.amount = parseInt(amount);
                }

                try {
                    if (editingId) {
                        await db.collection('entries').doc(editingId).update(entry);
                    } else {
                        await db.collection('entries').add(entry);
                    }
                    closeForm();
                } catch (error) {
                    console.error('Erreur sauvegarde:', error);
                    alert('Erreur lors de la sauvegarde');
                }
            };
            const deleteEntry = async (entryId) => {
                if (!confirm('Supprimer cette entrée ?')) return;

                try {
                    await db.collection('entries').doc(entryId).delete();
                } catch (error) {
                    console.error('Erreur suppression:', error);
                }
            };

            // Gestion des médicaments
            const saveMedication = async () => {
                const { name, dosage, date, time, interval } = medicationData;

                if (!name || !dosage || !date || !time) {
                    alert('Veuillez remplir tous les champs obligatoires');
                    return;
                }

                const medication = {
                    name,
                    dosage,
                    timestamp: new Date(`${date}T${time}:00`).toISOString(),
                    familyCode: user.code, // Ajout du code famille
                    interval: interval ? parseInt(interval) : null,
                    lastGiven: new Date(`${date}T${time}:00`).toISOString()
                };

                try {
                    await db.collection('medications').add(medication);
                    setMedicationData({ name: '', dosage: '', date: '', time: '', interval: '' });
                    setCurrentView('medical');
                } catch (error) {
                    console.error('Erreur sauvegarde médicament:', error);
                    alert('Erreur lors de la sauvegarde du médicament');
                }
            };
            const giveMedication = async (medicationId) => {
                const medication = medications.find(m => m.id === medicationId);
                if (!medication) return;

                const newLastGiven = new Date().toISOString();

                try {
                    await db.collection('medications').doc(medicationId).update({
                        lastGiven: newLastGiven
                    });
                } catch (error) {
                    console.error('Erreur mise à jour médicament:', error);
                    alert('Erreur lors de la mise à jour');
                }
            };

            const deleteMedication = async (medicationId) => {
                if (!confirm('Supprimer ce médicament ?')) return;

                try {
                    await db.collection('medications').doc(medicationId).delete();
                } catch (error) {
                    console.error('Erreur suppression médicament:', error);
                }
            };

            // Gestion des rendez-vous
            const saveAppointment = async () => {
                const { type, doctor, date, time, location } = appointmentData;

                if (!type || !date || !time) {
                    alert('Veuillez remplir tous les champs obligatoires');
                    return;
                }

                const appointment = {
                    type,
                    doctor,
                    location,
                    timestamp: new Date(`${date}T${time}:00`).toISOString(),
                    familyCode: user.code // Ajout du code famille
                };

                try {
                    await db.collection('appointments').add(appointment);
                    setAppointmentData({ type: '', doctor: '', date: '', time: '', location: '' });
                    setCurrentView('medical');
                } catch (error) {
                    console.error('Erreur sauvegarde RDV:', error);
                    alert('Erreur lors de la sauvegarde du rendez-vous');
                }
            };
            const deleteAppointment = async (appointmentId) => {
                if (!confirm('Supprimer ce rendez-vous ?')) return;

                try {
                    await db.collection('appointments').doc(appointmentId).delete();
                } catch (error) {
                    console.error('Erreur suppression RDV:', error);
                }
            };
            // Gestion des stocks
            const setMilkPowderDate = async () => {
                const date = prompt('Date d\'ouverture du lait en poudre (JJ/MM/AAAA):');
                if (!date) return;

                try {
                    // Supprimer l'ancien s'il existe pour cette famille
                    const existingDocs = await db.collection('stocks')
                        .where('type', '==', 'milk-powder')
                        .where('familyCode', '==', user.code)
                        .get();
                    existingDocs.forEach(doc => doc.ref.delete());

                    await db.collection('stocks').add({
                        type: 'milk-powder',
                        date: date,
                        timestamp: new Date().toISOString(),
                        familyCode: user.code // Ajout du code famille
                    });
                } catch (error) {
                    console.error('Erreur sauvegarde date lait:', error);
                    alert('Erreur lors de la sauvegarde');
                }
            };

            // Gestion des vaccins
            const saveVaccine = async () => {
                const { name, date, nextDue, notes } = vaccineData;

                if (!name || !date) {
                    alert('Nom du vaccin et date obligatoires');
                    return;
                }

                const vaccine = {
                    name,
                    timestamp: new Date(`${date}T12:00:00`).toISOString(),
                    nextDue,
                    notes,
                    familyCode: user.code
                };

                try {
                    await db.collection('vaccines').add(vaccine);
                    setVaccineData({ name: '', date: '', nextDue: '', notes: '' });
                    setCurrentView('medical');
                } catch (error) {
                    console.error('Erreur sauvegarde vaccin:', error);
                    alert('Erreur lors de la sauvegarde du vaccin');
                }
            };

            const deleteVaccine = async (vaccineId) => {
                if (!confirm('Supprimer ce vaccin ?')) return;

                try {
                    await db.collection('vaccines').doc(vaccineId).delete();
                } catch (error) {
                    console.error('Erreur suppression vaccin:', error);
                }
            };
            const setWaterBottleDateTime = async () => {
                const datetime = prompt('Date et heure d\'ouverture de la bouteille d\'eau (JJ/MM/AAAA HH:MM):');
                if (!datetime) return;

                try {
                    // Supprimer l'ancien s'il existe pour cette famille
                    const existingDocs = await db.collection('stocks')
                        .where('type', '==', 'water-bottle')
                        .where('familyCode', '==', user.code)
                        .get();
                    existingDocs.forEach(doc => doc.ref.delete());

                    await db.collection('stocks').add({
                        type: 'water-bottle',
                        datetime: datetime,
                        timestamp: new Date().toISOString(),
                        familyCode: user.code // Ajout du code famille
                    });
                } catch (error) {
                    console.error('Erreur sauvegarde datetime eau:', error);
                    alert('Erreur lors de la sauvegarde');
                }
            };
            // Gestion de la diversification
            const saveDiversificationEntry = async () => {
                const { food, date, rating, notes } = diversificationData;

                if (!food || !date) {
                    alert('Aliment et date obligatoires');
                    return;
                }

                const entry = {
                    food,
                    timestamp: new Date(`${date}T12:00:00`).toISOString(),
                    rating: parseInt(rating),
                    notes,
                    familyCode: user.code
                };

                try {
                    await db.collection('diversification').add(entry);
                    setDiversificationData({ food: '', date: '', rating: 5, notes: '' });
                    setCurrentView('food');
                } catch (error) {
                    console.error('Erreur sauvegarde diversification:', error);
                    alert('Erreur lors de la sauvegarde');
                }
            };

            const deleteDiversificationEntry = async (entryId) => {
                if (!confirm('Supprimer cette entrée ?')) return;

                try {
                    await db.collection('diversification').doc(entryId).delete();
                } catch (error) {
                    console.error('Erreur suppression diversification:', error);
                }
            };
            // Gestion de la garde-robe
            const saveWardrobeItem = async () => {
                const { type, size, quantity, notes } = wardrobeData;

                if (!type || !size) {
                    alert('Type de vêtement et taille obligatoires');
                    return;
                }

                const item = {
                    type,
                    size,
                    quantity: parseInt(quantity),
                    notes,
                    familyCode: user.code,
                    timestamp: new Date().toISOString()
                };

                try {
                    if (editingWardrobeId) {
                        await db.collection('wardrobe').doc(editingWardrobeId).update(item);
                    } else {
                        await db.collection('wardrobe').add(item);
                    }
                    setWardrobeData({ type: '', size: '', quantity: 1, notes: '' });
                    setEditingWardrobeId(null);
                    setCurrentView('wardrobe');
                } catch (error) {
                    console.error('Erreur sauvegarde garde-robe:', error);
                    alert('Erreur lors de la sauvegarde');
                }
            };
            const deleteWardrobeItem = async (itemId) => {
                if (!confirm('Supprimer cet article ?')) return;

                try {
                    await db.collection('wardrobe').doc(itemId).delete();
                } catch (error) {
                    console.error('Erreur suppression garde-robe:', error);
                }
            };
            const editWardrobeItem = (itemId) => {
                const item = wardrobe.find(w => w.id === itemId);
                if (!item) return;

                setWardrobeData({
                    type: item.type,
                    size: item.size,
                    quantity: item.quantity,
                    notes: item.notes || ''
                });
                setEditingWardrobeId(itemId);
                setCurrentView('wardrobe-form');
            };

            // Gestion des soins quotidiens
            const checkCareStatus = () => {
                const today = getCurrentDate();
                const newCareStatus = { ...dailyCare };
                let hasChanges = false;

                // Réinitialiser les soins quotidiens (sauf cordon si inactif)
                Object.keys(newCareStatus).forEach(careType => {
                    if (careType === 'cordon') {
                        if (newCareStatus.cordon.active && newCareStatus.cordon.lastDate !== today) {
                            newCareStatus.cordon.morningDone = false;
                            newCareStatus.cordon.eveningDone = false;
                            hasChanges = true;
                        }
                    } else if (newCareStatus[careType].lastDate !== today) {
                        newCareStatus[careType].done = false;
                        hasChanges = true;
                    }
                });

                if (hasChanges) {
                    setDailyCare(newCareStatus);
                }
            };

            const toggleCare = async (careType, timeOfDay = null) => {
                const today = getCurrentDate();
                let updatedCare = { ...dailyCare };

                if (careType === 'cordon' && timeOfDay) {
                    // Gestion spécifique pour le cordon (matin/soir)
                    updatedCare.cordon = {
                        ...updatedCare.cordon,
                        [timeOfDay === 'morning' ? 'morningDone' : 'eveningDone']: !updatedCare.cordon[timeOfDay === 'morning' ? 'morningDone' : 'eveningDone'],
                        lastDate: today
                    };
                } else if (careType !== 'cordon') {
                    // Gestion normale pour visage et vitamines
                    const newStatus = !dailyCare[careType].done;
                    updatedCare[careType] = {
                        done: newStatus,
                        lastDate: newStatus ? today : null
                    };
                }

                setDailyCare(updatedCare);

                // Sauvegarder dans Firebase
                try {
                    await db.collection('dailyCare').doc(`${user.code}_${today}`).set({
                        familyCode: user.code,
                        date: today,
                        care: updatedCare,
                        timestamp: new Date().toISOString()
                    });
                } catch (error) {
                    console.error('Erreur sauvegarde soins:', error);
                }
            };

            const toggleCordonActive = async () => {
                const today = getCurrentDate();
                const updatedCare = {
                    ...dailyCare,
                    cordon: {
                        ...dailyCare.cordon,
                        active: !dailyCare.cordon.active,
                        morningDone: false,
                        eveningDone: false,
                        lastDate: today
                    }
                };

                setDailyCare(updatedCare);

                // Sauvegarder dans Firebase
                try {
                    await db.collection('dailyCare').doc(`${user.code}_${today}`).set({
                        familyCode: user.code,
                        date: today,
                        care: updatedCare,
                        timestamp: new Date().toISOString()
                    });
                } catch (error) {
                    console.error('Erreur sauvegarde soins:', error);
                }
            };

            const getCareReminders = () => {
                const today = getCurrentDate();
                const reminders = [];

                // Cordon (si actif et pas fait 2 fois)
                if (dailyCare.cordon.active &&
                    (!dailyCare.cordon.morningDone || !dailyCare.cordon.eveningDone ||
                        dailyCare.cordon.lastDate !== today)) {
                    reminders.push('Soin du cordon');
                }

                // Autres soins
                ['visage', 'vitamines'].forEach(careType => {
                    if (!dailyCare[careType].done || dailyCare[careType].lastDate !== today) {
                        const careNames = {
                            visage: 'Nettoyage du visage',
                            vitamines: 'Vitamines'
                        };
                        reminders.push(careNames[careType]);
                    }
                });

                return reminders;
            };
            // Graphique quotidien
            const updateDailyChart = () => {
                if (!chartRef.current) return;

                const ctx = chartRef.current.getContext('2d');

                if (chartInstance.current) {
                    chartInstance.current.destroy();
                }

                const now = new Date();
                const dayStart = getDayStart(now);
                const dayEnd = getDayEnd(now);

                const todayFeedings = entries.filter(entry => {
                    const entryDate = new Date(entry.timestamp);
                    return entry.type === 'feeding' && entryDate >= dayStart && entryDate <= dayEnd;
                });

                const hourLabels = [];
                const data = [];

                for (let h = 7; h < 31; h++) {
                    const displayHour = h > 24 ? h - 24 : h;
                    const hourStr = h === 30 ? '6:30' : `${displayHour}h`;
                    hourLabels.push(hourStr);

                    let cumulativeMilk = 0;
                    const currentTime = new Date(dayStart);
                    currentTime.setHours(h > 24 ? h - 24 : h, h === 30 ? 30 : 0);

                    todayFeedings.forEach(feeding => {
                        const feedingTime = new Date(feeding.timestamp);
                        if (feedingTime <= currentTime) {
                            cumulativeMilk += parseInt(feeding.amount || 0);
                        }
                    });

                    data.push(cumulativeMilk);
                }

                chartInstance.current = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: hourLabels,
                        datasets: [{
                            label: 'Lait (ml)',
                            data: data,
                            borderColor: user?.gender === 'girl' ? '#ec4899' : '#3B82F6',
                            backgroundColor: user?.gender === 'girl' ? 'rgba(236, 72, 153, 0.1)' : 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { fontSize: 10 }
                            },
                            x: {
                                ticks: { fontSize: 10 }
                            }
                        },
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            };

            // Fonctions d'information sur les selles
            const getPoopInfo = (quantity, consistency, color) => {
                const quantities = {
                    'peu': { label: 'Un peu', emoji: '🤏' },
                    'moyen': { label: 'Moyen', emoji: '👌' },
                    'beaucoup': { label: 'Beaucoup', emoji: '🙌' }
                };

                const consistencies = {
                    'liquide': { label: 'Liquide', emoji: '💧' },
                    'molle': { label: 'Molle', emoji: '🟡' },
                    'normale': { label: 'Normale', emoji: '🟤' },
                    'dure': { label: 'Dure', emoji: '🔴' }
                };

                const colors = {
                    'noir': { label: 'Noir', emoji: '⚫', bgColor: 'bg-gray-800', textColor: 'text-white' },
                    'marron': { label: 'Marron', emoji: '🟤', bgColor: 'bg-amber-700', textColor: 'text-white' },
                    'vert': { label: 'Vert', emoji: '🟢', bgColor: 'bg-green-600', textColor: 'text-white' },
                    'jaune': { label: 'Jaune', emoji: '🟡', bgColor: 'bg-yellow-400', textColor: 'text-gray-800' }
                };

                return {
                    quantity: quantities[quantity] || { label: '', emoji: '' },
                    consistency: consistencies[consistency] || { label: '', emoji: '' },
                    color: colors[color] || { label: '', emoji: '', bgColor: 'bg-orange-100', textColor: 'text-orange-800' }
                };
            };
            // Conseils par âge complets
            const getTipsForAge = (age) => {
                if (age <= 7) {
                    return {
                        title: `🍼 Premiers jours (${age} jours)`,
                        sections: [
                            {
                                title: '💝 Contact et lien affectif',
                                color: 'bg-blue-50',
                                textColor: 'text-blue-800',
                                tips: [
                                    'Contact peau à peau : régule la température et favorise la mise au sein',
                                    'Répondre aux sourires spontanés pour créer des associations positives',
                                    'Parler doucement, chanter des berceuses, maintenir le contact visuel',
                                    'Le toucher est le premier sens développé - chaque caresse compte'
                                ]
                            },
                            {
                                title: '🍼 Alimentation à la demande',
                                color: 'bg-green-50',
                                textColor: 'text-green-800',
                                tips: [
                                    '6-8 tétées par 24h - suivre les signaux de faim du bébé',
                                    'Signes précoces : lèche les lèvres, agite les mains, tourne la tête',
                                    'Consoler d\'abord si bébé pleure, puis proposer le sein/biberon',
                                    'Contact peau à peau avant la tétée pour éveiller les réflexes'
                                ]
                            },
                            {
                                title: '🌙 Rythmes et sommeil',
                                color: 'bg-yellow-50',
                                textColor: 'text-yellow-800',
                                tips: [
                                    'Pas de routine fixe encore - c\'est normal',
                                    'Jour : lumière naturelle, atmosphère animée',
                                    'Nuit : obscurité, voix basse, changes rapides sans jeu',
                                    'Coucher sur le dos, matelas ferme, température 18-20°C'
                                ]
                            },
                            {
                                title: '😢 Comprendre les pleurs',
                                color: 'bg-purple-50',
                                textColor: 'text-purple-800',
                                tips: [
                                    'Les pleurs = communication d\'un besoin, pas un caprice',
                                    'Consoler ne "gâte" pas - construit la confiance',
                                    'Acceptable de déposer bébé en sécurité et prendre une pause'
                                ]
                            }
                        ]
                    };
                } else if (age >= 8 && age <= 30) {
                    return {
                        title: `👶 Premier mois (${age} jours)`,
                        sections: [
                            {
                                title: '🏃 Développement moteur',
                                color: 'bg-blue-50',
                                textColor: 'text-blue-800',
                                tips: [
                                    '"Tummy time" : renforce le cou et les bras',
                                    'Exploration des mains et pieds',
                                    'Meilleure maîtrise de la tête',
                                    'Mouvements plus coordonnés'
                                ]
                            },
                            {
                                title: '😊 Éveil social',
                                color: 'bg-green-50',
                                textColor: 'text-green-800',
                                tips: [
                                    'Premiers vrais sourires en réponse',
                                    'Suit les objets du regard',
                                    'Début du babillage pour exprimer la joie',
                                    'Distingue ses parents des autres'
                                ]
                            },
                            {
                                title: '🎮 Jeux et activités',
                                color: 'bg-orange-50',
                                textColor: 'text-orange-800',
                                tips: [
                                    'Jeux de "coucou" - apprend la permanence de l\'objet',
                                    'Cartes à contraste élevé',
                                    'Mobiles colorés, miroirs incassables',
                                    'Le parent est le meilleur "jouet"'
                                ]
                            },
                            {
                                title: '😣 Gestion des coliques',
                                color: 'bg-red-50',
                                textColor: 'text-red-800',
                                tips: [
                                    'Massages doux du ventre (sens horaire)',
                                    'Position "paresseux" sur l\'avant-bras',
                                    'Portage en écharpe, bercements, bruits blancs',
                                    'Chaleur douce sur le ventre'
                                ]
                            }
                        ]
                    };
                } else if (age >= 31 && age <= 60) {
                    return {
                        title: `👶 Deuxième mois (${age} jours)`,
                        sections: [
                            {
                                title: '💪 Grandes étapes motrices',
                                color: 'bg-blue-50',
                                textColor: 'text-blue-800',
                                tips: [
                                    'Se soulève sur les avant-bras en position ventrale',
                                    'Muscles du cou plus forts',
                                    'Exploration active mains/pieds',
                                    'Coordination œil-main s\'améliore'
                                ]
                            },
                            {
                                title: '🗣️ Communication avancée',
                                color: 'bg-green-50',
                                textColor: 'text-green-800',
                                tips: [
                                    'Babillage structuré : "ba-ba", "ma-ma"',
                                    'Distingue les émotions par le ton',
                                    'Peut reconnaître son prénom',
                                    'Interactions sociales plus riches'
                                ]
                            },
                            {
                                title: '🌙 Régression du sommeil (possible)',
                                color: 'bg-purple-50',
                                textColor: 'text-purple-800',
                                tips: [
                                    'Normal entre 2-4 mois : signe de développement sain',
                                    'Maturation vers cycles de sommeil adulte',
                                    'Encourager l\'auto-apaisement',
                                    'Rituel de coucher régulier et apaisant'
                                ]
                            },
                            {
                                title: '🎯 Stimulation appropriée',
                                color: 'bg-yellow-50',
                                textColor: 'text-yellow-800',
                                tips: [
                                    'Limiter transats/sièges-auto',
                                    'Tapis de jeu pour éveil supervisé',
                                    'Objets colorés, textures variées',
                                    'Lecture à voix haute'
                                ]
                            }
                        ]
                    };
                } else if (age >= 61 && age <= 120) {
                    return {
                        title: `🌟 3-4 mois (${age} jours)`,
                        sections: [
                            {
                                title: '🤸 Mobilité accrue',
                                color: 'bg-blue-50',
                                textColor: 'text-blue-800',
                                tips: [
                                    'Début des retournements dos-ventre',
                                    'Prend appui sur les jambes',
                                    'Coordination œil-main développée',
                                    'Attrape volontairement les objets'
                                ]
                            },
                            {
                                title: '👁️ Vision et perception',
                                color: 'bg-green-50',
                                textColor: 'text-green-800',
                                tips: [
                                    'Meilleure distinction des couleurs',
                                    'Suit les objets en mouvement',
                                    'Exploration bouche = découverte sensorielle',
                                    'Vision s\'affine considérablement'
                                ]
                            },
                            {
                                title: '🍼 Préparation diversification',
                                color: 'bg-orange-50',
                                textColor: 'text-orange-800',
                                tips: [
                                    'Lait reste la source principale jusqu\'à 1 an',
                                    'Possible introduction légumes/fruits vers 4-6 mois',
                                    'Observer les signaux de prêtesse',
                                    'Un aliment à la fois pour tester les réactions'
                                ]
                            },
                            {
                                title: '😴 Régression sommeil 4 mois',
                                color: 'bg-red-50',
                                textColor: 'text-red-800',
                                tips: [
                                    'Dure 2-6 semaines - patience nécessaire',
                                    'Résultat de la maturation neurologique',
                                    'Encourager l\'auto-apaisement',
                                    'Demander de l\'aide si besoin'
                                ]
                            }
                        ]
                    };
                } else if (age >= 121 && age <= 180) {
                    return {
                        title: `🚀 4-6 mois (${age} jours)`,
                        sections: [
                            {
                                title: '🎯 Grand bond moteur',
                                color: 'bg-blue-50',
                                textColor: 'text-blue-800',
                                tips: [
                                    'Se retourne dans les 2 sens',
                                    'S\'assoit avec soutien puis seul',
                                    'Force du haut du corps développée',
                                    'Exploration active de l\'environnement'
                                ]
                            },
                            {
                                title: '🍎 Diversification alimentaire',
                                color: 'bg-green-50',
                                textColor: 'text-green-800',
                                tips: [
                                    'Légumes/fruits : purées lisses, un à la fois',
                                    'Céréales infantiles dès 4 mois',
                                    'Protéines : 10g viande/poisson ou 1/4 œuf',
                                    'Ne jamais forcer - exploration sensorielle'
                                ]
                            },
                            {
                                title: '🗣️ Communication complexe',
                                color: 'bg-purple-50',
                                textColor: 'text-purple-800',
                                tips: [
                                    'Chaînes de sons : "ba-ba", "dee-dee"',
                                    'Répond à la négation "non"',
                                    'Reconnaît son prénom',
                                    'Exprime la joie par la voix'
                                ]
                            },
                            {
                                title: '🎮 Jeux adaptés',
                                color: 'bg-yellow-50',
                                textColor: 'text-yellow-800',
                                tips: [
                                    'Jouets à saisir et manipuler',
                                    'Miroirs incassables',
                                    'Jeux de mains et comptines',
                                    'Objets de textures variées'
                                ]
                            }
                        ]
                    };
                } else {
                    return {
                        title: `🌟 Croissance avancée (${age} jours)`,
                        sections: [
                            {
                                title: '🚀 Développement avancé',
                                color: 'bg-green-50',
                                textColor: 'text-green-800',
                                tips: [
                                    'Exploration active et curiosité intense',
                                    'Interaction sociale complexe',
                                    'Personnalité qui s\'affirme',
                                    'Préparation aux prochaines étapes'
                                ]
                            },
                            {
                                title: '🍼 Alimentation diversifiée',
                                color: 'bg-blue-50',
                                textColor: 'text-blue-800',
                                tips: [
                                    'Lait reste principal jusqu\'à 1 an',
                                    'Diversification en cours',
                                    'Texture adaptée à l\'âge',
                                    'Consulter le pédiatre pour conseils'
                                ]
                            },
                            {
                                title: '👨‍⚕️ Suivi médical',
                                color: 'bg-purple-50',
                                textColor: 'text-purple-800',
                                tips: [
                                    'Consultations régulières importantes',
                                    'Stimulation sensorielle et motrice',
                                    'Adaptation selon la croissance',
                                    'Chaque enfant évolue à son rythme'
                                ]
                            }
                        ]
                    };
                }
            };

            // Calculer les recommandations alimentaires
            const age = calculateAge();
            const recommendations = getFeedingRecommendations(age);
            const nextFeedingInfo = calculateNextFeeding();
            const themeColors = getThemeColors();
            // Rendu conditionnel - Écran d'authentification
            if (showAuth) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl p-6 max-w-md w-full shadow-xl">
                            <div className="text-center mb-6">
                                <div className="inline-block mb-4">
                                    <img src="logo.PNG" alt="BabyTrack Logo" className="w-40 h-40 mx-auto rounded-2xl" />                                </div>

                            </div>

                            {authMode === 'login' ? (
                                <div className="space-y-4">
                                    <h2 className="text-lg font-semibold">Se connecter</h2>
                                    <input
                                        type="text"
                                        placeholder="Code famille (6 caractères)"
                                        className="w-full border rounded-xl px-4 py-3 text-center uppercase"
                                        maxLength="6"
                                        value={authData.code}
                                        onChange={(e) => setAuthData(prev => ({ ...prev, code: e.target.value }))}
                                    />
                                    <button
                                        onClick={() => handleLogin()}
                                        className="w-full bg-blue-500 text-white py-3 rounded-xl font-medium"
                                    >
                                        Se connecter
                                    </button>
                                    <button
                                        onClick={() => setAuthMode('create')}
                                        className="w-full bg-gray-200 text-gray-700 py-3 rounded-xl font-medium"
                                    >
                                        Créer un compte famille
                                    </button>
                                </div>
                            ) : (
                                <div className="space-y-4">
                                    <h2 className="text-lg font-semibold">Nouvelle famille</h2>
                                    <input
                                        type="text"
                                        placeholder="Nom du bébé"
                                        className="w-full border rounded-xl px-4 py-3"
                                        value={authData.babyName}
                                        onChange={(e) => setAuthData(prev => ({ ...prev, babyName: e.target.value }))}
                                    />
                                    <input
                                        type="date"
                                        className="w-full border rounded-xl px-4 py-3"
                                        value={authData.birthDate}
                                        onChange={(e) => setAuthData(prev => ({ ...prev, birthDate: e.target.value }))}
                                    />
                                    <input
                                        type="time"
                                        className="w-full border rounded-xl px-4 py-3"
                                        value={authData.birthTime}
                                        onChange={(e) => setAuthData(prev => ({ ...prev, birthTime: e.target.value }))}
                                    />
                                    <div className="grid grid-cols-2 gap-3">
                                        <input
                                            type="number"
                                            placeholder="Poids (kg)"
                                            step="0.001"
                                            className="w-full border rounded-xl px-4 py-3"
                                            value={authData.birthWeight}
                                            onChange={(e) => setAuthData(prev => ({ ...prev, birthWeight: e.target.value }))}
                                        />
                                        <input
                                            type="number"
                                            placeholder="Taille (cm)"
                                            className="w-full border rounded-xl px-4 py-3"
                                            value={authData.birthHeight}
                                            onChange={(e) => setAuthData(prev => ({ ...prev, birthHeight: e.target.value }))}
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Sexe</label>
                                        <select
                                            className="w-full border rounded-xl px-4 py-3"
                                            value={authData.gender}
                                            onChange={(e) => setAuthData(prev => ({ ...prev, gender: e.target.value }))}
                                        >
                                            <option value="boy">Garçon</option>
                                            <option value="girl">Fille</option>
                                        </select>
                                    </div>
                                    <input
                                        type="text"
                                        placeholder="Noms des parents"
                                        className="w-full border rounded-xl px-4 py-3"
                                        value={authData.parents}
                                        onChange={(e) => setAuthData(prev => ({ ...prev, parents: e.target.value }))}
                                    />
                                    <button
                                        onClick={handleCreateAccount}
                                        className="w-full bg-green-500 text-white py-3 rounded-xl font-medium"
                                    >
                                        Créer la famille
                                    </button>
                                    <button
                                        onClick={() => setAuthMode('login')}
                                        className="w-full bg-gray-200 text-gray-700 py-3 rounded-xl font-medium"
                                    >
                                        Retour
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            // Navigation tabs
            const TabButton = ({ id, label, icon, active, onClick }) => (
                <button
                    onClick={onClick}
                    className={`flex flex-col items-center justify-center p-2 rounded-lg text-xs font-medium transition-all ${active
                        ? `${themeColors.primaryBg} text-white shadow-md`
                        : 'text-gray-600 hover:text-gray-800'
                        }`}
                >
                    <i className={`${icon} text-lg mb-1`}></i>
                    <span>{label}</span>
                </button>
            );
            // Rendu principal
            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50">
                    <div className="max-w-md mx-auto p-4 pb-24">
                        {/* Header */}
                        {/* Header Premium compact */}
                        <div className="relative mb-4">
                            <div className="bg-white/95 backdrop-blur-xl rounded-2xl shadow-lg border border-white/50 p-3">
                                <div className="flex items-center justify-end mb-2">
                                    <button
                                        onClick={logout}
                                        className="w-6 h-6 rounded-lg bg-gray-50 flex items-center justify-center"
                                    >
                                        <i className="fas fa-sign-out-alt text-xs text-gray-400"></i>
                                    </button>
                                </div>

                                <div className="flex items-center gap-3 mb-2">
                                    {/* Photo/Avatar plus petit */}
                                    <div className="relative">
                                        <input
                                            type="file"
                                            accept="image/*"
                                            onChange={(e) => {
                                                const file = e.target.files[0];
                                                if (file) {
                                                    const reader = new FileReader();
                                                    reader.onload = (e) => {
                                                        setUser(prev => ({ ...prev, photo: e.target.result }));
                                                    };
                                                    reader.readAsDataURL(file);
                                                }
                                            }}
                                            className="hidden"
                                            id="photo-upload"
                                        />
                                        <label
                                            htmlFor="photo-upload"
                                            className="block w-12 h-12 rounded-xl overflow-hidden cursor-pointer border border-gray-200"
                                        >
                                            {user?.photo ? (
                                                <img src={user.photo} alt={user.babyName} className="w-full h-full object-cover" />
                                            ) : (
                                                <div
                                                    className="w-full h-full flex items-center justify-center text-xl"
                                                    style={{
                                                        background: `linear-gradient(135deg, ${user?.gender === 'girl' ? '#ec4899' : '#3b82f6'} 0%, ${user?.gender === 'girl' ? '#f472b6' : '#6366f1'} 100%)`
                                                    }}
                                                >
                                                    <span className="text-white">
                                                        {user?.gender === 'girl' ? '👧' : '👦'}
                                                    </span>
                                                </div>
                                            )}
                                        </label>
                                    </div>

                                    <div className="flex-1">
                                        <h1 className="text-lg font-bold text-gray-900 mb-1">{user?.babyName}</h1>
                                        <div className="text-sm font-semibold text-gray-600">{formatAgeDisplay(age)}</div>

                                        {/* Prochain biberon compact avec fond et 3 états */}
                                        {nextFeedingInfo && currentView === 'daily' && (
                                            <div className="mt-2">
                                                {(() => {
                                                    const now = new Date();
                                                    const timeSinceLastFeeding = now - new Date(nextFeedingInfo.lastFeeding);
                                                    const minutesSinceLastFeeding = Math.floor(timeSinceLastFeeding / (1000 * 60));

                                                    const timeDiff = nextFeedingInfo.nextTime - now;
                                                    const minutesRemaining = Math.ceil(timeDiff / (1000 * 60));

                                                    let bgClass, textClass, message;

                                                    // 3 états basés sur le temps écoulé depuis le dernier biberon
                                                    if (minutesSinceLastFeeding <= 60) {
                                                        // Récent (moins d'1h)
                                                        bgClass = 'bg-green-500';
                                                        textClass = 'text-white';
                                                        if (minutesRemaining <= 0) {
                                                            message = '🍼 C\'est l\'heure !';
                                                        } else {
                                                            const hoursRemaining = Math.floor(minutesRemaining / 60);
                                                            const minsRemaining = minutesRemaining % 60;
                                                            const timeText = hoursRemaining > 0 ? `${hoursRemaining}h${minsRemaining > 0 ? `${minsRemaining.toString().padStart(2, '0')}` : ''}` : `${minsRemaining} min`;
                                                            message = `🍼Prochain dans ${timeText}`;
                                                        }
                                                    } else if (minutesSinceLastFeeding <= 180) {
                                                        // Normal (1h-3h)
                                                        bgClass = 'bg-blue-500';
                                                        textClass = 'text-white';
                                                        if (minutesRemaining <= 0) {
                                                            message = '🍼 C\'est l\'heure !';
                                                        } else if (minutesRemaining <= 30) {
                                                            message = `🍼 Dans ${minutesRemaining} min`;
                                                        } else {
                                                            const hoursRemaining = Math.floor(minutesRemaining / 60);
                                                            const minsRemaining = minutesRemaining % 60;
                                                            const timeText = hoursRemaining > 0 ? `${hoursRemaining}h${minsRemaining > 0 ? `${minsRemaining.toString().padStart(2, '0')}` : ''}` : `${minsRemaining} min`;
                                                            message = `🍼 Prochain dans ${timeText}`;
                                                        }
                                                    } else {
                                                        // Tardif (plus de 3h)
                                                        bgClass = 'bg-orange-500';
                                                        textClass = 'text-white';
                                                        message = '🍼 Biberon attendu !';
                                                    }

                                                    return (
                                                        <div className={`${bgClass} ${textClass} px-2 py-1 rounded-lg text-xs font-medium`}>
                                                            {message}
                                                        </div>
                                                    );
                                                })()}
                                            </div>
                                        )}
                                    </div>
                                </div>

                                {/* Stats en ligne cliquables sans icônes */}
                                <div className="grid grid-cols-3 gap-2">
                                    {/* Poids cliquable */}
                                    <button
                                        onClick={() => setCurrentView('weight-update')}
                                        className="bg-white/60 hover:bg-white/80 rounded-lg p-2 text-center transition-all duration-200 active:scale-95"
                                    >
                                        <div className="text-base font-bold" style={{ color: user?.gender === 'girl' ? '#ec4899' : '#3b82f6' }}>
                                            {currentWeight ? `${currentWeight}` : `${user?.birthWeight?.toFixed(2)}`}
                                        </div>
                                        <div className="text-xs text-gray-500">kg</div>
                                    </button>

                                    {/* Taille cliquable */}
                                    <button
                                        onClick={() => setCurrentView('height-update')}
                                        className="bg-white/60 hover:bg-white/80 rounded-lg p-2 text-center transition-all duration-200 active:scale-95"
                                    >
                                        <div className="text-base font-bold" style={{ color: user?.gender === 'girl' ? '#ec4899' : '#3b82f6' }}>
                                            {currentHeight || user?.birthHeight}
                                        </div>
                                        <div className="text-xs text-gray-500">cm</div>
                                    </button>

                                    {/* Âge non cliquable */}
                                    <div className="bg-white/60 rounded-lg p-2 text-center">
                                        <div className="text-base font-bold" style={{ color: user?.gender === 'girl' ? '#ec4899' : '#3b82f6' }}>
                                            {age}
                                        </div>
                                        <div className="text-xs text-gray-500">jours</div>
                                    </div>
                                </div>

                                {/* Calcul personnalisé intégré plus compact */}
                                {currentWeight && periodView === 'daily' && (
                                    <div className="mt-2 bg-green-50 rounded-lg p-2">
                                        <div className="flex items-center justify-between mb-1">
                                            <span className="text-xs font-medium text-green-700">Calcul personnalisé</span>
                                            <span className="text-xs bg-green-500 text-white px-2 py-0.5 rounded-full font-bold">PRÉCIS</span>
                                        </div>
                                        {(() => {
                                            const calculation = calculateMilkByWeight(currentWeight, age);
                                            return calculation ? (
                                                <div className="text-xs text-green-700">
                                                    {calculation.mlPerFeeding}ml × {calculation.feedingsPerDay} = {calculation.totalPerDay}ml/jour
                                                </div>
                                            ) : null;
                                        })()}
                                    </div>
                                )}
                            </div>
                        </div>
                        {/* Navigation fixe en bas */}
                        <div className="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-lg border-t border-gray-200 shadow-xl z-50">
                            <div className="max-w-md mx-auto px-4 py-2">
                                <div className="flex items-center justify-around">
                                    {/* Accueil */}
                                    <button
                                        onClick={() => setCurrentView('daily')}
                                        className={`flex flex-col items-center p-3 rounded-2xl transition-all ${currentView === 'daily'
                                            ? `text-${user?.gender === 'girl' ? 'pink' : 'blue'}-600`
                                            : 'text-gray-500'
                                            }`}
                                    >
                                        <i className="fas fa-home text-xl mb-1"></i>
                                        <span className="text-xs font-medium">Accueil</span>
                                    </button>

                                    {/* Médical */}
                                    <button
                                        onClick={() => setCurrentView('medical')}
                                        className={`flex flex-col items-center p-3 rounded-2xl transition-all ${currentView === 'medical'
                                            ? 'text-green-600'
                                            : 'text-gray-500'
                                            }`}
                                    >
                                        <i className="fas fa-stethoscope text-xl mb-1"></i>
                                        <span className="text-xs font-medium">Médical</span>
                                    </button>

                                    {/* Bouton + central */}
                                    {/* Bouton + central */}
                                    <div className="relative -mt-6" data-menu="plus">
                                        <button
                                            onClick={() => setShowPlusMenu(!showPlusMenu)}
                                            className={`w-16 h-16 bg-gradient-to-r ${themeColors.primary} text-white rounded-full shadow-xl flex items-center justify-center`}
                                        >
                                            <i className={`fas ${showPlusMenu ? 'fa-times' : 'fa-plus'} text-2xl`}></i>
                                        </button>

                                        {/* Menu flottant du bouton + */}
                                        {showPlusMenu && (
                                            <div className="absolute bottom-20 left-1/2 transform -translate-x-1/2 bg-white rounded-2xl shadow-2xl border p-4 min-w-[200px]">
                                                <button
                                                    onClick={() => {
                                                        openForm('feeding');
                                                        setShowPlusMenu(false);
                                                    }}
                                                    className="w-full flex items-center gap-3 p-3 hover:bg-gray-50 rounded-xl mb-2"
                                                >
                                                    <div className="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center">
                                                        <i className="fas fa-bottle-water text-blue-600"></i>
                                                    </div>
                                                    <span className="font-medium">Biberon</span>
                                                </button>
                                                <button
                                                    onClick={() => {
                                                        openForm('diaper');
                                                        setShowPlusMenu(false);
                                                    }}
                                                    className="w-full flex items-center gap-3 p-3 hover:bg-gray-50 rounded-xl"
                                                >
                                                    <div className="w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center">
                                                        <i className="fas fa-baby text-green-600"></i>
                                                    </div>
                                                    <span className="font-medium">Couche</span>
                                                </button>
                                            </div>
                                        )}
                                    </div>
                                    {/* Conseils */}
                                    <button
                                        onClick={() => setCurrentView('tips')}
                                        className={`flex flex-col items-center p-3 rounded-2xl transition-all ${currentView === 'tips'
                                            ? 'text-amber-600'
                                            : 'text-gray-500'
                                            }`}
                                    >
                                        <i className="fas fa-lightbulb text-xl mb-1"></i>
                                        <span className="text-xs font-medium">Conseils</span>
                                    </button>


                                    {/* Plus */}
                                    <div className="relative" data-menu="more">
                                        <button
                                            onClick={() => setShowMoreMenu(!showMoreMenu)}
                                            className={`flex flex-col items-center p-3 rounded-2xl transition-all ${['supplies', 'food', 'wardrobe'].includes(currentView)
                                                ? 'text-purple-600'
                                                : 'text-gray-500'
                                                }`}
                                        >
                                            <i className="fas fa-ellipsis-h text-xl mb-1"></i>
                                            <span className="text-xs font-medium">Plus</span>
                                        </button>

                                        {/* Dropdown menu Plus */}
                                        {showMoreMenu && (
                                            <div className="absolute bottom-16 right-0 bg-white rounded-2xl shadow-2xl border border-gray-200 py-2 min-w-[140px] z-50">
                                                <button
                                                    onClick={() => {
                                                        setCurrentView('food');
                                                        setShowMoreMenu(false);
                                                    }}
                                                    className="w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center gap-3"
                                                >
                                                    <i className="fas fa-utensils text-orange-500"></i>
                                                    <span className="text-sm font-medium">Diversification</span>
                                                </button>
                                                <button
                                                    onClick={() => {
                                                        setCurrentView('supplies');
                                                        setShowMoreMenu(false);
                                                    }}
                                                    className="w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center gap-3"
                                                >
                                                    <i className="fas fa-boxes text-blue-500"></i>
                                                    <span className="text-sm font-medium">Stocks</span>
                                                </button>
                                                <button
                                                    onClick={() => {
                                                        setCurrentView('wardrobe');
                                                        setShowMoreMenu(false);
                                                    }}
                                                    className="w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center gap-3"
                                                >
                                                    <i className="fas fa-tshirt text-pink-500"></i>
                                                    <span className="text-sm font-medium">Garde-robe</span>
                                                </button>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {/* Contenu selon la vue */}
                        {currentView === 'daily' && (
                            <>
                                {/* Onglets de période */}
                                <div className="bg-white/80 glass rounded-xl p-2 mb-4 shadow-sm border border-white/50">
                                    <div className="flex gap-1">
                                        <button
                                            onClick={() => setPeriodView('daily')}
                                            className={`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${periodView === 'daily'
                                                ? `${themeColors.primaryBg} text-white shadow-md`
                                                : 'text-gray-600 hover:text-gray-800'
                                                }`}
                                        >
                                            Aujourd'hui
                                        </button>
                                        <button
                                            onClick={() => setPeriodView('weekly')}
                                            className={`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${periodView === 'weekly'
                                                ? `${themeColors.primaryBg} text-white shadow-md`
                                                : 'text-gray-600 hover:text-gray-800'
                                                }`}
                                        >
                                            7 jours
                                        </button>
                                        <button
                                            onClick={() => setPeriodView('monthly')}
                                            className={`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${periodView === 'monthly'
                                                ? `${themeColors.primaryBg} text-white shadow-md`
                                                : 'text-gray-600 hover:text-gray-800'
                                                }`}
                                        >
                                            30 jours
                                        </button>
                                    </div>
                                </div>


                                {/* Statistiques selon la période */}
                                {(() => {
                                    const currentStats = getStats(periodView);
                                    const age = calculateAge();

                                    // Calculs pour les recommandations
                                    const weightCalculation = currentWeight ? calculateMilkByWeight(currentWeight, age) : null;
                                    const recommendations = getFeedingRecommendations(age);

                                    let expectedDailyMilk = null;
                                    if (weightCalculation) {
                                        expectedDailyMilk = weightCalculation.totalPerDay;
                                    } else if (recommendations) {
                                        const avgVolume = getDefaultAmount(recommendations.volume);
                                        const avgFrequency = recommendations.frequency.split('–')[0].trim().split(' ')[0];
                                        expectedDailyMilk = avgVolume * parseInt(avgFrequency);
                                    }

                                    return (
                                        <div className="grid grid-cols-3 gap-3 mb-6">
                                            {/* Carte Lait avec progression */}
                                            <div className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30 relative overflow-hidden">
                                                {/* Background décoratif */}
                                                <div className={`absolute top-0 right-0 w-12 h-12 ${themeColors.primary} opacity-5 rounded-full -translate-y-2 translate-x-2`} />

                                                <div className="relative">
                                                    <div className="flex items-center justify-center mb-2">
                                                        <div className={`w-8 h-8 rounded-xl ${themeColors.primaryLight} flex items-center justify-center`}>
                                                            <i className={`fas fa-bottle-water ${themeColors.primaryText} text-sm`}></i>
                                                        </div>
                                                    </div>

                                                    <div className="text-center">
                                                        <div className="text-xl font-bold text-gray-900 mb-1">
                                                            {currentStats.totalMilk}
                                                            <span className="text-sm font-medium text-gray-600">ml</span>
                                                        </div>

                                                        {/* Barre de progression pour le lait quotidien */}
                                                        {periodView === 'daily' && expectedDailyMilk && (
                                                            <div className="mb-2">
                                                                <div className="w-full bg-gray-200 rounded-full h-1.5 mb-1">
                                                                    <div
                                                                        className={`h-1.5 rounded-full ${themeColors.primaryBg}`}
                                                                        style={{ width: `${Math.min((currentStats.totalMilk / expectedDailyMilk) * 100, 100)}%` }}
                                                                    />
                                                                </div>
                                                                <div className="text-xs text-gray-500">
                                                                    {Math.round((currentStats.totalMilk / expectedDailyMilk) * 100)}% objectif
                                                                </div>
                                                            </div>
                                                        )}

                                                        <div className="text-xs font-medium text-gray-500">
                                                            {periodView === 'daily' ? 'Aujourd\'hui' :
                                                                periodView === 'weekly' ? '7 jours' : '30 jours'}
                                                        </div>

                                                        {/* Moyenne par biberon */}
                                                        {currentStats.feedingCount > 0 && (
                                                            <div className="text-xs text-gray-400 mt-1">
                                                                ~{Math.round(currentStats.totalMilk / currentStats.feedingCount)}ml/biberon
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Carte Pipi avec fréquence */}
                                            <div className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30 relative overflow-hidden">
                                                {/* Background décoratif */}
                                                <div className="absolute top-0 right-0 w-12 h-12 bg-blue-500 opacity-5 rounded-full -translate-y-2 translate-x-2" />

                                                <div className="relative">
                                                    <div className="flex items-center justify-center mb-2">
                                                        <div className="w-8 h-8 rounded-xl bg-blue-100 flex items-center justify-center">
                                                            <span className="text-sm">💧</span>
                                                        </div>
                                                    </div>

                                                    <div className="text-center">
                                                        <div className="text-xl font-bold text-gray-900 mb-1">
                                                            {currentStats.totalPees}
                                                        </div>

                                                        {/* Indicateur de fréquence */}
                                                        {periodView === 'daily' && (


                                                            <div className="mb-2">
                                                                <div className={`text-xs px-2 py-1 rounded-full font-medium ${currentStats.totalPees >= 6
                                                                    ? 'bg-green-100 text-green-700'
                                                                    : currentStats.totalPees >= 4
                                                                        ? 'bg-yellow-100 text-yellow-700'
                                                                        : 'bg-orange-100 text-orange-700'
                                                                    }`}>
                                                                    {currentStats.totalPees >= 6 ? 'Normal' :
                                                                        currentStats.totalPees >= 4 ? 'Correct' : 'Surveiller'}
                                                                </div>
                                                            </div>
                                                        )}

                                                        <div className="text-xs font-medium text-gray-500">
                                                            Pipis
                                                        </div>

                                                        {periodView === 'daily' && (

                                                            <div className="text-xs text-gray-400 mt-1">
                                                                6+ attendus/jour
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Carte Caca avec analyse */}
                                            <div className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30 relative overflow-hidden">
                                                {/* Background décoratif */}
                                                <div className="absolute top-0 right-0 w-12 h-12 bg-orange-500 opacity-5 rounded-full -translate-y-2 translate-x-2" />

                                                <div className="relative">
                                                    <div className="flex items-center justify-center mb-2">
                                                        <div className="w-8 h-8 rounded-xl bg-orange-100 flex items-center justify-center">
                                                            <span className="text-sm">💩</span>
                                                        </div>
                                                    </div>

                                                    <div className="text-center">
                                                        <div className="text-xl font-bold text-gray-900 mb-1">
                                                            {currentStats.totalPoops}
                                                        </div>

                                                        {/* Indicateur de fréquence selles */}
                                                        {periodView === 'daily' && (
                                                            <div className="mb-2">
                                                                <div className={`text-xs px-2 py-1 rounded-full font-medium ${currentStats.totalPoops >= 1
                                                                    ? 'bg-green-100 text-green-700'
                                                                    : 'bg-orange-100 text-orange-700'
                                                                    }`}>
                                                                    {currentStats.totalPoops >= 1 ? 'Normal' : 'À surveiller'}
                                                                </div>
                                                            </div>
                                                        )}

                                                        <div className="text-xs font-medium text-gray-500">
                                                            Cacas
                                                        </div>

                                                        {periodView === 'weekly' && currentStats.totalPoops > 0 && (
                                                            <div className="text-xs text-gray-400 mt-1">
                                                                ~{(currentStats.totalPoops / 7).toFixed(1)}/jour
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    );

                                })()}

                                {/* Graphique quotidien moderne */}
                                {periodView === 'daily' && (
                                    <div className="bg-white/95 backdrop-blur-sm rounded-3xl p-5 shadow-xl border border-white/20 mb-6 relative overflow-hidden">
                                        {/* Background décoratif */}
                                        <div className={`absolute top-0 right-0 w-16 h-16 opacity-5 rounded-full -translate-y-4 translate-x-4 ${user?.gender === 'girl' ? 'bg-pink-500' : 'bg-blue-500'}`} />

                                        <div className="relative">
                                            {/* Header du graphique */}
                                            <div className="flex items-center justify-between mb-4">
                                                <div className="flex items-center gap-2">
                                                    <div className={`w-8 h-8 ${themeColors.primaryLight} rounded-xl flex items-center justify-center`}>
                                                        <span className="text-sm">📊</span>
                                                    </div>
                                                    <div>
                                                        <h4 className="font-bold text-gray-900">Évolution quotidienne</h4>
                                                        <p className="text-xs text-gray-500">Lait consommé par heure</p>
                                                    </div>
                                                </div>
                                                <div className={`${themeColors.primaryBg} text-white px-3 py-1 rounded-full text-xs font-bold`}>
                                                    TEMPS RÉEL
                                                </div>
                                            </div>

                                            {/* Zone du graphique */}
                                            <div className="h-40 mb-4 bg-gradient-to-b from-gray-50 to-gray-100 rounded-2xl p-4 flex items-center justify-center">
                                                <canvas ref={chartRef} className="w-full h-full"></canvas>
                                            </div>

                                            {/* Résumé sous le graphique */}
                                            {(() => {
                                                const currentStats = getStats('daily');
                                                const now = new Date();
                                                const dayStart = getDayStart(now);
                                                const dayEnd = getDayEnd(now);

                                                const todayFeedings = entries.filter(entry => {
                                                    const entryDate = new Date(entry.timestamp);
                                                    return entry.type === 'feeding' && entryDate >= dayStart && entryDate <= dayEnd;
                                                });

                                                return todayFeedings.length > 0 ? (
                                                    <div className="grid grid-cols-3 gap-3">
                                                        <div className="text-center">
                                                            <div className={`text-lg font-bold ${themeColors.primaryText}`}>
                                                                {todayFeedings.length}
                                                            </div>
                                                            <div className="text-xs text-gray-600">Biberons</div>
                                                        </div>
                                                        <div className="text-center">
                                                            <div className="text-lg font-bold text-gray-800">
                                                                {Math.round(currentStats.totalMilk / todayFeedings.length)}ml
                                                            </div>
                                                            <div className="text-xs text-gray-600">Moyenne</div>
                                                        </div>
                                                        <div className="text-center">
                                                            {(() => {
                                                                if (todayFeedings.length >= 2) {
                                                                    const sortedFeedings = [...todayFeedings].sort((a, b) =>
                                                                        new Date(a.timestamp) - new Date(b.timestamp)
                                                                    );
                                                                    const intervals = [];
                                                                    for (let i = 1; i < sortedFeedings.length; i++) {
                                                                        const prev = new Date(sortedFeedings[i - 1].timestamp);
                                                                        const curr = new Date(sortedFeedings[i].timestamp);
                                                                        intervals.push((curr - prev) / (1000 * 60));
                                                                    }
                                                                    const avgInterval = intervals.reduce((a, b) => a + b, 0) / intervals.length;
                                                                    return (
                                                                        <>
                                                                            <div className="text-lg font-bold text-gray-800">
                                                                                {Math.round(avgInterval / 60 * 10) / 10}h
                                                                            </div>
                                                                            <div className="text-xs text-gray-600">Intervalle</div>
                                                                        </>
                                                                    );
                                                                }
                                                                return (
                                                                    <>
                                                                        <div className="text-lg font-bold text-gray-400">-</div>
                                                                        <div className="text-xs text-gray-600">Intervalle</div>
                                                                    </>
                                                                );
                                                            })()}
                                                        </div>
                                                    </div>
                                                ) : (
                                                    <div className="text-center py-6">
                                                        <div className="text-4xl mb-2">🍼</div>
                                                        <p className="text-sm text-gray-500 font-medium">Aucun biberon aujourd'hui</p>
                                                        <p className="text-xs text-gray-400">Ajoutez un biberon pour voir le graphique</p>
                                                    </div>
                                                );
                                            })()}
                                        </div>
                                    </div>
                                )}
                                {/* Panneau notifications */}
                                {notificationPermission !== 'granted' && (
                                    <div className="bg-blue-50 border border-blue-200 rounded-2xl p-4 mb-6">
                                        <div className="flex items-center gap-3">
                                            <span className="text-2xl">🔔</span>
                                            <div className="flex-1">
                                                <h3 className="font-semibold text-blue-800">Activer les notifications</h3>
                                                <p className="text-sm text-blue-700">Recevez des rappels pour les biberons, médicaments et RDV</p>
                                            </div>
                                            <button
                                                onClick={requestNotificationPermission}
                                                className="bg-blue-500 text-white px-4 py-2 rounded-xl text-sm font-medium"
                                            >
                                                Activer
                                            </button>
                                        </div>
                                    </div>
                                )}

                                {/* Historique avec pagination */}
                                <div className="space-y-3">
                                    <div className="flex items-center justify-between">
                                        <h3 className="text-lg font-bold text-gray-800">Historique</h3>
                                        <select
                                            value={historyFilter}
                                            onChange={(e) => {
                                                setHistoryFilter(e.target.value);
                                                setCurrentPage(0);
                                            }}
                                            className="text-sm border rounded-lg px-2 py-1"
                                        >
                                            <option value="today">Aujourd'hui</option>
                                            <option value="yesterday">Hier</option>
                                            <option value="week">7 derniers jours</option>
                                            <option value="all">Tout</option>
                                        </select>
                                    </div>

                                    <div className="space-y-3">
                                        {(() => {
                                            const filteredEntries = getFilteredHistory();
                                            const itemsPerPage = 10;
                                            const startIndex = currentPage * itemsPerPage;
                                            const endIndex = startIndex + itemsPerPage;
                                            const currentEntries = filteredEntries.slice(startIndex, endIndex);
                                            const totalPages = Math.ceil(filteredEntries.length / itemsPerPage);

                                            return (
                                                <>
                                                    {currentEntries.length === 0 ? (
                                                        <p className="text-gray-500 text-center py-8">Aucune entrée pour cette période</p>
                                                    ) : (
                                                        currentEntries.map((entry) => {
                                                            let poopDisplay = '';
                                                            if (entry.hasPoop) {
                                                                const poopInfo = getPoopInfo(entry.poopQuantity, entry.poopConsistency, entry.poopColor);
                                                                const parts = [];

                                                                if (poopInfo.quantity.label) parts.push(`${poopInfo.quantity.emoji} ${poopInfo.quantity.label}`);
                                                                if (poopInfo.consistency.label) parts.push(`${poopInfo.consistency.emoji} ${poopInfo.consistency.label}`);
                                                                if (poopInfo.color.label) parts.push(`${poopInfo.color.emoji} ${poopInfo.color.label}`);

                                                                const displayText = parts.length > 0 ? parts.join(' • ') : '💩 Caca';
                                                                poopDisplay = (
                                                                    <span className={`${poopInfo.color.bgColor || 'bg-orange-100'} ${poopInfo.color.textColor || 'text-orange-800'} px-3 py-1 rounded-full text-xs font-medium`}>
                                                                        {displayText}
                                                                    </span>
                                                                );
                                                            }

                                                            // Calcul du temps écoulé
                                                            const timeElapsed = new Date() - new Date(entry.timestamp);
                                                            const minutesAgo = Math.floor(timeElapsed / (1000 * 60));
                                                            const hoursAgo = Math.floor(minutesAgo / 60);

                                                            let timeDisplayClass = 'text-gray-500';
                                                            if (minutesAgo < 30) timeDisplayClass = 'text-green-600 font-medium';
                                                            else if (minutesAgo < 120) timeDisplayClass = 'text-blue-600';

                                                            return (
                                                                <div key={entry.id} className="bg-white/95 backdrop-blur-sm rounded-3xl shadow-xl border border-white/20 overflow-hidden">
                                                                    {/* Barre de couleur latérale */}
                                                                    <div
                                                                        className={`absolute left-0 top-0 bottom-0 w-1 ${entry.type === 'feeding'
                                                                            ? `bg-gradient-to-b ${themeColors.primary}`
                                                                            : 'bg-gradient-to-b from-emerald-500 to-emerald-600'
                                                                            }`}
                                                                    />

                                                                    {/* Contenu principal */}
                                                                    <div className="p-5 pl-6 relative">
                                                                        {/* Header de la carte */}
                                                                        <div className="flex items-start justify-between mb-4">
                                                                            <div className="flex items-center gap-4 flex-1">
                                                                                {/* Icône */}
                                                                                <div className={`w-14 h-14 rounded-2xl flex items-center justify-center ${entry.type === 'feeding'
                                                                                    ? `${themeColors.primaryLight} ${themeColors.primaryBorder} border-2`
                                                                                    : 'bg-emerald-100 border-2 border-emerald-200'
                                                                                    }`}>
                                                                                    {entry.type === 'feeding' ? (
                                                                                        <i className={`fas fa-bottle-water ${themeColors.primaryText} text-xl`}></i>
                                                                                    ) : (
                                                                                        <i className="fas fa-baby text-emerald-600 text-xl"></i>
                                                                                    )}

                                                                                    {/* Badge nouveau pour les entrées < 5 min */}
                                                                                    {minutesAgo < 5 && (
                                                                                        <div className="absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full flex items-center justify-center">
                                                                                            <div className="w-2 h-2 bg-white rounded-full" />
                                                                                        </div>
                                                                                    )}
                                                                                </div>

                                                                                {/* Titre et infos */}
                                                                                <div className="flex-1 min-w-0">
                                                                                    <div className="flex items-center gap-2 mb-1 flex-wrap">
                                                                                        <h4 className="font-bold text-gray-900 text-lg">
                                                                                            {entry.type === 'feeding' ? 'Biberon' : 'Change'}
                                                                                        </h4>

                                                                                        {/* Badge de statut */}
                                                                                        <div className={`px-2 py-0.5 rounded-full text-xs font-medium border ${entry.type === 'feeding'
                                                                                            ? `${themeColors.primaryLight} ${themeColors.primaryText} ${themeColors.primaryBorder}`
                                                                                            : 'bg-emerald-50 text-emerald-700 border-emerald-200'
                                                                                            }`}>
                                                                                            {entry.type === 'feeding' ? 'Nutrition' : 'Hygiène'}
                                                                                        </div>
                                                                                    </div>

                                                                                    <div className="flex items-center gap-2 flex-wrap">
                                                                                        <p className={`text-sm font-medium ${timeDisplayClass}`}>
                                                                                            {formatDateTime(entry.timestamp)}
                                                                                        </p>

                                                                                        {/* Indicateur de fraîcheur */}
                                                                                        {minutesAgo < 30 && (
                                                                                            <div className="flex items-center gap-1 bg-green-50 px-2 py-0.5 rounded-full">
                                                                                                <div className="w-2 h-2 bg-green-500 rounded-full"></div>
                                                                                                <span className="text-xs text-green-700 font-medium">Récent</span>
                                                                                            </div>
                                                                                        )}
                                                                                    </div>
                                                                                </div>
                                                                            </div>

                                                                            {/* Actions toujours visibles sur mobile */}
                                                                            <div className="flex items-center gap-2 ml-2">
                                                                                <button
                                                                                    onClick={() => editEntry(entry.id)}
                                                                                    className="w-9 h-9 rounded-2xl bg-blue-50 flex items-center justify-center active:scale-95 transition-transform"
                                                                                >
                                                                                    <i className="fas fa-edit text-sm text-blue-600"></i>
                                                                                </button>
                                                                                <button
                                                                                    onClick={() => deleteEntry(entry.id)}
                                                                                    className="w-9 h-9 rounded-2xl bg-red-50 flex items-center justify-center active:scale-95 transition-transform"
                                                                                >
                                                                                    <i className="fas fa-trash text-sm text-red-600"></i>
                                                                                </button>
                                                                            </div>
                                                                        </div>

                                                                        {/* Séparateur */}
                                                                        <div className="h-px bg-gradient-to-r from-transparent via-gray-200 to-transparent mb-4 opacity-60"></div>

                                                                        {/* Contenu principal */}
                                                                        <div className="space-y-3">
                                                                            {/* Données biberon */}
                                                                            {entry.type === 'feeding' && entry.amount && (
                                                                                <div className="flex items-center gap-3 flex-wrap">
                                                                                    <div className={`flex items-center gap-2 px-4 py-2 rounded-2xl ${themeColors.primaryLight} ${themeColors.primaryBorder} border`}>
                                                                                        <i className="fas fa-tint text-sm opacity-70"></i>
                                                                                        <span className="font-bold text-base">{entry.amount}ml</span>
                                                                                    </div>

                                                                                    {/* Pourcentage de la recommandation */}
                                                                                    {(() => {
                                                                                        const age = calculateAge();
                                                                                        const weightCalculation = currentWeight ? calculateMilkByWeight(currentWeight, age) : null;
                                                                                        const recommendations = getFeedingRecommendations(age);

                                                                                        let expectedAmount = null;
                                                                                        if (weightCalculation) {
                                                                                            expectedAmount = weightCalculation.mlPerFeeding;
                                                                                        } else if (recommendations) {
                                                                                            expectedAmount = getDefaultAmount(recommendations.volume);
                                                                                        }

                                                                                        if (expectedAmount) {
                                                                                            const percentage = Math.round((entry.amount / expectedAmount) * 100);
                                                                                            let percentageClass = 'bg-green-100 text-green-800 border-green-200';
                                                                                            if (percentage < 80) percentageClass = 'bg-orange-100 text-orange-800 border-orange-200';
                                                                                            if (percentage < 60) percentageClass = 'bg-red-100 text-red-800 border-red-200';
                                                                                            if (percentage > 120) percentageClass = 'bg-blue-100 text-blue-800 border-blue-200';

                                                                                            return (
                                                                                                <div className={`px-3 py-1 rounded-full text-xs font-medium border ${percentageClass}`}>
                                                                                                    {percentage}% recommandé
                                                                                                </div>
                                                                                            );
                                                                                        }
                                                                                        return null;
                                                                                    })()}
                                                                                </div>
                                                                            )}

                                                                            {/* Informations change */}
                                                                            {(entry.hasPee || entry.hasPoop) && (
                                                                                <div className="flex items-center gap-3 flex-wrap">
                                                                                    {entry.hasPee && (
                                                                                        <div className="flex items-center gap-2 px-4 py-2 rounded-2xl bg-blue-100 border border-blue-200">
                                                                                            <span className="text-base">💧</span>
                                                                                            <span className="font-medium text-blue-800 text-sm">Pipi</span>
                                                                                        </div>
                                                                                    )}
                                                                                    {entry.hasPoop && (
                                                                                        <div className="flex items-center gap-2 px-4 py-2 rounded-2xl bg-amber-100 border border-amber-200">
                                                                                            {poopDisplay}
                                                                                        </div>
                                                                                    )}
                                                                                </div>
                                                                            )}
                                                                        </div>

                                                                        {/* Footer informatif */}
                                                                        <div className="mt-4 pt-3 border-t border-gray-100">
                                                                            <div className="flex items-center justify-between text-xs text-gray-500">
                                                                                <span>#{entry.id.slice(-6)}</span>
                                                                                <span>
                                                                                    {minutesAgo < 60
                                                                                        ? `Il y a ${minutesAgo} min`
                                                                                        : `Il y a ${Math.floor(minutesAgo / 60)}h${minutesAgo % 60 > 0 ? `${minutesAgo % 60}min` : ''}`
                                                                                    }
                                                                                </span>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            );
                                                        })
                                                    )}

                                                    {/* Pagination */}
                                                    {totalPages > 1 && (
                                                        <div className="flex items-center justify-center gap-2 mt-4">
                                                            <button
                                                                onClick={() => setCurrentPage(Math.max(0, currentPage - 1))}
                                                                disabled={currentPage === 0}
                                                                className="px-3 py-1 rounded-lg border disabled:opacity-50"
                                                            >
                                                                ←
                                                            </button>
                                                            <span className="text-sm text-gray-600">
                                                                Page {currentPage + 1} sur {totalPages}
                                                            </span>
                                                            <button
                                                                onClick={() => setCurrentPage(Math.min(totalPages - 1, currentPage + 1))}
                                                                disabled={currentPage === totalPages - 1}
                                                                className="px-3 py-1 rounded-lg border disabled:opacity-50"
                                                            >
                                                                →
                                                            </button>
                                                        </div>
                                                    )}
                                                </>
                                            );
                                        })()}
                                    </div>
                                </div>

                            </>
                        )}
                        {/* Vue Médical */}
                        {currentView === 'medical' && (
                            <div className="space-y-4">
                                {/* Header avec style unifié */}
                                <div className="bg-white/95 backdrop-blur-xl rounded-2xl shadow-lg border border-white/50 p-4">
                                    <h2 className="text-xl font-bold text-gray-900 mb-4">Suivi médical</h2>

                                    {/* Boutons actions dans des cartes */}
                                    <div className="grid grid-cols-2 gap-3">
                                        <button
                                            onClick={() => {
                                                setMedicationData({
                                                    name: '',
                                                    dosage: '',
                                                    date: getCurrentDate(),
                                                    time: getCurrentTime(),
                                                    interval: ''
                                                });
                                                setCurrentView('medication-form');
                                            }}
                                            className="bg-white/80 border border-white/30 rounded-2xl p-4 shadow-xl active:scale-95 transition-transform"
                                        >
                                            <div className="w-12 h-12 bg-green-100 rounded-2xl flex items-center justify-center mb-3 mx-auto">
                                                <i className="fas fa-pills text-green-600 text-xl"></i>
                                            </div>
                                            <div className="text-center">
                                                <h3 className="font-semibold text-gray-900 mb-1">Médicament</h3>
                                                <p className="text-xs text-gray-600">Ajouter un traitement</p>
                                            </div>
                                        </button>

                                        <button
                                            onClick={() => {
                                                setAppointmentData({
                                                    type: '',
                                                    doctor: '',
                                                    date: getCurrentDate(),
                                                    time: '',
                                                    location: ''
                                                });
                                                setCurrentView('appointment-form');
                                            }}
                                            className="bg-white/80 border border-white/30 rounded-2xl p-4 shadow-xl active:scale-95 transition-transform"
                                        >
                                            <div className="w-12 h-12 bg-purple-100 rounded-2xl flex items-center justify-center mb-3 mx-auto">
                                                <i className="fas fa-calendar-plus text-purple-600 text-xl"></i>
                                            </div>
                                            <div className="text-center">
                                                <h3 className="font-semibold text-gray-900 mb-1">Rendez-vous</h3>
                                                <p className="text-xs text-gray-600">Programmer un RDV</p>
                                            </div>
                                        </button>
                                    </div>
                                </div>
                                {/* Soins quotidiens */}
                                <div>
                                    <div className="flex items-center justify-between mb-3">
                                        <h3 className="text-lg font-semibold text-gray-800">🧼 Soins quotidiens</h3>
                                        {(() => {
                                            const reminders = getCareReminders();
                                            return reminders.length > 0 && (
                                                <div className="bg-orange-100 text-orange-800 px-2 py-1 rounded-full text-xs font-bold">
                                                    {reminders.length} restant
                                                </div>
                                            );
                                        })()}
                                    </div>

                                    <div className="space-y-3">
                                        {/* Soin du cordon */}
                                        <div className={`p-3 rounded-xl border-2 ${!dailyCare.cordon.active
                                            ? 'bg-gray-100 border-gray-300'
                                            : (dailyCare.cordon.morningDone && dailyCare.cordon.eveningDone)
                                                ? 'bg-green-50 border-green-200'
                                                : 'bg-orange-50 border-orange-200'}`}>

                                            <div className="flex items-center justify-between mb-2">
                                                <div className="flex items-center gap-3">
                                                    <span className="text-xl">
                                                        {!dailyCare.cordon.active ? '⚪' :
                                                            (dailyCare.cordon.morningDone && dailyCare.cordon.eveningDone) ? '✅' : '🩹'}
                                                    </span>
                                                    <div>
                                                        <h4 className="font-medium text-gray-800">
                                                            Soin du cordon
                                                            {!dailyCare.cordon.active && <span className="text-sm text-gray-500">(Désactivé)</span>}
                                                        </h4>
                                                        <p className="text-xs text-gray-600">
                                                            {dailyCare.cordon.active ? 'Nettoyage matin et soir' : 'Cordon tombé'}
                                                        </p>
                                                    </div>
                                                </div>

                                                {/* Bouton pour désactiver/réactiver le cordon */}
                                                <button
                                                    onClick={toggleCordonActive}
                                                    className={`text-xs px-2 py-1 rounded ${dailyCare.cordon.active
                                                        ? 'bg-red-100 text-red-700 hover:bg-red-200'
                                                        : 'bg-blue-100 text-blue-700 hover:bg-blue-200'}`}
                                                >
                                                    {dailyCare.cordon.active ? 'Désactiver' : 'Réactiver'}
                                                </button>
                                            </div>

                                            {/* Cases à cocher pour matin et soir (seulement si actif) */}
                                            {dailyCare.cordon.active && (
                                                <div className="flex gap-4">
                                                    <div className="flex items-center gap-2">
                                                        <button
                                                            onClick={() => toggleCare('cordon', 'morning')}
                                                            className={`w-5 h-5 rounded border-2 flex items-center justify-center ${dailyCare.cordon.morningDone
                                                                ? 'bg-green-500 border-green-500'
                                                                : 'border-gray-300 hover:border-green-400'}`}
                                                        >
                                                            {dailyCare.cordon.morningDone && <i className="fas fa-check text-white text-xs"></i>}
                                                        </button>
                                                        <span className="text-sm text-gray-700">Matin</span>
                                                    </div>

                                                    <div className="flex items-center gap-2">
                                                        <button
                                                            onClick={() => toggleCare('cordon', 'evening')}
                                                            className={`w-5 h-5 rounded border-2 flex items-center justify-center ${dailyCare.cordon.eveningDone
                                                                ? 'bg-green-500 border-green-500'
                                                                : 'border-gray-300 hover:border-green-400'}`}
                                                        >
                                                            {dailyCare.cordon.eveningDone && <i className="fas fa-check text-white text-xs"></i>}
                                                        </button>
                                                        <span className="text-sm text-gray-700">Soir</span>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                        {/* Nettoyage visage */}
                                        <div className={`flex items-center justify-between p-3 rounded-xl border-2 ${dailyCare.visage.done
                                            ? 'bg-green-50 border-green-200'
                                            : 'bg-orange-50 border-orange-200'}`}>
                                            <div className="flex items-center gap-3">
                                                <span className="text-xl">{dailyCare.visage.done ? '✅' : '🧼'}</span>
                                                <div>
                                                    <h4 className="font-medium text-gray-800">Nettoyage du visage</h4>
                                                    <p className="text-xs text-gray-600">Yeux, nez, oreilles</p>
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => toggleCare('visage')}
                                                className={`w-6 h-6 rounded border-2 flex items-center justify-center ${dailyCare.visage.done
                                                    ? 'bg-green-500 border-green-500'
                                                    : 'border-gray-300 hover:border-green-400'}`}
                                            >
                                                {dailyCare.visage.done && <i className="fas fa-check text-white text-xs"></i>}
                                            </button>
                                        </div>

                                        {/* Vitamines */}
                                        <div className={`flex items-center justify-between p-3 rounded-xl border-2 ${dailyCare.vitamines.done
                                            ? 'bg-green-50 border-green-200'
                                            : 'bg-orange-50 border-orange-200'}`}>
                                            <div className="flex items-center gap-3">
                                                <span className="text-xl">{dailyCare.vitamines.done ? '✅' : '💊'}</span>
                                                <div>
                                                    <h4 className="font-medium text-gray-800">Vitamines</h4>
                                                    <p className="text-xs text-gray-600">Vitamine D, K si prescrites</p>
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => toggleCare('vitamines')}
                                                className={`w-6 h-6 rounded border-2 flex items-center justify-center ${dailyCare.vitamines.done
                                                    ? 'bg-green-500 border-green-500'
                                                    : 'border-gray-300 hover:border-green-400'}`}
                                            >
                                                {dailyCare.vitamines.done && <i className="fas fa-check text-white text-xs"></i>}
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                {/* Médicaments */}
                                <div>
                                    <h3 className="text-lg font-semibold text-gray-800 mb-3">💊 Médicaments</h3>
                                    <div className="space-y-3">
                                        {medications.length === 0 ? (
                                            <p className="text-gray-500 text-center py-6">Aucun médicament enregistré</p>
                                        ) : (
                                            medications.map(medication => {
                                                const now = new Date();
                                                const lastGiven = new Date(medication.lastGiven);
                                                const hoursSinceLastDose = (now - lastGiven) / (1000 * 60 * 60);

                                                let statusClass = 'medication-available';
                                                let statusText = 'Peut être donné';
                                                let statusIcon = '✅';

                                                if (medication.interval) {
                                                    if (hoursSinceLastDose < medication.interval) {
                                                        const nextDose = new Date(lastGiven);
                                                        nextDose.setHours(nextDose.getHours() + medication.interval);

                                                        const hoursRemaining = medication.interval - hoursSinceLastDose;

                                                        if (hoursRemaining <= 1) {
                                                            statusClass = 'medication-soon pulse-gentle';
                                                            statusText = `Prochaine prise à : ${formatTime(nextDose.toISOString())}`;
                                                            statusIcon = '⏰';
                                                        } else {
                                                            statusClass = 'medication-waiting';
                                                            statusText = `Prochaine prise à : ${formatTime(nextDose.toISOString())}`;
                                                            statusIcon = '⏳';
                                                        }
                                                    }
                                                }

                                                return (
                                                    <div key={medication.id} className={`${statusClass} rounded-xl p-3 border-2`}>
                                                        <div className="flex items-center justify-between mb-2">
                                                            <div className="flex items-center gap-2">
                                                                <span className="text-lg">{statusIcon}</span>
                                                                <div>
                                                                    <h5 className="font-semibold text-gray-800">{medication.name}</h5>
                                                                    <p className="text-sm text-gray-600">{medication.dosage}</p>
                                                                </div>
                                                            </div>
                                                            <div className="text-right">
                                                                <p className="text-xs text-gray-500">{formatDateTime(medication.lastGiven)}</p>
                                                                <p className="text-xs font-medium">{statusText}</p>
                                                            </div>
                                                        </div>
                                                        <div className="flex gap-2">
                                                            {hoursSinceLastDose >= (medication.interval || 0) ? (
                                                                <button
                                                                    onClick={() => giveMedication(medication.id)}
                                                                    className="flex-1 bg-green-500 text-white py-2 rounded-lg text-sm font-medium"
                                                                >
                                                                    Donner maintenant
                                                                </button>
                                                            ) : (
                                                                <button
                                                                    disabled
                                                                    className="flex-1 bg-gray-300 text-gray-500 py-2 rounded-lg text-sm font-medium"
                                                                >
                                                                    Pas encore
                                                                </button>
                                                            )}
                                                            <button
                                                                onClick={() => deleteMedication(medication.id)}
                                                                className="px-3 bg-red-100 text-red-600 rounded-lg text-sm"
                                                            >
                                                                <i className="fas fa-trash"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                );
                                            })
                                        )}
                                    </div>
                                </div>

                                {/* Rendez-vous */}
                                <div className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30">
                                    <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
                                        <div className="w-8 h-8 bg-purple-100 rounded-xl flex items-center justify-center">
                                            <i className="fas fa-calendar text-purple-600"></i>
                                        </div>
                                        Rendez-vous
                                    </h3>
                                    <div className="space-y-3">
                                        {appointments.length === 0 ? (
                                            <div className="text-center py-8">
                                                <div className="w-16 h-16 bg-purple-100 rounded-2xl flex items-center justify-center mx-auto mb-3">
                                                    <i className="fas fa-calendar-plus text-purple-600 text-2xl"></i>
                                                </div>
                                                <p className="text-gray-500 font-medium">Aucun rendez-vous programmé</p>
                                                <p className="text-gray-400 text-sm">Ajoutez un RDV médical</p>
                                            </div>
                                        ) : (

                                            appointments.map(appointment => {
                                                const appointmentDate = new Date(appointment.timestamp);
                                                const now = new Date();
                                                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                                                const appointmentDay = new Date(appointmentDate.getFullYear(), appointmentDate.getMonth(), appointmentDate.getDate());

                                                let statusClass = '';
                                                let statusIcon = '📅';

                                                if (appointmentDay.getTime() === today.getTime()) {
                                                    statusClass = 'appointment-today pulse-gentle';
                                                    statusIcon = '🚨';
                                                } else if (appointmentDate > now && appointmentDate < new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000)) {
                                                    statusClass = 'appointment-upcoming';
                                                    statusIcon = '⏰';
                                                }

                                                return (
                                                    <div key={appointment.id} className={`${statusClass} rounded-xl p-3 border-2 border-gray-200`}>
                                                        <div className="flex items-center justify-between mb-2">
                                                            <div className="flex items-center gap-2">
                                                                <span className="text-lg">{statusIcon}</span>
                                                                <div>
                                                                    <h5 className="font-semibold text-gray-800">{appointment.type}</h5>
                                                                    <p className="text-sm text-gray-600">{appointment.doctor || 'Praticien non renseigné'}</p>
                                                                </div>
                                                            </div>
                                                            <button
                                                                onClick={() => deleteAppointment(appointment.id)}
                                                                className="text-red-500 hover:text-red-700"
                                                            >
                                                                <i className="fas fa-trash"></i>
                                                            </button>
                                                        </div>
                                                        <div className="text-sm text-gray-600">
                                                            <p><i className="far fa-calendar mr-2"></i>{formatDateTime(appointment.timestamp)}</p>
                                                            {appointment.location && (
                                                                <p><i className="fas fa-map-marker-alt mr-2"></i>{appointment.location}</p>
                                                            )}
                                                        </div>
                                                    </div>
                                                );
                                            })
                                        )}
                                    </div>
                                </div>

                                {/* Vaccins */}
                                <div className="bg-white/90 backdrop-blur-sm rounded-2xl p-4 shadow-xl border border-white/30">
                                    <div className="flex items-center justify-between mb-4">
                                        <h3 className="text-lg font-semibold text-gray-900 flex items-center gap-2">
                                            <div className="w-8 h-8 bg-green-100 rounded-xl flex items-center justify-center">
                                                <i className="fas fa-syringe text-green-600"></i>
                                            </div>
                                            Suivi vaccinal
                                        </h3>
                                        <button
                                            onClick={() => setCurrentView('vaccine-form')}
                                            className="bg-green-500 text-white px-4 py-2 rounded-xl text-sm font-medium shadow-lg active:scale-95 transition-transform"
                                        >
                                            + Vaccin
                                        </button>
                                    </div>

                                    {/* Vaccins à venir selon l'âge */}
                                    {(() => {
                                        const ageInMonths = Math.floor(age / 30);
                                        const upcomingVaccines = [];

                                        Object.keys(VACCINE_SCHEDULE).forEach(monthKey => {
                                            const month = parseInt(monthKey);
                                            if (month >= ageInMonths && month <= ageInMonths + 2) {
                                                VACCINE_SCHEDULE[month].forEach(vaccine => {
                                                    const isAlreadyDone = vaccines.some(v => v.name.includes(vaccine.name.split('(')[0].trim()));
                                                    if (!isAlreadyDone) {
                                                        upcomingVaccines.push({ ...vaccine, dueMonth: month });
                                                    }
                                                });
                                            }
                                        });

                                        return upcomingVaccines.length > 0 && (
                                            <div className="bg-blue-50 rounded-lg p-3 mb-3">
                                                <h4 className="font-medium text-blue-800 mb-2">📅 Vaccins à prévoir :</h4>
                                                <div className="space-y-1">
                                                    {upcomingVaccines.map((vaccine, index) => (
                                                        <div key={index} className="text-sm text-blue-700">
                                                            <span className="font-medium">{vaccine.dueMonth} mois :</span> {vaccine.name}
                                                            {vaccine.required && <span className="text-red-600"> *</span>}
                                                        </div>
                                                    ))}
                                                </div>
                                                <p className="text-xs text-blue-600 mt-2">* = Obligatoire</p>
                                            </div>
                                        );
                                    })()}

                                    {/* Liste des vaccins effectués */}
                                    <div className="space-y-3">
                                        {vaccines.length === 0 ? (
                                            <p className="text-gray-500 text-center py-6">Aucun vaccin enregistré</p>
                                        ) : (
                                            vaccines.map(vaccine => (
                                                <div key={vaccine.id} className="bg-white/80 rounded-xl p-3 shadow-sm border border-white/50">
                                                    <div className="flex items-center justify-between mb-2">
                                                        <h5 className="font-semibold text-gray-800">{vaccine.name}</h5>
                                                        <button
                                                            onClick={() => deleteVaccine(vaccine.id)}
                                                            className="text-red-500 hover:text-red-700"
                                                        >
                                                            <i className="fas fa-trash text-sm"></i>
                                                        </button>
                                                    </div>
                                                    <div className="text-sm text-gray-600">
                                                        <p><i className="fas fa-calendar mr-2"></i>{formatDate(vaccine.timestamp)}</p>
                                                        {vaccine.nextDue && (
                                                            <p><i className="fas fa-clock mr-2"></i>Prochain : {vaccine.nextDue}</p>
                                                        )}
                                                        {vaccine.notes && (
                                                            <p><i className="fas fa-note-sticky mr-2"></i>{vaccine.notes}</p>
                                                        )}
                                                    </div>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}{/* Vue Stocks */}

                        {currentView === 'supplies' && (
                            <div className="space-y-6">
                                <h2 className="text-xl font-bold text-gray-800">Gestion des stocks</h2>

                                <div className="space-y-4">
                                    {/* Lait en poudre */}
                                    <div className="bg-white/80 rounded-2xl p-4 shadow-sm border border-white/50">
                                        <div className="flex items-center justify-between mb-3">
                                            <div className="flex items-center gap-2">
                                                <span className="text-xl">🥛</span>
                                                <h3 className="font-semibold text-gray-800">Lait en poudre</h3>
                                            </div>
                                            <button
                                                onClick={setMilkPowderDate}
                                                className={`${themeColors.primaryBg} text-white px-3 py-1 rounded-lg text-sm`}
                                            >
                                                Définir date
                                            </button>
                                        </div>
                                        <p className="text-sm text-gray-600">
                                            Date d'ouverture : {stocks['milk-powder']?.date || 'Non renseignée'}
                                        </p>
                                        {stocks['milk-powder']?.date && (
                                            <p className="text-xs text-orange-600 mt-1">
                                                ⚠️ À consommer dans les 3-4 semaines après ouverture
                                            </p>
                                        )}
                                    </div>

                                    {/* Bouteille d'eau */}
                                    <div className="bg-white/80 rounded-2xl p-4 shadow-sm border border-white/50">
                                        <div className="flex items-center justify-between mb-3">
                                            <div className="flex items-center gap-2">
                                                <span className="text-xl">💧</span>
                                                <h3 className="font-semibold text-gray-800">Bouteille d'eau</h3>
                                            </div>
                                            <button
                                                onClick={setWaterBottleDateTime}
                                                className={`${themeColors.primaryBg} text-white px-3 py-1 rounded-lg text-sm`}
                                            >
                                                Définir date/heure
                                            </button>
                                        </div>
                                        <p className="text-sm text-gray-600">
                                            Ouverture : {stocks['water-bottle']?.datetime || 'Non renseignée'}
                                        </p>
                                        {stocks['water-bottle']?.datetime && (
                                            <p className="text-xs text-orange-600 mt-1">
                                                ⚠️ À consommer dans les 48-72h après ouverture
                                            </p>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* Vue Diversification */}
                        {currentView === 'food' && (
                            <div className="space-y-6">
                                <h2 className="text-xl font-bold text-gray-800">Diversification alimentaire</h2>

                                {(() => {
                                    const diversification = getDiversificationRecommendations(age);

                                    if (diversification.phase === 'Pas encore') {
                                        return (
                                            <div className="bg-blue-50 rounded-2xl p-4 shadow-sm border border-blue-200">
                                                <div className="text-center">
                                                    <div className="text-4xl mb-3">🍼</div>
                                                    <h3 className="text-lg font-semibold text-blue-800 mb-2">{diversification.phase}</h3>
                                                    <p className="text-blue-700 text-sm mb-2">{diversification.message}</p>
                                                    <p className="text-blue-600 text-xs font-medium">{diversification.recommendation}</p>
                                                </div>
                                            </div>
                                        );
                                    }

                                    return (
                                        <div className="space-y-4">
                                            {/* Phase actuelle */}
                                            <div className={`${themeColors.primaryLight} rounded-2xl p-4 shadow-sm border ${themeColors.primaryBorder}`}>
                                                <h3 className={`text-lg font-semibold ${themeColors.primaryDark} mb-3`}>
                                                    📅 Phase : {diversification.phase}
                                                </h3>
                                                <div className="space-y-2">
                                                    {diversification.principles.map((principle, index) => (
                                                        <div key={index} className="flex items-start gap-2">
                                                            <span className="text-xs">•</span>
                                                            <span className="text-xs text-gray-700">{principle}</span>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>

                                            {/* Légumes */}
                                            {diversification.vegetables && (
                                                <div className="bg-white/80 rounded-2xl p-4 shadow-sm border border-white/50">
                                                    <h4 className="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                                        <span>🥕</span> Légumes recommandés
                                                    </h4>
                                                    <div className="space-y-2">
                                                        {diversification.vegetables.map((veg, index) => (
                                                            <div key={index} className="bg-green-50 rounded-lg p-2">
                                                                <div className="flex items-center justify-between mb-1">
                                                                    <span className="font-medium text-green-800">{veg.name}</span>
                                                                    <span className="text-xs text-green-600">{veg.quantity}</span>
                                                                </div>
                                                                <div className="text-xs text-green-700">
                                                                    <span>{veg.texture} • {veg.preparation}</span>
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}

                                            {/* Fruits */}
                                            {diversification.fruits && (
                                                <div className="bg-white/80 rounded-2xl p-4 shadow-sm border border-white/50">
                                                    <h4 className="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                                        <span>🍎</span> Fruits recommandés
                                                    </h4>
                                                    <div className="space-y-2">
                                                        {diversification.fruits.map((fruit, index) => (
                                                            <div key={index} className="bg-yellow-50 rounded-lg p-2">
                                                                <div className="flex items-center justify-between mb-1">
                                                                    <span className="font-medium text-yellow-800">{fruit.name}</span>
                                                                    <span className="text-xs text-yellow-600">{fruit.quantity}</span>
                                                                </div>
                                                                <div className="text-xs text-yellow-700">
                                                                    <span>{fruit.texture} • {fruit.preparation}</span>
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}

                                            {/* Protéines */}
                                            {diversification.proteins && (
                                                <div className="bg-white/80 rounded-2xl p-4 shadow-sm border border-white/50">
                                                    <h4 className="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                                        <span>🥩</span> Protéines
                                                    </h4>
                                                    <div className="space-y-2">
                                                        {diversification.proteins.map((protein, index) => (
                                                            <div key={index} className="bg-red-50 rounded-lg p-2">
                                                                <div className="flex items-center justify-between mb-1">
                                                                    <span className="font-medium text-red-800">{protein.name}</span>
                                                                    <span className="text-xs text-red-600">{protein.quantity}</span>
                                                                </div>
                                                                <div className="text-xs text-red-700">
                                                                    <span>{protein.texture} • {protein.preparation}</span>
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}

                                            {/* Féculents */}
                                            {diversification.starches && (
                                                <div className="bg-white/80 rounded-2xl p-4 shadow-sm border border-white/50">
                                                    <h4 className="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                                        <span>🍞</span> Féculents
                                                    </h4>
                                                    <div className="space-y-2">
                                                        {diversification.starches.map((starch, index) => (
                                                            <div key={index} className="bg-orange-50 rounded-lg p-2">
                                                                <div className="flex items-center justify-between mb-1">
                                                                    <span className="font-medium text-orange-800">{starch.name}</span>
                                                                    <span className="text-xs text-orange-600">{starch.quantity}</span>
                                                                </div>
                                                                <div className="text-xs text-orange-700">
                                                                    <span>{starch.texture} • {starch.preparation}</span>
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}

                                            {/* Laitages */}
                                            {diversification.dairy && (
                                                <div className="bg-white/80 rounded-2xl p-4 shadow-sm border border-white/50">
                                                    <h4 className="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                                        <span>🧀</span> Laitages
                                                    </h4>
                                                    <div className="space-y-2">
                                                        {diversification.dairy.map((dairy, index) => (
                                                            <div key={index} className="bg-blue-50 rounded-lg p-2">
                                                                <div className="flex items-center justify-between mb-1">
                                                                    <span className="font-medium text-blue-800">{dairy.name}</span>
                                                                    <span className="text-xs text-blue-600">{dairy.quantity}</span>
                                                                </div>
                                                                <div className="text-xs text-blue-700">
                                                                    <span>{dairy.texture} • {dairy.preparation}</span>
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}

                                            {/* Nouveaux aliments (après 12 mois) */}
                                            {diversification.newFoods && (
                                                <div className="bg-white/80 rounded-2xl p-4 shadow-sm border border-white/50">
                                                    <h4 className="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                                        <span>✨</span> Nouveaux aliments possibles
                                                    </h4>
                                                    <div className="space-y-2">
                                                        {diversification.newFoods.map((food, index) => (
                                                            <div key={index} className="bg-purple-50 rounded-lg p-2">
                                                                <div className="flex items-center justify-between mb-1">
                                                                    <span className="font-medium text-purple-800">{food.name}</span>
                                                                    <span className="text-xs text-purple-600">Dès {food.age}</span>
                                                                </div>
                                                                <div className="text-xs text-purple-700">
                                                                    <span>{food.note}</span>
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}

                                            {/* Suivi personnalisé de la diversification */}
                                            <div className="space-y-4 mt-6">
                                                <div className="flex items-center justify-between">
                                                    <h3 className="text-lg font-semibold text-gray-800">📝 Mon suivi personnalisé</h3>
                                                    <button
                                                        onClick={() => setCurrentView('diversification-form')}
                                                        className={`${themeColors.primaryBg} text-white px-3 py-1 rounded-lg text-sm`}
                                                    >
                                                        + Aliment testé
                                                    </button>
                                                </div>

                                                <div className="space-y-3">
                                                    {diversificationEntries.length === 0 ? (
                                                        <p className="text-gray-500 text-center py-6">Aucun aliment testé enregistré</p>
                                                    ) : (
                                                        diversificationEntries.map(entry => (
                                                            <div key={entry.id} className="bg-white/80 rounded-xl p-3 shadow-sm border border-white/50">
                                                                <div className="flex items-center justify-between mb-2">
                                                                    <div className="flex items-center gap-2">
                                                                        <h5 className="font-semibold text-gray-800">{entry.food}</h5>
                                                                        <div className="flex items-center gap-1">
                                                                            {[...Array(entry.rating)].map((_, i) => (
                                                                                <span key={i} className="text-xs text-yellow-400">
                                                                                    ⭐
                                                                                </span>
                                                                            ))}
                                                                            <span className="text-xs text-gray-600 ml-1">{entry.rating}/10</span>
                                                                        </div>
                                                                    </div>
                                                                    <button
                                                                        onClick={() => deleteDiversificationEntry(entry.id)}
                                                                        className="text-red-500 hover:text-red-700"
                                                                    >
                                                                        <i className="fas fa-trash text-sm"></i>
                                                                    </button>
                                                                </div>
                                                                <div className="text-sm text-gray-600">
                                                                    <p><i className="fas fa-calendar mr-2"></i>{formatDate(entry.timestamp)}</p>
                                                                    {entry.notes && (
                                                                        <p><i className="fas fa-note-sticky mr-2"></i>{entry.notes}</p>
                                                                    )}
                                                                </div>
                                                            </div>
                                                        ))
                                                    )}
                                                </div>
                                            </div>

                                            {/* Aliments à éviter */}
                                            {diversification.avoid && (
                                                <div className="bg-red-50 rounded-2xl p-4 shadow-sm border border-red-200">
                                                    <h4 className="font-semibold text-red-800 mb-3 flex items-center gap-2">
                                                        <span>⚠️</span> À éviter pour le moment
                                                    </h4>
                                                    <div className="flex flex-wrap gap-2">
                                                        {diversification.avoid.map((item, index) => (
                                                            <span key={index} className="bg-red-100 text-red-700 px-2 py-1 rounded-full text-xs">
                                                                {item}
                                                            </span>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    );
                                })()}
                            </div>
                        )}

                        {/* Vue Garde-robe */}
                        {currentView === 'wardrobe' && (
                            <div className="space-y-6">
                                <div className="flex items-center justify-between">
                                    <h2 className="text-xl font-bold text-gray-800">👕 Garde-robe</h2>
                                    <button
                                        onClick={() => setCurrentView('wardrobe-form')}
                                        className={`${themeColors.primaryBg} text-white px-3 py-1 rounded-lg text-sm`}
                                    >
                                        + Article
                                    </button>
                                </div>

                                {/* Tri par taille */}
                                {(() => {
                                    const groupedBySize = {};
                                    wardrobe.forEach(item => {
                                        if (!groupedBySize[item.size]) {
                                            groupedBySize[item.size] = [];
                                        }
                                        groupedBySize[item.size].push(item);
                                    });

                                    const sizes = Object.keys(groupedBySize).sort((a, b) => {
                                        const sizeOrder = ['Naissance', '1 mois', '3 mois', '6 mois', '9 mois', '12 mois', '18 mois', '2 ans', '3 ans'];
                                        return sizeOrder.indexOf(a) - sizeOrder.indexOf(b);
                                    });

                                    return sizes.length === 0 ? (
                                        <p className="text-gray-500 text-center py-8">Aucun vêtement enregistré</p>
                                    ) : (
                                        sizes.map(size => (
                                            <div key={size} className="bg-white/80 rounded-2xl p-4 shadow-sm border border-white/50">
                                                <h3 className="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                                    <i className="fas fa-ruler text-blue-500"></i>
                                                    Taille {size}
                                                </h3>
                                                <div className="grid grid-cols-1 gap-3">
                                                    {groupedBySize[size].map(item => (
                                                        <div key={item.id} className="bg-gray-50 rounded-lg p-3">
                                                            <div className="flex items-center justify-between mb-2">
                                                                <div className="flex items-center gap-2">
                                                                    <span className="text-lg">
                                                                        {item.type === 'Body' && '👕'}
                                                                        {item.type === 'Pyjama' && '🩱'}
                                                                        {item.type === 'Pantalon' && '👖'}
                                                                        {item.type === 'T-shirt' && '👕'}
                                                                        {item.type === 'Robe' && '👗'}
                                                                        {item.type === 'Chaussettes' && '🧦'}
                                                                        {item.type === 'Autre' && '👶'}
                                                                    </span>
                                                                    <span className="font-medium text-gray-800">{item.type}</span>
                                                                    <span className={`${themeColors.primaryLight} ${themeColors.primaryDark} px-2 py-1 rounded-full text-xs font-medium`}>
                                                                        x{item.quantity}
                                                                    </span>
                                                                </div>
                                                                <div className="flex items-center gap-2">
                                                                    <button
                                                                        onClick={() => editWardrobeItem(item.id)}
                                                                        className={`${themeColors.primaryText} ${themeColors.primaryHover}`}
                                                                    >
                                                                        <i className="fas fa-edit text-sm"></i>
                                                                    </button>
                                                                    <button
                                                                        onClick={() => deleteWardrobeItem(item.id)}
                                                                        className="text-red-500 hover:text-red-700"
                                                                    >
                                                                        <i className="fas fa-trash text-sm"></i>
                                                                    </button>
                                                                </div>
                                                            </div>
                                                            {item.notes && (
                                                                <p className="text-sm text-gray-600">
                                                                    <i className="fas fa-note-sticky mr-2"></i>{item.notes}
                                                                </p>
                                                            )}
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        ))
                                    );
                                })()}
                            </div>
                        )}
                        {/* Vue Conseils - maintenant avec motricité */}
                        {currentView === 'tips' && (
                            <div className="space-y-6">
                                <h2 className="text-xl font-bold text-gray-800">Conseils & Développement moteur</h2>

                                {/* Guide de motricité par défaut */}
                                {(() => {
                                    const motorGuide = getMotorDevelopmentForAge(age);

                                    return (
                                        <div className="space-y-4">
                                            {/* En-tête du guide moteur */}
                                            <div className={`${themeColors.primaryLight} rounded-2xl p-4 shadow-sm border ${themeColors.primaryBorder}`}>
                                                <h3 className={`text-lg font-semibold ${themeColors.primaryDark} mb-2`}>
                                                    🏃 {motorGuide.title}
                                                </h3>
                                                <p className="text-sm text-gray-700 mb-3">
                                                    {motorGuide.description}
                                                </p>

                                                {/* Capacités attendues */}
                                                <div className="bg-white/50 rounded-lg p-3">
                                                    <h4 className="text-sm font-medium text-gray-800 mb-2">📋 Capacités développées :</h4>
                                                    <div className="space-y-1">
                                                        {motorGuide.skills.map((skill, index) => (
                                                            <div key={index} className="flex items-start gap-2">
                                                                <span className="text-xs text-green-600 mt-1">✓</span>
                                                                <span className="text-xs text-gray-700">{skill}</span>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Exercices recommandés */}
                                            <div className="space-y-3">
                                                <h4 className="font-semibold text-gray-800">🎯 Exercices recommandés :</h4>
                                                {motorGuide.exercises.map((exercise, index) => (
                                                    <div key={index} className="bg-white/80 rounded-2xl p-4 shadow-sm border border-white/50">
                                                        <div className="flex items-center justify-between mb-2">
                                                            <h5 className="font-medium text-gray-800">{exercise.name}</h5>
                                                            <span className="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">
                                                                {exercise.duration}
                                                            </span>
                                                        </div>

                                                        <p className="text-sm text-gray-700 mb-2">
                                                            {exercise.description}
                                                        </p>

                                                        <div className="grid grid-cols-1 gap-2 text-xs">
                                                            <div className="bg-green-50 rounded-lg p-2">
                                                                <span className="font-medium text-green-800">💪 Bénéfices : </span>
                                                                <span className="text-green-700">{exercise.benefits}</span>
                                                            </div>
                                                            <div className="bg-orange-50 rounded-lg p-2">
                                                                <span className="font-medium text-orange-800">⚠️ Sécurité : </span>
                                                                <span className="text-orange-700">{exercise.safety}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>

                                            {/* Conseils généraux par âge - en bonus */}
                                            <div className="bg-white/80 glass rounded-2xl p-4 shadow-sm border border-white/50">
                                                <h4 className="font-semibold text-gray-800 mb-3">💡 Conseils généraux pour cet âge :</h4>
                                                {(() => {
                                                    const tips = getTipsForAge(age);
                                                    return (
                                                        <div className="text-sm text-gray-700 space-y-3">
                                                            {tips.sections.slice(0, 2).map((section, index) => (
                                                                <div key={index} className={`${section.color} p-3 rounded-lg`}>
                                                                    <h5 className={`font-medium ${section.textColor} mb-2`}>{section.title}</h5>
                                                                    <ul className="space-y-1 text-xs">
                                                                        {section.tips.slice(0, 3).map((tip, tipIndex) => (
                                                                            <li key={tipIndex}>• {tip}</li>
                                                                        ))}
                                                                        {section.tips.length > 3 && (
                                                                            <li className="text-gray-500 italic">... et {section.tips.length - 3} autres conseils</li>
                                                                        )}
                                                                    </ul>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    );
                                                })()}
                                            </div>

                                            {/* Note importante */}
                                            <div className="bg-blue-50 border border-blue-200 rounded-lg p-3">
                                                <div className="flex items-start gap-2">
                                                    <span className="text-blue-500 text-lg">ℹ️</span>
                                                    <div className="text-xs text-blue-700">
                                                        <strong>Important :</strong> Chaque bébé se développe à son propre rythme. Ces âges sont des repères, pas une règle stricte. L'essentiel est d'offrir un environnement sûr et stimulant, sans jamais forcer. En cas de préoccupation, consultez votre pédiatre.
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })()}
                            </div>
                        )}

                        {/* Vue Mise à jour du poids */}
                        {currentView === 'weight-update' && (
                            <div className="space-y-6">
                                <div className="flex items-center justify-between">
                                    <h2 className="text-xl font-bold text-gray-800">⚖️ Mise à jour du poids</h2>
                                    <button
                                        onClick={() => setCurrentView('daily')}
                                        className="text-gray-500 hover:text-gray-700"
                                    >
                                        <i className="fas fa-times text-xl"></i>
                                    </button>
                                </div>

                                <div className="bg-white/90 rounded-2xl p-6 shadow-xl border border-white/50">
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                Poids actuel (kg) *
                                            </label>
                                            <input
                                                type="number"
                                                step="0.001"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                placeholder="3.500"
                                                value={currentWeight || ''}
                                                onChange={(e) => setCurrentWeight(parseFloat(e.target.value) || null)}
                                            />
                                        </div>

                                        {currentWeight && (
                                            <div className={`${themeColors.primaryLight} rounded-lg p-3`}>
                                                <h4 className="font-medium text-gray-800 mb-2">📊 Nouveau calcul automatique :</h4>
                                                {(() => {
                                                    const calculation = calculateMilkByWeight(currentWeight, age);
                                                    return calculation ? (
                                                        <div className="text-sm text-gray-700">
                                                            <p>• <strong>Total par jour :</strong> {calculation.totalPerDay}ml</p>
                                                            <p>• <strong>Biberons recommandés :</strong> {calculation.feedingsPerDay} par jour</p>
                                                            <p>• <strong>Volume par biberon :</strong> {calculation.mlPerFeeding}ml</p>
                                                        </div>
                                                    ) : null;
                                                })()}
                                            </div>
                                        )}

                                        <button
                                            onClick={async () => {
                                                if (currentWeight) {
                                                    try {
                                                        // Sauvegarder dans Firebase
                                                        await db.collection('families').doc(user.code).update({
                                                            currentWeight: currentWeight,
                                                            lastWeightUpdate: new Date().toISOString()
                                                        });

                                                        // Mettre à jour l'état local
                                                        setUser(prev => ({ ...prev, currentWeight: currentWeight }));
                                                        setLastWeightUpdate(new Date().toISOString());
                                                        setCurrentView('daily');
                                                        alert('Poids mis à jour et sauvegardé !');
                                                    } catch (error) {
                                                        console.error('Erreur sauvegarde poids:', error);
                                                        alert('Erreur lors de la sauvegarde');
                                                    }
                                                } else {
                                                    alert('Veuillez entrer un poids valide');
                                                }
                                            }}
                                            className="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-4 rounded-xl font-bold"
                                        >
                                            Mettre à jour le poids
                                        </button>
                                    </div>
                                </div>

                                {lastWeightUpdate && (
                                    <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                                        <p className="text-sm text-yellow-800">
                                            ℹ️ Dernière mise à jour : {formatDateTime(lastWeightUpdate)}
                                        </p>
                                        <p className="text-xs text-yellow-700 mt-1">
                                            Pensez à mettre à jour le poids régulièrement pour des calculs précis.
                                        </p>
                                    </div>
                                )}
                            </div>
                        )}
                        {/* Vue Mise à jour de la taille */}
                        {currentView === 'height-update' && (
                            <div className="space-y-6">
                                <div className="flex items-center justify-between">
                                    <h2 className="text-xl font-bold text-gray-800">📏 Mise à jour de la taille</h2>
                                    <button
                                        onClick={() => setCurrentView('daily')}
                                        className="text-gray-500 hover:text-gray-700"
                                    >
                                        <i className="fas fa-times text-xl"></i>
                                    </button>
                                </div>

                                <div className="bg-white/90 rounded-2xl p-6 shadow-xl border border-white/50">
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                Taille actuelle (cm) *
                                            </label>
                                            <input
                                                type="number"
                                                step="0.1"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                placeholder="52.5"
                                                value={currentHeight || ''}
                                                onChange={(e) => setCurrentHeight(parseFloat(e.target.value) || null)}
                                            />
                                        </div>

                                        <button
                                            onClick={async () => {
                                                if (currentHeight) {
                                                    try {
                                                        await db.collection('families').doc(user.code).update({
                                                            birthHeight: currentHeight
                                                        });
                                                        setUser(prev => ({ ...prev, birthHeight: currentHeight }));
                                                        setLastHeightUpdate(new Date().toISOString());
                                                        setCurrentView('daily');
                                                        alert('Taille mise à jour !');
                                                    } catch (error) {
                                                        console.error('Erreur mise à jour taille:', error);
                                                        alert('Erreur lors de la mise à jour');
                                                    }
                                                } else {
                                                    alert('Veuillez entrer une taille valide');
                                                }
                                            }}
                                            className="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-4 rounded-xl font-bold"
                                        >
                                            Mettre à jour la taille
                                        </button>
                                    </div>
                                </div>

                                {lastHeightUpdate && (
                                    <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                                        <p className="text-sm text-yellow-800">
                                            ℹ️ Dernière mise à jour : {formatDateTime(lastHeightUpdate)}
                                        </p>
                                        <p className="text-xs text-yellow-700 mt-1">
                                            La taille peut être mesurée moins fréquemment que le poids.
                                        </p>
                                    </div>
                                )}
                            </div>
                        )}
                        {/* Formulaire médicament */}
                        {currentView === 'medication-form' && (
                            <div className="space-y-6">
                                <div className="flex items-center justify-between">
                                    <h2 className="text-xl font-bold text-gray-800">💊 Nouveau médicament</h2>
                                    <button
                                        onClick={() => setCurrentView('medical')}
                                        className="text-gray-500 hover:text-gray-700"
                                    >
                                        <i className="fas fa-times text-xl"></i>
                                    </button>
                                </div>

                                <div className="bg-white/90 rounded-2xl p-6 shadow-xl border border-white/50">
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Nom du médicament *</label>
                                            <input
                                                type="text"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                placeholder="Ex: Doliprane"
                                                value={medicationData.name}
                                                onChange={(e) => setMedicationData(prev => ({ ...prev, name: e.target.value }))}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Dosage *</label>
                                            <input
                                                type="text"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                placeholder="Ex: 2.5ml"
                                                value={medicationData.dosage}
                                                onChange={(e) => setMedicationData(prev => ({ ...prev, dosage: e.target.value }))}
                                            />
                                        </div>

                                        <div className="grid grid-cols-2 gap-3">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Date *</label>
                                                <input
                                                    type="date"
                                                    className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                    value={medicationData.date}
                                                    onChange={(e) => setMedicationData(prev => ({ ...prev, date: e.target.value }))}
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Heure *</label>
                                                <input
                                                    type="time"
                                                    className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                    value={medicationData.time}
                                                    onChange={(e) => setMedicationData(prev => ({ ...prev, time: e.target.value }))}
                                                />
                                            </div>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Intervalle (heures)</label>
                                            <input
                                                type="number"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                placeholder="Ex: 6 (pour toutes les 6h)"
                                                value={medicationData.interval}
                                                onChange={(e) => setMedicationData(prev => ({ ...prev, interval: e.target.value }))}
                                            />
                                        </div>

                                        <button
                                            onClick={saveMedication}
                                            className="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-4 rounded-xl font-bold"
                                        >
                                            Enregistrer le médicament
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Formulaire rendez-vous */}
                        {currentView === 'appointment-form' && (
                            <div className="space-y-6">
                                <div className="flex items-center justify-between">
                                    <h2 className="text-xl font-bold text-gray-800">📅 Nouveau rendez-vous</h2>
                                    <button
                                        onClick={() => setCurrentView('medical')}
                                        className="text-gray-500 hover:text-gray-700"
                                    >
                                        <i className="fas fa-times text-xl"></i>
                                    </button>
                                </div>

                                <div className="bg-white/90 rounded-2xl p-6 shadow-xl border border-white/50">
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Type de rendez-vous *</label>
                                            <input
                                                type="text"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                placeholder="Ex: Pédiatre, Vaccination"
                                                value={appointmentData.type}
                                                onChange={(e) => setAppointmentData(prev => ({ ...prev, type: e.target.value }))}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Médecin/Praticien</label>
                                            <input
                                                type="text"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                placeholder="Ex: Dr. Martin"
                                                value={appointmentData.doctor}
                                                onChange={(e) => setAppointmentData(prev => ({ ...prev, doctor: e.target.value }))}
                                            />
                                        </div>

                                        <div className="grid grid-cols-2 gap-3">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Date *</label>
                                                <input
                                                    type="date"
                                                    className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                    value={appointmentData.date}
                                                    onChange={(e) => setAppointmentData(prev => ({ ...prev, date: e.target.value }))}
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Heure *</label>
                                                <input
                                                    type="time"
                                                    className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                    value={appointmentData.time}
                                                    onChange={(e) => setAppointmentData(prev => ({ ...prev, time: e.target.value }))}
                                                />
                                            </div>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Lieu</label>
                                            <input
                                                type="text"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                placeholder="Ex: Clinique Saint-Vincent"
                                                value={appointmentData.location}
                                                onChange={(e) => setAppointmentData(prev => ({ ...prev, location: e.target.value }))}
                                            />
                                        </div>

                                        <button
                                            onClick={saveAppointment}
                                            className="w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white py-4 rounded-xl font-bold"
                                        >
                                            Enregistrer le rendez-vous
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Formulaire principal */}
                        {/* Formulaire vaccin */}
                        {currentView === 'vaccine-form' && (
                            <div className="space-y-6">
                                <div className="flex items-center justify-between">
                                    <h2 className="text-xl font-bold text-gray-800">💉 Nouveau vaccin</h2>
                                    <button
                                        onClick={() => setCurrentView('medical')}
                                        className="text-gray-500 hover:text-gray-700"
                                    >
                                        <i className="fas fa-times text-xl"></i>
                                    </button>
                                </div>

                                <div className="bg-white/90 rounded-2xl p-6 shadow-xl border border-white/50">
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Nom du vaccin *</label>
                                            <input
                                                type="text"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                placeholder="Ex: DTC-Polio-Hib (1ère injection)"
                                                value={vaccineData.name}
                                                onChange={(e) => setVaccineData(prev => ({ ...prev, name: e.target.value }))}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Date du vaccin *</label>
                                            <input
                                                type="date"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                value={vaccineData.date}
                                                onChange={(e) => setVaccineData(prev => ({ ...prev, date: e.target.value }))}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Prochain rappel</label>
                                            <input
                                                type="text"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                placeholder="Ex: Dans 2 mois"
                                                value={vaccineData.nextDue}
                                                onChange={(e) => setVaccineData(prev => ({ ...prev, nextDue: e.target.value }))}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Notes</label>
                                            <textarea
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                rows="3"
                                                placeholder="Réaction, remarques..."
                                                value={vaccineData.notes}
                                                onChange={(e) => setVaccineData(prev => ({ ...prev, notes: e.target.value }))}
                                            />
                                        </div>

                                        <button
                                            onClick={saveVaccine}
                                            className="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-4 rounded-xl font-bold"
                                        >
                                            Enregistrer le vaccin
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* Formulaire diversification */}
                        {currentView === 'diversification-form' && (
                            <div className="space-y-6">
                                <div className="flex items-center justify-between">
                                    <h2 className="text-xl font-bold text-gray-800">🥄 Nouvel aliment testé</h2>
                                    <button
                                        onClick={() => setCurrentView('food')}
                                        className="text-gray-500 hover:text-gray-700"
                                    >
                                        <i className="fas fa-times text-xl"></i>
                                    </button>
                                </div>

                                <div className="bg-white/90 rounded-2xl p-6 shadow-xl border border-white/50">
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Aliment testé *</label>
                                            <input
                                                type="text"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                placeholder="Ex: Carotte, Pomme, Courgette..."
                                                value={diversificationData.food}
                                                onChange={(e) => setDiversificationData(prev => ({ ...prev, food: e.target.value }))}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Date du test *</label>
                                            <input
                                                type="date"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                value={diversificationData.date}
                                                onChange={(e) => setDiversificationData(prev => ({ ...prev, date: e.target.value }))}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                Réaction du bébé (sur 10) *
                                            </label>
                                            <div className="flex items-center gap-2 mb-2">
                                                <input
                                                    type="range"
                                                    min="1"
                                                    max="10"
                                                    className="flex-1"
                                                    value={diversificationData.rating}
                                                    onChange={(e) => setDiversificationData(prev => ({ ...prev, rating: e.target.value }))}
                                                />
                                                <span className="text-lg font-bold text-gray-700 min-w-[3rem]">
                                                    {diversificationData.rating}/10
                                                </span>
                                            </div>
                                            <div className="flex justify-between text-xs text-gray-500">
                                                <span>😣 Refus total</span>
                                                <span>😋 Adoré</span>
                                            </div>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Notes</label>
                                            <textarea
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                rows="3"
                                                placeholder="Texture donnée, réaction, quantité mangée, allergies..."
                                                value={diversificationData.notes}
                                                onChange={(e) => setDiversificationData(prev => ({ ...prev, notes: e.target.value }))}
                                            />
                                        </div>

                                        <button
                                            onClick={saveDiversificationEntry}
                                            className="w-full bg-gradient-to-r from-orange-500 to-orange-600 text-white py-4 rounded-xl font-bold"
                                        >
                                            Enregistrer le test
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* Formulaire garde-robe */}
                        {currentView === 'wardrobe-form' && (
                            <div className="space-y-6">
                                <div className="flex items-center justify-between">
                                    <h2 className="text-xl font-bold text-gray-800">👕 Nouvel article</h2>
                                    <button
                                        onClick={() => setCurrentView('wardrobe')}
                                        className="text-gray-500 hover:text-gray-700"
                                    >
                                        <i className="fas fa-times text-xl"></i>
                                    </button>
                                </div>

                                <div className="bg-white/90 rounded-2xl p-6 shadow-xl border border-white/50">
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Type de vêtement *</label>
                                            <select
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                value={wardrobeData.type}
                                                onChange={(e) => setWardrobeData(prev => ({ ...prev, type: e.target.value }))}
                                            >
                                                <option value="">Choisir...</option>
                                                <option value="Body">Body</option>
                                                <option value="Pyjama">Pyjama</option>
                                                <option value="T-shirt">T-shirt</option>
                                                <option value="Pantalon">Pantalon</option>
                                                <option value="Robe">Robe</option>
                                                <option value="Chaussettes">Chaussettes</option>
                                                <option value="Bonnet">Bonnet</option>
                                                <option value="Gilet">Gilet</option>
                                                <option value="Autre">Autre</option>
                                            </select>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Taille *</label>
                                            <select
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                value={wardrobeData.size}
                                                onChange={(e) => setWardrobeData(prev => ({ ...prev, size: e.target.value }))}
                                            >
                                                <option value="">Choisir...</option>
                                                <option value="Naissance">Naissance</option>
                                                <option value="1 mois">1 mois</option>
                                                <option value="3 mois">3 mois</option>
                                                <option value="6 mois">6 mois</option>
                                                <option value="9 mois">9 mois</option>
                                                <option value="12 mois">12 mois</option>
                                                <option value="18 mois">18 mois</option>
                                                <option value="2 ans">2 ans</option>
                                                <option value="3 ans">3 ans</option>
                                            </select>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Quantité</label>
                                            <input
                                                type="number"
                                                min="1"
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                value={wardrobeData.quantity}
                                                onChange={(e) => setWardrobeData(prev => ({ ...prev, quantity: e.target.value }))}
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Notes</label>
                                            <textarea
                                                className="w-full px-4 py-3 rounded-xl border-2 border-gray-200"
                                                rows="3"
                                                placeholder="Couleur, marque, état..."
                                                value={wardrobeData.notes}
                                                onChange={(e) => setWardrobeData(prev => ({ ...prev, notes: e.target.value }))}
                                            />
                                        </div>

                                        <button
                                            onClick={saveWardrobeItem}
                                            className="w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white py-4 rounded-xl font-bold"
                                        >
                                            Ajouter à la garde-robe
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* Formulaire principal biberon/couche */}
                        {showForm && (
                            <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-end sm:items-center justify-center p-0 sm:p-4 z-50">
                                <div className="bg-white w-full sm:max-w-md sm:rounded-3xl rounded-t-3xl max-h-[90vh] overflow-y-auto relative">
                                    {/* Header du formulaire */}
                                    <div className={`sticky top-0 bg-gradient-to-r ${themeColors.primary} text-white p-6 rounded-t-3xl z-10`}>
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center gap-3">
                                                <div className="w-12 h-12 bg-white/20 rounded-2xl flex items-center justify-center">
                                                    {formType === 'feeding' ? (
                                                        <i className="fas fa-bottle-water text-xl"></i>
                                                    ) : (
                                                        <i className="fas fa-baby text-xl"></i>
                                                    )}
                                                </div>
                                                <div>
                                                    <h3 className="text-xl font-bold">
                                                        {formType === 'feeding' ? 'Nouveau biberon' : 'Nouveau change'}
                                                    </h3>
                                                    <p className="text-sm opacity-80">
                                                        {editingId ? 'Modifier l\'entrée' : 'Ajouter une nouvelle entrée'}
                                                    </p>
                                                </div>
                                            </div>
                                            <button
                                                onClick={closeForm}
                                                className="w-10 h-10 rounded-2xl bg-white/20 flex items-center justify-center active:scale-95 transition-transform"
                                            >
                                                <i className="fas fa-times text-lg"></i>
                                            </button>
                                        </div>
                                    </div>

                                    {/* Contenu du formulaire */}
                                    <div className="p-6 space-y-6">
                                        {/* Date et heure */}
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                    Date *
                                                </label>
                                                <div className="relative">
                                                    <input
                                                        type="date"
                                                        className="w-full px-4 py-3 rounded-2xl border-2 border-gray-200 focus:border-blue-500 focus:outline-none transition-colors"
                                                        value={formData.date}
                                                        onChange={(e) => setFormData(prev => ({ ...prev, date: e.target.value }))}
                                                    />
                                                    <i className="fas fa-calendar absolute right-3 top-4 text-gray-400 text-sm pointer-events-none"></i>
                                                </div>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                    Heure *
                                                </label>
                                                <div className="relative">
                                                    <input
                                                        type="time"
                                                        className="w-full px-4 py-3 rounded-2xl border-2 border-gray-200 focus:border-blue-500 focus:outline-none transition-colors"
                                                        value={formData.time}
                                                        onChange={(e) => setFormData(prev => ({ ...prev, time: e.target.value }))}
                                                    />
                                                    <i className="fas fa-clock absolute right-3 top-4 text-gray-400 text-sm pointer-events-none"></i>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Formulaire biberon */}
                                        {formType === 'feeding' && (
                                            <div className="space-y-4">
                                                <div>
                                                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                        Quantité (ml) *
                                                    </label>
                                                    <div className="relative">
                                                        <input
                                                            type="number"
                                                            placeholder="120"
                                                            className="w-full px-4 py-3 pr-12 rounded-2xl border-2 border-gray-200 focus:border-blue-500 focus:outline-none text-lg font-bold text-center transition-colors"
                                                            value={formData.amount}
                                                            onChange={(e) => setFormData(prev => ({ ...prev, amount: e.target.value }))}
                                                        />
                                                        <span className="absolute right-4 top-4 text-gray-500 font-medium">ml</span>
                                                    </div>
                                                </div>

                                                {/* Suggestions rapides */}
                                                {(() => {
                                                    const age = calculateAge();
                                                    const weightCalculation = currentWeight ? calculateMilkByWeight(currentWeight, age) : null;
                                                    const recommendations = getFeedingRecommendations(age);

                                                    const suggestions = [];

                                                    if (weightCalculation) {
                                                        const base = weightCalculation.mlPerFeeding;
                                                        suggestions.push(
                                                            { label: 'Recommandé', value: base, color: 'bg-green-500' },
                                                            { label: '-20ml', value: Math.max(base - 20, 30), color: 'bg-blue-500' },
                                                            { label: '+20ml', value: base + 20, color: 'bg-purple-500' }
                                                        );
                                                    } else if (recommendations) {
                                                        const base = getDefaultAmount(recommendations.volume);
                                                        if (base) {
                                                            suggestions.push(
                                                                { label: 'Moyenne', value: base, color: 'bg-green-500' },
                                                                { label: '-20ml', value: Math.max(base - 20, 30), color: 'bg-blue-500' },
                                                                { label: '+20ml', value: base + 20, color: 'bg-purple-500' }
                                                            );
                                                        }
                                                    }

                                                    return suggestions.length > 0 && (
                                                        <div>
                                                            <p className="text-sm text-gray-600 mb-3">Suggestions rapides :</p>
                                                            <div className="flex gap-2 flex-wrap">
                                                                {suggestions.map((suggestion, index) => (
                                                                    <button
                                                                        key={index}
                                                                        type="button"
                                                                        onClick={() => setFormData(prev => ({ ...prev, amount: suggestion.value.toString() }))}
                                                                        className={`${suggestion.color} text-white px-4 py-2 rounded-xl text-sm font-medium active:scale-95 transition-transform`}
                                                                    >
                                                                        {suggestion.label}
                                                                        <span className="ml-1 opacity-80">({suggestion.value}ml)</span>
                                                                    </button>
                                                                ))}
                                                            </div>
                                                        </div>
                                                    );
                                                })()}
                                            </div>
                                        )}

                                        {/* Formulaire couche */}
                                        {formType === 'diaper' && (
                                            <div className="space-y-6">
                                                {/* Type de change */}
                                                <div>
                                                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                                                        Type de change *
                                                    </label>
                                                    <div className="grid grid-cols-2 gap-3">
                                                        <button
                                                            type="button"
                                                            onClick={() => setFormData(prev => ({ ...prev, hasPee: !prev.hasPee }))}
                                                            className={`p-4 rounded-2xl border-2 transition-all ${formData.hasPee
                                                                ? 'bg-blue-100 border-blue-300 text-blue-800'
                                                                : 'bg-gray-50 border-gray-200 text-gray-600'
                                                                }`}
                                                        >
                                                            <div className="text-2xl mb-2">💧</div>
                                                            <div className="font-semibold">Pipi</div>
                                                        </button>
                                                        <button
                                                            type="button"
                                                            onClick={() => setFormData(prev => ({ ...prev, hasPoop: !prev.hasPoop }))}
                                                            className={`p-4 rounded-2xl border-2 transition-all ${formData.hasPoop
                                                                ? 'bg-orange-100 border-orange-300 text-orange-800'
                                                                : 'bg-gray-50 border-gray-200 text-gray-600'
                                                                }`}
                                                        >
                                                            <div className="text-2xl mb-2">💩</div>
                                                            <div className="font-semibold">Caca</div>
                                                        </button>
                                                    </div>
                                                </div>

                                                {/* Détails caca si sélectionné */}
                                                {formData.hasPoop && (
                                                    <div className="space-y-4 bg-orange-50 rounded-2xl p-4 border border-orange-200">
                                                        <h4 className="font-semibold text-orange-800 mb-3">Détails du caca</h4>

                                                        {/* Quantité */}
                                                        <div>
                                                            <label className="block text-sm font-medium text-orange-700 mb-2">Quantité</label>
                                                            <div className="grid grid-cols-3 gap-2">
                                                                {['peu', 'moyen', 'beaucoup'].map(qty => (
                                                                    <button
                                                                        key={qty}
                                                                        type="button"
                                                                        onClick={() => setFormData(prev => ({ ...prev, poopQuantity: qty }))}
                                                                        className={`p-2 rounded-xl text-sm font-medium border-2 transition-all ${formData.poopQuantity === qty
                                                                            ? 'bg-orange-200 border-orange-400 text-orange-800'
                                                                            : 'bg-white border-orange-200 text-orange-600'
                                                                            }`}
                                                                    >
                                                                        {qty === 'peu' && '🤏'} {qty === 'moyen' && '👌'} {qty === 'beaucoup' && '🙌'}
                                                                        <div className="capitalize">{qty}</div>
                                                                    </button>
                                                                ))}
                                                            </div>
                                                        </div>

                                                        {/* Consistance */}
                                                        <div>
                                                            <label className="block text-sm font-medium text-orange-700 mb-2">Consistance</label>
                                                            <div className="grid grid-cols-2 gap-2">
                                                                {[
                                                                    { value: 'liquide', emoji: '💧', label: 'Liquide' },
                                                                    { value: 'molle', emoji: '🟡', label: 'Molle' },
                                                                    { value: 'normale', emoji: '🟤', label: 'Normale' },
                                                                    { value: 'dure', emoji: '🔴', label: 'Dure' }
                                                                ].map(consistency => (
                                                                    <button
                                                                        key={consistency.value}
                                                                        type="button"
                                                                        onClick={() => setFormData(prev => ({ ...prev, poopConsistency: consistency.value }))}
                                                                        className={`p-2 rounded-xl text-sm font-medium border-2 transition-all ${formData.poopConsistency === consistency.value
                                                                            ? 'bg-orange-200 border-orange-400 text-orange-800'
                                                                            : 'bg-white border-orange-200 text-orange-600'
                                                                            }`}
                                                                    >
                                                                        <div className="text-lg mb-1">{consistency.emoji}</div>
                                                                        <div>{consistency.label}</div>
                                                                    </button>
                                                                ))}
                                                            </div>
                                                        </div>

                                                        {/* Couleur */}
                                                        <div>
                                                            <label className="block text-sm font-medium text-orange-700 mb-2">Couleur</label>
                                                            <div className="grid grid-cols-2 gap-2">
                                                                {[
                                                                    { value: 'jaune', emoji: '🟡', label: 'Jaune' },
                                                                    { value: 'marron', emoji: '🟤', label: 'Marron' },
                                                                    { value: 'vert', emoji: '🟢', label: 'Vert' },
                                                                    { value: 'noir', emoji: '⚫', label: 'Noir' }
                                                                ].map(color => (
                                                                    <button
                                                                        key={color.value}
                                                                        type="button"
                                                                        onClick={() => setFormData(prev => ({ ...prev, poopColor: color.value }))}
                                                                        className={`p-2 rounded-xl text-sm font-medium border-2 transition-all ${formData.poopColor === color.value
                                                                            ? 'bg-orange-200 border-orange-400 text-orange-800'
                                                                            : 'bg-white border-orange-200 text-orange-600'
                                                                            }`}
                                                                    >
                                                                        <div className="text-lg mb-1">{color.emoji}</div>
                                                                        <div>{color.label}</div>
                                                                    </button>
                                                                ))}
                                                            </div>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                    </div>

                                    {/* Footer avec boutons */}
                                    <div className="sticky bottom-0 bg-white border-t border-gray-100 p-6 space-y-3">
                                        <button
                                            onClick={saveEntry}
                                            className={`w-full bg-gradient-to-r ${themeColors.primary} text-white py-4 rounded-2xl font-bold text-lg active:scale-95 transition-transform shadow-lg`}
                                        >
                                            {editingId ? 'Mettre à jour' : 'Enregistrer'}
                                        </button>
                                        <button
                                            onClick={closeForm}
                                            className="w-full bg-gray-100 text-gray-700 py-3 rounded-2xl font-medium active:scale-95 transition-transform"
                                        >
                                            Annuler
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<BabyTracker />, document.getElementById('root'));
    </script>
</body>

</html>